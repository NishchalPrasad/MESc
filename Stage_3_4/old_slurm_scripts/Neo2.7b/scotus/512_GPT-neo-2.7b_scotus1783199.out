Loading tensorflow-gpu/py3/2.11.0
  Loading requirement: cuda/11.2 nccl/2.9.6-1-cuda cudnn/8.1.1.33-cuda gcc/8.5.0
    openmpi/4.1.1-cuda sox/14.4.2
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 02:57:08.199507: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 02:57:08.580248: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 02:57:10.746438: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 02:57:10.748535: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 02:57:10.748555: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 02:57:29.734261: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 02:57:30.268519: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    1layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder (Transf  (None, None, 10240)      503412736 
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 504,725,261
Trainable params: 504,725,261
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder (Transf  (None, None, 10240)      503412736 
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 504,725,261
Trainable params: 504,725,261
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 02:57:32.514510: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 98s - loss: 0.6398 - acc: 0.8170 - precision: 0.8501 - recall: 0.7862 - val_loss: 0.9299 - val_acc: 0.7743 - val_precision: 0.7933 - val_recall: 0.7650 - 98s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8571428571428571, 'recall': 0.9193548387096774, 'f1-score': 0.8871595330739299, 'support': 372}, '1': {'precision': 0.7903225806451613, 'recall': 0.6621621621621622, 'f1-score': 0.7205882352941176, 'support': 222}, '2': {'precision': 0.7978723404255319, 'recall': 0.8522727272727273, 'f1-score': 0.8241758241758241, 'support': 88}, '3': {'precision': 0.8695652173913043, 'recall': 0.39215686274509803, 'f1-score': 0.5405405405405406, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.32142857142857145, 'f1-score': 0.45000000000000007, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.6618075801749271, 'recall': 0.8730769230769231, 'f1-score': 0.7529021558872305, 'support': 260}, '8': {'precision': 0.6062176165803109, 'recall': 0.585, 'f1-score': 0.5954198473282444, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.24096385542168675, 'f1-score': 0.34782608695652173, 'support': 83}, '10': {'precision': 0.8333333333333334, 'recall': 0.3333333333333333, 'f1-score': 0.47619047619047616, 'support': 15}, '11': {'precision': 0.9032258064516129, 'recall': 0.7567567567567568, 'f1-score': 0.823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7546468401486989, 'recall': 0.725, 'f1-score': 0.7395264116575591, 'support': 1400}, 'macro avg': {'precision': 0.7409221024726953, 'recall': 0.5499801019249679, 'f1-score': 0.6083902193809486, 'support': 1400}, 'weighted avg': {'precision': 0.7574837120035892, 'recall': 0.725, 'f1-score': 0.7247165055845001, 'support': 1400}, 'samples avg': {'precision': 0.725, 'recall': 0.725, 'f1-score': 0.725, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9141274238227147, 'recall': 0.9166666666666666, 'f1-score': 0.9153952843273232, 'support': 360}, '1': {'precision': 0.8298969072164949, 'recall': 0.7385321100917431, 'f1-score': 0.7815533980582524, 'support': 218}, '2': {'precision': 0.9074074074074074, 'recall': 0.9074074074074074, 'f1-score': 0.9074074074074074, 'support': 108}, '3': {'precision': 0.90625, 'recall': 0.4142857142857143, 'f1-score': 0.5686274509803921, 'support': 70}, '4': {'precision': 0.8333333333333334, 'recall': 0.6818181818181818, 'f1-score': 0.7499999999999999, 'support': 22}, '5': {'precision': 0.84375, 'recall': 0.7714285714285715, 'f1-score': 0.8059701492537314, 'support': 35}, '6': {'precision': 0.9696969696969697, 'recall': 0.6274509803921569, 'f1-score': 0.761904761904762, 'support': 51}, '7': {'precision': 0.6951672862453532, 'recall': 0.827433628318584, 'f1-score': 0.7555555555555555, 'support': 226}, '8': {'precision': 0.5572139303482587, 'recall': 0.6787878787878788, 'f1-score': 0.6120218579234973, 'support': 165}, '9': {'precision': 0.6607142857142857, 'recall': 0.4457831325301205, 'f1-score': 0.5323741007194244, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.9166666666666666, 'recall': 0.868421052631579, 'f1-score': 0.8918918918918918, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7933333333333333, 'recall': 0.765, 'f1-score': 0.7789090909090909, 'support': 1400}, 'macro avg': {'precision': 0.7718634008039603, 'recall': 0.6609462337418707, 'f1-score': 0.7012334762581207, 'support': 1400}, 'weighted avg': {'precision': 0.8010576795598453, 'recall': 0.765, 'f1-score': 0.773411238439564, 'support': 1400}, 'samples avg': {'precision': 0.765, 'recall': 0.765, 'f1-score': 0.765, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 97s - loss: 0.4160 - acc: 0.8676 - precision: 0.8844 - recall: 0.8570 - val_loss: 1.0308 - val_acc: 0.7743 - val_precision: 0.7913 - val_recall: 0.7693 - 97s/epoch - 19ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8341463414634146, 'recall': 0.9193548387096774, 'f1-score': 0.8746803069053708, 'support': 372}, '1': {'precision': 0.8121546961325967, 'recall': 0.6621621621621622, 'f1-score': 0.7295285359801489, 'support': 222}, '2': {'precision': 0.7766990291262136, 'recall': 0.9090909090909091, 'f1-score': 0.837696335078534, 'support': 88}, '3': {'precision': 0.5576923076923077, 'recall': 0.5686274509803921, 'f1-score': 0.5631067961165048, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.6832298136645962, 'recall': 0.8461538461538461, 'f1-score': 0.7560137457044673, 'support': 260}, '8': {'precision': 0.7278481012658228, 'recall': 0.575, 'f1-score': 0.6424581005586592, 'support': 200}, '9': {'precision': 0.5777777777777777, 'recall': 0.3132530120481928, 'f1-score': 0.40625, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.13333333333333333, 'f1-score': 0.23529411764705882, 'support': 15}, '11': {'precision': 0.8823529411764706, 'recall': 0.8108108108108109, 'f1-score': 0.8450704225352113, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7612712490761271, 'recall': 0.7357142857142858, 'f1-score': 0.7482746095168907, 'support': 1400}, 'macro avg': {'precision': 0.7220725956416872, 'recall': 0.5771686558272546, 'f1-score': 0.610660652944952, 'support': 1400}, 'weighted avg': {'precision': 0.760593022165662, 'recall': 0.7357142857142858, 'f1-score': 0.7352879994059016, 'support': 1400}, 'samples avg': {'precision': 0.7357142857142858, 'recall': 0.7357142857142858, 'f1-score': 0.7357142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9131652661064426, 'recall': 0.9055555555555556, 'f1-score': 0.9093444909344491, 'support': 360}, '1': {'precision': 0.8554913294797688, 'recall': 0.6788990825688074, 'f1-score': 0.7570332480818414, 'support': 218}, '2': {'precision': 0.865546218487395, 'recall': 0.9537037037037037, 'f1-score': 0.9074889867841409, 'support': 108}, '3': {'precision': 0.7068965517241379, 'recall': 0.5857142857142857, 'f1-score': 0.640625, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.8048780487804879, 'recall': 0.9428571428571428, 'f1-score': 0.868421052631579, 'support': 35}, '6': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 51}, '7': {'precision': 0.72, 'recall': 0.7964601769911505, 'f1-score': 0.7563025210084032, 'support': 226}, '8': {'precision': 0.581151832460733, 'recall': 0.6727272727272727, 'f1-score': 0.6235955056179774, 'support': 165}, '9': {'precision': 0.6617647058823529, 'recall': 0.5421686746987951, 'f1-score': 0.5960264900662251, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.35714285714285715, 'f1-score': 0.5263157894736842, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7913299044819986, 'recall': 0.7692857142857142, 'f1-score': 0.7801521187975371, 'support': 1400}, 'macro avg': {'precision': 0.742362527145515, 'recall': 0.6705897022172456, 'f1-score': 0.690586145795566, 'support': 1400}, 'weighted avg': {'precision': 0.792759392675226, 'recall': 0.7692857142857142, 'f1-score': 0.7756480227650948, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 97s - loss: 0.3114 - acc: 0.9012 - precision: 0.9118 - recall: 0.8894 - val_loss: 1.1045 - val_acc: 0.7929 - val_precision: 0.8026 - val_recall: 0.7900 - 97s/epoch - 19ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8027210884353742, 'recall': 0.9516129032258065, 'f1-score': 0.870848708487085, 'support': 372}, '1': {'precision': 0.7745098039215687, 'recall': 0.7117117117117117, 'f1-score': 0.7417840375586854, 'support': 222}, '2': {'precision': 0.7821782178217822, 'recall': 0.8977272727272727, 'f1-score': 0.835978835978836, 'support': 88}, '3': {'precision': 0.71875, 'recall': 0.45098039215686275, 'f1-score': 0.5542168674698795, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.6686390532544378, 'recall': 0.8692307692307693, 'f1-score': 0.7558528428093645, 'support': 260}, '8': {'precision': 0.6956521739130435, 'recall': 0.48, 'f1-score': 0.5680473372781065, 'support': 200}, '9': {'precision': 0.7586206896551724, 'recall': 0.26506024096385544, 'f1-score': 0.3928571428571429, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.8857142857142857, 'recall': 0.8378378378378378, 'f1-score': 0.8611111111111112, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7547445255474453, 'recall': 0.7385714285714285, 'f1-score': 0.7465703971119133, 'support': 1400}, 'macro avg': {'precision': 0.7456867822968094, 'recall': 0.5818693218366557, 'f1-score': 0.6282224745958076, 'support': 1400}, 'weighted avg': {'precision': 0.7559473696784738, 'recall': 0.7385714285714285, 'f1-score': 0.7283055386585393, 'support': 1400}, 'samples avg': {'precision': 0.7385714285714285, 'recall': 0.7385714285714285, 'f1-score': 0.7385714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8831168831168831, 'recall': 0.9444444444444444, 'f1-score': 0.912751677852349, 'support': 360}, '1': {'precision': 0.7909090909090909, 'recall': 0.7981651376146789, 'f1-score': 0.7945205479452055, 'support': 218}, '2': {'precision': 0.8547008547008547, 'recall': 0.9259259259259259, 'f1-score': 0.8888888888888888, 'support': 108}, '3': {'precision': 0.8421052631578947, 'recall': 0.45714285714285713, 'f1-score': 0.5925925925925926, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.875, 'recall': 0.8, 'f1-score': 0.8358208955223881, 'support': 35}, '6': {'precision': 0.9069767441860465, 'recall': 0.7647058823529411, 'f1-score': 0.8297872340425532, 'support': 51}, '7': {'precision': 0.722007722007722, 'recall': 0.827433628318584, 'f1-score': 0.7711340206185567, 'support': 226}, '8': {'precision': 0.6582278481012658, 'recall': 0.6303030303030303, 'f1-score': 0.6439628482972135, 'support': 165}, '9': {'precision': 0.7636363636363637, 'recall': 0.5060240963855421, 'f1-score': 0.608695652173913, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8026124818577649, 'recall': 0.79, 'f1-score': 0.7962562994960404, 'support': 1400}, 'macro avg': {'precision': 0.7637914973437151, 'recall': 0.6875763257079737, 'f1-score': 0.7136324582308663, 'support': 1400}, 'weighted avg': {'precision': 0.7979690600136523, 'recall': 0.79, 'f1-score': 0.7877231187922343, 'support': 1400}, 'samples avg': {'precision': 0.79, 'recall': 0.79, 'f1-score': 0.79, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 97s - loss: 0.2197 - acc: 0.9272 - precision: 0.9351 - recall: 0.9198 - val_loss: 1.2265 - val_acc: 0.7714 - val_precision: 0.7802 - val_recall: 0.7657 - 97s/epoch - 19ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8357487922705314, 'recall': 0.9301075268817204, 'f1-score': 0.8804071246819338, 'support': 372}, '1': {'precision': 0.8181818181818182, 'recall': 0.6486486486486487, 'f1-score': 0.7236180904522613, 'support': 222}, '2': {'precision': 0.8333333333333334, 'recall': 0.8522727272727273, 'f1-score': 0.8426966292134833, 'support': 88}, '3': {'precision': 0.8095238095238095, 'recall': 0.3333333333333333, 'f1-score': 0.4722222222222222, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 24}, '7': {'precision': 0.6196808510638298, 'recall': 0.8961538461538462, 'f1-score': 0.7327044025157232, 'support': 260}, '8': {'precision': 0.6648351648351648, 'recall': 0.605, 'f1-score': 0.6335078534031414, 'support': 200}, '9': {'precision': 0.7297297297297297, 'recall': 0.3253012048192771, 'f1-score': 0.45, 'support': 83}, '10': {'precision': 0.8888888888888888, 'recall': 0.5333333333333333, 'f1-score': 0.6666666666666667, 'support': 15}, '11': {'precision': 0.8378378378378378, 'recall': 0.8378378378378378, 'f1-score': 0.8378378378378378, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7494600431965442, 'recall': 0.7435714285714285, 'f1-score': 0.7465041233416995, 'support': 1400}, 'macro avg': {'precision': 0.7375200173588419, 'recall': 0.5926373366960178, 'f1-score': 0.6383155681103715, 'support': 1400}, 'weighted avg': {'precision': 0.7595277979461276, 'recall': 0.7435714285714285, 'f1-score': 0.7343103100609522, 'support': 1400}, 'samples avg': {'precision': 0.7435714285714285, 'recall': 0.7435714285714285, 'f1-score': 0.7435714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9129213483146067, 'recall': 0.9027777777777778, 'f1-score': 0.9078212290502793, 'support': 360}, '1': {'precision': 0.8690476190476191, 'recall': 0.6697247706422018, 'f1-score': 0.7564766839378239, 'support': 218}, '2': {'precision': 0.9306930693069307, 'recall': 0.8703703703703703, 'f1-score': 0.8995215311004785, 'support': 108}, '3': {'precision': 0.8378378378378378, 'recall': 0.44285714285714284, 'f1-score': 0.5794392523364486, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.90625, 'recall': 0.8285714285714286, 'f1-score': 0.8656716417910447, 'support': 35}, '6': {'precision': 0.9117647058823529, 'recall': 0.6078431372549019, 'f1-score': 0.7294117647058823, 'support': 51}, '7': {'precision': 0.6277602523659306, 'recall': 0.8805309734513275, 'f1-score': 0.7329650092081031, 'support': 226}, '8': {'precision': 0.5693069306930693, 'recall': 0.696969696969697, 'f1-score': 0.6267029972752044, 'support': 165}, '9': {'precision': 0.7647058823529411, 'recall': 0.46987951807228917, 'f1-score': 0.582089552238806, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7802037845705968, 'recall': 0.7657142857142857, 'f1-score': 0.7728911319394376, 'support': 1400}, 'macro avg': {'precision': 0.7581046257144932, 'recall': 0.684163983687887, 'f1-score': 0.7078827166870091, 'support': 1400}, 'weighted avg': {'precision': 0.7972868838277253, 'recall': 0.7657142857142857, 'f1-score': 0.7688985462234534, 'support': 1400}, 'samples avg': {'precision': 0.7657142857142857, 'recall': 0.7657142857142857, 'f1-score': 0.7657142857142857, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 97s - loss: 0.1542 - acc: 0.9440 - precision: 0.9489 - recall: 0.9404 - val_loss: 1.3567 - val_acc: 0.7821 - val_precision: 0.7872 - val_recall: 0.7793 - 97s/epoch - 19ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8369829683698297, 'recall': 0.9247311827956989, 'f1-score': 0.8786717752234993, 'support': 372}, '1': {'precision': 0.8100558659217877, 'recall': 0.6531531531531531, 'f1-score': 0.7231920199501248, 'support': 222}, '2': {'precision': 0.7916666666666666, 'recall': 0.8636363636363636, 'f1-score': 0.8260869565217391, 'support': 88}, '3': {'precision': 0.5952380952380952, 'recall': 0.49019607843137253, 'f1-score': 0.5376344086021505, 'support': 51}, '4': {'precision': 0.65, 'recall': 0.4642857142857143, 'f1-score': 0.5416666666666667, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.5825242718446602, 'recall': 0.9230769230769231, 'f1-score': 0.7142857142857142, 'support': 260}, '8': {'precision': 0.7674418604651163, 'recall': 0.495, 'f1-score': 0.601823708206687, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.1686746987951807, 'f1-score': 0.27184466019417475, 'support': 83}, '10': {'precision': 0.8888888888888888, 'recall': 0.5333333333333333, 'f1-score': 0.6666666666666667, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7386281588447653, 'recall': 0.7307142857142858, 'f1-score': 0.7346499102333931, 'support': 1400}, 'macro avg': {'precision': 0.7161768167226957, 'recall': 0.5941505447575355, 'f1-score': 0.6282424676479241, 'support': 1400}, 'weighted avg': {'precision': 0.7539138514985653, 'recall': 0.7307142857142858, 'f1-score': 0.7177638518169425, 'support': 1400}, 'samples avg': {'precision': 0.7307142857142858, 'recall': 0.7307142857142858, 'f1-score': 0.7307142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9136490250696379, 'recall': 0.9111111111111111, 'f1-score': 0.9123783031988875, 'support': 360}, '1': {'precision': 0.8473684210526315, 'recall': 0.7385321100917431, 'f1-score': 0.7892156862745098, 'support': 218}, '2': {'precision': 0.8785046728971962, 'recall': 0.8703703703703703, 'f1-score': 0.8744186046511628, 'support': 108}, '3': {'precision': 0.7692307692307693, 'recall': 0.5714285714285714, 'f1-score': 0.6557377049180327, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.8723404255319149, 'recall': 0.803921568627451, 'f1-score': 0.8367346938775511, 'support': 51}, '7': {'precision': 0.5894428152492669, 'recall': 0.8893805309734514, 'f1-score': 0.7089947089947091, 'support': 226}, '8': {'precision': 0.7183098591549296, 'recall': 0.6181818181818182, 'f1-score': 0.6644951140065147, 'support': 165}, '9': {'precision': 0.7837837837837838, 'recall': 0.3493975903614458, 'f1-score': 0.4833333333333334, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7871572871572872, 'recall': 0.7792857142857142, 'f1-score': 0.7832017229002154, 'support': 1400}, 'macro avg': {'precision': 0.7534183720615224, 'recall': 0.7070166428774669, 'f1-score': 0.7194906403610228, 'support': 1400}, 'weighted avg': {'precision': 0.7979267563251702, 'recall': 0.7792857142857142, 'f1-score': 0.7769189066300779, 'support': 1400}, 'samples avg': {'precision': 0.7792857142857142, 'recall': 0.7792857142857142, 'f1-score': 0.7792857142857142, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 03:06:43.798542: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:06:44.076990: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 03:06:46.981665: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:06:46.981866: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:06:46.981881: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 03:07:04.959133: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:07:05.469392: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    2layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 10240)       0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 1,008,137,997
Trainable params: 1,008,137,997
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 10240)       0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 1,008,137,997
Trainable params: 1,008,137,997
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 03:07:08.397150: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 193s - loss: 0.7978 - acc: 0.7810 - precision: 0.8327 - recall: 0.7406 - val_loss: 1.0251 - val_acc: 0.7614 - val_precision: 0.7820 - val_recall: 0.7457 - 193s/epoch - 39ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8521303258145363, 'recall': 0.9139784946236559, 'f1-score': 0.8819714656290533, 'support': 372}, '1': {'precision': 0.8121546961325967, 'recall': 0.6621621621621622, 'f1-score': 0.7295285359801489, 'support': 222}, '2': {'precision': 0.8085106382978723, 'recall': 0.8636363636363636, 'f1-score': 0.8351648351648351, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.17647058823529413, 'f1-score': 0.3, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5833333333333334, 'f1-score': 0.7368421052631579, 'support': 24}, '7': {'precision': 0.6785714285714286, 'recall': 0.8769230769230769, 'f1-score': 0.7651006711409396, 'support': 260}, '8': {'precision': 0.6030927835051546, 'recall': 0.585, 'f1-score': 0.5939086294416243, 'support': 200}, '9': {'precision': 0.5531914893617021, 'recall': 0.3132530120481928, 'f1-score': 0.4, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.2, 'f1-score': 0.33333333333333337, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7574626865671642, 'recall': 0.725, 'f1-score': 0.740875912408759, 'support': 1400}, 'macro avg': {'precision': 0.7590000077830067, 'recall': 0.5504412237692139, 'f1-score': 0.599798932269944, 'support': 1400}, 'weighted avg': {'precision': 0.7657660535275652, 'recall': 0.725, 'f1-score': 0.7242487983937343, 'support': 1400}, 'samples avg': {'precision': 0.725, 'recall': 0.725, 'f1-score': 0.725, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9120879120879121, 'recall': 0.9222222222222223, 'f1-score': 0.9171270718232044, 'support': 360}, '1': {'precision': 0.8514285714285714, 'recall': 0.6834862385321101, 'f1-score': 0.7582697201017812, 'support': 218}, '2': {'precision': 0.9230769230769231, 'recall': 0.8888888888888888, 'f1-score': 0.9056603773584906, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.15714285714285714, 'f1-score': 0.271604938271605, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8, 'recall': 0.9142857142857143, 'f1-score': 0.8533333333333333, 'support': 35}, '6': {'precision': 0.9714285714285714, 'recall': 0.6666666666666666, 'f1-score': 0.7906976744186046, 'support': 51}, '7': {'precision': 0.726530612244898, 'recall': 0.7876106194690266, 'f1-score': 0.7558386411889597, 'support': 226}, '8': {'precision': 0.5161290322580645, 'recall': 0.6787878787878788, 'f1-score': 0.5863874345549739, 'support': 165}, '9': {'precision': 0.5783132530120482, 'recall': 0.5783132530120482, 'f1-score': 0.5783132530120482, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.21428571428571427, 'f1-score': 0.35294117647058826, 'support': 14}, '11': {'precision': 0.868421052631579, 'recall': 0.868421052631579, 'f1-score': 0.868421052631579, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7820224719101123, 'recall': 0.7457142857142857, 'f1-score': 0.7634369287020111, 'support': 1400}, 'macro avg': {'precision': 0.7651858406283514, 'recall': 0.6221064487074949, 'f1-score': 0.6461922642361485, 'support': 1400}, 'weighted avg': {'precision': 0.8022538931772638, 'recall': 0.7457142857142857, 'f1-score': 0.751972142983611, 'support': 1400}, 'samples avg': {'precision': 0.7457142857142857, 'recall': 0.7457142857142857, 'f1-score': 0.7457142857142857, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 191s - loss: 0.5801 - acc: 0.8450 - precision: 0.8727 - recall: 0.8106 - val_loss: 1.0065 - val_acc: 0.7864 - val_precision: 0.8116 - val_recall: 0.7721 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8618925831202046, 'recall': 0.9059139784946236, 'f1-score': 0.8833551769331586, 'support': 372}, '1': {'precision': 0.8092783505154639, 'recall': 0.7072072072072072, 'f1-score': 0.7548076923076924, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.5686274509803921, 'recall': 0.5686274509803921, 'f1-score': 0.5686274509803921, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.5357142857142857, 'f1-score': 0.6122448979591837, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.7620817843866171, 'recall': 0.7884615384615384, 'f1-score': 0.775047258979206, 'support': 260}, '8': {'precision': 0.6612021857923497, 'recall': 0.605, 'f1-score': 0.6318537859007832, 'support': 200}, '9': {'precision': 0.6744186046511628, 'recall': 0.3493975903614458, 'f1-score': 0.46031746031746035, 'support': 83}, '10': {'precision': 0.8, 'recall': 0.8, 'f1-score': 0.8000000000000002, 'support': 15}, '11': {'precision': 0.775, 'recall': 0.8378378378378378, 'f1-score': 0.8051948051948051, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7820224719101123, 'recall': 0.7457142857142857, 'f1-score': 0.7634369287020111, 'support': 1400}, 'macro avg': {'precision': 0.7105225913841722, 'recall': 0.6492619906432419, 'f1-score': 0.6729685681319644, 'support': 1400}, 'weighted avg': {'precision': 0.7754302091997619, 'recall': 0.7457142857142857, 'f1-score': 0.7560203311401276, 'support': 1400}, 'samples avg': {'precision': 0.7457142857142857, 'recall': 0.7457142857142857, 'f1-score': 0.7457142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9250720461095101, 'recall': 0.8916666666666667, 'f1-score': 0.9080622347949081, 'support': 360}, '1': {'precision': 0.8702702702702703, 'recall': 0.7385321100917431, 'f1-score': 0.7990074441687346, 'support': 218}, '2': {'precision': 0.9074074074074074, 'recall': 0.9074074074074074, 'f1-score': 0.9074074074074074, 'support': 108}, '3': {'precision': 0.7222222222222222, 'recall': 0.5571428571428572, 'f1-score': 0.6290322580645162, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.8888888888888888, 'recall': 0.7843137254901961, 'f1-score': 0.8333333333333334, 'support': 51}, '7': {'precision': 0.8078817733990148, 'recall': 0.7256637168141593, 'f1-score': 0.7645687645687645, 'support': 226}, '8': {'precision': 0.572139303482587, 'recall': 0.696969696969697, 'f1-score': 0.6284153005464481, 'support': 165}, '9': {'precision': 0.7076923076923077, 'recall': 0.5542168674698795, 'f1-score': 0.6216216216216216, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.7446808510638298, 'recall': 0.9210526315789473, 'f1-score': 0.8235294117647057, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8115615615615616, 'recall': 0.7721428571428571, 'f1-score': 0.7913616398243045, 'support': 1400}, 'macro avg': {'precision': 0.735643102591841, 'recall': 0.7225038534781514, 'f1-score': 0.7251824818429312, 'support': 1400}, 'weighted avg': {'precision': 0.81274621073294, 'recall': 0.7721428571428571, 'f1-score': 0.7889182773241592, 'support': 1400}, 'samples avg': {'precision': 0.7721428571428571, 'recall': 0.7721428571428571, 'f1-score': 0.7721428571428571, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 191s - loss: 0.4969 - acc: 0.8606 - precision: 0.8891 - recall: 0.8336 - val_loss: 1.0151 - val_acc: 0.7807 - val_precision: 0.7963 - val_recall: 0.7679 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8618090452261307, 'recall': 0.9220430107526881, 'f1-score': 0.8909090909090909, 'support': 372}, '1': {'precision': 0.8452380952380952, 'recall': 0.6396396396396397, 'f1-score': 0.7282051282051283, 'support': 222}, '2': {'precision': 0.7878787878787878, 'recall': 0.8863636363636364, 'f1-score': 0.8342245989304813, 'support': 88}, '3': {'precision': 0.6666666666666666, 'recall': 0.5098039215686274, 'f1-score': 0.5777777777777778, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 0.8461538461538461, 'recall': 0.6470588235294118, 'f1-score': 0.7333333333333334, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.7439446366782007, 'recall': 0.8269230769230769, 'f1-score': 0.7832422586520947, 'support': 260}, '8': {'precision': 0.5945945945945946, 'recall': 0.66, 'f1-score': 0.6255924170616114, 'support': 200}, '9': {'precision': 0.6578947368421053, 'recall': 0.30120481927710846, 'f1-score': 0.41322314049586784, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7567567567567568, 'f1-score': 0.8615384615384616, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7756170531039641, 'recall': 0.7407142857142858, 'f1-score': 0.7577639751552795, 'support': 1400}, 'macro avg': {'precision': 0.7452608411995552, 'recall': 0.60300610762282, 'f1-score': 0.6554206511920244, 'support': 1400}, 'weighted avg': {'precision': 0.777186752167796, 'recall': 0.7407142857142858, 'f1-score': 0.7489725949161065, 'support': 1400}, 'samples avg': {'precision': 0.7407142857142858, 'recall': 0.7407142857142858, 'f1-score': 0.7407142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9277456647398844, 'recall': 0.8916666666666667, 'f1-score': 0.9093484419263456, 'support': 360}, '1': {'precision': 0.9119496855345912, 'recall': 0.6651376146788991, 'f1-score': 0.7692307692307694, 'support': 218}, '2': {'precision': 0.8918918918918919, 'recall': 0.9166666666666666, 'f1-score': 0.9041095890410958, 'support': 108}, '3': {'precision': 0.7924528301886793, 'recall': 0.6, 'f1-score': 0.6829268292682927, 'support': 70}, '4': {'precision': 0.72, 'recall': 0.8181818181818182, 'f1-score': 0.7659574468085107, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.9705882352941176, 'recall': 0.6470588235294118, 'f1-score': 0.7764705882352942, 'support': 51}, '7': {'precision': 0.8009049773755657, 'recall': 0.7831858407079646, 'f1-score': 0.7919463087248323, 'support': 226}, '8': {'precision': 0.46875, 'recall': 0.7272727272727273, 'f1-score': 0.5700712589073634, 'support': 165}, '9': {'precision': 0.7377049180327869, 'recall': 0.5421686746987951, 'f1-score': 0.625, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7962962962962963, 'recall': 0.7678571428571429, 'f1-score': 0.7818181818181819, 'support': 1400}, 'macro avg': {'precision': 0.7672393657831591, 'recall': 0.7058693260321529, 'f1-score': 0.7273816611613586, 'support': 1400}, 'weighted avg': {'precision': 0.8196960412437229, 'recall': 0.7678571428571429, 'f1-score': 0.7844651300553155, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 191s - loss: 0.4323 - acc: 0.8762 - precision: 0.9017 - recall: 0.8550 - val_loss: 1.1194 - val_acc: 0.8064 - val_precision: 0.8211 - val_recall: 0.8000 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8100686498855835, 'recall': 0.9516129032258065, 'f1-score': 0.8751545117428925, 'support': 372}, '1': {'precision': 0.7815533980582524, 'recall': 0.7252252252252253, 'f1-score': 0.7523364485981308, 'support': 222}, '2': {'precision': 0.8505747126436781, 'recall': 0.8409090909090909, 'f1-score': 0.8457142857142856, 'support': 88}, '3': {'precision': 0.7272727272727273, 'recall': 0.47058823529411764, 'f1-score': 0.5714285714285714, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.5, 'f1-score': 0.5714285714285715, 'support': 28}, '5': {'precision': 0.65, 'recall': 0.7647058823529411, 'f1-score': 0.7027027027027027, 'support': 17}, '6': {'precision': 0.9, 'recall': 0.75, 'f1-score': 0.8181818181818182, 'support': 24}, '7': {'precision': 0.722972972972973, 'recall': 0.823076923076923, 'f1-score': 0.7697841726618705, 'support': 260}, '8': {'precision': 0.7388535031847133, 'recall': 0.58, 'f1-score': 0.6498599439775911, 'support': 200}, '9': {'precision': 0.6739130434782609, 'recall': 0.37349397590361444, 'f1-score': 0.4806201550387596, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7761413843888071, 'recall': 0.7528571428571429, 'f1-score': 0.7643219724437998, 'support': 1400}, 'macro avg': {'precision': 0.7324519749356042, 'recall': 0.6186673306962139, 'f1-score': 0.6597394888760183, 'support': 1400}, 'weighted avg': {'precision': 0.7727049991537143, 'recall': 0.7528571428571429, 'f1-score': 0.7538464807069158, 'support': 1400}, 'samples avg': {'precision': 0.7528571428571429, 'recall': 0.7528571428571429, 'f1-score': 0.7528571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8851174934725848, 'recall': 0.9416666666666667, 'f1-score': 0.9125168236877522, 'support': 360}, '1': {'precision': 0.845771144278607, 'recall': 0.7798165137614679, 'f1-score': 0.81145584725537, 'support': 218}, '2': {'precision': 0.95, 'recall': 0.8796296296296297, 'f1-score': 0.9134615384615385, 'support': 108}, '3': {'precision': 0.8367346938775511, 'recall': 0.5857142857142857, 'f1-score': 0.689075630252101, 'support': 70}, '4': {'precision': 0.72, 'recall': 0.8181818181818182, 'f1-score': 0.7659574468085107, 'support': 22}, '5': {'precision': 0.8205128205128205, 'recall': 0.9142857142857143, 'f1-score': 0.8648648648648648, 'support': 35}, '6': {'precision': 0.9565217391304348, 'recall': 0.8627450980392157, 'f1-score': 0.9072164948453608, 'support': 51}, '7': {'precision': 0.7652173913043478, 'recall': 0.7787610619469026, 'f1-score': 0.7719298245614037, 'support': 226}, '8': {'precision': 0.6529411764705882, 'recall': 0.6727272727272727, 'f1-score': 0.6626865671641792, 'support': 165}, '9': {'precision': 0.6666666666666666, 'recall': 0.6024096385542169, 'f1-score': 0.6329113924050633, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.9411764705882353, 'recall': 0.8421052631578947, 'f1-score': 0.8888888888888888, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8211143695014663, 'recall': 0.8, 'f1-score': 0.8104196816208394, 'support': 1400}, 'macro avg': {'precision': 0.7723584304847566, 'recall': 0.7334758322929187, 'f1-score': 0.7495417109439966, 'support': 1400}, 'weighted avg': {'precision': 0.8166463263257231, 'recall': 0.8, 'f1-score': 0.8062241936009765, 'support': 1400}, 'samples avg': {'precision': 0.8, 'recall': 0.8, 'f1-score': 0.8, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 191s - loss: 0.3714 - acc: 0.8920 - precision: 0.9104 - recall: 0.8738 - val_loss: 1.3520 - val_acc: 0.7864 - val_precision: 0.7994 - val_recall: 0.7800 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8401937046004843, 'recall': 0.9327956989247311, 'f1-score': 0.8840764331210191, 'support': 372}, '1': {'precision': 0.775609756097561, 'recall': 0.7162162162162162, 'f1-score': 0.7447306791569087, 'support': 222}, '2': {'precision': 0.8105263157894737, 'recall': 0.875, 'f1-score': 0.8415300546448087, 'support': 88}, '3': {'precision': 0.627906976744186, 'recall': 0.5294117647058824, 'f1-score': 0.5744680851063829, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 0.8181818181818182, 'recall': 0.5294117647058824, 'f1-score': 0.6428571428571428, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.6934984520123839, 'recall': 0.8615384615384616, 'f1-score': 0.7684391080617495, 'support': 260}, '8': {'precision': 0.6810810810810811, 'recall': 0.63, 'f1-score': 0.6545454545454545, 'support': 200}, '9': {'precision': 0.6451612903225806, 'recall': 0.24096385542168675, 'f1-score': 0.3508771929824561, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7649635036496351, 'recall': 0.7485714285714286, 'f1-score': 0.7566787003610108, 'support': 1400}, 'macro avg': {'precision': 0.7383109036746729, 'recall': 0.571690173319027, 'f1-score': 0.6236798656184633, 'support': 1400}, 'weighted avg': {'precision': 0.7627392808543713, 'recall': 0.7485714285714286, 'f1-score': 0.7431624430636816, 'support': 1400}, 'samples avg': {'precision': 0.7485714285714286, 'recall': 0.7485714285714286, 'f1-score': 0.7485714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9098591549295775, 'recall': 0.8972222222222223, 'f1-score': 0.9034965034965036, 'support': 360}, '1': {'precision': 0.8316326530612245, 'recall': 0.7477064220183486, 'f1-score': 0.78743961352657, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.9166666666666666, 'f1-score': 0.908256880733945, 'support': 108}, '3': {'precision': 0.7307692307692307, 'recall': 0.5428571428571428, 'f1-score': 0.6229508196721311, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8235294117647058, 'recall': 0.8, 'f1-score': 0.8115942028985507, 'support': 35}, '6': {'precision': 0.9736842105263158, 'recall': 0.7254901960784313, 'f1-score': 0.8314606741573034, 'support': 51}, '7': {'precision': 0.7245283018867924, 'recall': 0.8495575221238938, 'f1-score': 0.7820773930753564, 'support': 226}, '8': {'precision': 0.5969387755102041, 'recall': 0.7090909090909091, 'f1-score': 0.6481994459833795, 'support': 165}, '9': {'precision': 0.6909090909090909, 'recall': 0.4578313253012048, 'f1-score': 0.5507246376811594, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.9411764705882353, 'recall': 0.8421052631578947, 'f1-score': 0.8888888888888888, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7994143484626647, 'recall': 0.78, 'f1-score': 0.789587852494577, 'support': 1400}, 'macro avg': {'precision': 0.7586275180559988, 'recall': 0.6794371933594275, 'f1-score': 0.7090705648416977, 'support': 1400}, 'weighted avg': {'precision': 0.8009212918736224, 'recall': 0.78, 'f1-score': 0.7853025225135452, 'support': 1400}, 'samples avg': {'precision': 0.78, 'recall': 0.78, 'f1-score': 0.78, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 03:24:15.626150: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:24:15.868115: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 03:24:17.321124: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:24:17.321320: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:24:17.321334: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 03:24:25.374822: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:24:25.900753: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    3layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 10240)       0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 10240)       0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 1,511,550,733
Trainable params: 1,511,550,733
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 10240)]     0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 10240)       0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 10240)       0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 10240)      503412736 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 10240)            0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 10240)             0         
                                                                 
 dense (Dense)               (None, 128)               1310848   
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 1,511,550,733
Trainable params: 1,511,550,733
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 03:24:29.157621: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 286s - loss: 0.8680 - acc: 0.7632 - precision: 0.8190 - recall: 0.7212 - val_loss: 1.0751 - val_acc: 0.7564 - val_precision: 0.7783 - val_recall: 0.7321 - 286s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8325358851674641, 'recall': 0.9354838709677419, 'f1-score': 0.8810126582278481, 'support': 372}, '1': {'precision': 0.8581560283687943, 'recall': 0.545045045045045, 'f1-score': 0.6666666666666666, 'support': 222}, '2': {'precision': 0.79, 'recall': 0.8977272727272727, 'f1-score': 0.8404255319148937, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.29411764705882354, 'f1-score': 0.45454545454545453, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.2857142857142857, 'f1-score': 0.4210526315789473, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.9411764705882353, 'recall': 0.6666666666666666, 'f1-score': 0.7804878048780487, 'support': 24}, '7': {'precision': 0.740484429065744, 'recall': 0.823076923076923, 'f1-score': 0.7795992714025501, 'support': 260}, '8': {'precision': 0.5991379310344828, 'recall': 0.695, 'f1-score': 0.6435185185185185, 'support': 200}, '9': {'precision': 0.5526315789473685, 'recall': 0.25301204819277107, 'f1-score': 0.347107438016529, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.13333333333333333, 'f1-score': 0.23529411764705882, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7684049079754601, 'recall': 0.7157142857142857, 'f1-score': 0.7411242603550297, 'support': 1400}, 'macro avg': {'precision': 0.7626247940901607, 'recall': 0.5357530134964438, 'f1-score': 0.5879584687228089, 'support': 1400}, 'weighted avg': {'precision': 0.7782458440649345, 'recall': 0.7157142857142857, 'f1-score': 0.722217677314869, 'support': 1400}, 'samples avg': {'precision': 0.7157142857142857, 'recall': 0.7157142857142857, 'f1-score': 0.7157142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9105691056910569, 'recall': 0.9333333333333333, 'f1-score': 0.9218106995884775, 'support': 360}, '1': {'precision': 0.936, 'recall': 0.536697247706422, 'f1-score': 0.6822157434402332, 'support': 218}, '2': {'precision': 0.8771929824561403, 'recall': 0.9259259259259259, 'f1-score': 0.9009009009009009, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.2571428571428571, 'f1-score': 0.40909090909090906, 'support': 70}, '4': {'precision': 0.9333333333333333, 'recall': 0.6363636363636364, 'f1-score': 0.7567567567567568, 'support': 22}, '5': {'precision': 0.9333333333333333, 'recall': 0.8, 'f1-score': 0.8615384615384616, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7675438596491229, 'recall': 0.7743362831858407, 'f1-score': 0.7709251101321586, 'support': 226}, '8': {'precision': 0.4575645756457565, 'recall': 0.7515151515151515, 'f1-score': 0.5688073394495413, 'support': 165}, '9': {'precision': 0.5714285714285714, 'recall': 0.43373493975903615, 'f1-score': 0.4931506849315068, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.42857142857142855, 'f1-score': 0.6, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7782839787395596, 'recall': 0.7321428571428571, 'f1-score': 0.7545086492454913, 'support': 1400}, 'macro avg': {'precision': 0.7852556696035753, 'recall': 0.6229113724374867, 'f1-score': 0.6674008537371207, 'support': 1400}, 'weighted avg': {'precision': 0.8150890485769199, 'recall': 0.7321428571428571, 'f1-score': 0.7472856463357883, 'support': 1400}, 'samples avg': {'precision': 0.7321428571428571, 'recall': 0.7321428571428571, 'f1-score': 0.7321428571428571, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 283s - loss: 0.6242 - acc: 0.8284 - precision: 0.8672 - recall: 0.7938 - val_loss: 0.9144 - val_acc: 0.7600 - val_precision: 0.7966 - val_recall: 0.7300 - 283s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8864864864864865, 'recall': 0.8817204301075269, 'f1-score': 0.8840970350404314, 'support': 372}, '1': {'precision': 0.7979274611398963, 'recall': 0.6936936936936937, 'f1-score': 0.7421686746987951, 'support': 222}, '2': {'precision': 0.8461538461538461, 'recall': 0.875, 'f1-score': 0.8603351955307262, 'support': 88}, '3': {'precision': 0.8888888888888888, 'recall': 0.3137254901960784, 'f1-score': 0.46376811594202894, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 0.8333333333333334, 'recall': 0.29411764705882354, 'f1-score': 0.4347826086956522, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.72, 'recall': 0.8307692307692308, 'f1-score': 0.7714285714285715, 'support': 260}, '8': {'precision': 0.6367713004484304, 'recall': 0.71, 'f1-score': 0.6713947990543735, 'support': 200}, '9': {'precision': 0.6, 'recall': 0.18072289156626506, 'f1-score': 0.2777777777777778, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.06666666666666667, 'f1-score': 0.125, 'support': 15}, '11': {'precision': 0.9642857142857143, 'recall': 0.7297297297297297, 'f1-score': 0.8307692307692307, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7842679127725857, 'recall': 0.7192857142857143, 'f1-score': 0.7503725782414308, 'support': 1400}, 'macro avg': {'precision': 0.7661201012654524, 'recall': 0.5072309940496275, 'f1-score': 0.5657355616906061, 'support': 1400}, 'weighted avg': {'precision': 0.7870765995184471, 'recall': 0.7192857142857143, 'f1-score': 0.7314615206359086, 'support': 1400}, 'samples avg': {'precision': 0.7192857142857143, 'recall': 0.7192857142857143, 'f1-score': 0.7192857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9402985074626866, 'recall': 0.875, 'f1-score': 0.9064748201438849, 'support': 360}, '1': {'precision': 0.8715083798882681, 'recall': 0.7155963302752294, 'f1-score': 0.7858942065491185, 'support': 218}, '2': {'precision': 0.9047619047619048, 'recall': 0.8796296296296297, 'f1-score': 0.892018779342723, 'support': 108}, '3': {'precision': 0.9166666666666666, 'recall': 0.3142857142857143, 'f1-score': 0.4680851063829787, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 1.0, 'recall': 0.34285714285714286, 'f1-score': 0.5106382978723404, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7685589519650655, 'recall': 0.7787610619469026, 'f1-score': 0.7736263736263737, 'support': 226}, '8': {'precision': 0.49609375, 'recall': 0.7696969696969697, 'f1-score': 0.6033254156769596, 'support': 165}, '9': {'precision': 0.6666666666666666, 'recall': 0.3373493975903614, 'f1-score': 0.4479999999999999, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.35714285714285715, 'f1-score': 0.5263157894736842, 'support': 14}, '11': {'precision': 0.8918918918918919, 'recall': 0.868421052631579, 'f1-score': 0.88, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7965705378020265, 'recall': 0.73, 'f1-score': 0.761833768169959, 'support': 1400}, 'macro avg': {'precision': 0.7882903563524832, 'recall': 0.5916540830313495, 'f1-score': 0.6460558934734629, 'support': 1400}, 'weighted avg': {'precision': 0.82123728914425, 'recall': 0.73, 'f1-score': 0.7540247232358471, 'support': 1400}, 'samples avg': {'precision': 0.73, 'recall': 0.73, 'f1-score': 0.73, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 283s - loss: 0.5352 - acc: 0.8542 - precision: 0.8864 - recall: 0.8242 - val_loss: 1.2216 - val_acc: 0.7607 - val_precision: 0.7743 - val_recall: 0.7521 - 283s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8756756756756757, 'recall': 0.8709677419354839, 'f1-score': 0.8733153638814016, 'support': 372}, '1': {'precision': 0.8206521739130435, 'recall': 0.6801801801801802, 'f1-score': 0.7438423645320198, 'support': 222}, '2': {'precision': 0.8555555555555555, 'recall': 0.875, 'f1-score': 0.8651685393258427, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 0.8333333333333334, 'recall': 0.5882352941176471, 'f1-score': 0.6896551724137931, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 24}, '7': {'precision': 0.7326388888888888, 'recall': 0.8115384615384615, 'f1-score': 0.7700729927007298, 'support': 260}, '8': {'precision': 0.5494505494505495, 'recall': 0.75, 'f1-score': 0.6342494714587739, 'support': 200}, '9': {'precision': 0.696969696969697, 'recall': 0.27710843373493976, 'f1-score': 0.39655172413793105, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.2, 'f1-score': 0.33333333333333337, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7606774668630338, 'recall': 0.7378571428571429, 'f1-score': 0.7490935460478607, 'support': 1400}, 'macro avg': {'precision': 0.7338712533811393, 'recall': 0.5751001633087707, 'f1-score': 0.6179654630744635, 'support': 1400}, 'weighted avg': {'precision': 0.7721287577939479, 'recall': 0.7378571428571429, 'f1-score': 0.7410973213228509, 'support': 1400}, 'samples avg': {'precision': 0.7378571428571429, 'recall': 0.7378571428571429, 'f1-score': 0.7378571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.941717791411043, 'recall': 0.8527777777777777, 'f1-score': 0.8950437317784257, 'support': 360}, '1': {'precision': 0.8700564971751412, 'recall': 0.7064220183486238, 'f1-score': 0.779746835443038, 'support': 218}, '2': {'precision': 0.9223300970873787, 'recall': 0.8796296296296297, 'f1-score': 0.9004739336492891, 'support': 108}, '3': {'precision': 0.8333333333333334, 'recall': 0.5, 'f1-score': 0.625, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.96, 'recall': 0.6857142857142857, 'f1-score': 0.7999999999999999, 'support': 35}, '6': {'precision': 0.8809523809523809, 'recall': 0.7254901960784313, 'f1-score': 0.7956989247311828, 'support': 51}, '7': {'precision': 0.7782608695652173, 'recall': 0.7920353982300885, 'f1-score': 0.7850877192982456, 'support': 226}, '8': {'precision': 0.4379310344827586, 'recall': 0.7696969696969697, 'f1-score': 0.5582417582417581, 'support': 165}, '9': {'precision': 0.6610169491525424, 'recall': 0.46987951807228917, 'f1-score': 0.5492957746478874, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.42857142857142855, 'f1-score': 0.6, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.774264705882353, 'recall': 0.7521428571428571, 'f1-score': 0.7630434782608696, 'support': 1400}, 'macro avg': {'precision': 0.7659209622308166, 'recall': 0.6486328301151935, 'f1-score': 0.6869104597183662, 'support': 1400}, 'weighted avg': {'precision': 0.8087234081728415, 'recall': 0.7521428571428571, 'f1-score': 0.7679951714257917, 'support': 1400}, 'samples avg': {'precision': 0.7521428571428571, 'recall': 0.7521428571428571, 'f1-score': 0.7521428571428571, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 283s - loss: 0.4640 - acc: 0.8724 - precision: 0.8990 - recall: 0.8506 - val_loss: 1.0817 - val_acc: 0.7857 - val_precision: 0.8027 - val_recall: 0.7729 - 283s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8436724565756824, 'recall': 0.9139784946236559, 'f1-score': 0.8774193548387096, 'support': 372}, '1': {'precision': 0.7860696517412935, 'recall': 0.7117117117117117, 'f1-score': 0.7470449172576831, 'support': 222}, '2': {'precision': 0.8279569892473119, 'recall': 0.875, 'f1-score': 0.8508287292817679, 'support': 88}, '3': {'precision': 0.5918367346938775, 'recall': 0.5686274509803921, 'f1-score': 0.58, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9, 'recall': 0.75, 'f1-score': 0.8181818181818182, 'support': 24}, '7': {'precision': 0.7786259541984732, 'recall': 0.7846153846153846, 'f1-score': 0.7816091954022988, 'support': 260}, '8': {'precision': 0.6682464454976303, 'recall': 0.705, 'f1-score': 0.6861313868613138, 'support': 200}, '9': {'precision': 0.6538461538461539, 'recall': 0.40963855421686746, 'f1-score': 0.5037037037037037, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9333333333333333, 'recall': 0.7567567567567568, 'f1-score': 0.835820895522388, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.780559646539028, 'recall': 0.7571428571428571, 'f1-score': 0.7686729514140681, 'support': 1400}, 'macro avg': {'precision': 0.7406836049563771, 'recall': 0.6188843400101276, 'f1-score': 0.6628758433678925, 'support': 1400}, 'weighted avg': {'precision': 0.7777190259029252, 'recall': 0.7571428571428571, 'f1-score': 0.7625058769220795, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.895774647887324, 'recall': 0.8833333333333333, 'f1-score': 0.8895104895104895, 'support': 360}, '1': {'precision': 0.8391959798994975, 'recall': 0.7660550458715596, 'f1-score': 0.8009592326139089, 'support': 218}, '2': {'precision': 0.97, 'recall': 0.8981481481481481, 'f1-score': 0.9326923076923077, 'support': 108}, '3': {'precision': 0.7090909090909091, 'recall': 0.5571428571428572, 'f1-score': 0.6239999999999999, 'support': 70}, '4': {'precision': 0.72, 'recall': 0.8181818181818182, 'f1-score': 0.7659574468085107, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 51}, '7': {'precision': 0.8009708737864077, 'recall': 0.7300884955752213, 'f1-score': 0.763888888888889, 'support': 226}, '8': {'precision': 0.5666666666666667, 'recall': 0.7212121212121212, 'f1-score': 0.6346666666666666, 'support': 165}, '9': {'precision': 0.6619718309859155, 'recall': 0.5662650602409639, 'f1-score': 0.6103896103896105, 'support': 83}, '10': {'precision': 0.8333333333333334, 'recall': 0.7142857142857143, 'f1-score': 0.7692307692307692, 'support': 14}, '11': {'precision': 0.8857142857142857, 'recall': 0.8157894736842105, 'f1-score': 0.8493150684931505, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8026706231454006, 'recall': 0.7728571428571429, 'f1-score': 0.7874818049490538, 'support': 1400}, 'macro avg': {'precision': 0.7425688630072049, 'recall': 0.703807204947277, 'f1-score': 0.7196948066523678, 'support': 1400}, 'weighted avg': {'precision': 0.8051983403806633, 'recall': 0.7728571428571429, 'f1-score': 0.7861559121232845, 'support': 1400}, 'samples avg': {'precision': 0.7728571428571429, 'recall': 0.7728571428571429, 'f1-score': 0.7728571428571429, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 283s - loss: 0.3954 - acc: 0.8978 - precision: 0.9137 - recall: 0.8744 - val_loss: 1.4627 - val_acc: 0.7986 - val_precision: 0.8193 - val_recall: 0.7871 - 283s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.7489539748953975, 'recall': 0.9623655913978495, 'f1-score': 0.8423529411764706, 'support': 372}, '1': {'precision': 0.7192982456140351, 'recall': 0.7387387387387387, 'f1-score': 0.7288888888888888, 'support': 222}, '2': {'precision': 0.7669902912621359, 'recall': 0.8977272727272727, 'f1-score': 0.8272251308900525, 'support': 88}, '3': {'precision': 0.5909090909090909, 'recall': 0.5098039215686274, 'f1-score': 0.5473684210526317, 'support': 51}, '4': {'precision': 0.65, 'recall': 0.4642857142857143, 'f1-score': 0.5416666666666667, 'support': 28}, '5': {'precision': 0.8461538461538461, 'recall': 0.6470588235294118, 'f1-score': 0.7333333333333334, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.7241379310344828, 'recall': 0.7269230769230769, 'f1-score': 0.72552783109405, 'support': 260}, '8': {'precision': 0.8037383177570093, 'recall': 0.43, 'f1-score': 0.5602605863192182, 'support': 200}, '9': {'precision': 0.7666666666666667, 'recall': 0.27710843373493976, 'f1-score': 0.40707964601769914, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7475800446760983, 'recall': 0.7171428571428572, 'f1-score': 0.7320452059788553, 'support': 1400}, 'macro avg': {'precision': 0.7262477787807151, 'recall': 0.5977791300017498, 'f1-score': 0.6406576449087971, 'support': 1400}, 'weighted avg': {'precision': 0.7515102209659221, 'recall': 0.7171428571428572, 'f1-score': 0.7141679025422959, 'support': 1400}, 'samples avg': {'precision': 0.7171428571428572, 'recall': 0.7171428571428572, 'f1-score': 0.7171428571428572, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8389423076923077, 'recall': 0.9694444444444444, 'f1-score': 0.8994845360824743, 'support': 360}, '1': {'precision': 0.7792207792207793, 'recall': 0.8256880733944955, 'f1-score': 0.8017817371937639, 'support': 218}, '2': {'precision': 0.8828828828828829, 'recall': 0.9074074074074074, 'f1-score': 0.8949771689497718, 'support': 108}, '3': {'precision': 0.7924528301886793, 'recall': 0.6, 'f1-score': 0.6829268292682927, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.9090909090909091, 'recall': 0.8571428571428571, 'f1-score': 0.8823529411764706, 'support': 35}, '6': {'precision': 0.9361702127659575, 'recall': 0.8627450980392157, 'f1-score': 0.8979591836734694, 'support': 51}, '7': {'precision': 0.7961165048543689, 'recall': 0.7256637168141593, 'f1-score': 0.7592592592592593, 'support': 226}, '8': {'precision': 0.768, 'recall': 0.5818181818181818, 'f1-score': 0.6620689655172414, 'support': 165}, '9': {'precision': 0.75, 'recall': 0.46987951807228917, 'f1-score': 0.5777777777777777, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8529411764705882, 'recall': 0.7631578947368421, 'f1-score': 0.8055555555555555, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8193308550185874, 'recall': 0.7871428571428571, 'f1-score': 0.8029143897996357, 'support': 1400}, 'macro avg': {'precision': 0.7705382867223136, 'recall': 0.7161308029710107, 'f1-score': 0.7379011833096543, 'support': 1400}, 'weighted avg': {'precision': 0.8098548277717735, 'recall': 0.7871428571428571, 'f1-score': 0.7926744099081533, 'support': 1400}, 'samples avg': {'precision': 0.7871428571428571, 'recall': 0.7871428571428571, 'f1-score': 0.7871428571428571, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 03:49:47.008706: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:49:47.302692: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 03:49:49.135882: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:49:49.136087: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 03:49:49.136102: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 03:50:01.176876: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 03:50:01.700214: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3399500.73it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3189584.79it/s]
Mon May 22 03:50:12 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 03:50:20.756924: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 2:12  8/148 [>.............................] - ETA: 1s   15/148 [==>...........................] - ETA: 1s 23/148 [===>..........................] - ETA: 0s 31/148 [=====>........................] - ETA: 0s 39/148 [======>.......................] - ETA: 0s 47/148 [========>.....................] - ETA: 0s 55/148 [==========>...................] - ETA: 0s 63/148 [===========>..................] - ETA: 0s 71/148 [=============>................] - ETA: 0s 79/148 [===============>..............] - ETA: 0s 87/148 [================>.............] - ETA: 0s 96/148 [==================>...........] - ETA: 0s105/148 [====================>.........] - ETA: 0s114/148 [======================>.......] - ETA: 0s123/148 [=======================>......] - ETA: 0s132/148 [=========================>....] - ETA: 0s141/148 [===========================>..] - ETA: 0s148/148 [==============================] - 2s 6ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2315504.03it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2633195.34it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2748200.76it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 80623.10it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2597092.26it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82034.45it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3075969.41it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2992877.47it/s]
Mon May 22 03:50:29 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 4s 3/44 [=>............................] - ETA: 1s10/44 [=====>........................] - ETA: 0s19/44 [===========>..................] - ETA: 0s28/44 [==================>...........] - ETA: 0s37/44 [========================>.....] - ETA: 0s44/44 [==============================] - 0s 8ms/step
 1/44 [..............................] - ETA: 1s 2/44 [>.............................] - ETA: 2s 9/44 [=====>........................] - ETA: 0s17/44 [==========>...................] - ETA: 0s25/44 [================>.............] - ETA: 0s33/44 [=====================>........] - ETA: 0s41/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 8ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2066886.87it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2276861.42it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2450761.94it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 81535.53it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2475558.85it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82539.51it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               2 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 10240)  503412736  ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 1,008,158,989
Trainable params: 1,008,158,989
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 10240)  503412736  ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 1,008,158,989
Trainable params: 1,008,158,989
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 192s - loss: 0.7406 - acc: 0.7920 - precision: 0.8436 - recall: 0.7496 - val_loss: 0.9167 - val_acc: 0.7671 - val_precision: 0.7860 - val_recall: 0.7450 - 192s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8859416445623343, 'recall': 0.8978494623655914, 'f1-score': 0.8918558077436582, 'support': 372}, '1': {'precision': 0.8125, 'recall': 0.6441441441441441, 'f1-score': 0.7185929648241207, 'support': 222}, '2': {'precision': 0.8444444444444444, 'recall': 0.8636363636363636, 'f1-score': 0.853932584269663, 'support': 88}, '3': {'precision': 0.8823529411764706, 'recall': 0.29411764705882354, 'f1-score': 0.4411764705882352, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.2857142857142857, 'f1-score': 0.4210526315789473, 'support': 28}, '5': {'precision': 0.68, 'recall': 1.0, 'f1-score': 0.8095238095238095, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5, 'f1-score': 0.6666666666666666, 'support': 24}, '7': {'precision': 0.6260162601626016, 'recall': 0.8884615384615384, 'f1-score': 0.7344992050874404, 'support': 260}, '8': {'precision': 0.6687898089171974, 'recall': 0.525, 'f1-score': 0.5882352941176471, 'support': 200}, '9': {'precision': 0.5675675675675675, 'recall': 0.25301204819277107, 'f1-score': 0.35, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7641221374045801, 'recall': 0.715, 'f1-score': 0.7387453874538746, 'support': 1400}, 'macro avg': {'precision': 0.7488734309472682, 'recall': 0.5817497154141791, 'f1-score': 0.6236837211982045, 'support': 1400}, 'weighted avg': {'precision': 0.7726093943107333, 'recall': 0.715, 'f1-score': 0.7228995396451675, 'support': 1400}, 'samples avg': {'precision': 0.715, 'recall': 0.715, 'f1-score': 0.715, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9150141643059491, 'recall': 0.8972222222222223, 'f1-score': 0.906030855539972, 'support': 360}, '1': {'precision': 0.8630952380952381, 'recall': 0.6651376146788991, 'f1-score': 0.7512953367875649, 'support': 218}, '2': {'precision': 0.92, 'recall': 0.8518518518518519, 'f1-score': 0.8846153846153846, 'support': 108}, '3': {'precision': 0.9, 'recall': 0.38571428571428573, 'f1-score': 0.5399999999999999, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.7857142857142857, 'recall': 0.9428571428571428, 'f1-score': 0.8571428571428571, 'support': 35}, '6': {'precision': 0.9615384615384616, 'recall': 0.49019607843137253, 'f1-score': 0.6493506493506493, 'support': 51}, '7': {'precision': 0.6484641638225256, 'recall': 0.8407079646017699, 'f1-score': 0.7321772639691715, 'support': 226}, '8': {'precision': 0.5815217391304348, 'recall': 0.6484848484848484, 'f1-score': 0.6131805157593123, 'support': 165}, '9': {'precision': 0.6666666666666666, 'recall': 0.4819277108433735, 'f1-score': 0.5594405594405594, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.785983421250942, 'recall': 0.745, 'f1-score': 0.7649431609827649, 'support': 1400}, 'macro avg': {'precision': 0.7558738614119911, 'recall': 0.6644459692886205, 'f1-score': 0.6920728085911088, 'support': 1400}, 'weighted avg': {'precision': 0.7983681050078747, 'recall': 0.745, 'f1-score': 0.7582783544562892, 'support': 1400}, 'samples avg': {'precision': 0.745, 'recall': 0.745, 'f1-score': 0.745, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 190s - loss: 0.5451 - acc: 0.8440 - precision: 0.8741 - recall: 0.8182 - val_loss: 0.9184 - val_acc: 0.7893 - val_precision: 0.8001 - val_recall: 0.7807 - 190s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.849009900990099, 'recall': 0.9220430107526881, 'f1-score': 0.884020618556701, 'support': 372}, '1': {'precision': 0.8031914893617021, 'recall': 0.6801801801801802, 'f1-score': 0.7365853658536586, 'support': 222}, '2': {'precision': 0.7843137254901961, 'recall': 0.9090909090909091, 'f1-score': 0.8421052631578948, 'support': 88}, '3': {'precision': 0.8461538461538461, 'recall': 0.43137254901960786, 'f1-score': 0.5714285714285715, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.5714285714285714, 'f1-score': 0.6666666666666666, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.7306397306397306, 'recall': 0.8346153846153846, 'f1-score': 0.7791741472172352, 'support': 260}, '8': {'precision': 0.6323529411764706, 'recall': 0.645, 'f1-score': 0.6386138613861386, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.30120481927710846, 'f1-score': 0.40650406504065045, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7765486725663717, 'recall': 0.7521428571428571, 'f1-score': 0.7641509433962265, 'support': 1400}, 'macro avg': {'precision': 0.7576882851704435, 'recall': 0.6318196627033434, 'f1-score': 0.677527831188542, 'support': 1400}, 'weighted avg': {'precision': 0.774371310344174, 'recall': 0.7521428571428571, 'f1-score': 0.7540562334468626, 'support': 1400}, 'samples avg': {'precision': 0.7521428571428571, 'recall': 0.7521428571428571, 'f1-score': 0.7521428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9141274238227147, 'recall': 0.9166666666666666, 'f1-score': 0.9153952843273232, 'support': 360}, '1': {'precision': 0.872093023255814, 'recall': 0.6880733944954128, 'f1-score': 0.7692307692307693, 'support': 218}, '2': {'precision': 0.8947368421052632, 'recall': 0.9444444444444444, 'f1-score': 0.918918918918919, 'support': 108}, '3': {'precision': 0.8857142857142857, 'recall': 0.44285714285714284, 'f1-score': 0.5904761904761905, 'support': 70}, '4': {'precision': 0.68, 'recall': 0.7727272727272727, 'f1-score': 0.7234042553191491, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.875, 'recall': 0.8235294117647058, 'f1-score': 0.8484848484848485, 'support': 51}, '7': {'precision': 0.7542372881355932, 'recall': 0.7876106194690266, 'f1-score': 0.7705627705627707, 'support': 226}, '8': {'precision': 0.5462962962962963, 'recall': 0.7151515151515152, 'f1-score': 0.6194225721784777, 'support': 165}, '9': {'precision': 0.6911764705882353, 'recall': 0.5662650602409639, 'f1-score': 0.6225165562913907, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8001464128843339, 'recall': 0.7807142857142857, 'f1-score': 0.7903109182935648, 'support': 1400}, 'macro avg': {'precision': 0.7454288163364879, 'recall': 0.720488314169856, 'f1-score': 0.7245396769635526, 'support': 1400}, 'weighted avg': {'precision': 0.8071920418371075, 'recall': 0.7807142857142857, 'f1-score': 0.7866409598432006, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 191s - loss: 0.4585 - acc: 0.8688 - precision: 0.8899 - recall: 0.8436 - val_loss: 1.0756 - val_acc: 0.7757 - val_precision: 0.7899 - val_recall: 0.7679 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8282352941176471, 'recall': 0.946236559139785, 'f1-score': 0.8833124215809286, 'support': 372}, '1': {'precision': 0.8082901554404145, 'recall': 0.7027027027027027, 'f1-score': 0.7518072289156625, 'support': 222}, '2': {'precision': 0.8172043010752689, 'recall': 0.8636363636363636, 'f1-score': 0.8397790055248618, 'support': 88}, '3': {'precision': 0.7931034482758621, 'recall': 0.45098039215686275, 'f1-score': 0.5750000000000001, 'support': 51}, '4': {'precision': 0.8125, 'recall': 0.4642857142857143, 'f1-score': 0.5909090909090908, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5416666666666666, 'f1-score': 0.7027027027027027, 'support': 24}, '7': {'precision': 0.6735905044510386, 'recall': 0.8730769230769231, 'f1-score': 0.7604690117252931, 'support': 260}, '8': {'precision': 0.6479591836734694, 'recall': 0.635, 'f1-score': 0.6414141414141414, 'support': 200}, '9': {'precision': 0.6428571428571429, 'recall': 0.21686746987951808, 'f1-score': 0.32432432432432434, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9666666666666667, 'recall': 0.7837837837837838, 'f1-score': 0.8656716417910447, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7628716461203771, 'recall': 0.7514285714285714, 'f1-score': 0.7571068729758905, 'support': 1400}, 'macro avg': {'precision': 0.7620825664018598, 'recall': 0.5839970819634152, 'f1-score': 0.6407979919159122, 'support': 1400}, 'weighted avg': {'precision': 0.7650633635895258, 'recall': 0.7514285714285714, 'f1-score': 0.7425177462929103, 'support': 1400}, 'samples avg': {'precision': 0.7514285714285714, 'recall': 0.7514285714285714, 'f1-score': 0.7514285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8937329700272479, 'recall': 0.9111111111111111, 'f1-score': 0.9023383768913342, 'support': 360}, '1': {'precision': 0.851063829787234, 'recall': 0.7339449541284404, 'f1-score': 0.788177339901478, 'support': 218}, '2': {'precision': 0.9423076923076923, 'recall': 0.9074074074074074, 'f1-score': 0.9245283018867925, 'support': 108}, '3': {'precision': 0.868421052631579, 'recall': 0.4714285714285714, 'f1-score': 0.6111111111111112, 'support': 70}, '4': {'precision': 0.8095238095238095, 'recall': 0.7727272727272727, 'f1-score': 0.7906976744186046, 'support': 22}, '5': {'precision': 0.9090909090909091, 'recall': 0.8571428571428571, 'f1-score': 0.8823529411764706, 'support': 35}, '6': {'precision': 0.9375, 'recall': 0.5882352941176471, 'f1-score': 0.7228915662650602, 'support': 51}, '7': {'precision': 0.7061068702290076, 'recall': 0.8185840707964602, 'f1-score': 0.7581967213114755, 'support': 226}, '8': {'precision': 0.5296803652968036, 'recall': 0.703030303030303, 'f1-score': 0.6041666666666666, 'support': 165}, '9': {'precision': 0.717391304347826, 'recall': 0.39759036144578314, 'f1-score': 0.5116279069767442, 'support': 83}, '10': {'precision': 0.8461538461538461, 'recall': 0.7857142857142857, 'f1-score': 0.8148148148148148, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.789860396767083, 'recall': 0.7678571428571429, 'f1-score': 0.7787033683448026, 'support': 1400}, 'macro avg': {'precision': 0.7619776531924015, 'recall': 0.6801271793196464, 'f1-score': 0.7081261741173706, 'support': 1400}, 'weighted avg': {'precision': 0.7997440994552322, 'recall': 0.7678571428571429, 'f1-score': 0.7738206889440916, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 192s - loss: 0.3725 - acc: 0.8886 - precision: 0.9078 - recall: 0.8688 - val_loss: 1.4094 - val_acc: 0.7657 - val_precision: 0.7734 - val_recall: 0.7629 - 192s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8654822335025381, 'recall': 0.9166666666666666, 'f1-score': 0.8903394255874673, 'support': 372}, '1': {'precision': 0.8305084745762712, 'recall': 0.6621621621621622, 'f1-score': 0.7368421052631579, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.65, 'recall': 0.5098039215686274, 'f1-score': 0.5714285714285715, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 0.9090909090909091, 'recall': 0.5882352941176471, 'f1-score': 0.7142857142857143, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.6170212765957447, 'recall': 0.8923076923076924, 'f1-score': 0.7295597484276729, 'support': 260}, '8': {'precision': 0.615, 'recall': 0.615, 'f1-score': 0.615, 'support': 200}, '9': {'precision': 0.65, 'recall': 0.1566265060240964, 'f1-score': 0.2524271844660194, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7567567567567568, 'f1-score': 0.8615384615384616, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7478197674418605, 'recall': 0.735, 'f1-score': 0.7413544668587897, 'support': 1400}, 'macro avg': {'precision': 0.7444002418763099, 'recall': 0.5661625470890587, 'f1-score': 0.6182359261982554, 'support': 1400}, 'weighted avg': {'precision': 0.7578321294051878, 'recall': 0.735, 'f1-score': 0.7264786427592558, 'support': 1400}, 'samples avg': {'precision': 0.735, 'recall': 0.735, 'f1-score': 0.735, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9244186046511628, 'recall': 0.8833333333333333, 'f1-score': 0.9034090909090909, 'support': 360}, '1': {'precision': 0.852760736196319, 'recall': 0.6376146788990825, 'f1-score': 0.7296587926509186, 'support': 218}, '2': {'precision': 0.9339622641509434, 'recall': 0.9166666666666666, 'f1-score': 0.9252336448598131, 'support': 108}, '3': {'precision': 0.8125, 'recall': 0.5571428571428572, 'f1-score': 0.6610169491525424, 'support': 70}, '4': {'precision': 0.8095238095238095, 'recall': 0.7727272727272727, 'f1-score': 0.7906976744186046, 'support': 22}, '5': {'precision': 0.9354838709677419, 'recall': 0.8285714285714286, 'f1-score': 0.8787878787878788, 'support': 35}, '6': {'precision': 0.967741935483871, 'recall': 0.5882352941176471, 'f1-score': 0.7317073170731707, 'support': 51}, '7': {'precision': 0.6567656765676567, 'recall': 0.8805309734513275, 'f1-score': 0.7523629489603025, 'support': 226}, '8': {'precision': 0.5041322314049587, 'recall': 0.7393939393939394, 'f1-score': 0.5995085995085996, 'support': 165}, '9': {'precision': 0.8055555555555556, 'recall': 0.3493975903614458, 'f1-score': 0.4873949579831932, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8095238095238095, 'recall': 0.8947368421052632, 'f1-score': 0.8500000000000001, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7733526430123099, 'recall': 0.7628571428571429, 'f1-score': 0.7680690399137, 'support': 1400}, 'macro avg': {'precision': 0.7646876863536352, 'recall': 0.6905324850262841, 'f1-score': 0.7106422525288879, 'support': 1400}, 'weighted avg': {'precision': 0.7989825983255104, 'recall': 0.7628571428571429, 'f1-score': 0.7647614530519856, 'support': 1400}, 'samples avg': {'precision': 0.7628571428571429, 'recall': 0.7628571428571429, 'f1-score': 0.7628571428571429, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 191s - loss: 0.3123 - acc: 0.9054 - precision: 0.9178 - recall: 0.8910 - val_loss: 1.7183 - val_acc: 0.7571 - val_precision: 0.7632 - val_recall: 0.7550 - 191s/epoch - 38ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8532338308457711, 'recall': 0.9220430107526881, 'f1-score': 0.8863049095607234, 'support': 372}, '1': {'precision': 0.8245614035087719, 'recall': 0.6351351351351351, 'f1-score': 0.7175572519083969, 'support': 222}, '2': {'precision': 0.8, 'recall': 0.9090909090909091, 'f1-score': 0.8510638297872342, 'support': 88}, '3': {'precision': 0.6923076923076923, 'recall': 0.35294117647058826, 'f1-score': 0.4675324675324675, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.5790754257907542, 'recall': 0.9153846153846154, 'f1-score': 0.7093889716840537, 'support': 260}, '8': {'precision': 0.6571428571428571, 'recall': 0.575, 'f1-score': 0.6133333333333333, 'support': 200}, '9': {'precision': 0.8095238095238095, 'recall': 0.20481927710843373, 'f1-score': 0.32692307692307687, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7388489208633093, 'recall': 0.7335714285714285, 'f1-score': 0.7362007168458782, 'support': 1400}, 'macro avg': {'precision': 0.7441236208699196, 'recall': 0.581045971937285, 'f1-score': 0.6269570794793812, 'support': 1400}, 'weighted avg': {'precision': 0.7593941328215845, 'recall': 0.7335714285714285, 'f1-score': 0.7212992115873119, 'support': 1400}, 'samples avg': {'precision': 0.7335714285714285, 'recall': 0.7335714285714285, 'f1-score': 0.7335714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9273255813953488, 'recall': 0.8861111111111111, 'f1-score': 0.9062499999999999, 'support': 360}, '1': {'precision': 0.8597560975609756, 'recall': 0.6467889908256881, 'f1-score': 0.7382198952879581, 'support': 218}, '2': {'precision': 0.9009009009009009, 'recall': 0.9259259259259259, 'f1-score': 0.91324200913242, 'support': 108}, '3': {'precision': 0.8235294117647058, 'recall': 0.4, 'f1-score': 0.5384615384615384, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.925, 'recall': 0.7254901960784313, 'f1-score': 0.8131868131868133, 'support': 51}, '7': {'precision': 0.5970588235294118, 'recall': 0.8982300884955752, 'f1-score': 0.7173144876325087, 'support': 226}, '8': {'precision': 0.5339805825242718, 'recall': 0.6666666666666666, 'f1-score': 0.5929919137466306, 'support': 165}, '9': {'precision': 0.7837837837837838, 'recall': 0.3493975903614458, 'f1-score': 0.4833333333333334, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8378378378378378, 'recall': 0.8157894736842105, 'f1-score': 0.8266666666666665, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7631768953068592, 'recall': 0.755, 'f1-score': 0.7590664272890484, 'support': 1400}, 'macro avg': {'precision': 0.7453803213817795, 'recall': 0.6757330702522248, 'f1-score': 0.6932351277955028, 'support': 1400}, 'weighted avg': {'precision': 0.7868249929152984, 'recall': 0.755, 'f1-score': 0.7535758672585807, 'support': 1400}, 'samples avg': {'precision': 0.755, 'recall': 0.755, 'f1-score': 0.755, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 04:07:56.615413: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:07:56.847746: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 04:07:58.252962: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:07:58.253187: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:07:58.253202: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 04:08:06.869276: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:08:07.397800: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3427278.97it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3182669.70it/s]
Mon May 22 04:08:16 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 04:08:22.536564: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:56  8/148 [>.............................] - ETA: 1s   15/148 [==>...........................] - ETA: 1s 22/148 [===>..........................] - ETA: 0s 30/148 [=====>........................] - ETA: 0s 37/148 [======>.......................] - ETA: 0s 45/148 [========>.....................] - ETA: 0s 52/148 [=========>....................] - ETA: 0s 59/148 [==========>...................] - ETA: 0s 67/148 [============>.................] - ETA: 0s 74/148 [==============>...............] - ETA: 0s 81/148 [===============>..............] - ETA: 0s 89/148 [=================>............] - ETA: 0s 97/148 [==================>...........] - ETA: 0s105/148 [====================>.........] - ETA: 0s113/148 [=====================>........] - ETA: 0s121/148 [=======================>......] - ETA: 0s129/148 [=========================>....] - ETA: 0s137/148 [==========================>...] - ETA: 0s146/148 [============================>.] - ETA: 0s148/148 [==============================] - 2s 7ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2260349.21it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2554165.12it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2720394.34it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82714.84it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2431480.58it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82680.13it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3064731.52it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3003593.66it/s]
Mon May 22 04:08:29 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 3s 7/44 [===>..........................] - ETA: 0s14/44 [========>.....................] - ETA: 0s23/44 [==============>...............] - ETA: 0s31/44 [====================>.........] - ETA: 0s40/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 7ms/step
 1/44 [..............................] - ETA: 1s 4/44 [=>............................] - ETA: 0s11/44 [======>.......................] - ETA: 0s19/44 [===========>..................] - ETA: 0s27/44 [=================>............] - ETA: 0s35/44 [======================>.......] - ETA: 0s43/44 [============================>.] - ETA: 0s44/44 [==============================] - 0s 8ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2097901.25it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2277744.61it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2570939.40it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82962.82it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2601694.99it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84262.86it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               3 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 10240)  503412736  ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 10240)  503412736  ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 1,511,571,725
Trainable params: 1,511,571,725
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 10240)  503412736  ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 10240)  0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 10240)  503412736  ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 1,511,571,725
Trainable params: 1,511,571,725
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 287s - loss: 0.7856 - acc: 0.7840 - precision: 0.8288 - recall: 0.7380 - val_loss: 0.9456 - val_acc: 0.7514 - val_precision: 0.7786 - val_recall: 0.7157 - 287s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8305489260143198, 'recall': 0.9354838709677419, 'f1-score': 0.8798988621997471, 'support': 372}, '1': {'precision': 0.79, 'recall': 0.7117117117117117, 'f1-score': 0.7488151658767773, 'support': 222}, '2': {'precision': 0.8426966292134831, 'recall': 0.8522727272727273, 'f1-score': 0.8474576271186441, 'support': 88}, '3': {'precision': 0.9285714285714286, 'recall': 0.2549019607843137, 'f1-score': 0.39999999999999997, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5294117647058824, 'f1-score': 0.6923076923076924, 'support': 17}, '6': {'precision': 0.7777777777777778, 'recall': 0.5833333333333334, 'f1-score': 0.6666666666666666, 'support': 24}, '7': {'precision': 0.8017241379310345, 'recall': 0.7153846153846154, 'f1-score': 0.7560975609756098, 'support': 260}, '8': {'precision': 0.58, 'recall': 0.725, 'f1-score': 0.6444444444444445, 'support': 200}, '9': {'precision': 0.7857142857142857, 'recall': 0.13253012048192772, 'f1-score': 0.22680412371134023, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.2, 'f1-score': 0.33333333333333337, 'support': 15}, '11': {'precision': 0.9285714285714286, 'recall': 0.7027027027027027, 'f1-score': 0.7999999999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7750193948797518, 'recall': 0.7135714285714285, 'f1-score': 0.7430271476385273, 'support': 1400}, 'macro avg': {'precision': 0.7778275738421235, 'recall': 0.5181223038616999, 'f1-score': 0.5794162186529165, 'support': 1400}, 'weighted avg': {'precision': 0.7887409467840917, 'recall': 0.7135714285714285, 'f1-score': 0.7215915948379381, 'support': 1400}, 'samples avg': {'precision': 0.7135714285714285, 'recall': 0.7135714285714285, 'f1-score': 0.7135714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.893048128342246, 'recall': 0.9277777777777778, 'f1-score': 0.9100817438692099, 'support': 360}, '1': {'precision': 0.8440860215053764, 'recall': 0.7201834862385321, 'f1-score': 0.7772277227722773, 'support': 218}, '2': {'precision': 0.9393939393939394, 'recall': 0.8611111111111112, 'f1-score': 0.8985507246376813, 'support': 108}, '3': {'precision': 0.9411764705882353, 'recall': 0.22857142857142856, 'f1-score': 0.36781609195402293, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.9523809523809523, 'recall': 0.5714285714285714, 'f1-score': 0.7142857142857142, 'support': 35}, '6': {'precision': 0.85, 'recall': 0.6666666666666666, 'f1-score': 0.7472527472527473, 'support': 51}, '7': {'precision': 0.8397790055248618, 'recall': 0.672566371681416, 'f1-score': 0.746928746928747, 'support': 226}, '8': {'precision': 0.43727598566308246, 'recall': 0.7393939393939394, 'f1-score': 0.5495495495495495, 'support': 165}, '9': {'precision': 0.6944444444444444, 'recall': 0.30120481927710846, 'f1-score': 0.4201680672268908, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.42857142857142855, 'f1-score': 0.6, 'support': 14}, '11': {'precision': 0.9310344827586207, 'recall': 0.7105263157894737, 'f1-score': 0.8059701492537312, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7785547785547785, 'recall': 0.7157142857142857, 'f1-score': 0.7458131745441012, 'support': 1400}, 'macro avg': {'precision': 0.7819018995199734, 'recall': 0.5811749725984755, 'f1-score': 0.63987069712374, 'support': 1400}, 'weighted avg': {'precision': 0.8121524418047525, 'recall': 0.7157142857142857, 'f1-score': 0.738227632575126, 'support': 1400}, 'samples avg': {'precision': 0.7157142857142857, 'recall': 0.7157142857142857, 'f1-score': 0.7157142857142857, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 285s - loss: 0.5700 - acc: 0.8428 - precision: 0.8770 - recall: 0.8144 - val_loss: 1.2165 - val_acc: 0.7357 - val_precision: 0.7460 - val_recall: 0.7279 - 285s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8463541666666666, 'recall': 0.8736559139784946, 'f1-score': 0.8597883597883598, 'support': 372}, '1': {'precision': 0.8032786885245902, 'recall': 0.6621621621621622, 'f1-score': 0.725925925925926, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.23529411764705882, 'f1-score': 0.36923076923076925, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 0.7368421052631579, 'recall': 0.8235294117647058, 'f1-score': 0.7777777777777778, 'support': 17}, '6': {'precision': 0.8823529411764706, 'recall': 0.625, 'f1-score': 0.7317073170731708, 'support': 24}, '7': {'precision': 0.6858006042296072, 'recall': 0.8730769230769231, 'f1-score': 0.7681895093062605, 'support': 260}, '8': {'precision': 0.5766129032258065, 'recall': 0.715, 'f1-score': 0.6383928571428572, 'support': 200}, '9': {'precision': 0.5161290322580645, 'recall': 0.1927710843373494, 'f1-score': 0.28070175438596495, 'support': 83}, '10': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 15}, '11': {'precision': 0.9642857142857143, 'recall': 0.7297297297297297, 'f1-score': 0.8307692307692307, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7448529411764706, 'recall': 0.7235714285714285, 'f1-score': 0.7340579710144928, 'support': 1400}, 'macro avg': {'precision': 0.6530521641270811, 'recall': 0.5374394499376869, 'f1-score': 0.5658042335679251, 'support': 1400}, 'weighted avg': {'precision': 0.7415937252070065, 'recall': 0.7235714285714285, 'f1-score': 0.7153201907929827, 'support': 1400}, 'samples avg': {'precision': 0.7235714285714285, 'recall': 0.7235714285714285, 'f1-score': 0.7235714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8967551622418879, 'recall': 0.8444444444444444, 'f1-score': 0.8698140200286124, 'support': 360}, '1': {'precision': 0.888235294117647, 'recall': 0.6926605504587156, 'f1-score': 0.7783505154639175, 'support': 218}, '2': {'precision': 0.9313725490196079, 'recall': 0.8796296296296297, 'f1-score': 0.9047619047619048, 'support': 108}, '3': {'precision': 0.8181818181818182, 'recall': 0.2571428571428571, 'f1-score': 0.39130434782608686, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8, 'recall': 0.9142857142857143, 'f1-score': 0.8533333333333333, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.6739130434782609, 'recall': 0.8230088495575221, 'f1-score': 0.7410358565737051, 'support': 226}, '8': {'precision': 0.43703703703703706, 'recall': 0.7151515151515152, 'f1-score': 0.542528735632184, 'support': 165}, '9': {'precision': 0.6037735849056604, 'recall': 0.3855421686746988, 'f1-score': 0.47058823529411764, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.07142857142857142, 'f1-score': 0.13333333333333333, 'support': 14}, '11': {'precision': 0.9090909090909091, 'recall': 0.7894736842105263, 'f1-score': 0.8450704225352113, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7459736456808199, 'recall': 0.7278571428571429, 'f1-score': 0.7368040491684743, 'support': 1400}, 'macro avg': {'precision': 0.742950722928679, 'recall': 0.6004556203998538, 'f1-score': 0.6217872506073815, 'support': 1400}, 'weighted avg': {'precision': 0.7777873115152815, 'recall': 0.7278571428571429, 'f1-score': 0.73209198617225, 'support': 1400}, 'samples avg': {'precision': 0.7278571428571429, 'recall': 0.7278571428571429, 'f1-score': 0.7278571428571429, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 286s - loss: 0.5003 - acc: 0.8616 - precision: 0.8862 - recall: 0.8360 - val_loss: 1.0461 - val_acc: 0.7857 - val_precision: 0.7987 - val_recall: 0.7736 - 286s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8309859154929577, 'recall': 0.9516129032258065, 'f1-score': 0.887218045112782, 'support': 372}, '1': {'precision': 0.8148148148148148, 'recall': 0.6936936936936937, 'f1-score': 0.7493917274939172, 'support': 222}, '2': {'precision': 0.8636363636363636, 'recall': 0.8636363636363636, 'f1-score': 0.8636363636363636, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.35294117647058826, 'f1-score': 0.5, 'support': 51}, '4': {'precision': 0.7368421052631579, 'recall': 0.5, 'f1-score': 0.5957446808510638, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5833333333333334, 'f1-score': 0.7368421052631579, 'support': 24}, '7': {'precision': 0.6778115501519757, 'recall': 0.8576923076923076, 'f1-score': 0.7572156196943972, 'support': 260}, '8': {'precision': 0.7090909090909091, 'recall': 0.585, 'f1-score': 0.6410958904109589, 'support': 200}, '9': {'precision': 0.6140350877192983, 'recall': 0.42168674698795183, 'f1-score': 0.5, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9090909090909091, 'recall': 0.8108108108108109, 'f1-score': 0.8571428571428571, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7745961820851689, 'recall': 0.7535714285714286, 'f1-score': 0.7639391745112237, 'support': 1400}, 'macro avg': {'precision': 0.7638551676207622, 'recall': 0.6051897045677128, 'f1-score': 0.6613006137892824, 'support': 1400}, 'weighted avg': {'precision': 0.7768537915871554, 'recall': 0.7535714285714286, 'f1-score': 0.7533794389406491, 'support': 1400}, 'samples avg': {'precision': 0.7535714285714286, 'recall': 0.7535714285714286, 'f1-score': 0.7535714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9141274238227147, 'recall': 0.9166666666666666, 'f1-score': 0.9153952843273232, 'support': 360}, '1': {'precision': 0.8681318681318682, 'recall': 0.7247706422018348, 'f1-score': 0.79, 'support': 218}, '2': {'precision': 0.9489795918367347, 'recall': 0.8611111111111112, 'f1-score': 0.9029126213592233, 'support': 108}, '3': {'precision': 0.8857142857142857, 'recall': 0.44285714285714284, 'f1-score': 0.5904761904761905, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 35}, '6': {'precision': 0.9696969696969697, 'recall': 0.6274509803921569, 'f1-score': 0.761904761904762, 'support': 51}, '7': {'precision': 0.7237354085603113, 'recall': 0.8230088495575221, 'f1-score': 0.7701863354037267, 'support': 226}, '8': {'precision': 0.545, 'recall': 0.6606060606060606, 'f1-score': 0.5972602739726028, 'support': 165}, '9': {'precision': 0.6578947368421053, 'recall': 0.6024096385542169, 'f1-score': 0.628930817610063, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.7906976744186046, 'recall': 0.8947368421052632, 'f1-score': 0.8395061728395061, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7986725663716814, 'recall': 0.7735714285714286, 'f1-score': 0.785921625544267, 'support': 1400}, 'macro avg': {'precision': 0.761557788534543, 'recall': 0.7009276532687334, 'f1-score': 0.7209410641195979, 'support': 1400}, 'weighted avg': {'precision': 0.8076320056339191, 'recall': 0.7735714285714286, 'f1-score': 0.7830597105679075, 'support': 1400}, 'samples avg': {'precision': 0.7735714285714286, 'recall': 0.7735714285714286, 'f1-score': 0.7735714285714286, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 285s - loss: 0.4327 - acc: 0.8846 - precision: 0.9056 - recall: 0.8618 - val_loss: 1.1986 - val_acc: 0.7914 - val_precision: 0.8072 - val_recall: 0.7864 - 285s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8175519630484989, 'recall': 0.9516129032258065, 'f1-score': 0.8795031055900622, 'support': 372}, '1': {'precision': 0.8163265306122449, 'recall': 0.7207207207207207, 'f1-score': 0.7655502392344496, 'support': 222}, '2': {'precision': 0.8586956521739131, 'recall': 0.8977272727272727, 'f1-score': 0.8777777777777778, 'support': 88}, '3': {'precision': 0.725, 'recall': 0.5686274509803921, 'f1-score': 0.6373626373626374, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 0.8125, 'recall': 0.7647058823529411, 'f1-score': 0.787878787878788, 'support': 17}, '6': {'precision': 0.7241379310344828, 'recall': 0.875, 'f1-score': 0.7924528301886793, 'support': 24}, '7': {'precision': 0.7481751824817519, 'recall': 0.7884615384615384, 'f1-score': 0.7677902621722846, 'support': 260}, '8': {'precision': 0.6733668341708543, 'recall': 0.67, 'f1-score': 0.6716791979949875, 'support': 200}, '9': {'precision': 0.5833333333333334, 'recall': 0.25301204819277107, 'f1-score': 0.35294117647058826, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9666666666666667, 'recall': 0.7837837837837838, 'f1-score': 0.8656716417910447, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7772096420745069, 'recall': 0.76, 'f1-score': 0.7685084868183459, 'support': 1400}, 'macro avg': {'precision': 0.7267674089033821, 'recall': 0.6259951780562262, 'f1-score': 0.6565579707072475, 'support': 1400}, 'weighted avg': {'precision': 0.7697787983007671, 'recall': 0.76, 'f1-score': 0.756409175959305, 'support': 1400}, 'samples avg': {'precision': 0.76, 'recall': 0.76, 'f1-score': 0.76, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8826666666666667, 'recall': 0.9194444444444444, 'f1-score': 0.9006802721088436, 'support': 360}, '1': {'precision': 0.8797814207650273, 'recall': 0.7385321100917431, 'f1-score': 0.802992518703242, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.9166666666666666, 'f1-score': 0.908256880733945, 'support': 108}, '3': {'precision': 0.7857142857142857, 'recall': 0.6285714285714286, 'f1-score': 0.6984126984126985, 'support': 70}, '4': {'precision': 0.68, 'recall': 0.7727272727272727, 'f1-score': 0.7234042553191491, 'support': 22}, '5': {'precision': 0.9032258064516129, 'recall': 0.8, 'f1-score': 0.8484848484848486, 'support': 35}, '6': {'precision': 0.9111111111111111, 'recall': 0.803921568627451, 'f1-score': 0.8541666666666666, 'support': 51}, '7': {'precision': 0.8, 'recall': 0.7610619469026548, 'f1-score': 0.7800453514739228, 'support': 226}, '8': {'precision': 0.5648148148148148, 'recall': 0.7393939393939394, 'f1-score': 0.6404199475065616, 'support': 165}, '9': {'precision': 0.7049180327868853, 'recall': 0.5180722891566265, 'f1-score': 0.5972222222222223, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.9375, 'recall': 0.7894736842105263, 'f1-score': 0.8571428571428572, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8071847507331378, 'recall': 0.7864285714285715, 'f1-score': 0.796671490593343, 'support': 1400}, 'macro avg': {'precision': 0.7551076003828516, 'recall': 0.7166489830280139, 'f1-score': 0.7313677109932991, 'support': 1400}, 'weighted avg': {'precision': 0.8107520672273846, 'recall': 0.7864285714285715, 'f1-score': 0.7943602859172355, 'support': 1400}, 'samples avg': {'precision': 0.7864285714285715, 'recall': 0.7864285714285715, 'f1-score': 0.7864285714285715, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 286s - loss: 0.3736 - acc: 0.9012 - precision: 0.9204 - recall: 0.8834 - val_loss: 2.1611 - val_acc: 0.7500 - val_precision: 0.7556 - val_recall: 0.7464 - 286s/epoch - 57ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8402948402948403, 'recall': 0.9193548387096774, 'f1-score': 0.8780487804878049, 'support': 372}, '1': {'precision': 0.8148148148148148, 'recall': 0.5945945945945946, 'f1-score': 0.6875, 'support': 222}, '2': {'precision': 0.8041237113402062, 'recall': 0.8863636363636364, 'f1-score': 0.8432432432432433, 'support': 88}, '3': {'precision': 0.6666666666666666, 'recall': 0.47058823529411764, 'f1-score': 0.5517241379310345, 'support': 51}, '4': {'precision': 0.7368421052631579, 'recall': 0.5, 'f1-score': 0.5957446808510638, 'support': 28}, '5': {'precision': 0.75, 'recall': 0.7058823529411765, 'f1-score': 0.7272727272727272, 'support': 17}, '6': {'precision': 0.7894736842105263, 'recall': 0.625, 'f1-score': 0.6976744186046512, 'support': 24}, '7': {'precision': 0.6263440860215054, 'recall': 0.8961538461538462, 'f1-score': 0.7373417721518987, 'support': 260}, '8': {'precision': 0.6517412935323383, 'recall': 0.655, 'f1-score': 0.6533665835411472, 'support': 200}, '9': {'precision': 0.7777777777777778, 'recall': 0.1686746987951807, 'f1-score': 0.2772277227722772, 'support': 83}, '10': {'precision': 0.8181818181818182, 'recall': 0.6, 'f1-score': 0.6923076923076923, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7449567723342939, 'recall': 0.7385714285714285, 'f1-score': 0.7417503586800573, 'support': 1400}, 'macro avg': {'precision': 0.7135585229310502, 'recall': 0.60249407797408, 'f1-score': 0.6336133959402493, 'support': 1400}, 'weighted avg': {'precision': 0.7554260052466218, 'recall': 0.7385714285714285, 'f1-score': 0.7259301274685541, 'support': 1400}, 'samples avg': {'precision': 0.7385714285714285, 'recall': 0.7385714285714285, 'f1-score': 0.7385714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9183673469387755, 'recall': 0.875, 'f1-score': 0.8961593172119489, 'support': 360}, '1': {'precision': 0.8896551724137931, 'recall': 0.591743119266055, 'f1-score': 0.7107438016528925, 'support': 218}, '2': {'precision': 0.868421052631579, 'recall': 0.9166666666666666, 'f1-score': 0.8918918918918918, 'support': 108}, '3': {'precision': 0.7368421052631579, 'recall': 0.4, 'f1-score': 0.5185185185185185, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.7567567567567568, 'recall': 0.8, 'f1-score': 0.7777777777777778, 'support': 35}, '6': {'precision': 0.9487179487179487, 'recall': 0.7254901960784313, 'f1-score': 0.8222222222222223, 'support': 51}, '7': {'precision': 0.6132075471698113, 'recall': 0.8628318584070797, 'f1-score': 0.7169117647058824, 'support': 226}, '8': {'precision': 0.5194805194805194, 'recall': 0.7272727272727273, 'f1-score': 0.6060606060606061, 'support': 165}, '9': {'precision': 0.775, 'recall': 0.37349397590361444, 'f1-score': 0.5040650406504064, 'support': 83}, '10': {'precision': 0.7647058823529411, 'recall': 0.9285714285714286, 'f1-score': 0.8387096774193549, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7556037599421548, 'recall': 0.7464285714285714, 'f1-score': 0.7509881422924901, 'support': 1400}, 'macro avg': {'precision': 0.7223247639071448, 'recall': 0.6786984262726149, 'f1-score': 0.6841115560385471, 'support': 1400}, 'weighted avg': {'precision': 0.780896338759792, 'recall': 0.7464285714285714, 'f1-score': 0.7460682238375956, 'support': 1400}, 'samples avg': {'precision': 0.7464285714285714, 'recall': 0.7464285714285714, 'f1-score': 0.7464285714285714, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 04:34:18.245486: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:34:18.507367: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 04:34:19.979291: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:34:19.979492: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:34:19.979507: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 04:34:29.476004: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:34:30.001927: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3364594.90it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3118441.64it/s]
Mon May 22 04:34:39 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 04:34:45.353385: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 2:06  8/148 [>.............................] - ETA: 1s   16/148 [==>...........................] - ETA: 0s 24/148 [===>..........................] - ETA: 0s 32/148 [=====>........................] - ETA: 0s 40/148 [=======>......................] - ETA: 0s 48/148 [========>.....................] - ETA: 0s 56/148 [==========>...................] - ETA: 0s 64/148 [===========>..................] - ETA: 0s 72/148 [=============>................] - ETA: 0s 80/148 [===============>..............] - ETA: 0s 88/148 [================>.............] - ETA: 0s 97/148 [==================>...........] - ETA: 0s106/148 [====================>.........] - ETA: 0s115/148 [======================>.......] - ETA: 0s124/148 [========================>.....] - ETA: 0s133/148 [=========================>....] - ETA: 0s142/148 [===========================>..] - ETA: 0s148/148 [==============================] - 2s 7ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2293975.06it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2581110.15it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2658324.25it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82865.51it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2572065.53it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82736.05it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3056754.61it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3002058.08it/s]
Mon May 22 04:34:52 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 4s 5/44 [==>...........................] - ETA: 0s12/44 [=======>......................] - ETA: 0s21/44 [=============>................] - ETA: 0s30/44 [===================>..........] - ETA: 0s39/44 [=========================>....] - ETA: 0s44/44 [==============================] - 0s 7ms/step
 1/44 [..............................] - ETA: 3s 4/44 [=>............................] - ETA: 0s12/44 [=======>......................] - ETA: 0s21/44 [=============>................] - ETA: 0s30/44 [===================>..........] - ETA: 0s39/44 [=========================>....] - ETA: 0s44/44 [==============================] - 0s 7ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2097901.25it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2328321.02it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2481836.69it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84346.37it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2554165.12it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84864.45it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               1 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder (Transform  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 504,746,253
Trainable params: 504,746,253
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 10240  0           []                               
                                )]                                                                
                                                                                                  
 transformer_encoder (Transform  (None, None, 10240)  503412736  ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 10240)       0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 10240)        0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          1310848     ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 504,746,253
Trainable params: 504,746,253
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 100s - loss: 0.6456 - acc: 0.8078 - precision: 0.8472 - recall: 0.7728 - val_loss: 0.7960 - val_acc: 0.7771 - val_precision: 0.7999 - val_recall: 0.7621 - 100s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8301435406698564, 'recall': 0.9327956989247311, 'f1-score': 0.8784810126582279, 'support': 372}, '1': {'precision': 0.7945945945945946, 'recall': 0.6621621621621622, 'f1-score': 0.7223587223587223, 'support': 222}, '2': {'precision': 0.7916666666666666, 'recall': 0.8636363636363636, 'f1-score': 0.8260869565217391, 'support': 88}, '3': {'precision': 0.8888888888888888, 'recall': 0.3137254901960784, 'f1-score': 0.46376811594202894, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 0.9090909090909091, 'recall': 0.5882352941176471, 'f1-score': 0.7142857142857143, 'support': 17}, '6': {'precision': 0.8421052631578947, 'recall': 0.6666666666666666, 'f1-score': 0.744186046511628, 'support': 24}, '7': {'precision': 0.735593220338983, 'recall': 0.8346153846153846, 'f1-score': 0.781981981981982, 'support': 260}, '8': {'precision': 0.6331658291457286, 'recall': 0.63, 'f1-score': 0.631578947368421, 'support': 200}, '9': {'precision': 0.6285714285714286, 'recall': 0.26506024096385544, 'f1-score': 0.37288135593220345, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7027027027027027, 'f1-score': 0.8253968253968255, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7721423164269493, 'recall': 0.7285714285714285, 'f1-score': 0.7497243660418963, 'support': 1400}, 'macro avg': {'precision': 0.7615364759445229, 'recall': 0.5578813189879027, 'f1-score': 0.6206938166338247, 'support': 1400}, 'weighted avg': {'precision': 0.7725925773432422, 'recall': 0.7285714285714285, 'f1-score': 0.7344467715035541, 'support': 1400}, 'samples avg': {'precision': 0.7285714285714285, 'recall': 0.7285714285714285, 'f1-score': 0.7285714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9032258064516129, 'recall': 0.9333333333333333, 'f1-score': 0.9180327868852459, 'support': 360}, '1': {'precision': 0.8491620111731844, 'recall': 0.6972477064220184, 'f1-score': 0.7657430730478589, 'support': 218}, '2': {'precision': 0.8695652173913043, 'recall': 0.9259259259259259, 'f1-score': 0.8968609865470852, 'support': 108}, '3': {'precision': 0.9090909090909091, 'recall': 0.42857142857142855, 'f1-score': 0.5825242718446602, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.8387096774193549, 'recall': 0.7428571428571429, 'f1-score': 0.787878787878788, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7870370370370371, 'recall': 0.7522123893805309, 'f1-score': 0.7692307692307693, 'support': 226}, '8': {'precision': 0.55, 'recall': 0.7333333333333333, 'f1-score': 0.6285714285714286, 'support': 165}, '9': {'precision': 0.6212121212121212, 'recall': 0.4939759036144578, 'f1-score': 0.5503355704697986, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5, 'f1-score': 0.6666666666666666, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7998500749625187, 'recall': 0.7621428571428571, 'f1-score': 0.7805413313825895, 'support': 1400}, 'macro avg': {'precision': 0.7641693232816931, 'recall': 0.6505285234225137, 'f1-score': 0.6906624471591963, 'support': 1400}, 'weighted avg': {'precision': 0.8067853567521461, 'recall': 0.7621428571428571, 'f1-score': 0.7754594501407513, 'support': 1400}, 'samples avg': {'precision': 0.7621428571428571, 'recall': 0.7621428571428571, 'f1-score': 0.7621428571428571, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 98s - loss: 0.4368 - acc: 0.8636 - precision: 0.8812 - recall: 0.8498 - val_loss: 0.8681 - val_acc: 0.7800 - val_precision: 0.7964 - val_recall: 0.7686 - 98s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8511166253101737, 'recall': 0.9220430107526881, 'f1-score': 0.8851612903225807, 'support': 372}, '1': {'precision': 0.8421052631578947, 'recall': 0.6486486486486487, 'f1-score': 0.7328244274809161, 'support': 222}, '2': {'precision': 0.8315789473684211, 'recall': 0.8977272727272727, 'f1-score': 0.8633879781420765, 'support': 88}, '3': {'precision': 0.6578947368421053, 'recall': 0.49019607843137253, 'f1-score': 0.5617977528089888, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 24}, '7': {'precision': 0.6646884272997032, 'recall': 0.8615384615384616, 'f1-score': 0.7504187604690117, 'support': 260}, '8': {'precision': 0.672316384180791, 'recall': 0.595, 'f1-score': 0.6312997347480107, 'support': 200}, '9': {'precision': 0.5652173913043478, 'recall': 0.3132530120481928, 'f1-score': 0.40310077519379844, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.6666666666666666, 'f1-score': 0.7692307692307692, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7647492625368731, 'recall': 0.7407142857142858, 'f1-score': 0.7525399129172715, 'support': 1400}, 'macro avg': {'precision': 0.7216980727339612, 'recall': 0.6072405251028898, 'f1-score': 0.651148699010941, 'support': 1400}, 'weighted avg': {'precision': 0.7631415601280228, 'recall': 0.7407142857142858, 'f1-score': 0.7425999077339807, 'support': 1400}, 'samples avg': {'precision': 0.7407142857142858, 'recall': 0.7407142857142858, 'f1-score': 0.7407142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8997289972899729, 'recall': 0.9222222222222223, 'f1-score': 0.9108367626886146, 'support': 360}, '1': {'precision': 0.9090909090909091, 'recall': 0.6422018348623854, 'f1-score': 0.7526881720430108, 'support': 218}, '2': {'precision': 0.9142857142857143, 'recall': 0.8888888888888888, 'f1-score': 0.9014084507042254, 'support': 108}, '3': {'precision': 0.7555555555555555, 'recall': 0.4857142857142857, 'f1-score': 0.5913043478260869, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8205128205128205, 'recall': 0.9142857142857143, 'f1-score': 0.8648648648648648, 'support': 35}, '6': {'precision': 0.9210526315789473, 'recall': 0.6862745098039216, 'f1-score': 0.7865168539325842, 'support': 51}, '7': {'precision': 0.7368421052631579, 'recall': 0.8053097345132744, 'f1-score': 0.7695560253699788, 'support': 226}, '8': {'precision': 0.5476190476190477, 'recall': 0.696969696969697, 'f1-score': 0.6133333333333334, 'support': 165}, '9': {'precision': 0.6712328767123288, 'recall': 0.5903614457831325, 'f1-score': 0.6282051282051282, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.9166666666666666, 'recall': 0.868421052631579, 'f1-score': 0.8918918918918918, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7964470762398224, 'recall': 0.7685714285714286, 'f1-score': 0.7822609960014542, 'support': 1400}, 'macro avg': {'precision': 0.7494566903788284, 'recall': 0.6988511515454374, 'f1-score': 0.7174436497708718, 'support': 1400}, 'weighted avg': {'precision': 0.8041141670261281, 'recall': 0.7685714285714286, 'f1-score': 0.7790788047349781, 'support': 1400}, 'samples avg': {'precision': 0.7685714285714286, 'recall': 0.7685714285714286, 'f1-score': 0.7685714285714286, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 98s - loss: 0.3584 - acc: 0.8906 - precision: 0.9039 - recall: 0.8746 - val_loss: 1.0312 - val_acc: 0.7771 - val_precision: 0.7848 - val_recall: 0.7686 - 98s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8200934579439252, 'recall': 0.9435483870967742, 'f1-score': 0.8775, 'support': 372}, '1': {'precision': 0.7978142076502732, 'recall': 0.6576576576576577, 'f1-score': 0.7209876543209878, 'support': 222}, '2': {'precision': 0.8144329896907216, 'recall': 0.8977272727272727, 'f1-score': 0.8540540540540541, 'support': 88}, '3': {'precision': 0.7333333333333333, 'recall': 0.43137254901960786, 'f1-score': 0.54320987654321, 'support': 51}, '4': {'precision': 0.6470588235294118, 'recall': 0.39285714285714285, 'f1-score': 0.4888888888888888, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 0.9411764705882353, 'recall': 0.6666666666666666, 'f1-score': 0.7804878048780487, 'support': 24}, '7': {'precision': 0.6551724137931034, 'recall': 0.8769230769230769, 'f1-score': 0.75, 'support': 260}, '8': {'precision': 0.718562874251497, 'recall': 0.6, 'f1-score': 0.6539509536784741, 'support': 200}, '9': {'precision': 0.7407407407407407, 'recall': 0.24096385542168675, 'f1-score': 0.36363636363636365, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9629629629629629, 'recall': 0.7027027027027027, 'f1-score': 0.8125, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7630227439471754, 'recall': 0.7428571428571429, 'f1-score': 0.7528049221860298, 'support': 1400}, 'macro avg': {'precision': 0.7498473031654517, 'recall': 0.5941649847129744, 'f1-score': 0.6464489450504, 'support': 1400}, 'weighted avg': {'precision': 0.7669409662715545, 'recall': 0.7428571428571429, 'f1-score': 0.7376438404052377, 'support': 1400}, 'samples avg': {'precision': 0.7428571428571429, 'recall': 0.7428571428571429, 'f1-score': 0.7428571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8967391304347826, 'recall': 0.9166666666666666, 'f1-score': 0.9065934065934065, 'support': 360}, '1': {'precision': 0.8131868131868132, 'recall': 0.6788990825688074, 'f1-score': 0.7399999999999999, 'support': 218}, '2': {'precision': 0.8807339449541285, 'recall': 0.8888888888888888, 'f1-score': 0.8847926267281107, 'support': 108}, '3': {'precision': 0.868421052631579, 'recall': 0.4714285714285714, 'f1-score': 0.6111111111111112, 'support': 70}, '4': {'precision': 0.6666666666666666, 'recall': 0.8181818181818182, 'f1-score': 0.7346938775510203, 'support': 22}, '5': {'precision': 0.8108108108108109, 'recall': 0.8571428571428571, 'f1-score': 0.8333333333333334, 'support': 35}, '6': {'precision': 0.925, 'recall': 0.7254901960784313, 'f1-score': 0.8131868131868133, 'support': 51}, '7': {'precision': 0.6666666666666666, 'recall': 0.8407079646017699, 'f1-score': 0.7436399217221134, 'support': 226}, '8': {'precision': 0.601063829787234, 'recall': 0.6848484848484848, 'f1-score': 0.6402266288951841, 'support': 165}, '9': {'precision': 0.7708333333333334, 'recall': 0.4457831325301205, 'f1-score': 0.5648854961832062, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8918918918918919, 'recall': 0.868421052631579, 'f1-score': 0.88, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7848285922684172, 'recall': 0.7685714285714286, 'f1-score': 0.7766149404547094, 'support': 1400}, 'macro avg': {'precision': 0.7468216005408134, 'recall': 0.6909363847140215, 'f1-score': 0.7075859278044727, 'support': 1400}, 'weighted avg': {'precision': 0.7905544196350003, 'recall': 0.7685714285714286, 'f1-score': 0.7705022381354427, 'support': 1400}, 'samples avg': {'precision': 0.7685714285714286, 'recall': 0.7685714285714286, 'f1-score': 0.7685714285714286, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 98s - loss: 0.2816 - acc: 0.9058 - precision: 0.9175 - recall: 0.8944 - val_loss: 1.2539 - val_acc: 0.7879 - val_precision: 0.7943 - val_recall: 0.7807 - 98s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8459657701711492, 'recall': 0.9301075268817204, 'f1-score': 0.8860435339308578, 'support': 372}, '1': {'precision': 0.7857142857142857, 'recall': 0.6936936936936937, 'f1-score': 0.736842105263158, 'support': 222}, '2': {'precision': 0.8181818181818182, 'recall': 0.8181818181818182, 'f1-score': 0.8181818181818182, 'support': 88}, '3': {'precision': 0.625, 'recall': 0.49019607843137253, 'f1-score': 0.5494505494505494, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8260869565217391, 'recall': 0.7916666666666666, 'f1-score': 0.8085106382978724, 'support': 24}, '7': {'precision': 0.595, 'recall': 0.9153846153846154, 'f1-score': 0.7212121212121212, 'support': 260}, '8': {'precision': 0.7647058823529411, 'recall': 0.455, 'f1-score': 0.5705329153605015, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.21686746987951808, 'f1-score': 0.3364485981308411, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7333333333333333, 'f1-score': 0.846153846153846, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7487254187909687, 'recall': 0.7342857142857143, 'f1-score': 0.741435268662099, 'support': 1400}, 'macro avg': {'precision': 0.7397619009955334, 'recall': 0.6134826007512257, 'f1-score': 0.6525387273210854, 'support': 1400}, 'weighted avg': {'precision': 0.7627509652566777, 'recall': 0.7342857142857143, 'f1-score': 0.7254604119443465, 'support': 1400}, 'samples avg': {'precision': 0.7342857142857143, 'recall': 0.7342857142857143, 'f1-score': 0.7342857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9171270718232044, 'recall': 0.9222222222222223, 'f1-score': 0.9196675900277009, 'support': 360}, '1': {'precision': 0.806930693069307, 'recall': 0.7477064220183486, 'f1-score': 0.7761904761904762, 'support': 218}, '2': {'precision': 0.8921568627450981, 'recall': 0.8425925925925926, 'f1-score': 0.8666666666666667, 'support': 108}, '3': {'precision': 0.75, 'recall': 0.4714285714285714, 'f1-score': 0.5789473684210525, 'support': 70}, '4': {'precision': 0.6666666666666666, 'recall': 0.7272727272727273, 'f1-score': 0.6956521739130435, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9148936170212766, 'recall': 0.8431372549019608, 'f1-score': 0.8775510204081632, 'support': 51}, '7': {'precision': 0.6293929712460063, 'recall': 0.8716814159292036, 'f1-score': 0.7309833024118738, 'support': 226}, '8': {'precision': 0.7214285714285714, 'recall': 0.6121212121212121, 'f1-score': 0.6622950819672131, 'support': 165}, '9': {'precision': 0.7755102040816326, 'recall': 0.4578313253012048, 'f1-score': 0.5757575757575758, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7943313953488372, 'recall': 0.7807142857142857, 'f1-score': 0.7874639769452448, 'support': 1400}, 'macro avg': {'precision': 0.7441578186533857, 'recall': 0.71027597913465, 'f1-score': 0.7192118851364001, 'support': 1400}, 'weighted avg': {'precision': 0.7970625509394639, 'recall': 0.7807142857142857, 'f1-score': 0.7808130055712633, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 99s - loss: 0.2220 - acc: 0.9268 - precision: 0.9354 - recall: 0.9206 - val_loss: 1.4935 - val_acc: 0.7621 - val_precision: 0.7681 - val_recall: 0.7593 - 99s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8701657458563536, 'recall': 0.8467741935483871, 'f1-score': 0.8583106267029974, 'support': 372}, '1': {'precision': 0.7681818181818182, 'recall': 0.7612612612612613, 'f1-score': 0.7647058823529412, 'support': 222}, '2': {'precision': 0.7731958762886598, 'recall': 0.8522727272727273, 'f1-score': 0.8108108108108107, 'support': 88}, '3': {'precision': 0.7, 'recall': 0.4117647058823529, 'f1-score': 0.5185185185185185, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.5, 'f1-score': 0.5714285714285715, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8095238095238095, 'recall': 0.7083333333333334, 'f1-score': 0.7555555555555556, 'support': 24}, '7': {'precision': 0.6607669616519174, 'recall': 0.8615384615384616, 'f1-score': 0.7479131886477463, 'support': 260}, '8': {'precision': 0.6129032258064516, 'recall': 0.665, 'f1-score': 0.6378896882494005, 'support': 200}, '9': {'precision': 0.7222222222222222, 'recall': 0.1566265060240964, 'f1-score': 0.25742574257425743, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.8611111111111112, 'recall': 0.8378378378378378, 'f1-score': 0.8493150684931507, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7471098265895953, 'recall': 0.7385714285714285, 'f1-score': 0.742816091954023, 'support': 1400}, 'macro avg': {'precision': 0.7206011046450717, 'recall': 0.6133813881774078, 'f1-score': 0.6439902810256884, 'support': 1400}, 'weighted avg': {'precision': 0.7521088676730139, 'recall': 0.7385714285714285, 'f1-score': 0.7295798207222866, 'support': 1400}, 'samples avg': {'precision': 0.7385714285714285, 'recall': 0.7385714285714285, 'f1-score': 0.7385714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9292307692307692, 'recall': 0.8388888888888889, 'f1-score': 0.8817518248175182, 'support': 360}, '1': {'precision': 0.8018867924528302, 'recall': 0.7798165137614679, 'f1-score': 0.7906976744186047, 'support': 218}, '2': {'precision': 0.9056603773584906, 'recall': 0.8888888888888888, 'f1-score': 0.897196261682243, 'support': 108}, '3': {'precision': 0.6666666666666666, 'recall': 0.4, 'f1-score': 0.5, 'support': 70}, '4': {'precision': 0.6923076923076923, 'recall': 0.8181818181818182, 'f1-score': 0.7500000000000001, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.925, 'recall': 0.7254901960784313, 'f1-score': 0.8131868131868133, 'support': 51}, '7': {'precision': 0.6951672862453532, 'recall': 0.827433628318584, 'f1-score': 0.7555555555555555, 'support': 226}, '8': {'precision': 0.5125, 'recall': 0.7454545454545455, 'f1-score': 0.6074074074074074, 'support': 165}, '9': {'precision': 0.8214285714285714, 'recall': 0.27710843373493976, 'f1-score': 0.4144144144144144, 'support': 83}, '10': {'precision': 0.8125, 'recall': 0.9285714285714286, 'f1-score': 0.8666666666666666, 'support': 14}, '11': {'precision': 0.8095238095238095, 'recall': 0.8947368421052632, 'f1-score': 0.8500000000000001, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7680635838150289, 'recall': 0.7592857142857142, 'f1-score': 0.7636494252873562, 'support': 1400}, 'macro avg': {'precision': 0.7241520944901599, 'recall': 0.6952966844823053, 'f1-score': 0.6925837651474113, 'support': 1400}, 'weighted avg': {'precision': 0.7840554438731423, 'recall': 0.7592857142857142, 'f1-score': 0.7572606519329492, 'support': 1400}, 'samples avg': {'precision': 0.7592857142857142, 'recall': 0.7592857142857142, 'f1-score': 0.7592857142857142, 'support': 1400}}
Training Finished
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 04:44:11.396738: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:44:11.655407: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 04:44:13.125921: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:44:13.126132: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:44:13.126146: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 04:44:21.755730: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:44:22.284263: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    1layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 5120)       146850816 
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 147,507,981
Trainable params: 147,507,981
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 5120)       146850816 
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 147,507,981
Trainable params: 147,507,981
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 04:44:24.586423: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 40s - loss: 0.6094 - acc: 0.8182 - precision: 0.8588 - recall: 0.7810 - val_loss: 0.8447 - val_acc: 0.7771 - val_precision: 0.8002 - val_recall: 0.7607 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8410757946210269, 'recall': 0.9247311827956989, 'f1-score': 0.8809218950064021, 'support': 372}, '1': {'precision': 0.7929292929292929, 'recall': 0.7072072072072072, 'f1-score': 0.7476190476190476, 'support': 222}, '2': {'precision': 0.8369565217391305, 'recall': 0.875, 'f1-score': 0.8555555555555556, 'support': 88}, '3': {'precision': 0.782608695652174, 'recall': 0.35294117647058826, 'f1-score': 0.48648648648648657, 'support': 51}, '4': {'precision': 0.8571428571428571, 'recall': 0.42857142857142855, 'f1-score': 0.5714285714285714, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5416666666666666, 'f1-score': 0.7027027027027027, 'support': 24}, '7': {'precision': 0.6869300911854104, 'recall': 0.8692307692307693, 'f1-score': 0.7674023769100171, 'support': 260}, '8': {'precision': 0.6404494382022472, 'recall': 0.57, 'f1-score': 0.6031746031746033, 'support': 200}, '9': {'precision': 0.7307692307692307, 'recall': 0.2289156626506024, 'f1-score': 0.3486238532110092, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9333333333333333, 'recall': 0.7567567567567568, 'f1-score': 0.835820895522388, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7714285714285715, 'recall': 0.7328571428571429, 'f1-score': 0.7516483516483516, 'support': 1400}, 'macro avg': {'precision': 0.7770919427365156, 'recall': 0.5668266415804459, 'f1-score': 0.6324472238226697, 'support': 1400}, 'weighted avg': {'precision': 0.774539004897475, 'recall': 0.7328571428571429, 'f1-score': 0.7354015907595282, 'support': 1400}, 'samples avg': {'precision': 0.7328571428571429, 'recall': 0.7328571428571429, 'f1-score': 0.7328571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.893048128342246, 'recall': 0.9277777777777778, 'f1-score': 0.9100817438692099, 'support': 360}, '1': {'precision': 0.8385416666666666, 'recall': 0.7385321100917431, 'f1-score': 0.7853658536585365, 'support': 218}, '2': {'precision': 0.9215686274509803, 'recall': 0.8703703703703703, 'f1-score': 0.8952380952380952, 'support': 108}, '3': {'precision': 0.9310344827586207, 'recall': 0.38571428571428573, 'f1-score': 0.5454545454545455, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 35}, '6': {'precision': 0.9411764705882353, 'recall': 0.6274509803921569, 'f1-score': 0.7529411764705882, 'support': 51}, '7': {'precision': 0.7265625, 'recall': 0.8230088495575221, 'f1-score': 0.7717842323651452, 'support': 226}, '8': {'precision': 0.5588235294117647, 'recall': 0.6909090909090909, 'f1-score': 0.6178861788617886, 'support': 165}, '9': {'precision': 0.7631578947368421, 'recall': 0.3493975903614458, 'f1-score': 0.4793388429752066, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.7142857142857143, 'f1-score': 0.8, 'support': 14}, '11': {'precision': 0.8888888888888888, 'recall': 0.8421052631578947, 'f1-score': 0.8648648648648649, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8001502629601803, 'recall': 0.7607142857142857, 'f1-score': 0.779934090076895, 'support': 1400}, 'macro avg': {'precision': 0.77146430423677, 'recall': 0.6579975090025835, 'f1-score': 0.6955387040619693, 'support': 1400}, 'weighted avg': {'precision': 0.8077552844396434, 'recall': 0.7607142857142857, 'f1-score': 0.7707807614131705, 'support': 1400}, 'samples avg': {'precision': 0.7607142857142857, 'recall': 0.7607142857142857, 'f1-score': 0.7607142857142857, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 38s - loss: 0.3569 - acc: 0.8872 - precision: 0.9032 - recall: 0.8756 - val_loss: 0.8338 - val_acc: 0.7900 - val_precision: 0.8044 - val_recall: 0.7786 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8553615960099751, 'recall': 0.9220430107526881, 'f1-score': 0.8874514877102199, 'support': 372}, '1': {'precision': 0.7960199004975125, 'recall': 0.7207207207207207, 'f1-score': 0.7565011820330969, 'support': 222}, '2': {'precision': 0.8041237113402062, 'recall': 0.8863636363636364, 'f1-score': 0.8432432432432433, 'support': 88}, '3': {'precision': 0.7586206896551724, 'recall': 0.43137254901960786, 'f1-score': 0.55, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.6526610644257703, 'recall': 0.8961538461538462, 'f1-score': 0.7552674230145867, 'support': 260}, '8': {'precision': 0.7123287671232876, 'recall': 0.52, 'f1-score': 0.6011560693641619, 'support': 200}, '9': {'precision': 0.6666666666666666, 'recall': 0.2891566265060241, 'f1-score': 0.40336134453781514, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7711111111111111, 'recall': 0.7435714285714285, 'f1-score': 0.7570909090909091, 'support': 1400}, 'macro avg': {'precision': 0.7603593295851907, 'recall': 0.5963270348021672, 'f1-score': 0.6524022234576511, 'support': 1400}, 'weighted avg': {'precision': 0.7737055501703821, 'recall': 0.7435714285714285, 'f1-score': 0.743496465771934, 'support': 1400}, 'samples avg': {'precision': 0.7435714285714285, 'recall': 0.7435714285714285, 'f1-score': 0.7435714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9157303370786517, 'recall': 0.9055555555555556, 'f1-score': 0.9106145251396648, 'support': 360}, '1': {'precision': 0.8203883495145631, 'recall': 0.7752293577981652, 'f1-score': 0.7971698113207547, 'support': 218}, '2': {'precision': 0.9074074074074074, 'recall': 0.9074074074074074, 'f1-score': 0.9074074074074074, 'support': 108}, '3': {'precision': 0.7441860465116279, 'recall': 0.45714285714285713, 'f1-score': 0.5663716814159292, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.926829268292683, 'recall': 0.7450980392156863, 'f1-score': 0.8260869565217392, 'support': 51}, '7': {'precision': 0.6940298507462687, 'recall': 0.8230088495575221, 'f1-score': 0.7530364372469635, 'support': 226}, '8': {'precision': 0.6347305389221557, 'recall': 0.6424242424242425, 'f1-score': 0.6385542168674699, 'support': 165}, '9': {'precision': 0.7166666666666667, 'recall': 0.5180722891566265, 'f1-score': 0.6013986013986015, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.7142857142857143, 'f1-score': 0.8, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8044280442804428, 'recall': 0.7785714285714286, 'f1-score': 0.7912885662431942, 'support': 1400}, 'macro avg': {'precision': 0.7549806092245753, 'recall': 0.6941938150928834, 'f1-score': 0.7184908645681318, 'support': 1400}, 'weighted avg': {'precision': 0.8011513447741019, 'recall': 0.7785714285714286, 'f1-score': 0.7857007159890416, 'support': 1400}, 'samples avg': {'precision': 0.7785714285714286, 'recall': 0.7785714285714286, 'f1-score': 0.7785714285714286, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 38s - loss: 0.2369 - acc: 0.9222 - precision: 0.9330 - recall: 0.9134 - val_loss: 0.9880 - val_acc: 0.7871 - val_precision: 0.7972 - val_recall: 0.7807 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8207547169811321, 'recall': 0.9354838709677419, 'f1-score': 0.8743718592964823, 'support': 372}, '1': {'precision': 0.8054054054054054, 'recall': 0.6711711711711712, 'f1-score': 0.7321867321867321, 'support': 222}, '2': {'precision': 0.8191489361702128, 'recall': 0.875, 'f1-score': 0.8461538461538463, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.618798955613577, 'recall': 0.9115384615384615, 'f1-score': 0.7371695178849144, 'support': 260}, '8': {'precision': 0.7, 'recall': 0.49, 'f1-score': 0.5764705882352941, 'support': 200}, '9': {'precision': 0.72, 'recall': 0.21686746987951808, 'f1-score': 0.3333333333333333, 'support': 83}, '10': {'precision': 0.875, 'recall': 0.4666666666666667, 'f1-score': 0.608695652173913, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7837837837837838, 'f1-score': 0.8787878787878788, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.75, 'recall': 0.735, 'f1-score': 0.7424242424242425, 'support': 1400}, 'macro avg': {'precision': 0.7382464040204281, 'recall': 0.5897182888107351, 'f1-score': 0.6363569224614862, 'support': 1400}, 'weighted avg': {'precision': 0.7575442306377308, 'recall': 0.735, 'f1-score': 0.7254030083674361, 'support': 1400}, 'samples avg': {'precision': 0.735, 'recall': 0.735, 'f1-score': 0.735, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.893048128342246, 'recall': 0.9277777777777778, 'f1-score': 0.9100817438692099, 'support': 360}, '1': {'precision': 0.8290155440414507, 'recall': 0.7339449541284404, 'f1-score': 0.7785888077858882, 'support': 218}, '2': {'precision': 0.9326923076923077, 'recall': 0.8981481481481481, 'f1-score': 0.9150943396226415, 'support': 108}, '3': {'precision': 0.7333333333333333, 'recall': 0.4714285714285714, 'f1-score': 0.5739130434782609, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 51}, '7': {'precision': 0.65, 'recall': 0.8628318584070797, 'f1-score': 0.7414448669201522, 'support': 226}, '8': {'precision': 0.6560509554140127, 'recall': 0.6242424242424243, 'f1-score': 0.6397515527950312, 'support': 165}, '9': {'precision': 0.8181818181818182, 'recall': 0.43373493975903615, 'f1-score': 0.5669291338582677, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7972283005105762, 'recall': 0.7807142857142857, 'f1-score': 0.7888848791050163, 'support': 1400}, 'macro avg': {'precision': 0.7594046457162998, 'recall': 0.7084809766962293, 'f1-score': 0.724915336525309, 'support': 1400}, 'weighted avg': {'precision': 0.7986276772537019, 'recall': 0.7807142857142857, 'f1-score': 0.7813636118901377, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 38s - loss: 0.1516 - acc: 0.9522 - precision: 0.9579 - recall: 0.9464 - val_loss: 1.1022 - val_acc: 0.7714 - val_precision: 0.7817 - val_recall: 0.7700 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8220140515222483, 'recall': 0.9435483870967742, 'f1-score': 0.8785982478097623, 'support': 372}, '1': {'precision': 0.7978723404255319, 'recall': 0.6756756756756757, 'f1-score': 0.7317073170731708, 'support': 222}, '2': {'precision': 0.8191489361702128, 'recall': 0.875, 'f1-score': 0.8461538461538463, 'support': 88}, '3': {'precision': 0.8076923076923077, 'recall': 0.4117647058823529, 'f1-score': 0.5454545454545454, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6190476190476191, 'recall': 0.9, 'f1-score': 0.7335423197492164, 'support': 260}, '8': {'precision': 0.6598639455782312, 'recall': 0.485, 'f1-score': 0.5590778097982708, 'support': 200}, '9': {'precision': 0.6774193548387096, 'recall': 0.25301204819277107, 'f1-score': 0.368421052631579, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7478260869565218, 'recall': 0.7371428571428571, 'f1-score': 0.7424460431654676, 'support': 1400}, 'macro avg': {'precision': 0.7536765690292403, 'recall': 0.6001815882512482, 'f1-score': 0.650442070407048, 'support': 1400}, 'weighted avg': {'precision': 0.7538706868187124, 'recall': 0.7371428571428571, 'f1-score': 0.7268721138011378, 'support': 1400}, 'samples avg': {'precision': 0.7371428571428571, 'recall': 0.7371428571428571, 'f1-score': 0.7371428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8859416445623343, 'recall': 0.9277777777777778, 'f1-score': 0.9063772048846677, 'support': 360}, '1': {'precision': 0.8378378378378378, 'recall': 0.7110091743119266, 'f1-score': 0.7692307692307693, 'support': 218}, '2': {'precision': 0.9326923076923077, 'recall': 0.8981481481481481, 'f1-score': 0.9150943396226415, 'support': 108}, '3': {'precision': 0.825, 'recall': 0.4714285714285714, 'f1-score': 0.6000000000000001, 'support': 70}, '4': {'precision': 0.72, 'recall': 0.8181818181818182, 'f1-score': 0.7659574468085107, 'support': 22}, '5': {'precision': 0.825, 'recall': 0.9428571428571428, 'f1-score': 0.88, 'support': 35}, '6': {'precision': 0.9210526315789473, 'recall': 0.6862745098039216, 'f1-score': 0.7865168539325842, 'support': 51}, '7': {'precision': 0.6198083067092651, 'recall': 0.8584070796460177, 'f1-score': 0.719851576994434, 'support': 226}, '8': {'precision': 0.6073619631901841, 'recall': 0.6, 'f1-score': 0.6036585365853658, 'support': 165}, '9': {'precision': 0.8181818181818182, 'recall': 0.43373493975903615, 'f1-score': 0.5669291338582677, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.8888888888888888, 'recall': 0.8421052631578947, 'f1-score': 0.8648648648648649, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7817258883248731, 'recall': 0.77, 'f1-score': 0.7758186397984888, 'support': 1400}, 'macro avg': {'precision': 0.7491467889064954, 'recall': 0.6959282524780857, 'f1-score': 0.7104325833788432, 'support': 1400}, 'weighted avg': {'precision': 0.7898109743299483, 'recall': 0.77, 'f1-score': 0.7691370081591506, 'support': 1400}, 'samples avg': {'precision': 0.77, 'recall': 0.77, 'f1-score': 0.77, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 38s - loss: 0.0939 - acc: 0.9712 - precision: 0.9745 - recall: 0.9692 - val_loss: 1.3570 - val_acc: 0.7686 - val_precision: 0.7746 - val_recall: 0.7636 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8471177944862155, 'recall': 0.9086021505376344, 'f1-score': 0.8767833981841764, 'support': 372}, '1': {'precision': 0.782608695652174, 'recall': 0.7297297297297297, 'f1-score': 0.7552447552447553, 'support': 222}, '2': {'precision': 0.8333333333333334, 'recall': 0.8522727272727273, 'f1-score': 0.8426966292134833, 'support': 88}, '3': {'precision': 0.7666666666666667, 'recall': 0.45098039215686275, 'f1-score': 0.5679012345679013, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.5994897959183674, 'recall': 0.9038461538461539, 'f1-score': 0.7208588957055215, 'support': 260}, '8': {'precision': 0.6727272727272727, 'recall': 0.555, 'f1-score': 0.6082191780821918, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.14457831325301204, 'f1-score': 0.24489795918367346, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7474674384949349, 'recall': 0.7378571428571429, 'f1-score': 0.7426312005751259, 'support': 1400}, 'macro avg': {'precision': 0.7634800807556504, 'recall': 0.5884998575965684, 'f1-score': 0.6398334912558098, 'support': 1400}, 'weighted avg': {'precision': 0.763244113311674, 'recall': 0.7378571428571429, 'f1-score': 0.7261805450733435, 'support': 1400}, 'samples avg': {'precision': 0.7378571428571429, 'recall': 0.7378571428571429, 'f1-score': 0.7378571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9098591549295775, 'recall': 0.8972222222222223, 'f1-score': 0.9034965034965036, 'support': 360}, '1': {'precision': 0.8113207547169812, 'recall': 0.7889908256880734, 'f1-score': 0.7999999999999999, 'support': 218}, '2': {'precision': 0.9479166666666666, 'recall': 0.8425925925925926, 'f1-score': 0.892156862745098, 'support': 108}, '3': {'precision': 0.775, 'recall': 0.44285714285714284, 'f1-score': 0.5636363636363636, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9411764705882353, 'recall': 0.6274509803921569, 'f1-score': 0.7529411764705882, 'support': 51}, '7': {'precision': 0.6073619631901841, 'recall': 0.8761061946902655, 'f1-score': 0.717391304347826, 'support': 226}, '8': {'precision': 0.6081871345029239, 'recall': 0.6303030303030303, 'f1-score': 0.619047619047619, 'support': 165}, '9': {'precision': 0.7857142857142857, 'recall': 0.26506024096385544, 'f1-score': 0.3963963963963964, 'support': 83}, '10': {'precision': 0.7647058823529411, 'recall': 0.9285714285714286, 'f1-score': 0.8387096774193549, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7746376811594203, 'recall': 0.7635714285714286, 'f1-score': 0.7690647482014389, 'support': 1400}, 'macro avg': {'precision': 0.736421213919069, 'recall': 0.6831464990306937, 'f1-score': 0.6909796577097205, 'support': 1400}, 'weighted avg': {'precision': 0.7862587799401467, 'recall': 0.7635714285714286, 'f1-score': 0.7594904277360736, 'support': 1400}, 'samples avg': {'precision': 0.7635714285714286, 'recall': 0.7635714285714286, 'f1-score': 0.7635714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 04:48:22.151966: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:48:22.438666: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 04:48:24.304183: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:48:24.304375: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:48:24.304389: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 04:48:35.682920: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:48:36.210570: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    2layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 5120)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 294,358,797
Trainable params: 294,358,797
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 5120)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 294,358,797
Trainable params: 294,358,797
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 04:48:38.953612: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 72s - loss: 0.7286 - acc: 0.7952 - precision: 0.8519 - recall: 0.7544 - val_loss: 0.8377 - val_acc: 0.7829 - val_precision: 0.8043 - val_recall: 0.7664 - 72s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8618090452261307, 'recall': 0.9220430107526881, 'f1-score': 0.8909090909090909, 'support': 372}, '1': {'precision': 0.7737556561085973, 'recall': 0.7702702702702703, 'f1-score': 0.7720090293453724, 'support': 222}, '2': {'precision': 0.875, 'recall': 0.875, 'f1-score': 0.875, 'support': 88}, '3': {'precision': 0.9473684210526315, 'recall': 0.35294117647058826, 'f1-score': 0.5142857142857143, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.2857142857142857, 'f1-score': 0.4210526315789473, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.717948717948718, 'recall': 0.8615384615384616, 'f1-score': 0.7832167832167831, 'support': 260}, '8': {'precision': 0.6649746192893401, 'recall': 0.655, 'f1-score': 0.6599496221662469, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.25301204819277107, 'f1-score': 0.3716814159292035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.6756756756756757, 'f1-score': 0.8064516129032258, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7876969242310577, 'recall': 0.75, 'f1-score': 0.7683863885839736, 'support': 1400}, 'macro avg': {'precision': 0.7906428045865705, 'recall': 0.5639305299537735, 'f1-score': 0.6324354059568431, 'support': 1400}, 'weighted avg': {'precision': 0.7923886431988916, 'recall': 0.75, 'f1-score': 0.7530534527520282, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9162011173184358, 'recall': 0.9111111111111111, 'f1-score': 0.9136490250696379, 'support': 360}, '1': {'precision': 0.7963800904977375, 'recall': 0.8073394495412844, 'f1-score': 0.8018223234624147, 'support': 218}, '2': {'precision': 0.94, 'recall': 0.8703703703703703, 'f1-score': 0.9038461538461539, 'support': 108}, '3': {'precision': 0.9333333333333333, 'recall': 0.4, 'f1-score': 0.5599999999999999, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 1.0, 'recall': 0.7714285714285715, 'f1-score': 0.870967741935484, 'support': 35}, '6': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 51}, '7': {'precision': 0.7416666666666667, 'recall': 0.7876106194690266, 'f1-score': 0.7639484978540773, 'support': 226}, '8': {'precision': 0.5687203791469194, 'recall': 0.7272727272727273, 'f1-score': 0.6382978723404256, 'support': 165}, '9': {'precision': 0.68, 'recall': 0.40963855421686746, 'f1-score': 0.5112781954887219, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.90625, 'recall': 0.7631578947368421, 'f1-score': 0.8285714285714286, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8043478260869565, 'recall': 0.7664285714285715, 'f1-score': 0.7849305047549379, 'support': 1400}, 'macro avg': {'precision': 0.7877941166759734, 'recall': 0.6566574279411272, 'f1-score': 0.7049863897257614, 'support': 1400}, 'weighted avg': {'precision': 0.812075671651328, 'recall': 0.7664285714285715, 'f1-score': 0.7788789561656214, 'support': 1400}, 'samples avg': {'precision': 0.7664285714285715, 'recall': 0.7664285714285715, 'f1-score': 0.7664285714285715, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 70s - loss: 0.4877 - acc: 0.8540 - precision: 0.8845 - recall: 0.8304 - val_loss: 0.8122 - val_acc: 0.7843 - val_precision: 0.8104 - val_recall: 0.7693 - 70s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8727272727272727, 'recall': 0.9032258064516129, 'f1-score': 0.8877146631439894, 'support': 372}, '1': {'precision': 0.7877358490566038, 'recall': 0.7522522522522522, 'f1-score': 0.7695852534562211, 'support': 222}, '2': {'precision': 0.8522727272727273, 'recall': 0.8522727272727273, 'f1-score': 0.8522727272727273, 'support': 88}, '3': {'precision': 0.8064516129032258, 'recall': 0.49019607843137253, 'f1-score': 0.6097560975609755, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.5, 'f1-score': 0.6086956521739131, 'support': 28}, '5': {'precision': 0.8461538461538461, 'recall': 0.6470588235294118, 'f1-score': 0.7333333333333334, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.7622377622377622, 'recall': 0.8384615384615385, 'f1-score': 0.7985347985347986, 'support': 260}, '8': {'precision': 0.6586538461538461, 'recall': 0.685, 'f1-score': 0.6715686274509803, 'support': 200}, '9': {'precision': 0.7105263157894737, 'recall': 0.3253012048192771, 'f1-score': 0.44628099173553715, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7962546816479401, 'recall': 0.7592857142857142, 'f1-score': 0.7773308957952467, 'support': 1400}, 'macro avg': {'precision': 0.7648734011056623, 'recall': 0.6175040165386136, 'f1-score': 0.6729716953139833, 'support': 1400}, 'weighted avg': {'precision': 0.7948017887246351, 'recall': 0.7592857142857142, 'f1-score': 0.7688922678881895, 'support': 1400}, 'samples avg': {'precision': 0.7592857142857142, 'recall': 0.7592857142857142, 'f1-score': 0.7592857142857142, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.930835734870317, 'recall': 0.8972222222222223, 'f1-score': 0.9137199434229137, 'support': 360}, '1': {'precision': 0.8173076923076923, 'recall': 0.7798165137614679, 'f1-score': 0.7981220657276996, 'support': 218}, '2': {'precision': 0.968421052631579, 'recall': 0.8518518518518519, 'f1-score': 0.9064039408866994, 'support': 108}, '3': {'precision': 0.8717948717948718, 'recall': 0.4857142857142857, 'f1-score': 0.6238532110091742, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.9666666666666667, 'recall': 0.5686274509803921, 'f1-score': 0.7160493827160493, 'support': 51}, '7': {'precision': 0.7990867579908676, 'recall': 0.7743362831858407, 'f1-score': 0.7865168539325842, 'support': 226}, '8': {'precision': 0.5294117647058824, 'recall': 0.7090909090909091, 'f1-score': 0.6062176165803109, 'support': 165}, '9': {'precision': 0.7457627118644068, 'recall': 0.5301204819277109, 'f1-score': 0.6197183098591549, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8918918918918919, 'recall': 0.868421052631579, 'f1-score': 0.88, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8103837471783296, 'recall': 0.7692857142857142, 'f1-score': 0.7893001099303774, 'support': 1400}, 'macro avg': {'precision': 0.7665800036138319, 'recall': 0.6928276533019001, 'f1-score': 0.7185118587136382, 'support': 1400}, 'weighted avg': {'precision': 0.8209811937996231, 'recall': 0.7692857142857142, 'f1-score': 0.7873677420479172, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 70s - loss: 0.4067 - acc: 0.8770 - precision: 0.8948 - recall: 0.8572 - val_loss: 1.0301 - val_acc: 0.7821 - val_precision: 0.7929 - val_recall: 0.7764 - 70s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8818897637795275, 'recall': 0.9032258064516129, 'f1-score': 0.8924302788844621, 'support': 372}, '1': {'precision': 0.7942583732057417, 'recall': 0.7477477477477478, 'f1-score': 0.7703016241299305, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.6222222222222222, 'recall': 0.5490196078431373, 'f1-score': 0.5833333333333334, 'support': 51}, '4': {'precision': 0.6818181818181818, 'recall': 0.5357142857142857, 'f1-score': 0.6, 'support': 28}, '5': {'precision': 0.875, 'recall': 0.8235294117647058, 'f1-score': 0.8484848484848485, 'support': 17}, '6': {'precision': 0.9411764705882353, 'recall': 0.6666666666666666, 'f1-score': 0.7804878048780487, 'support': 24}, '7': {'precision': 0.7142857142857143, 'recall': 0.8653846153846154, 'f1-score': 0.7826086956521738, 'support': 260}, '8': {'precision': 0.6328502415458938, 'recall': 0.655, 'f1-score': 0.6437346437346438, 'support': 200}, '9': {'precision': 0.7241379310344828, 'recall': 0.25301204819277107, 'f1-score': 0.375, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7755102040816326, 'recall': 0.76, 'f1-score': 0.7676767676767676, 'support': 1400}, 'macro avg': {'precision': 0.7441354882661225, 'recall': 0.6174428609401958, 'f1-score': 0.6570017050859546, 'support': 1400}, 'weighted avg': {'precision': 0.7771445617896783, 'recall': 0.76, 'f1-score': 0.7575643074308184, 'support': 1400}, 'samples avg': {'precision': 0.76, 'recall': 0.76, 'f1-score': 0.76, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9147727272727273, 'recall': 0.8944444444444445, 'f1-score': 0.9044943820224719, 'support': 360}, '1': {'precision': 0.8418367346938775, 'recall': 0.7568807339449541, 'f1-score': 0.7971014492753624, 'support': 218}, '2': {'precision': 0.8839285714285714, 'recall': 0.9166666666666666, 'f1-score': 0.8999999999999999, 'support': 108}, '3': {'precision': 0.74, 'recall': 0.5285714285714286, 'f1-score': 0.6166666666666666, 'support': 70}, '4': {'precision': 0.68, 'recall': 0.7727272727272727, 'f1-score': 0.7234042553191491, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.8974358974358975, 'recall': 0.6862745098039216, 'f1-score': 0.7777777777777778, 'support': 51}, '7': {'precision': 0.7530864197530864, 'recall': 0.8097345132743363, 'f1-score': 0.7803837953091685, 'support': 226}, '8': {'precision': 0.5339366515837104, 'recall': 0.7151515151515152, 'f1-score': 0.61139896373057, 'support': 165}, '9': {'precision': 0.7358490566037735, 'recall': 0.46987951807228917, 'f1-score': 0.5735294117647058, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7928519328956966, 'recall': 0.7764285714285715, 'f1-score': 0.784554312522555, 'support': 1400}, 'macro avg': {'precision': 0.7498517653483036, 'recall': 0.6928247369308027, 'f1-score': 0.7140037492906095, 'support': 1400}, 'weighted avg': {'precision': 0.7991431820413675, 'recall': 0.7764285714285715, 'f1-score': 0.7823144190718452, 'support': 1400}, 'samples avg': {'precision': 0.7764285714285715, 'recall': 0.7764285714285715, 'f1-score': 0.7764285714285715, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 70s - loss: 0.3358 - acc: 0.8956 - precision: 0.9099 - recall: 0.8824 - val_loss: 1.1742 - val_acc: 0.7700 - val_precision: 0.7824 - val_recall: 0.7629 - 70s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8733509234828496, 'recall': 0.8897849462365591, 'f1-score': 0.881491344873502, 'support': 372}, '1': {'precision': 0.8021390374331551, 'recall': 0.6756756756756757, 'f1-score': 0.7334963325183375, 'support': 222}, '2': {'precision': 0.8260869565217391, 'recall': 0.8636363636363636, 'f1-score': 0.8444444444444444, 'support': 88}, '3': {'precision': 0.7222222222222222, 'recall': 0.5098039215686274, 'f1-score': 0.5977011494252873, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.6572237960339944, 'recall': 0.8923076923076924, 'f1-score': 0.7569331158238174, 'support': 260}, '8': {'precision': 0.6129032258064516, 'recall': 0.665, 'f1-score': 0.6378896882494005, 'support': 200}, '9': {'precision': 0.7058823529411765, 'recall': 0.14457831325301204, 'f1-score': 0.24, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.6756756756756757, 'f1-score': 0.8064516129032258, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7592047128129602, 'recall': 0.7364285714285714, 'f1-score': 0.747643219724438, 'support': 1400}, 'macro avg': {'precision': 0.7543808747372651, 'recall': 0.5801986951179137, 'f1-score': 0.6325884759749278, 'support': 1400}, 'weighted avg': {'precision': 0.7686492081062156, 'recall': 0.7364285714285714, 'f1-score': 0.7329465027768624, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9285714285714286, 'recall': 0.8666666666666667, 'f1-score': 0.896551724137931, 'support': 360}, '1': {'precision': 0.8681318681318682, 'recall': 0.7247706422018348, 'f1-score': 0.79, 'support': 218}, '2': {'precision': 0.9142857142857143, 'recall': 0.8888888888888888, 'f1-score': 0.9014084507042254, 'support': 108}, '3': {'precision': 0.7708333333333334, 'recall': 0.5285714285714286, 'f1-score': 0.6271186440677967, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8108108108108109, 'recall': 0.8571428571428571, 'f1-score': 0.8333333333333334, 'support': 35}, '6': {'precision': 0.9696969696969697, 'recall': 0.6274509803921569, 'f1-score': 0.761904761904762, 'support': 51}, '7': {'precision': 0.6982456140350877, 'recall': 0.8805309734513275, 'f1-score': 0.7788649706457925, 'support': 226}, '8': {'precision': 0.49361702127659574, 'recall': 0.703030303030303, 'f1-score': 0.58, 'support': 165}, '9': {'precision': 0.8064516129032258, 'recall': 0.30120481927710846, 'f1-score': 0.43859649122807026, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7824175824175824, 'recall': 0.7628571428571429, 'f1-score': 0.7725135623869801, 'support': 1400}, 'macro avg': {'precision': 0.7565698036775468, 'recall': 0.6868337351978455, 'f1-score': 0.7054068614255949, 'support': 1400}, 'weighted avg': {'precision': 0.8029837828000219, 'recall': 0.7628571428571429, 'f1-score': 0.7684522667467708, 'support': 1400}, 'samples avg': {'precision': 0.7628571428571429, 'recall': 0.7628571428571429, 'f1-score': 0.7628571428571429, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 70s - loss: 0.2968 - acc: 0.9080 - precision: 0.9239 - recall: 0.8954 - val_loss: 1.1441 - val_acc: 0.7779 - val_precision: 0.7845 - val_recall: 0.7721 - 70s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8564231738035264, 'recall': 0.9139784946236559, 'f1-score': 0.8842652795838751, 'support': 372}, '1': {'precision': 0.8080808080808081, 'recall': 0.7207207207207207, 'f1-score': 0.7619047619047618, 'support': 222}, '2': {'precision': 0.7843137254901961, 'recall': 0.9090909090909091, 'f1-score': 0.8421052631578948, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.6975308641975309, 'recall': 0.8692307692307693, 'f1-score': 0.7739726027397261, 'support': 260}, '8': {'precision': 0.6089108910891089, 'recall': 0.615, 'f1-score': 0.6119402985074628, 'support': 200}, '9': {'precision': 0.7096774193548387, 'recall': 0.26506024096385544, 'f1-score': 0.3859649122807018, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.764919941775837, 'recall': 0.7507142857142857, 'f1-score': 0.7577505407354002, 'support': 1400}, 'macro avg': {'precision': 0.73944197561198, 'recall': 0.5990176203132276, 'f1-score': 0.6443522904286426, 'support': 1400}, 'weighted avg': {'precision': 0.7660711685484856, 'recall': 0.7507142857142857, 'f1-score': 0.7462605830808456, 'support': 1400}, 'samples avg': {'precision': 0.7507142857142857, 'recall': 0.7507142857142857, 'f1-score': 0.7507142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9193083573487032, 'recall': 0.8861111111111111, 'f1-score': 0.9024045261669024, 'support': 360}, '1': {'precision': 0.8190954773869347, 'recall': 0.7477064220183486, 'f1-score': 0.7817745803357314, 'support': 218}, '2': {'precision': 0.8839285714285714, 'recall': 0.9166666666666666, 'f1-score': 0.8999999999999999, 'support': 108}, '3': {'precision': 0.7857142857142857, 'recall': 0.4714285714285714, 'f1-score': 0.5892857142857143, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.9411764705882353, 'recall': 0.6274509803921569, 'f1-score': 0.7529411764705882, 'support': 51}, '7': {'precision': 0.7153846153846154, 'recall': 0.8230088495575221, 'f1-score': 0.7654320987654322, 'support': 226}, '8': {'precision': 0.515695067264574, 'recall': 0.696969696969697, 'f1-score': 0.5927835051546392, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.4819277108433735, 'f1-score': 0.6015037593984962, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7844702467343977, 'recall': 0.7721428571428571, 'f1-score': 0.7782577393808495, 'support': 1400}, 'macro avg': {'precision': 0.7528253655032944, 'recall': 0.7003421853487899, 'f1-score': 0.7165854898098692, 'support': 1400}, 'weighted avg': {'precision': 0.7953139924290145, 'recall': 0.7721428571428571, 'f1-score': 0.7757143849871618, 'support': 1400}, 'samples avg': {'precision': 0.7721428571428571, 'recall': 0.7721428571428571, 'f1-score': 0.7721428571428571, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 04:55:18.428266: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:55:18.666059: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 04:55:20.196264: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:55:20.196476: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 04:55:20.196492: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 04:55:28.655443: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 04:55:29.178685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    3layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 5120)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 5120)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 441,209,613
Trainable params: 441,209,613
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 5120)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 5120)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 5120)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 5120)       146850816 
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 5120)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 5120)              0         
                                                                 
 dense (Dense)               (None, 128)               655488    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 441,209,613
Trainable params: 441,209,613
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 04:55:32.390155: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 103s - loss: 0.7342 - acc: 0.7894 - precision: 0.8458 - recall: 0.7524 - val_loss: 0.8180 - val_acc: 0.7721 - val_precision: 0.7970 - val_recall: 0.7543 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8806366047745358, 'recall': 0.8924731182795699, 'f1-score': 0.8865153538050733, 'support': 372}, '1': {'precision': 0.8040201005025126, 'recall': 0.7207207207207207, 'f1-score': 0.7600950118764845, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.484375, 'recall': 0.6078431372549019, 'f1-score': 0.5391304347826086, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.32142857142857145, 'f1-score': 0.45000000000000007, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.8235294117647058, 'f1-score': 0.9032258064516129, 'support': 17}, '6': {'precision': 0.9285714285714286, 'recall': 0.5416666666666666, 'f1-score': 0.6842105263157894, 'support': 24}, '7': {'precision': 0.7278911564625851, 'recall': 0.823076923076923, 'f1-score': 0.772563176895307, 'support': 260}, '8': {'precision': 0.6574585635359116, 'recall': 0.595, 'f1-score': 0.6246719160104987, 'support': 200}, '9': {'precision': 0.46153846153846156, 'recall': 0.14457831325301204, 'f1-score': 0.2201834862385321, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.06666666666666667, 'f1-score': 0.125, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7728658536585366, 'recall': 0.7242857142857143, 'f1-score': 0.747787610619469, 'support': 1400}, 'macro avg': {'precision': 0.7260087511050022, 'recall': 0.5573478163576785, 'f1-score': 0.5911248688737392, 'support': 1400}, 'weighted avg': {'precision': 0.7648253569848216, 'recall': 0.7242857142857143, 'f1-score': 0.7309099910967394, 'support': 1400}, 'samples avg': {'precision': 0.7242857142857143, 'recall': 0.7242857142857143, 'f1-score': 0.7242857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9116809116809117, 'recall': 0.8888888888888888, 'f1-score': 0.90014064697609, 'support': 360}, '1': {'precision': 0.8469387755102041, 'recall': 0.7614678899082569, 'f1-score': 0.8019323671497586, 'support': 218}, '2': {'precision': 0.8928571428571429, 'recall': 0.9259259259259259, 'f1-score': 0.9090909090909091, 'support': 108}, '3': {'precision': 0.7213114754098361, 'recall': 0.6285714285714286, 'f1-score': 0.6717557251908397, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8285714285714286, 'recall': 0.8285714285714286, 'f1-score': 0.8285714285714286, 'support': 35}, '6': {'precision': 0.9142857142857143, 'recall': 0.6274509803921569, 'f1-score': 0.7441860465116279, 'support': 51}, '7': {'precision': 0.7699115044247787, 'recall': 0.7699115044247787, 'f1-score': 0.7699115044247787, 'support': 226}, '8': {'precision': 0.5472636815920398, 'recall': 0.6666666666666666, 'f1-score': 0.6010928961748634, 'support': 165}, '9': {'precision': 0.6122448979591837, 'recall': 0.3614457831325301, 'f1-score': 0.4545454545454545, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.2857142857142857, 'f1-score': 0.4444444444444445, 'support': 14}, '11': {'precision': 0.8857142857142857, 'recall': 0.8157894736842105, 'f1-score': 0.8493150684931505, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7969811320754717, 'recall': 0.7542857142857143, 'f1-score': 0.7750458715596331, 'support': 1400}, 'macro avg': {'precision': 0.7485215244619636, 'recall': 0.6375136140887142, 'f1-score': 0.6720685579598544, 'support': 1400}, 'weighted avg': {'precision': 0.7969705030375899, 'recall': 0.7542857142857143, 'f1-score': 0.7694255688930727, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 101s - loss: 0.4972 - acc: 0.8518 - precision: 0.8801 - recall: 0.8308 - val_loss: 0.8273 - val_acc: 0.7893 - val_precision: 0.8097 - val_recall: 0.7721 - 101s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8105022831050228, 'recall': 0.9543010752688172, 'f1-score': 0.8765432098765432, 'support': 372}, '1': {'precision': 0.8040201005025126, 'recall': 0.7207207207207207, 'f1-score': 0.7600950118764845, 'support': 222}, '2': {'precision': 0.8260869565217391, 'recall': 0.8636363636363636, 'f1-score': 0.8444444444444444, 'support': 88}, '3': {'precision': 0.7666666666666667, 'recall': 0.45098039215686275, 'f1-score': 0.5679012345679013, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.42857142857142855, 'f1-score': 0.5581395348837209, 'support': 28}, '5': {'precision': 0.8666666666666667, 'recall': 0.7647058823529411, 'f1-score': 0.8125, 'support': 17}, '6': {'precision': 0.8095238095238095, 'recall': 0.7083333333333334, 'f1-score': 0.7555555555555556, 'support': 24}, '7': {'precision': 0.7402135231316725, 'recall': 0.8, 'f1-score': 0.7689463955637706, 'support': 260}, '8': {'precision': 0.6722222222222223, 'recall': 0.605, 'f1-score': 0.6368421052631579, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.24096385542168675, 'f1-score': 0.37037037037037035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7804331590739357, 'recall': 0.7464285714285714, 'f1-score': 0.7630522088353413, 'support': 1400}, 'macro avg': {'precision': 0.7544359180171281, 'recall': 0.6134654530230763, 'f1-score': 0.6595828691555129, 'support': 1400}, 'weighted avg': {'precision': 0.7788515165276932, 'recall': 0.7464285714285714, 'f1-score': 0.7480414749212054, 'support': 1400}, 'samples avg': {'precision': 0.7464285714285714, 'recall': 0.7464285714285714, 'f1-score': 0.7464285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8743589743589744, 'recall': 0.9472222222222222, 'f1-score': 0.9093333333333333, 'support': 360}, '1': {'precision': 0.8563829787234043, 'recall': 0.7385321100917431, 'f1-score': 0.793103448275862, 'support': 218}, '2': {'precision': 0.9320388349514563, 'recall': 0.8888888888888888, 'f1-score': 0.909952606635071, 'support': 108}, '3': {'precision': 0.9230769230769231, 'recall': 0.5142857142857142, 'f1-score': 0.6605504587155963, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.8695652173913043, 'recall': 0.7843137254901961, 'f1-score': 0.8247422680412372, 'support': 51}, '7': {'precision': 0.7737556561085973, 'recall': 0.7566371681415929, 'f1-score': 0.7651006711409396, 'support': 226}, '8': {'precision': 0.5714285714285714, 'recall': 0.6787878787878788, 'f1-score': 0.6204986149584487, 'support': 165}, '9': {'precision': 0.7441860465116279, 'recall': 0.3855421686746988, 'f1-score': 0.507936507936508, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.825, 'recall': 0.868421052631579, 'f1-score': 0.8461538461538461, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8097378277153559, 'recall': 0.7721428571428571, 'f1-score': 0.7904936014625229, 'support': 1400}, 'macro avg': {'precision': 0.769817772337592, 'recall': 0.6948277537957218, 'f1-score': 0.7218049654833568, 'support': 1400}, 'weighted avg': {'precision': 0.8102002741136272, 'recall': 0.7721428571428571, 'f1-score': 0.7830452078952598, 'support': 1400}, 'samples avg': {'precision': 0.7721428571428571, 'recall': 0.7721428571428571, 'f1-score': 0.7721428571428571, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 102s - loss: 0.4326 - acc: 0.8706 - precision: 0.8950 - recall: 0.8486 - val_loss: 1.0097 - val_acc: 0.7657 - val_precision: 0.7869 - val_recall: 0.7571 - 102s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8688946015424165, 'recall': 0.9086021505376344, 'f1-score': 0.8883048620236531, 'support': 372}, '1': {'precision': 0.7961165048543689, 'recall': 0.7387387387387387, 'f1-score': 0.7663551401869159, 'support': 222}, '2': {'precision': 0.8705882352941177, 'recall': 0.8409090909090909, 'f1-score': 0.8554913294797689, 'support': 88}, '3': {'precision': 0.6774193548387096, 'recall': 0.4117647058823529, 'f1-score': 0.5121951219512195, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.5357142857142857, 'f1-score': 0.6250000000000001, 'support': 28}, '5': {'precision': 0.8125, 'recall': 0.7647058823529411, 'f1-score': 0.787878787878788, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 24}, '7': {'precision': 0.6266666666666667, 'recall': 0.9038461538461539, 'f1-score': 0.7401574803149606, 'support': 260}, '8': {'precision': 0.6751592356687898, 'recall': 0.53, 'f1-score': 0.5938375350140056, 'support': 200}, '9': {'precision': 0.7222222222222222, 'recall': 0.1566265060240964, 'f1-score': 0.25742574257425743, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7642698295033358, 'recall': 0.7364285714285714, 'f1-score': 0.7500909421607858, 'support': 1400}, 'macro avg': {'precision': 0.7538128323913302, 'recall': 0.599023377723207, 'f1-score': 0.6477227691864283, 'support': 1400}, 'weighted avg': {'precision': 0.771320666118315, 'recall': 0.7364285714285714, 'f1-score': 0.7336592256573713, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9159420289855073, 'recall': 0.8777777777777778, 'f1-score': 0.8964539007092199, 'support': 360}, '1': {'precision': 0.8407960199004975, 'recall': 0.7752293577981652, 'f1-score': 0.8066825775656324, 'support': 218}, '2': {'precision': 0.94, 'recall': 0.8703703703703703, 'f1-score': 0.9038461538461539, 'support': 108}, '3': {'precision': 0.78125, 'recall': 0.35714285714285715, 'f1-score': 0.49019607843137253, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8048780487804879, 'recall': 0.9428571428571428, 'f1-score': 0.868421052631579, 'support': 35}, '6': {'precision': 0.8947368421052632, 'recall': 0.6666666666666666, 'f1-score': 0.7640449438202247, 'support': 51}, '7': {'precision': 0.6504854368932039, 'recall': 0.8893805309734514, 'f1-score': 0.7514018691588785, 'support': 226}, '8': {'precision': 0.5777777777777777, 'recall': 0.6303030303030303, 'f1-score': 0.6028985507246376, 'support': 165}, '9': {'precision': 0.7878787878787878, 'recall': 0.3132530120481928, 'f1-score': 0.44827586206896547, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.9090909090909091, 'recall': 0.7894736842105263, 'f1-score': 0.8450704225352113, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7869339272457313, 'recall': 0.7571428571428571, 'f1-score': 0.7717510010921005, 'support': 1400}, 'macro avg': {'precision': 0.7502450385970832, 'recall': 0.6689900011202895, 'f1-score': 0.6918040790502685, 'support': 1400}, 'weighted avg': {'precision': 0.7958914188296035, 'recall': 0.7571428571428571, 'f1-score': 0.7620924611422306, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 102s - loss: 0.3870 - acc: 0.8810 - precision: 0.8985 - recall: 0.8644 - val_loss: 1.0092 - val_acc: 0.7829 - val_precision: 0.8006 - val_recall: 0.7771 - 102s/epoch - 20ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8610421836228288, 'recall': 0.9327956989247311, 'f1-score': 0.8954838709677421, 'support': 372}, '1': {'precision': 0.8288770053475936, 'recall': 0.6981981981981982, 'f1-score': 0.7579462102689487, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.78125, 'recall': 0.49019607843137253, 'f1-score': 0.6024096385542168, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.5, 'f1-score': 0.6086956521739131, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.85, 'recall': 0.7083333333333334, 'f1-score': 0.7727272727272727, 'support': 24}, '7': {'precision': 0.7034700315457413, 'recall': 0.8576923076923076, 'f1-score': 0.7729636048526862, 'support': 260}, '8': {'precision': 0.6470588235294118, 'recall': 0.66, 'f1-score': 0.6534653465346535, 'support': 200}, '9': {'precision': 0.7058823529411765, 'recall': 0.2891566265060241, 'f1-score': 0.4102564102564103, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.780952380952381, 'recall': 0.7614285714285715, 'f1-score': 0.7710669077757685, 'support': 1400}, 'macro avg': {'precision': 0.7514644257272367, 'recall': 0.6291591294493255, 'f1-score': 0.6733493651989977, 'support': 1400}, 'weighted avg': {'precision': 0.7811993477505078, 'recall': 0.7614285714285715, 'f1-score': 0.7608194849763017, 'support': 1400}, 'samples avg': {'precision': 0.7614285714285715, 'recall': 0.7614285714285715, 'f1-score': 0.7614285714285715, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9140401146131805, 'recall': 0.8861111111111111, 'f1-score': 0.8998589562764456, 'support': 360}, '1': {'precision': 0.8702702702702703, 'recall': 0.7385321100917431, 'f1-score': 0.7990074441687346, 'support': 218}, '2': {'precision': 0.9333333333333333, 'recall': 0.9074074074074074, 'f1-score': 0.9201877934272301, 'support': 108}, '3': {'precision': 0.813953488372093, 'recall': 0.5, 'f1-score': 0.6194690265486725, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.72265625, 'recall': 0.8185840707964602, 'f1-score': 0.7676348547717843, 'support': 226}, '8': {'precision': 0.5488372093023256, 'recall': 0.7151515151515152, 'f1-score': 0.6210526315789474, 'support': 165}, '9': {'precision': 0.7407407407407407, 'recall': 0.4819277108433735, 'f1-score': 0.583941605839416, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8005886681383371, 'recall': 0.7771428571428571, 'f1-score': 0.7886915549111997, 'support': 1400}, 'macro avg': {'precision': 0.7637408010293977, 'recall': 0.7119195346614071, 'f1-score': 0.7304167975858783, 'support': 1400}, 'weighted avg': {'precision': 0.8081335411275054, 'recall': 0.7771428571428571, 'f1-score': 0.786073447406943, 'support': 1400}, 'samples avg': {'precision': 0.7771428571428571, 'recall': 0.7771428571428571, 'f1-score': 0.7771428571428571, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 103s - loss: 0.3233 - acc: 0.9010 - precision: 0.9155 - recall: 0.8864 - val_loss: 1.2970 - val_acc: 0.7893 - val_precision: 0.8025 - val_recall: 0.7779 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8151658767772512, 'recall': 0.9247311827956989, 'f1-score': 0.8664987405541561, 'support': 372}, '1': {'precision': 0.8192090395480226, 'recall': 0.6531531531531531, 'f1-score': 0.7268170426065163, 'support': 222}, '2': {'precision': 0.7547169811320755, 'recall': 0.9090909090909091, 'f1-score': 0.8247422680412373, 'support': 88}, '3': {'precision': 0.6170212765957447, 'recall': 0.5686274509803921, 'f1-score': 0.5918367346938775, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 24}, '7': {'precision': 0.6727272727272727, 'recall': 0.8538461538461538, 'f1-score': 0.7525423728813558, 'support': 260}, '8': {'precision': 0.6853932584269663, 'recall': 0.61, 'f1-score': 0.6455026455026455, 'support': 200}, '9': {'precision': 0.7142857142857143, 'recall': 0.18072289156626506, 'f1-score': 0.2884615384615385, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7543731778425656, 'recall': 0.7392857142857143, 'f1-score': 0.7467532467532466, 'support': 1400}, 'macro avg': {'precision': 0.7231676552319395, 'recall': 0.6048316039331157, 'f1-score': 0.6404106133947981, 'support': 1400}, 'weighted avg': {'precision': 0.7559702255496183, 'recall': 0.7392857142857143, 'f1-score': 0.7313811806120665, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9111111111111111, 'recall': 0.9111111111111111, 'f1-score': 0.9111111111111111, 'support': 360}, '1': {'precision': 0.8693181818181818, 'recall': 0.7018348623853211, 'f1-score': 0.7766497461928934, 'support': 218}, '2': {'precision': 0.8188976377952756, 'recall': 0.9629629629629629, 'f1-score': 0.8851063829787233, 'support': 108}, '3': {'precision': 0.711864406779661, 'recall': 0.6, 'f1-score': 0.6511627906976744, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8709677419354839, 'recall': 0.7714285714285715, 'f1-score': 0.8181818181818182, 'support': 35}, '6': {'precision': 0.8809523809523809, 'recall': 0.7254901960784313, 'f1-score': 0.7956989247311828, 'support': 51}, '7': {'precision': 0.7089552238805971, 'recall': 0.8407079646017699, 'f1-score': 0.7692307692307693, 'support': 226}, '8': {'precision': 0.6333333333333333, 'recall': 0.6909090909090909, 'f1-score': 0.6608695652173913, 'support': 165}, '9': {'precision': 0.8095238095238095, 'recall': 0.40963855421686746, 'f1-score': 0.544, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8571428571428571, 'recall': 0.7894736842105263, 'f1-score': 0.8219178082191781, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8025055268975682, 'recall': 0.7778571428571428, 'f1-score': 0.7899891186071817, 'support': 1400}, 'macro avg': {'precision': 0.7492129652020559, 'recall': 0.7003735153233349, 'f1-score': 0.7167735308221328, 'support': 1400}, 'weighted avg': {'precision': 0.8035299387952002, 'recall': 0.7778571428571428, 'f1-score': 0.7832830494427276, 'support': 1400}, 'samples avg': {'precision': 0.7778571428571428, 'recall': 0.7778571428571428, 'f1-score': 0.7778571428571428, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 2 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:05:05.472438: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:05:05.706555: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:05:07.291036: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:05:07.291244: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:05:07.291260: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=2, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:05:16.836477: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:05:17.362529: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3440209.97it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3191318.26it/s]
Mon May 22 05:05:23 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:05:28.681207: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 2:11 11/148 [=>............................] - ETA: 0s   21/148 [===>..........................] - ETA: 0s 31/148 [=====>........................] - ETA: 0s 41/148 [=======>......................] - ETA: 0s 52/148 [=========>....................] - ETA: 0s 63/148 [===========>..................] - ETA: 0s 74/148 [==============>...............] - ETA: 0s 85/148 [================>.............] - ETA: 0s102/148 [===================>..........] - ETA: 0s119/148 [=======================>......] - ETA: 0s136/148 [==========================>...] - ETA: 0s148/148 [==============================] - 2s 4ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2278274.85it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2569814.27it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2713354.90it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 81205.64it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2551945.07it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82511.67it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3098694.25it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2973177.52it/s]
Mon May 22 05:05:32 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 3s 9/44 [=====>........................] - ETA: 0s25/44 [================>.............] - ETA: 0s41/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 4ms/step
 1/44 [..............................] - ETA: 1s11/44 [======>.......................] - ETA: 0s25/44 [================>.............] - ETA: 0s41/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 4ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2091922.19it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2340384.85it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2515863.58it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82561.56it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2587935.48it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84345.16it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               2 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 5120)  146850816   ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 294,379,789
Trainable params: 294,379,789
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 5120)  146850816   ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 294,379,789
Trainable params: 294,379,789
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 72s - loss: 0.6798 - acc: 0.7978 - precision: 0.8569 - recall: 0.7488 - val_loss: 0.8878 - val_acc: 0.7793 - val_precision: 0.7988 - val_recall: 0.7657 - 72s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8442822384428224, 'recall': 0.9327956989247311, 'f1-score': 0.8863346104725414, 'support': 372}, '1': {'precision': 0.7892156862745098, 'recall': 0.7252252252252253, 'f1-score': 0.755868544600939, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.23529411764705882, 'f1-score': 0.38095238095238093, 'support': 51}, '4': {'precision': 0.7368421052631579, 'recall': 0.5, 'f1-score': 0.5957446808510638, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.7619047619047619, 'recall': 0.6666666666666666, 'f1-score': 0.7111111111111111, 'support': 24}, '7': {'precision': 0.6906906906906907, 'recall': 0.8846153846153846, 'f1-score': 0.775716694772344, 'support': 260}, '8': {'precision': 0.6742857142857143, 'recall': 0.59, 'f1-score': 0.6293333333333333, 'support': 200}, '9': {'precision': 0.7142857142857143, 'recall': 0.18072289156626506, 'f1-score': 0.2884615384615385, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7736411020104245, 'recall': 0.7421428571428571, 'f1-score': 0.7575647101713453, 'support': 1400}, 'macro avg': {'precision': 0.7642901243869018, 'recall': 0.5752874727016396, 'f1-score': 0.6209365096175419, 'support': 1400}, 'weighted avg': {'precision': 0.7786813565191697, 'recall': 0.7421428571428571, 'f1-score': 0.7361987260574216, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9111111111111111, 'recall': 0.9111111111111111, 'f1-score': 0.9111111111111111, 'support': 360}, '1': {'precision': 0.8461538461538461, 'recall': 0.7568807339449541, 'f1-score': 0.7990314769975787, 'support': 218}, '2': {'precision': 0.9339622641509434, 'recall': 0.9166666666666666, 'f1-score': 0.9252336448598131, 'support': 108}, '3': {'precision': 0.9, 'recall': 0.2571428571428571, 'f1-score': 0.39999999999999997, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8857142857142857, 'recall': 0.8857142857142857, 'f1-score': 0.8857142857142857, 'support': 35}, '6': {'precision': 0.8367346938775511, 'recall': 0.803921568627451, 'f1-score': 0.8200000000000001, 'support': 51}, '7': {'precision': 0.7300380228136882, 'recall': 0.8495575221238938, 'f1-score': 0.7852760736196319, 'support': 226}, '8': {'precision': 0.5445544554455446, 'recall': 0.6666666666666666, 'f1-score': 0.5994550408719347, 'support': 165}, '9': {'precision': 0.6818181818181818, 'recall': 0.3614457831325301, 'f1-score': 0.47244094488188976, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5, 'f1-score': 0.6666666666666666, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7988077496274217, 'recall': 0.7657142857142857, 'f1-score': 0.7819110138584973, 'support': 1400}, 'macro avg': {'precision': 0.7626622312005613, 'recall': 0.6597362546125348, 'f1-score': 0.6862133385051591, 'support': 1400}, 'weighted avg': {'precision': 0.8039729463579414, 'recall': 0.7657142857142857, 'f1-score': 0.7703006738065783, 'support': 1400}, 'samples avg': {'precision': 0.7657142857142857, 'recall': 0.7657142857142857, 'f1-score': 0.7657142857142857, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 71s - loss: 0.4495 - acc: 0.8616 - precision: 0.8826 - recall: 0.8392 - val_loss: 0.9434 - val_acc: 0.7757 - val_precision: 0.7850 - val_recall: 0.7693 - 71s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8639798488664987, 'recall': 0.9220430107526881, 'f1-score': 0.8920676202860857, 'support': 372}, '1': {'precision': 0.8125, 'recall': 0.7027027027027027, 'f1-score': 0.7536231884057971, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.47058823529411764, 'f1-score': 0.6075949367088607, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5833333333333334, 'f1-score': 0.7368421052631579, 'support': 24}, '7': {'precision': 0.709375, 'recall': 0.8730769230769231, 'f1-score': 0.7827586206896551, 'support': 260}, '8': {'precision': 0.6052631578947368, 'recall': 0.69, 'f1-score': 0.6448598130841122, 'support': 200}, '9': {'precision': 0.6785714285714286, 'recall': 0.2289156626506024, 'f1-score': 0.34234234234234234, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7741228070175439, 'recall': 0.7564285714285715, 'f1-score': 0.7651734104046244, 'support': 1400}, 'macro avg': {'precision': 0.7739657318998264, 'recall': 0.5901027473496184, 'f1-score': 0.6458646692305486, 'support': 1400}, 'weighted avg': {'precision': 0.7800168370465866, 'recall': 0.7564285714285715, 'f1-score': 0.752761964118337, 'support': 1400}, 'samples avg': {'precision': 0.7564285714285715, 'recall': 0.7564285714285715, 'f1-score': 0.7564285714285715, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9285714285714286, 'recall': 0.9027777777777778, 'f1-score': 0.9154929577464788, 'support': 360}, '1': {'precision': 0.8532608695652174, 'recall': 0.7201834862385321, 'f1-score': 0.7810945273631842, 'support': 218}, '2': {'precision': 0.908256880733945, 'recall': 0.9166666666666666, 'f1-score': 0.912442396313364, 'support': 108}, '3': {'precision': 0.8611111111111112, 'recall': 0.44285714285714284, 'f1-score': 0.5849056603773586, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.9375, 'recall': 0.8571428571428571, 'f1-score': 0.8955223880597014, 'support': 35}, '6': {'precision': 0.9375, 'recall': 0.5882352941176471, 'f1-score': 0.7228915662650602, 'support': 51}, '7': {'precision': 0.71875, 'recall': 0.8141592920353983, 'f1-score': 0.7634854771784233, 'support': 226}, '8': {'precision': 0.4859437751004016, 'recall': 0.7333333333333333, 'f1-score': 0.5845410628019323, 'support': 165}, '9': {'precision': 0.7169811320754716, 'recall': 0.4578313253012048, 'f1-score': 0.5588235294117646, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7849854227405247, 'recall': 0.7692857142857142, 'f1-score': 0.777056277056277, 'support': 1400}, 'macro avg': {'precision': 0.7695782154744308, 'recall': 0.68556458476857, 'f1-score': 0.7139384136316218, 'support': 1400}, 'weighted avg': {'precision': 0.8044147616883647, 'recall': 0.7692857142857142, 'f1-score': 0.7758775116685174, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 70s - loss: 0.3884 - acc: 0.8820 - precision: 0.8977 - recall: 0.8668 - val_loss: 0.9670 - val_acc: 0.7907 - val_precision: 0.8056 - val_recall: 0.7814 - 70s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8686868686868687, 'recall': 0.9247311827956989, 'f1-score': 0.8958333333333334, 'support': 372}, '1': {'precision': 0.7989690721649485, 'recall': 0.6981981981981982, 'f1-score': 0.7451923076923077, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.88, 'recall': 0.43137254901960786, 'f1-score': 0.5789473684210527, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.5357142857142857, 'f1-score': 0.6122448979591837, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.6590909090909091, 'recall': 0.8923076923076924, 'f1-score': 0.7581699346405228, 'support': 260}, '8': {'precision': 0.6417112299465241, 'recall': 0.6, 'f1-score': 0.6201550387596899, 'support': 200}, '9': {'precision': 0.6111111111111112, 'recall': 0.26506024096385544, 'f1-score': 0.3697478991596639, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7837837837837838, 'f1-score': 0.8787878787878788, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7653061224489796, 'recall': 0.75, 'f1-score': 0.7575757575757575, 'support': 1400}, 'macro avg': {'precision': 0.7537169782501453, 'recall': 0.5941087632375334, 'f1-score': 0.6437545775088397, 'support': 1400}, 'weighted avg': {'precision': 0.7688259962663845, 'recall': 0.75, 'f1-score': 0.7455040664869921, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9250720461095101, 'recall': 0.8916666666666667, 'f1-score': 0.9080622347949081, 'support': 360}, '1': {'precision': 0.8707865168539326, 'recall': 0.7110091743119266, 'f1-score': 0.7828282828282828, 'support': 218}, '2': {'precision': 0.9259259259259259, 'recall': 0.9259259259259259, 'f1-score': 0.9259259259259259, 'support': 108}, '3': {'precision': 0.8918918918918919, 'recall': 0.4714285714285714, 'f1-score': 0.6168224299065421, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8857142857142857, 'recall': 0.8857142857142857, 'f1-score': 0.8857142857142857, 'support': 35}, '6': {'precision': 0.9512195121951219, 'recall': 0.7647058823529411, 'f1-score': 0.8478260869565216, 'support': 51}, '7': {'precision': 0.7028985507246377, 'recall': 0.8584070796460177, 'f1-score': 0.7729083665338645, 'support': 226}, '8': {'precision': 0.5707317073170731, 'recall': 0.7090909090909091, 'f1-score': 0.6324324324324324, 'support': 165}, '9': {'precision': 0.7142857142857143, 'recall': 0.5421686746987951, 'f1-score': 0.6164383561643836, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8055964653902798, 'recall': 0.7814285714285715, 'f1-score': 0.7933284989122553, 'support': 1400}, 'macro avg': {'precision': 0.7766596542092016, 'recall': 0.6922315273920882, 'f1-score': 0.721419488519392, 'support': 1400}, 'weighted avg': {'precision': 0.8159238084063575, 'recall': 0.7814285714285715, 'f1-score': 0.7903043358557111, 'support': 1400}, 'samples avg': {'precision': 0.7814285714285715, 'recall': 0.7814285714285715, 'f1-score': 0.7814285714285715, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 71s - loss: 0.3083 - acc: 0.9032 - precision: 0.9167 - recall: 0.8910 - val_loss: 1.0372 - val_acc: 0.7957 - val_precision: 0.8064 - val_recall: 0.7914 - 71s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8692307692307693, 'recall': 0.9112903225806451, 'f1-score': 0.889763779527559, 'support': 372}, '1': {'precision': 0.7990196078431373, 'recall': 0.7342342342342343, 'f1-score': 0.7652582159624414, 'support': 222}, '2': {'precision': 0.7920792079207921, 'recall': 0.9090909090909091, 'f1-score': 0.8465608465608466, 'support': 88}, '3': {'precision': 0.6578947368421053, 'recall': 0.49019607843137253, 'f1-score': 0.5617977528089888, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 24}, '7': {'precision': 0.6794117647058824, 'recall': 0.8884615384615384, 'f1-score': 0.77, 'support': 260}, '8': {'precision': 0.6536312849162011, 'recall': 0.585, 'f1-score': 0.6174142480211081, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.25301204819277107, 'f1-score': 0.3716814159292035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7713659605551497, 'recall': 0.7542857142857143, 'f1-score': 0.76273022751896, 'support': 1400}, 'macro avg': {'precision': 0.7511006501724543, 'recall': 0.6168408212073722, 'f1-score': 0.663080507022382, 'support': 1400}, 'weighted avg': {'precision': 0.7715614987894304, 'recall': 0.7542857142857143, 'f1-score': 0.7507743162320883, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9283667621776505, 'recall': 0.9, 'f1-score': 0.9139633286318759, 'support': 360}, '1': {'precision': 0.8477157360406091, 'recall': 0.7660550458715596, 'f1-score': 0.8048192771084336, 'support': 218}, '2': {'precision': 0.8849557522123894, 'recall': 0.9259259259259259, 'f1-score': 0.9049773755656108, 'support': 108}, '3': {'precision': 0.8222222222222222, 'recall': 0.5285714285714286, 'f1-score': 0.6434782608695652, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 51}, '7': {'precision': 0.7310606060606061, 'recall': 0.8539823008849557, 'f1-score': 0.7877551020408164, 'support': 226}, '8': {'precision': 0.5576923076923077, 'recall': 0.703030303030303, 'f1-score': 0.6219839142091154, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.4819277108433735, 'f1-score': 0.6015037593984962, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8064046579330422, 'recall': 0.7914285714285715, 'f1-score': 0.798846431146359, 'support': 1400}, 'macro avg': {'precision': 0.7680325537550459, 'recall': 0.719009607475921, 'f1-score': 0.7348000180333659, 'support': 1400}, 'weighted avg': {'precision': 0.8137304701879409, 'recall': 0.7914285714285715, 'f1-score': 0.795529806026066, 'support': 1400}, 'samples avg': {'precision': 0.7914285714285715, 'recall': 0.7914285714285715, 'f1-score': 0.7914285714285715, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 71s - loss: 0.2706 - acc: 0.9150 - precision: 0.9262 - recall: 0.9058 - val_loss: 1.3211 - val_acc: 0.7986 - val_precision: 0.8057 - val_recall: 0.7936 - 71s/epoch - 14ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.7991169977924945, 'recall': 0.9731182795698925, 'f1-score': 0.8775757575757575, 'support': 372}, '1': {'precision': 0.782608695652174, 'recall': 0.7297297297297297, 'f1-score': 0.7552447552447553, 'support': 222}, '2': {'precision': 0.8085106382978723, 'recall': 0.8636363636363636, 'f1-score': 0.8351648351648351, 'support': 88}, '3': {'precision': 0.9411764705882353, 'recall': 0.3137254901960784, 'f1-score': 0.47058823529411764, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6376021798365122, 'recall': 0.9, 'f1-score': 0.7464114832535885, 'support': 260}, '8': {'precision': 0.765625, 'recall': 0.49, 'f1-score': 0.5975609756097561, 'support': 200}, '9': {'precision': 0.7096774193548387, 'recall': 0.26506024096385544, 'f1-score': 0.3859649122807018, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7333333333333333, 'f1-score': 0.846153846153846, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7837837837837838, 'f1-score': 0.8787878787878788, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7581227436823105, 'recall': 0.75, 'f1-score': 0.7540394973070017, 'support': 1400}, 'macro avg': {'precision': 0.7696708392533889, 'recall': 0.6027962158959392, 'f1-score': 0.6532002899948393, 'support': 1400}, 'weighted avg': {'precision': 0.7693605237321008, 'recall': 0.75, 'f1-score': 0.7352723809764485, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8944591029023746, 'recall': 0.9416666666666667, 'f1-score': 0.9174560216508795, 'support': 360}, '1': {'precision': 0.8325123152709359, 'recall': 0.7752293577981652, 'f1-score': 0.8028503562945367, 'support': 218}, '2': {'precision': 0.9245283018867925, 'recall': 0.9074074074074074, 'f1-score': 0.9158878504672898, 'support': 108}, '3': {'precision': 0.9393939393939394, 'recall': 0.44285714285714284, 'f1-score': 0.6019417475728155, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.9090909090909091, 'recall': 0.8571428571428571, 'f1-score': 0.8823529411764706, 'support': 35}, '6': {'precision': 0.9487179487179487, 'recall': 0.7254901960784313, 'f1-score': 0.8222222222222223, 'support': 51}, '7': {'precision': 0.66996699669967, 'recall': 0.8982300884955752, 'f1-score': 0.7674858223062382, 'support': 226}, '8': {'precision': 0.6474358974358975, 'recall': 0.6121212121212121, 'f1-score': 0.6292834890965732, 'support': 165}, '9': {'precision': 0.8085106382978723, 'recall': 0.4578313253012048, 'f1-score': 0.5846153846153845, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8333333333333334, 'recall': 0.9210526315789473, 'f1-score': 0.875, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8056562726613488, 'recall': 0.7935714285714286, 'f1-score': 0.7995681899964017, 'support': 1400}, 'macro avg': {'precision': 0.7702881911137653, 'recall': 0.7107944297497162, 'f1-score': 0.7270156242381459, 'support': 1400}, 'weighted avg': {'precision': 0.8105065058664678, 'recall': 0.7935714285714286, 'f1-score': 0.7910025976764102, 'support': 1400}, 'samples avg': {'precision': 0.7935714285714286, 'recall': 0.7935714285714286, 'f1-score': 0.7935714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:12:49.216421: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:12:49.478840: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:12:52.139036: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:12:52.139257: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:12:52.139273: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:13:10.490958: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:13:11.023351: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3413888.98it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3180945.61it/s]
Mon May 22 05:13:15 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:13:20.642185: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 2:03 13/148 [=>............................] - ETA: 0s   23/148 [===>..........................] - ETA: 0s 33/148 [=====>........................] - ETA: 0s 43/148 [=======>......................] - ETA: 0s 53/148 [=========>....................] - ETA: 0s 63/148 [===========>..................] - ETA: 0s 73/148 [=============>................] - ETA: 0s 83/148 [===============>..............] - ETA: 0s 96/148 [==================>...........] - ETA: 0s112/148 [=====================>........] - ETA: 0s128/148 [========================>.....] - ETA: 0s143/148 [===========================>..] - ETA: 0s148/148 [==============================] - 1s 4ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2315504.03it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2615601.60it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2747120.78it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82936.62it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2615601.60it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83854.93it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3082428.14it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3056754.61it/s]
Mon May 22 05:13:24 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s 9/44 [=====>........................] - ETA: 0s25/44 [================>.............] - ETA: 0s41/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 4ms/step
 1/44 [..............................] - ETA: 1s 9/44 [=====>........................] - ETA: 0s25/44 [================>.............] - ETA: 0s40/44 [==========================>...] - ETA: 0s44/44 [==============================] - 0s 4ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2077857.61it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2356350.56it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2512633.98it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 81802.45it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2597092.26it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82960.48it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               3 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 5120)  146850816   ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 5120)  146850816   ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 441,230,605
Trainable params: 441,230,605
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 5120)  146850816   ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 5120)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 5120)  146850816   ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 441,230,605
Trainable params: 441,230,605
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 105s - loss: 0.6959 - acc: 0.7976 - precision: 0.8539 - recall: 0.7480 - val_loss: 0.8870 - val_acc: 0.7807 - val_precision: 0.7978 - val_recall: 0.7693 - 105s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8575, 'recall': 0.9220430107526881, 'f1-score': 0.8886010362694301, 'support': 372}, '1': {'precision': 0.8, 'recall': 0.7027027027027027, 'f1-score': 0.7482014388489208, 'support': 222}, '2': {'precision': 0.7714285714285715, 'recall': 0.9204545454545454, 'f1-score': 0.839378238341969, 'support': 88}, '3': {'precision': 0.9130434782608695, 'recall': 0.4117647058823529, 'f1-score': 0.5675675675675675, 'support': 51}, '4': {'precision': 0.8181818181818182, 'recall': 0.32142857142857145, 'f1-score': 0.46153846153846156, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9230769230769231, 'recall': 0.5, 'f1-score': 0.6486486486486487, 'support': 24}, '7': {'precision': 0.6763005780346821, 'recall': 0.9, 'f1-score': 0.7722772277227723, 'support': 260}, '8': {'precision': 0.703030303030303, 'recall': 0.58, 'f1-score': 0.6356164383561643, 'support': 200}, '9': {'precision': 0.6666666666666666, 'recall': 0.1686746987951807, 'f1-score': 0.2692307692307692, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7791134485349361, 'recall': 0.7407142857142858, 'f1-score': 0.7594287806664226, 'support': 1400}, 'macro avg': {'precision': 0.773254250904366, 'recall': 0.5802893383667714, 'f1-score': 0.6366601703526465, 'support': 1400}, 'weighted avg': {'precision': 0.7825526576147677, 'recall': 0.7407142857142858, 'f1-score': 0.740148592436349, 'support': 1400}, 'samples avg': {'precision': 0.7407142857142858, 'recall': 0.7407142857142858, 'f1-score': 0.7407142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9073569482288828, 'recall': 0.925, 'f1-score': 0.9160935350756534, 'support': 360}, '1': {'precision': 0.8461538461538461, 'recall': 0.7568807339449541, 'f1-score': 0.7990314769975787, 'support': 218}, '2': {'precision': 0.859504132231405, 'recall': 0.9629629629629629, 'f1-score': 0.908296943231441, 'support': 108}, '3': {'precision': 0.8787878787878788, 'recall': 0.4142857142857143, 'f1-score': 0.5631067961165049, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.8235294117647058, 'recall': 0.8, 'f1-score': 0.8115942028985507, 'support': 35}, '6': {'precision': 0.9393939393939394, 'recall': 0.6078431372549019, 'f1-score': 0.738095238095238, 'support': 51}, '7': {'precision': 0.7132075471698113, 'recall': 0.8362831858407079, 'f1-score': 0.769857433808554, 'support': 226}, '8': {'precision': 0.5618556701030928, 'recall': 0.6606060606060606, 'f1-score': 0.607242339832869, 'support': 165}, '9': {'precision': 0.75, 'recall': 0.3614457831325301, 'f1-score': 0.4878048780487804, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8857142857142857, 'recall': 0.8157894736842105, 'f1-score': 0.8493150684931505, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7977777777777778, 'recall': 0.7692857142857142, 'f1-score': 0.7832727272727272, 'support': 1400}, 'macro avg': {'precision': 0.7602729824869079, 'recall': 0.6731912817001272, 'f1-score': 0.7008243583263783, 'support': 1400}, 'weighted avg': {'precision': 0.8016792236272122, 'recall': 0.7692857142857142, 'f1-score': 0.7739905993026569, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 103s - loss: 0.4587 - acc: 0.8646 - precision: 0.8886 - recall: 0.8404 - val_loss: 0.8719 - val_acc: 0.7914 - val_precision: 0.8071 - val_recall: 0.7743 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8967391304347826, 'recall': 0.8870967741935484, 'f1-score': 0.8918918918918919, 'support': 372}, '1': {'precision': 0.7924528301886793, 'recall': 0.7567567567567568, 'f1-score': 0.7741935483870969, 'support': 222}, '2': {'precision': 0.79, 'recall': 0.8977272727272727, 'f1-score': 0.8404255319148937, 'support': 88}, '3': {'precision': 0.7435897435897436, 'recall': 0.5686274509803921, 'f1-score': 0.6444444444444445, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.4583333333333333, 'f1-score': 0.6285714285714286, 'support': 24}, '7': {'precision': 0.6794117647058824, 'recall': 0.8884615384615384, 'f1-score': 0.77, 'support': 260}, '8': {'precision': 0.6684782608695652, 'recall': 0.615, 'f1-score': 0.640625, 'support': 200}, '9': {'precision': 0.5555555555555556, 'recall': 0.24096385542168675, 'f1-score': 0.3361344537815126, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7739322533136966, 'recall': 0.7507142857142857, 'f1-score': 0.7621464829586656, 'support': 1400}, 'macro avg': {'precision': 0.7468481869725656, 'recall': 0.5867137840958125, 'f1-score': 0.63546683905284, 'support': 1400}, 'weighted avg': {'precision': 0.7735788669784188, 'recall': 0.7507142857142857, 'f1-score': 0.7506348135360548, 'support': 1400}, 'samples avg': {'precision': 0.7507142857142857, 'recall': 0.7507142857142857, 'f1-score': 0.7507142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9461077844311377, 'recall': 0.8777777777777778, 'f1-score': 0.9106628242074927, 'support': 360}, '1': {'precision': 0.8099547511312217, 'recall': 0.8211009174311926, 'f1-score': 0.8154897494305239, 'support': 218}, '2': {'precision': 0.9043478260869565, 'recall': 0.9629629629629629, 'f1-score': 0.9327354260089685, 'support': 108}, '3': {'precision': 0.7906976744186046, 'recall': 0.4857142857142857, 'f1-score': 0.6017699115044247, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.84375, 'recall': 0.7714285714285715, 'f1-score': 0.8059701492537314, 'support': 35}, '6': {'precision': 1.0, 'recall': 0.43137254901960786, 'f1-score': 0.6027397260273972, 'support': 51}, '7': {'precision': 0.7364341085271318, 'recall': 0.8407079646017699, 'f1-score': 0.7851239669421488, 'support': 226}, '8': {'precision': 0.5692307692307692, 'recall': 0.6727272727272727, 'f1-score': 0.6166666666666667, 'support': 165}, '9': {'precision': 0.7755102040816326, 'recall': 0.4578313253012048, 'f1-score': 0.5757575757575758, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.875, 'recall': 0.9210526315789473, 'f1-score': 0.8974358974358975, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8071481757259866, 'recall': 0.7742857142857142, 'f1-score': 0.7903755012759752, 'support': 1400}, 'macro avg': {'precision': 0.7675619880907831, 'recall': 0.6790070648430137, 'f1-score': 0.707284734121883, 'support': 1400}, 'weighted avg': {'precision': 0.8133522306839241, 'recall': 0.7742857142857142, 'f1-score': 0.7838749424989666, 'support': 1400}, 'samples avg': {'precision': 0.7742857142857142, 'recall': 0.7742857142857142, 'f1-score': 0.7742857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 103s - loss: 0.3964 - acc: 0.8794 - precision: 0.8995 - recall: 0.8646 - val_loss: 1.0741 - val_acc: 0.7714 - val_precision: 0.7775 - val_recall: 0.7636 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8772845953002611, 'recall': 0.9032258064516129, 'f1-score': 0.890066225165563, 'support': 372}, '1': {'precision': 0.8294117647058824, 'recall': 0.6351351351351351, 'f1-score': 0.7193877551020408, 'support': 222}, '2': {'precision': 0.797979797979798, 'recall': 0.8977272727272727, 'f1-score': 0.8449197860962567, 'support': 88}, '3': {'precision': 0.75, 'recall': 0.5294117647058824, 'f1-score': 0.6206896551724139, 'support': 51}, '4': {'precision': 0.7368421052631579, 'recall': 0.5, 'f1-score': 0.5957446808510638, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6745562130177515, 'recall': 0.8769230769230769, 'f1-score': 0.762541806020067, 'support': 260}, '8': {'precision': 0.6126126126126126, 'recall': 0.68, 'f1-score': 0.6445497630331753, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.25301204819277107, 'f1-score': 0.3783783783783783, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7567567567567568, 'f1-score': 0.8615384615384616, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7670830271858927, 'recall': 0.7457142857142857, 'f1-score': 0.7562477363274175, 'support': 1400}, 'macro avg': {'precision': 0.7523512913944295, 'recall': 0.5984416061923347, 'f1-score': 0.6448236718587016, 'support': 1400}, 'weighted avg': {'precision': 0.7769895236250617, 'recall': 0.7457142857142857, 'f1-score': 0.7454206194365315, 'support': 1400}, 'samples avg': {'precision': 0.7457142857142857, 'recall': 0.7457142857142857, 'f1-score': 0.7457142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9269005847953217, 'recall': 0.8805555555555555, 'f1-score': 0.9031339031339031, 'support': 360}, '1': {'precision': 0.8947368421052632, 'recall': 0.6238532110091743, 'f1-score': 0.7351351351351353, 'support': 218}, '2': {'precision': 0.8632478632478633, 'recall': 0.9351851851851852, 'f1-score': 0.8977777777777779, 'support': 108}, '3': {'precision': 0.75, 'recall': 0.5142857142857142, 'f1-score': 0.6101694915254237, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7153558052434457, 'recall': 0.8451327433628318, 'f1-score': 0.7748478701825556, 'support': 226}, '8': {'precision': 0.49206349206349204, 'recall': 0.7515151515151515, 'f1-score': 0.594724220623501, 'support': 165}, '9': {'precision': 0.7450980392156863, 'recall': 0.4578313253012048, 'f1-score': 0.5671641791044776, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6428571428571429, 'f1-score': 0.782608695652174, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7774545454545455, 'recall': 0.7635714285714286, 'f1-score': 0.7704504504504506, 'support': 1400}, 'macro avg': {'precision': 0.7503540951455598, 'recall': 0.6832081041529638, 'f1-score': 0.7040102218876747, 'support': 1400}, 'weighted avg': {'precision': 0.7989279807130809, 'recall': 0.7635714285714286, 'f1-score': 0.7692050914471318, 'support': 1400}, 'samples avg': {'precision': 0.7635714285714286, 'recall': 0.7635714285714286, 'f1-score': 0.7635714285714286, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 103s - loss: 0.3460 - acc: 0.8912 - precision: 0.9058 - recall: 0.8752 - val_loss: 1.1332 - val_acc: 0.7800 - val_precision: 0.7918 - val_recall: 0.7743 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8626943005181347, 'recall': 0.8951612903225806, 'f1-score': 0.8786279683377309, 'support': 372}, '1': {'precision': 0.8315217391304348, 'recall': 0.6891891891891891, 'f1-score': 0.7536945812807881, 'support': 222}, '2': {'precision': 0.8105263157894737, 'recall': 0.875, 'f1-score': 0.8415300546448087, 'support': 88}, '3': {'precision': 0.6444444444444445, 'recall': 0.5686274509803921, 'f1-score': 0.6041666666666666, 'support': 51}, '4': {'precision': 0.6818181818181818, 'recall': 0.5357142857142857, 'f1-score': 0.6, 'support': 28}, '5': {'precision': 0.75, 'recall': 0.7058823529411765, 'f1-score': 0.7272727272727272, 'support': 17}, '6': {'precision': 0.7037037037037037, 'recall': 0.7916666666666666, 'f1-score': 0.7450980392156864, 'support': 24}, '7': {'precision': 0.7233333333333334, 'recall': 0.8346153846153846, 'f1-score': 0.775, 'support': 260}, '8': {'precision': 0.6017699115044248, 'recall': 0.68, 'f1-score': 0.6384976525821596, 'support': 200}, '9': {'precision': 0.7352941176470589, 'recall': 0.30120481927710846, 'f1-score': 0.4273504273504274, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7333333333333333, 'f1-score': 0.846153846153846, 'support': 15}, '11': {'precision': 0.8857142857142857, 'recall': 0.8378378378378378, 'f1-score': 0.8611111111111112, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7661115133960897, 'recall': 0.7557142857142857, 'f1-score': 0.7608773822366054, 'support': 1400}, 'macro avg': {'precision': 0.7100631025848827, 'recall': 0.649864046990612, 'f1-score': 0.6691156211243041, 'support': 1400}, 'weighted avg': {'precision': 0.7683316968709479, 'recall': 0.7557142857142857, 'f1-score': 0.7537899786924737, 'support': 1400}, 'samples avg': {'precision': 0.7557142857142857, 'recall': 0.7557142857142857, 'f1-score': 0.7557142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9193083573487032, 'recall': 0.8861111111111111, 'f1-score': 0.9024045261669024, 'support': 360}, '1': {'precision': 0.8823529411764706, 'recall': 0.6880733944954128, 'f1-score': 0.7731958762886597, 'support': 218}, '2': {'precision': 0.9174311926605505, 'recall': 0.9259259259259259, 'f1-score': 0.9216589861751153, 'support': 108}, '3': {'precision': 0.7777777777777778, 'recall': 0.6, 'f1-score': 0.6774193548387097, 'support': 70}, '4': {'precision': 0.6206896551724138, 'recall': 0.8181818181818182, 'f1-score': 0.7058823529411765, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.8888888888888888, 'recall': 0.7843137254901961, 'f1-score': 0.8333333333333334, 'support': 51}, '7': {'precision': 0.7542372881355932, 'recall': 0.7876106194690266, 'f1-score': 0.7705627705627707, 'support': 226}, '8': {'precision': 0.5063291139240507, 'recall': 0.7272727272727273, 'f1-score': 0.5970149253731343, 'support': 165}, '9': {'precision': 0.7272727272727273, 'recall': 0.4819277108433735, 'f1-score': 0.5797101449275363, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7918188458729, 'recall': 0.7742857142857142, 'f1-score': 0.7829541350668111, 'support': 1400}, 'macro avg': {'precision': 0.7478737013689056, 'recall': 0.721528320046857, 'f1-score': 0.7279963460162135, 'support': 1400}, 'weighted avg': {'precision': 0.8052512162623782, 'recall': 0.7742857142857142, 'f1-score': 0.7830284319244953, 'support': 1400}, 'samples avg': {'precision': 0.7742857142857142, 'recall': 0.7742857142857142, 'f1-score': 0.7742857142857142, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 103s - loss: 0.2932 - acc: 0.9076 - precision: 0.9200 - recall: 0.8974 - val_loss: 1.3436 - val_acc: 0.7979 - val_precision: 0.8081 - val_recall: 0.7943 - 103s/epoch - 21ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8407960199004975, 'recall': 0.9086021505376344, 'f1-score': 0.8733850129198967, 'support': 372}, '1': {'precision': 0.8100558659217877, 'recall': 0.6531531531531531, 'f1-score': 0.7231920199501248, 'support': 222}, '2': {'precision': 0.7878787878787878, 'recall': 0.8863636363636364, 'f1-score': 0.8342245989304813, 'support': 88}, '3': {'precision': 0.6304347826086957, 'recall': 0.5686274509803921, 'f1-score': 0.5979381443298969, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.8181818181818182, 'recall': 0.75, 'f1-score': 0.7826086956521738, 'support': 24}, '7': {'precision': 0.6465753424657534, 'recall': 0.9076923076923077, 'f1-score': 0.7552000000000001, 'support': 260}, '8': {'precision': 0.710691823899371, 'recall': 0.565, 'f1-score': 0.629526462395543, 'support': 200}, '9': {'precision': 0.6896551724137931, 'recall': 0.24096385542168675, 'f1-score': 0.35714285714285715, 'support': 83}, '10': {'precision': 0.9, 'recall': 0.6, 'f1-score': 0.7200000000000001, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7563636363636363, 'recall': 0.7428571428571429, 'f1-score': 0.7495495495495496, 'support': 1400}, 'macro avg': {'precision': 0.715786576586419, 'recall': 0.6180272619353449, 'f1-score': 0.6493519445572061, 'support': 1400}, 'weighted avg': {'precision': 0.7594733859696856, 'recall': 0.7428571428571429, 'f1-score': 0.7363331776232817, 'support': 1400}, 'samples avg': {'precision': 0.7428571428571429, 'recall': 0.7428571428571429, 'f1-score': 0.7428571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.923728813559322, 'recall': 0.9083333333333333, 'f1-score': 0.9159663865546218, 'support': 360}, '1': {'precision': 0.8641304347826086, 'recall': 0.7293577981651376, 'f1-score': 0.7910447761194029, 'support': 218}, '2': {'precision': 0.8782608695652174, 'recall': 0.9351851851851852, 'f1-score': 0.905829596412556, 'support': 108}, '3': {'precision': 0.7454545454545455, 'recall': 0.5857142857142857, 'f1-score': 0.656, 'support': 70}, '4': {'precision': 0.75, 'recall': 0.8181818181818182, 'f1-score': 0.7826086956521738, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.9318181818181818, 'recall': 0.803921568627451, 'f1-score': 0.8631578947368421, 'support': 51}, '7': {'precision': 0.6923076923076923, 'recall': 0.8761061946902655, 'f1-score': 0.7734375, 'support': 226}, '8': {'precision': 0.6436781609195402, 'recall': 0.6787878787878788, 'f1-score': 0.6607669616519174, 'support': 165}, '9': {'precision': 0.76, 'recall': 0.4578313253012048, 'f1-score': 0.5714285714285715, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.8536585365853658, 'recall': 0.9210526315789473, 'f1-score': 0.8860759493670887, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8081395348837209, 'recall': 0.7942857142857143, 'f1-score': 0.8011527377521614, 'support': 1400}, 'macro avg': {'precision': 0.7583712852828218, 'recall': 0.7219923531533907, 'f1-score': 0.7335101077243327, 'support': 1400}, 'weighted avg': {'precision': 0.8090854414385767, 'recall': 0.7942857142857143, 'f1-score': 0.7958232923403741, 'support': 1400}, 'samples avg': {'precision': 0.7942857142857143, 'recall': 0.7942857142857143, 'f1-score': 0.7942857142857143, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:23:30.888426: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:23:31.133015: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:23:33.154483: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:23:33.154688: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:23:33.154703: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:23:47.179106: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:23:47.712788: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3382503.23it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3146851.88it/s]
Mon May 22 05:23:52 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:23:57.291007: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:55 10/148 [=>............................] - ETA: 0s   20/148 [===>..........................] - ETA: 0s 31/148 [=====>........................] - ETA: 0s 42/148 [=======>......................] - ETA: 0s 53/148 [=========>....................] - ETA: 0s 64/148 [===========>..................] - ETA: 0s 79/148 [===============>..............] - ETA: 0s 95/148 [==================>...........] - ETA: 0s112/148 [=====================>........] - ETA: 0s129/148 [=========================>....] - ETA: 0s145/148 [============================>.] - ETA: 0s148/148 [==============================] - 1s 4ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2300770.16it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2570939.40it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2716870.06it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82648.66it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2510485.51it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84012.10it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3059940.39it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2949284.58it/s]
Mon May 22 05:24:01 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s 4/44 [=>............................] - ETA: 0s18/44 [===========>..................] - ETA: 0s34/44 [======================>.......] - ETA: 0s44/44 [==============================] - 0s 4ms/step
 1/44 [..............................] - ETA: 1s 5/44 [==>...........................] - ETA: 0s21/44 [=============>................] - ETA: 0s38/44 [========================>.....] - ETA: 0s44/44 [==============================] - 0s 4ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2059637.18it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2257603.08it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2364891.50it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82832.92it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2406567.87it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83662.58it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               1 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 147,528,973
Trainable params: 147,528,973
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 5120)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 5120)  146850816   ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 5120)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 5120)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          655488      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 147,528,973
Trainable params: 147,528,973
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 40s - loss: 0.6314 - acc: 0.8128 - precision: 0.8692 - recall: 0.7628 - val_loss: 0.7691 - val_acc: 0.7836 - val_precision: 0.8083 - val_recall: 0.7679 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8476658476658476, 'recall': 0.9274193548387096, 'f1-score': 0.8857509627727855, 'support': 372}, '1': {'precision': 0.7878787878787878, 'recall': 0.7027027027027027, 'f1-score': 0.7428571428571429, 'support': 222}, '2': {'precision': 0.8105263157894737, 'recall': 0.875, 'f1-score': 0.8415300546448087, 'support': 88}, '3': {'precision': 0.8076923076923077, 'recall': 0.4117647058823529, 'f1-score': 0.5454545454545454, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9473684210526315, 'recall': 0.75, 'f1-score': 0.8372093023255814, 'support': 24}, '7': {'precision': 0.6871165644171779, 'recall': 0.8615384615384616, 'f1-score': 0.764505119453925, 'support': 260}, '8': {'precision': 0.7134146341463414, 'recall': 0.585, 'f1-score': 0.6428571428571428, 'support': 200}, '9': {'precision': 0.7037037037037037, 'recall': 0.2289156626506024, 'f1-score': 0.34545454545454546, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7787810383747178, 'recall': 0.7392857142857143, 'f1-score': 0.7585196042506412, 'support': 1400}, 'macro avg': {'precision': 0.7598679422317645, 'recall': 0.5847503787305735, 'f1-score': 0.6403908087340804, 'support': 1400}, 'weighted avg': {'precision': 0.7781677210568853, 'recall': 0.7392857142857143, 'f1-score': 0.7428812121477035, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9041095890410958, 'recall': 0.9166666666666666, 'f1-score': 0.9103448275862068, 'support': 360}, '1': {'precision': 0.8168316831683168, 'recall': 0.7568807339449541, 'f1-score': 0.7857142857142856, 'support': 218}, '2': {'precision': 0.875, 'recall': 0.9074074074074074, 'f1-score': 0.8909090909090909, 'support': 108}, '3': {'precision': 0.9117647058823529, 'recall': 0.44285714285714284, 'f1-score': 0.596153846153846, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8387096774193549, 'recall': 0.7428571428571429, 'f1-score': 0.787878787878788, 'support': 35}, '6': {'precision': 0.8837209302325582, 'recall': 0.7450980392156863, 'f1-score': 0.8085106382978724, 'support': 51}, '7': {'precision': 0.7309236947791165, 'recall': 0.8053097345132744, 'f1-score': 0.7663157894736843, 'support': 226}, '8': {'precision': 0.6104651162790697, 'recall': 0.6363636363636364, 'f1-score': 0.6231454005934717, 'support': 165}, '9': {'precision': 0.7547169811320755, 'recall': 0.4819277108433735, 'f1-score': 0.5882352941176471, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8082706766917294, 'recall': 0.7678571428571429, 'f1-score': 0.7875457875457875, 'support': 1400}, 'macro avg': {'precision': 0.7635007520924108, 'recall': 0.6816837740186741, 'f1-score': 0.7128457865301948, 'support': 1400}, 'weighted avg': {'precision': 0.8066298157262273, 'recall': 0.7678571428571429, 'f1-score': 0.7805214987758856, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 39s - loss: 0.3848 - acc: 0.8796 - precision: 0.8988 - recall: 0.8654 - val_loss: 0.8175 - val_acc: 0.7907 - val_precision: 0.8095 - val_recall: 0.7800 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8564231738035264, 'recall': 0.9139784946236559, 'f1-score': 0.8842652795838751, 'support': 372}, '1': {'precision': 0.8260869565217391, 'recall': 0.6846846846846847, 'f1-score': 0.7487684729064039, 'support': 222}, '2': {'precision': 0.797979797979798, 'recall': 0.8977272727272727, 'f1-score': 0.8449197860962567, 'support': 88}, '3': {'precision': 0.6666666666666666, 'recall': 0.5490196078431373, 'f1-score': 0.6021505376344086, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.9473684210526315, 'recall': 0.75, 'f1-score': 0.8372093023255814, 'support': 24}, '7': {'precision': 0.6775147928994083, 'recall': 0.8807692307692307, 'f1-score': 0.765886287625418, 'support': 260}, '8': {'precision': 0.6936416184971098, 'recall': 0.6, 'f1-score': 0.6434316353887399, 'support': 200}, '9': {'precision': 0.7241379310344828, 'recall': 0.25301204819277107, 'f1-score': 0.375, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7753891771682728, 'recall': 0.7471428571428571, 'f1-score': 0.7610040014550745, 'support': 1400}, 'macro avg': {'precision': 0.7431706886750653, 'recall': 0.6066975802905216, 'f1-score': 0.6515240861340387, 'support': 1400}, 'weighted avg': {'precision': 0.7771530366233862, 'recall': 0.7471428571428571, 'f1-score': 0.7484952971251047, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9136490250696379, 'recall': 0.9111111111111111, 'f1-score': 0.9123783031988875, 'support': 360}, '1': {'precision': 0.861878453038674, 'recall': 0.7155963302752294, 'f1-score': 0.7819548872180452, 'support': 218}, '2': {'precision': 0.9009009009009009, 'recall': 0.9259259259259259, 'f1-score': 0.91324200913242, 'support': 108}, '3': {'precision': 0.782608695652174, 'recall': 0.5142857142857142, 'f1-score': 0.6206896551724138, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7325581395348837, 'recall': 0.8362831858407079, 'f1-score': 0.78099173553719, 'support': 226}, '8': {'precision': 0.5846153846153846, 'recall': 0.6909090909090909, 'f1-score': 0.6333333333333333, 'support': 165}, '9': {'precision': 0.8125, 'recall': 0.46987951807228917, 'f1-score': 0.5954198473282443, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.809488510007413, 'recall': 0.78, 'f1-score': 0.7944707166242271, 'support': 1400}, 'macro avg': {'precision': 0.7602686643549453, 'recall': 0.706168806696225, 'f1-score': 0.7253469969069342, 'support': 1400}, 'weighted avg': {'precision': 0.8119632189924936, 'recall': 0.78, 'f1-score': 0.7892728220573976, 'support': 1400}, 'samples avg': {'precision': 0.78, 'recall': 0.78, 'f1-score': 0.78, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 39s - loss: 0.2917 - acc: 0.9052 - precision: 0.9199 - recall: 0.8960 - val_loss: 0.9298 - val_acc: 0.7914 - val_precision: 0.8031 - val_recall: 0.7807 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8398058252427184, 'recall': 0.9301075268817204, 'f1-score': 0.8826530612244897, 'support': 372}, '1': {'precision': 0.7868020304568528, 'recall': 0.6981981981981982, 'f1-score': 0.7398568019093079, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.696969696969697, 'recall': 0.45098039215686275, 'f1-score': 0.5476190476190477, 'support': 51}, '4': {'precision': 0.6875, 'recall': 0.39285714285714285, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9, 'recall': 0.75, 'f1-score': 0.8181818181818182, 'support': 24}, '7': {'precision': 0.6321525885558583, 'recall': 0.8923076923076924, 'f1-score': 0.7400318979266348, 'support': 260}, '8': {'precision': 0.6948051948051948, 'recall': 0.535, 'f1-score': 0.6045197740112994, 'support': 200}, '9': {'precision': 0.7777777777777778, 'recall': 0.25301204819277107, 'f1-score': 0.3818181818181818, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.8823529411764706, 'recall': 0.8108108108108109, 'f1-score': 0.8450704225352113, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7573099415204678, 'recall': 0.74, 'f1-score': 0.7485549132947976, 'support': 1400}, 'macro avg': {'precision': 0.7487177607807234, 'recall': 0.5864591537362288, 'f1-score': 0.6358504518109255, 'support': 1400}, 'weighted avg': {'precision': 0.7639222172545141, 'recall': 0.74, 'f1-score': 0.7336326251885859, 'support': 1400}, 'samples avg': {'precision': 0.74, 'recall': 0.74, 'f1-score': 0.74, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9093406593406593, 'recall': 0.9194444444444444, 'f1-score': 0.9143646408839778, 'support': 360}, '1': {'precision': 0.815, 'recall': 0.7477064220183486, 'f1-score': 0.7799043062200957, 'support': 218}, '2': {'precision': 0.9142857142857143, 'recall': 0.8888888888888888, 'f1-score': 0.9014084507042254, 'support': 108}, '3': {'precision': 0.8461538461538461, 'recall': 0.4714285714285714, 'f1-score': 0.6055045871559632, 'support': 70}, '4': {'precision': 0.6956521739130435, 'recall': 0.7272727272727273, 'f1-score': 0.711111111111111, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.9111111111111111, 'recall': 0.803921568627451, 'f1-score': 0.8541666666666666, 'support': 51}, '7': {'precision': 0.6666666666666666, 'recall': 0.8584070796460177, 'f1-score': 0.7504835589941972, 'support': 226}, '8': {'precision': 0.6666666666666666, 'recall': 0.6303030303030303, 'f1-score': 0.6479750778816199, 'support': 165}, '9': {'precision': 0.8125, 'recall': 0.46987951807228917, 'f1-score': 0.5954198473282443, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8333333333333334, 'recall': 0.9210526315789473, 'f1-score': 0.875, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8030859662013226, 'recall': 0.7807142857142857, 'f1-score': 0.7917421224194132, 'support': 1400}, 'macro avg': {'precision': 0.755439243959311, 'recall': 0.6985509250106046, 'f1-score': 0.7174278858180891, 'support': 1400}, 'weighted avg': {'precision': 0.8046772225445362, 'recall': 0.7807142857142857, 'f1-score': 0.7848238756013697, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 39s - loss: 0.2294 - acc: 0.9254 - precision: 0.9352 - recall: 0.9182 - val_loss: 0.9944 - val_acc: 0.7929 - val_precision: 0.8045 - val_recall: 0.7879 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8175355450236966, 'recall': 0.9274193548387096, 'f1-score': 0.8690176322418135, 'support': 372}, '1': {'precision': 0.8125, 'recall': 0.7027027027027027, 'f1-score': 0.7536231884057971, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.5869565217391305, 'recall': 0.5294117647058824, 'f1-score': 0.5567010309278351, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6696165191740413, 'recall': 0.8730769230769231, 'f1-score': 0.7579298831385642, 'support': 260}, '8': {'precision': 0.7017543859649122, 'recall': 0.6, 'f1-score': 0.6469002695417789, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.25301204819277107, 'f1-score': 0.3716814159292035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7613554434030281, 'recall': 0.7542857142857143, 'f1-score': 0.7578040904198061, 'support': 1400}, 'macro avg': {'precision': 0.7383574997936834, 'recall': 0.625228100609102, 'f1-score': 0.6646609963734809, 'support': 1400}, 'weighted avg': {'precision': 0.7617436987217913, 'recall': 0.7542857142857143, 'f1-score': 0.7456930573290486, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8954423592493298, 'recall': 0.9277777777777778, 'f1-score': 0.9113233287858118, 'support': 360}, '1': {'precision': 0.8526315789473684, 'recall': 0.7431192660550459, 'f1-score': 0.7941176470588235, 'support': 218}, '2': {'precision': 0.8818181818181818, 'recall': 0.8981481481481481, 'f1-score': 0.8899082568807339, 'support': 108}, '3': {'precision': 0.7647058823529411, 'recall': 0.5571428571428572, 'f1-score': 0.6446280991735537, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7203065134099617, 'recall': 0.831858407079646, 'f1-score': 0.7720739219712526, 'support': 226}, '8': {'precision': 0.6089385474860335, 'recall': 0.6606060606060606, 'f1-score': 0.633720930232558, 'support': 165}, '9': {'precision': 0.7735849056603774, 'recall': 0.4939759036144578, 'f1-score': 0.6029411764705882, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8045222465353756, 'recall': 0.7878571428571428, 'f1-score': 0.7961024900757849, 'support': 1400}, 'macro avg': {'precision': 0.7538004227616709, 'recall': 0.7198002661250982, 'f1-score': 0.7312448133611313, 'support': 1400}, 'weighted avg': {'precision': 0.8024914466747498, 'recall': 0.7878571428571428, 'f1-score': 0.7905763921959522, 'support': 1400}, 'samples avg': {'precision': 0.7878571428571428, 'recall': 0.7878571428571428, 'f1-score': 0.7878571428571428, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 39s - loss: 0.1682 - acc: 0.9448 - precision: 0.9513 - recall: 0.9408 - val_loss: 1.1185 - val_acc: 0.7800 - val_precision: 0.7860 - val_recall: 0.7764 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8207547169811321, 'recall': 0.9354838709677419, 'f1-score': 0.8743718592964823, 'support': 372}, '1': {'precision': 0.8238636363636364, 'recall': 0.6531531531531531, 'f1-score': 0.7286432160804021, 'support': 222}, '2': {'precision': 0.8191489361702128, 'recall': 0.875, 'f1-score': 0.8461538461538463, 'support': 88}, '3': {'precision': 0.7027027027027027, 'recall': 0.5098039215686274, 'f1-score': 0.5909090909090909, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.8333333333333334, 'f1-score': 0.816326530612245, 'support': 24}, '7': {'precision': 0.6819571865443425, 'recall': 0.8576923076923076, 'f1-score': 0.7597955706984668, 'support': 260}, '8': {'precision': 0.6631016042780749, 'recall': 0.62, 'f1-score': 0.6408268733850129, 'support': 200}, '9': {'precision': 0.7142857142857143, 'recall': 0.30120481927710846, 'f1-score': 0.42372881355932207, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7625272331154684, 'recall': 0.75, 'f1-score': 0.7562117392870003, 'support': 1400}, 'macro avg': {'precision': 0.7342205117385294, 'recall': 0.6148982546966923, 'f1-score': 0.6522011767772968, 'support': 1400}, 'weighted avg': {'precision': 0.7629584474287001, 'recall': 0.75, 'f1-score': 0.7443337346237502, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9016393442622951, 'recall': 0.9166666666666666, 'f1-score': 0.9090909090909091, 'support': 360}, '1': {'precision': 0.8497109826589595, 'recall': 0.6743119266055045, 'f1-score': 0.7519181585677748, 'support': 218}, '2': {'precision': 0.8899082568807339, 'recall': 0.8981481481481481, 'f1-score': 0.8940092165898618, 'support': 108}, '3': {'precision': 0.7954545454545454, 'recall': 0.5, 'f1-score': 0.6140350877192983, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9347826086956522, 'recall': 0.8431372549019608, 'f1-score': 0.8865979381443299, 'support': 51}, '7': {'precision': 0.6925925925925925, 'recall': 0.827433628318584, 'f1-score': 0.754032258064516, 'support': 226}, '8': {'precision': 0.5490196078431373, 'recall': 0.6787878787878788, 'f1-score': 0.6070460704607046, 'support': 165}, '9': {'precision': 0.7454545454545455, 'recall': 0.4939759036144578, 'f1-score': 0.5942028985507246, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7859725234996384, 'recall': 0.7764285714285715, 'f1-score': 0.7811713977721882, 'support': 1400}, 'macro avg': {'precision': 0.7431804843148876, 'recall': 0.7131810841003314, 'f1-score': 0.7212633602536636, 'support': 1400}, 'weighted avg': {'precision': 0.791265828002967, 'recall': 0.7764285714285715, 'f1-score': 0.7770961935873076, 'support': 1400}, 'samples avg': {'precision': 0.7764285714285715, 'recall': 0.7764285714285715, 'f1-score': 0.7764285714285715, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:28:11.514487: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:28:11.770514: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:28:13.355506: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:28:13.355719: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:28:13.355735: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:28:21.778260: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:28:22.304557: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    1layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 05:28:24.632600: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 23s - loss: 0.6536 - acc: 0.7964 - precision: 0.8472 - recall: 0.7586 - val_loss: 0.8914 - val_acc: 0.7607 - val_precision: 0.7835 - val_recall: 0.7393 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8513853904282116, 'recall': 0.9086021505376344, 'f1-score': 0.8790637191157347, 'support': 372}, '1': {'precision': 0.7626262626262627, 'recall': 0.6801801801801802, 'f1-score': 0.7190476190476192, 'support': 222}, '2': {'precision': 0.81, 'recall': 0.9204545454545454, 'f1-score': 0.8617021276595745, 'support': 88}, '3': {'precision': 0.85, 'recall': 0.3333333333333333, 'f1-score': 0.4788732394366197, 'support': 51}, '4': {'precision': 0.7692307692307693, 'recall': 0.35714285714285715, 'f1-score': 0.48780487804878053, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6891025641025641, 'recall': 0.8269230769230769, 'f1-score': 0.7517482517482517, 'support': 260}, '8': {'precision': 0.6033519553072626, 'recall': 0.54, 'f1-score': 0.5699208443271768, 'support': 200}, '9': {'precision': 0.5128205128205128, 'recall': 0.24096385542168675, 'f1-score': 0.3278688524590164, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.26666666666666666, 'f1-score': 0.4210526315789474, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7583081570996979, 'recall': 0.7171428571428572, 'f1-score': 0.7371512481644641, 'support': 1400}, 'macro avg': {'precision': 0.7478102559639582, 'recall': 0.5660089763197743, 'f1-score': 0.6185260029557376, 'support': 1400}, 'weighted avg': {'precision': 0.7536002845181351, 'recall': 0.7171428571428572, 'f1-score': 0.7216712263006954, 'support': 1400}, 'samples avg': {'precision': 0.7171428571428572, 'recall': 0.7171428571428572, 'f1-score': 0.7171428571428572, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9292035398230089, 'recall': 0.875, 'f1-score': 0.9012875536480688, 'support': 360}, '1': {'precision': 0.8134715025906736, 'recall': 0.7201834862385321, 'f1-score': 0.7639902676399026, 'support': 218}, '2': {'precision': 0.900990099009901, 'recall': 0.8425925925925926, 'f1-score': 0.8708133971291866, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.38571428571428573, 'f1-score': 0.5567010309278351, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.9166666666666666, 'recall': 0.9428571428571428, 'f1-score': 0.9295774647887323, 'support': 35}, '6': {'precision': 0.90625, 'recall': 0.5686274509803921, 'f1-score': 0.6987951807228915, 'support': 51}, '7': {'precision': 0.7408906882591093, 'recall': 0.8097345132743363, 'f1-score': 0.773784355179704, 'support': 226}, '8': {'precision': 0.4796380090497738, 'recall': 0.6424242424242425, 'f1-score': 0.5492227979274612, 'support': 165}, '9': {'precision': 0.6129032258064516, 'recall': 0.4578313253012048, 'f1-score': 0.5241379310344827, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7834973504920515, 'recall': 0.7392857142857143, 'f1-score': 0.7607497243660419, 'support': 1400}, 'macro avg': {'precision': 0.7703307265762539, 'recall': 0.6450593539416865, 'f1-score': 0.6872461382263751, 'support': 1400}, 'weighted avg': {'precision': 0.8008960484657264, 'recall': 0.7392857142857143, 'f1-score': 0.7581881055996837, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 22s - loss: 0.4441 - acc: 0.8568 - precision: 0.8768 - recall: 0.8386 - val_loss: 0.9380 - val_acc: 0.7743 - val_precision: 0.7943 - val_recall: 0.7614 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8406862745098039, 'recall': 0.9220430107526881, 'f1-score': 0.8794871794871795, 'support': 372}, '1': {'precision': 0.7300884955752213, 'recall': 0.7432432432432432, 'f1-score': 0.7366071428571428, 'support': 222}, '2': {'precision': 0.803921568627451, 'recall': 0.9318181818181818, 'f1-score': 0.8631578947368421, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.35294117647058826, 'f1-score': 0.5, 'support': 51}, '4': {'precision': 0.7692307692307693, 'recall': 0.35714285714285715, 'f1-score': 0.48780487804878053, 'support': 28}, '5': {'precision': 0.8666666666666667, 'recall': 0.7647058823529411, 'f1-score': 0.8125, 'support': 17}, '6': {'precision': 0.85, 'recall': 0.7083333333333334, 'f1-score': 0.7727272727272727, 'support': 24}, '7': {'precision': 0.6686390532544378, 'recall': 0.8692307692307693, 'f1-score': 0.7558528428093645, 'support': 260}, '8': {'precision': 0.6507936507936508, 'recall': 0.41, 'f1-score': 0.5030674846625766, 'support': 200}, '9': {'precision': 0.6, 'recall': 0.25301204819277107, 'f1-score': 0.35593220338983056, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.756152125279642, 'recall': 0.7242857142857143, 'f1-score': 0.739875957679679, 'support': 1400}, 'macro avg': {'precision': 0.7413207181385276, 'recall': 0.5838421523088346, 'f1-score': 0.6306940710109482, 'support': 1400}, 'weighted avg': {'precision': 0.7512507162610903, 'recall': 0.7242857142857143, 'f1-score': 0.7196627101422489, 'support': 1400}, 'samples avg': {'precision': 0.7242857142857143, 'recall': 0.7242857142857143, 'f1-score': 0.7242857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9180790960451978, 'recall': 0.9027777777777778, 'f1-score': 0.9103641456582634, 'support': 360}, '1': {'precision': 0.7990867579908676, 'recall': 0.8027522935779816, 'f1-score': 0.8009153318077803, 'support': 218}, '2': {'precision': 0.8584905660377359, 'recall': 0.8425925925925926, 'f1-score': 0.850467289719626, 'support': 108}, '3': {'precision': 0.9666666666666667, 'recall': 0.4142857142857143, 'f1-score': 0.5800000000000001, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.918918918918919, 'recall': 0.6666666666666666, 'f1-score': 0.7727272727272727, 'support': 51}, '7': {'precision': 0.6872727272727273, 'recall': 0.8362831858407079, 'f1-score': 0.7544910179640718, 'support': 226}, '8': {'precision': 0.6012658227848101, 'recall': 0.5757575757575758, 'f1-score': 0.5882352941176471, 'support': 165}, '9': {'precision': 0.6451612903225806, 'recall': 0.4819277108433735, 'f1-score': 0.5517241379310345, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.9117647058823529, 'recall': 0.8157894736842105, 'f1-score': 0.861111111111111, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7943368107302533, 'recall': 0.7614285714285715, 'f1-score': 0.7775346462436178, 'support': 1400}, 'macro avg': {'precision': 0.7656046460058233, 'recall': 0.6600301101988494, 'f1-score': 0.6962388447773991, 'support': 1400}, 'weighted avg': {'precision': 0.7970723058147897, 'recall': 0.7614285714285715, 'f1-score': 0.770313750992579, 'support': 1400}, 'samples avg': {'precision': 0.7614285714285715, 'recall': 0.7614285714285715, 'f1-score': 0.7614285714285715, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 22s - loss: 0.3439 - acc: 0.8860 - precision: 0.9015 - recall: 0.8728 - val_loss: 1.0208 - val_acc: 0.7750 - val_precision: 0.7896 - val_recall: 0.7664 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8333333333333334, 'recall': 0.9274193548387096, 'f1-score': 0.8778625954198473, 'support': 372}, '1': {'precision': 0.73568281938326, 'recall': 0.7522522522522522, 'f1-score': 0.7438752783964365, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.75, 'recall': 0.4117647058823529, 'f1-score': 0.5316455696202532, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6726190476190477, 'recall': 0.8692307692307693, 'f1-score': 0.7583892617449665, 'support': 260}, '8': {'precision': 0.6462585034013606, 'recall': 0.475, 'f1-score': 0.547550432276657, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.24096385542168675, 'f1-score': 0.34782608695652173, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7538461538461538, 'recall': 0.735, 'f1-score': 0.7443037974683544, 'support': 1400}, 'macro avg': {'precision': 0.7371398599156471, 'recall': 0.5900503172535397, 'f1-score': 0.6374647426864802, 'support': 1400}, 'weighted avg': {'precision': 0.7478605272830422, 'recall': 0.735, 'f1-score': 0.7270650584693219, 'support': 1400}, 'samples avg': {'precision': 0.735, 'recall': 0.735, 'f1-score': 0.735, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9250720461095101, 'recall': 0.8916666666666667, 'f1-score': 0.9080622347949081, 'support': 360}, '1': {'precision': 0.7926267281105991, 'recall': 0.7889908256880734, 'f1-score': 0.7908045977011494, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.8333333333333334, 'f1-score': 0.8653846153846153, 'support': 108}, '3': {'precision': 0.8378378378378378, 'recall': 0.44285714285714284, 'f1-score': 0.5794392523364486, 'support': 70}, '4': {'precision': 0.8095238095238095, 'recall': 0.7727272727272727, 'f1-score': 0.7906976744186046, 'support': 22}, '5': {'precision': 0.9166666666666666, 'recall': 0.9428571428571428, 'f1-score': 0.9295774647887323, 'support': 35}, '6': {'precision': 0.8974358974358975, 'recall': 0.6862745098039216, 'f1-score': 0.7777777777777778, 'support': 51}, '7': {'precision': 0.6773049645390071, 'recall': 0.8451327433628318, 'f1-score': 0.7519685039370079, 'support': 226}, '8': {'precision': 0.5819209039548022, 'recall': 0.6242424242424243, 'f1-score': 0.6023391812865497, 'support': 165}, '9': {'precision': 0.6610169491525424, 'recall': 0.46987951807228917, 'f1-score': 0.5492957746478874, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.9166666666666666, 'recall': 0.868421052631579, 'f1-score': 0.8918918918918918, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.789551140544518, 'recall': 0.7664285714285715, 'f1-score': 0.7778180500181224, 'support': 1400}, 'macro avg': {'precision': 0.7627748053844107, 'recall': 0.6721393233593267, 'f1-score': 0.7049624381721767, 'support': 1400}, 'weighted avg': {'precision': 0.7929392222425878, 'recall': 0.7664285714285715, 'f1-score': 0.7727953042093703, 'support': 1400}, 'samples avg': {'precision': 0.7664285714285715, 'recall': 0.7664285714285715, 'f1-score': 0.7664285714285715, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 21s - loss: 0.2619 - acc: 0.9158 - precision: 0.9251 - recall: 0.9068 - val_loss: 1.1388 - val_acc: 0.7664 - val_precision: 0.7783 - val_recall: 0.7600 - 21s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8321167883211679, 'recall': 0.9193548387096774, 'f1-score': 0.8735632183908045, 'support': 372}, '1': {'precision': 0.7547169811320755, 'recall': 0.7207207207207207, 'f1-score': 0.7373271889400921, 'support': 222}, '2': {'precision': 0.8282828282828283, 'recall': 0.9318181818181818, 'f1-score': 0.8770053475935828, 'support': 88}, '3': {'precision': 0.75, 'recall': 0.47058823529411764, 'f1-score': 0.5783132530120481, 'support': 51}, '4': {'precision': 0.631578947368421, 'recall': 0.42857142857142855, 'f1-score': 0.5106382978723404, 'support': 28}, '5': {'precision': 0.9, 'recall': 0.5294117647058824, 'f1-score': 0.6666666666666667, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6458923512747875, 'recall': 0.8769230769230769, 'f1-score': 0.7438825448613376, 'support': 260}, '8': {'precision': 0.6447368421052632, 'recall': 0.49, 'f1-score': 0.5568181818181819, 'support': 200}, '9': {'precision': 0.68, 'recall': 0.20481927710843373, 'f1-score': 0.3148148148148148, 'support': 83}, '10': {'precision': 0.9, 'recall': 0.6, 'f1-score': 0.7200000000000001, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7487254187909687, 'recall': 0.7342857142857143, 'f1-score': 0.741435268662099, 'support': 1400}, 'macro avg': {'precision': 0.7253695012364366, 'recall': 0.5916424359996664, 'f1-score': 0.6347753945819187, 'support': 1400}, 'weighted avg': {'precision': 0.7466551643270907, 'recall': 0.7342857142857143, 'f1-score': 0.7244859542989128, 'support': 1400}, 'samples avg': {'precision': 0.7342857142857143, 'recall': 0.7342857142857143, 'f1-score': 0.7342857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9215116279069767, 'recall': 0.8805555555555555, 'f1-score': 0.9005681818181818, 'support': 360}, '1': {'precision': 0.803921568627451, 'recall': 0.7522935779816514, 'f1-score': 0.7772511848341231, 'support': 218}, '2': {'precision': 0.8811881188118812, 'recall': 0.8240740740740741, 'f1-score': 0.8516746411483254, 'support': 108}, '3': {'precision': 0.7857142857142857, 'recall': 0.4714285714285714, 'f1-score': 0.5892857142857143, 'support': 70}, '4': {'precision': 0.8095238095238095, 'recall': 0.7727272727272727, 'f1-score': 0.7906976744186046, 'support': 22}, '5': {'precision': 0.9393939393939394, 'recall': 0.8857142857142857, 'f1-score': 0.9117647058823529, 'support': 35}, '6': {'precision': 0.8918918918918919, 'recall': 0.6470588235294118, 'f1-score': 0.7499999999999999, 'support': 51}, '7': {'precision': 0.6508474576271186, 'recall': 0.8495575221238938, 'f1-score': 0.7370441458733205, 'support': 226}, '8': {'precision': 0.5561497326203209, 'recall': 0.6303030303030303, 'f1-score': 0.5909090909090908, 'support': 165}, '9': {'precision': 0.7037037037037037, 'recall': 0.4578313253012048, 'f1-score': 0.5547445255474452, 'support': 83}, '10': {'precision': 1.0, 'recall': 1.0, 'f1-score': 1.0, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7783467446964155, 'recall': 0.76, 'f1-score': 0.7690639681966029, 'support': 1400}, 'macro avg': {'precision': 0.7583178346236227, 'recall': 0.6933576386074496, 'f1-score': 0.7177424764218678, 'support': 1400}, 'weighted avg': {'precision': 0.7852490706215168, 'recall': 0.76, 'f1-score': 0.7656172282974673, 'support': 1400}, 'samples avg': {'precision': 0.76, 'recall': 0.76, 'f1-score': 0.76, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 21s - loss: 0.1907 - acc: 0.9388 - precision: 0.9465 - recall: 0.9308 - val_loss: 1.1388 - val_acc: 0.7829 - val_precision: 0.7881 - val_recall: 0.7786 - 21s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.815242494226328, 'recall': 0.9489247311827957, 'f1-score': 0.8770186335403727, 'support': 372}, '1': {'precision': 0.7205240174672489, 'recall': 0.7432432432432432, 'f1-score': 0.7317073170731706, 'support': 222}, '2': {'precision': 0.801980198019802, 'recall': 0.9204545454545454, 'f1-score': 0.8571428571428572, 'support': 88}, '3': {'precision': 0.6428571428571429, 'recall': 0.5294117647058824, 'f1-score': 0.5806451612903226, 'support': 51}, '4': {'precision': 0.6875, 'recall': 0.39285714285714285, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 0.8666666666666667, 'recall': 0.7647058823529411, 'f1-score': 0.8125, 'support': 17}, '6': {'precision': 0.84, 'recall': 0.875, 'f1-score': 0.8571428571428572, 'support': 24}, '7': {'precision': 0.6884735202492211, 'recall': 0.85, 'f1-score': 0.7607573149741823, 'support': 260}, '8': {'precision': 0.6967213114754098, 'recall': 0.425, 'f1-score': 0.5279503105590062, 'support': 200}, '9': {'precision': 0.631578947368421, 'recall': 0.2891566265060241, 'f1-score': 0.396694214876033, 'support': 83}, '10': {'precision': 0.8888888888888888, 'recall': 0.5333333333333333, 'f1-score': 0.6666666666666667, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.751808972503618, 'recall': 0.7421428571428571, 'f1-score': 0.7469446441409059, 'support': 1400}, 'macro avg': {'precision': 0.7113980863617692, 'recall': 0.6217613908035938, 'f1-score': 0.65004448264938, 'support': 1400}, 'weighted avg': {'precision': 0.7433128999374348, 'recall': 0.7421428571428571, 'f1-score': 0.7293392871117127, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8997289972899729, 'recall': 0.9222222222222223, 'f1-score': 0.9108367626886146, 'support': 360}, '1': {'precision': 0.7772727272727272, 'recall': 0.7844036697247706, 'f1-score': 0.7808219178082191, 'support': 218}, '2': {'precision': 0.8846153846153846, 'recall': 0.8518518518518519, 'f1-score': 0.8679245283018868, 'support': 108}, '3': {'precision': 0.660377358490566, 'recall': 0.5, 'f1-score': 0.5691056910569106, 'support': 70}, '4': {'precision': 0.85, 'recall': 0.7727272727272727, 'f1-score': 0.8095238095238095, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.8936170212765957, 'recall': 0.8235294117647058, 'f1-score': 0.8571428571428571, 'support': 51}, '7': {'precision': 0.7109375, 'recall': 0.8053097345132744, 'f1-score': 0.7551867219917012, 'support': 226}, '8': {'precision': 0.6037735849056604, 'recall': 0.5818181818181818, 'f1-score': 0.5925925925925926, 'support': 165}, '9': {'precision': 0.6617647058823529, 'recall': 0.5421686746987951, 'f1-score': 0.5960264900662251, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.9411764705882353, 'recall': 0.8421052631578947, 'f1-score': 0.8888888888888888, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7881417208966016, 'recall': 0.7785714285714286, 'f1-score': 0.7833273445921667, 'support': 1400}, 'macro avg': {'precision': 0.7429222326959054, 'recall': 0.7151972964544263, 'f1-score': 0.7268087369634636, 'support': 1400}, 'weighted avg': {'precision': 0.7807059399165422, 'recall': 0.7785714285714286, 'f1-score': 0.7779511708727735, 'support': 1400}, 'samples avg': {'precision': 0.7785714285714286, 'recall': 0.7785714285714286, 'f1-score': 0.7785714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:30:44.469183: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:30:44.699448: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:30:46.307939: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:30:46.308145: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:30:46.308161: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:30:55.000278: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:30:55.526428: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    2layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 05:30:58.305157: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 40s - loss: 0.7833 - acc: 0.7696 - precision: 0.8377 - recall: 0.7124 - val_loss: 0.9338 - val_acc: 0.7714 - val_precision: 0.7933 - val_recall: 0.7564 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8459657701711492, 'recall': 0.9301075268817204, 'f1-score': 0.8860435339308578, 'support': 372}, '1': {'precision': 0.7557603686635944, 'recall': 0.7387387387387387, 'f1-score': 0.7471526195899773, 'support': 222}, '2': {'precision': 0.8282828282828283, 'recall': 0.9318181818181818, 'f1-score': 0.8770053475935828, 'support': 88}, '3': {'precision': 0.84, 'recall': 0.4117647058823529, 'f1-score': 0.5526315789473684, 'support': 51}, '4': {'precision': 0.8333333333333334, 'recall': 0.35714285714285715, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.668693009118541, 'recall': 0.8461538461538461, 'f1-score': 0.7470288624787776, 'support': 260}, '8': {'precision': 0.6369047619047619, 'recall': 0.535, 'f1-score': 0.5815217391304348, 'support': 200}, '9': {'precision': 0.56, 'recall': 0.1686746987951807, 'f1-score': 0.25925925925925924, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7603244837758112, 'recall': 0.7364285714285714, 'f1-score': 0.7481857764876634, 'support': 1400}, 'macro avg': {'precision': 0.7511905283085388, 'recall': 0.5850213545336147, 'f1-score': 0.6310018379470161, 'support': 1400}, 'weighted avg': {'precision': 0.7547074497499895, 'recall': 0.7364285714285714, 'f1-score': 0.7293513498426105, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9164265129682997, 'recall': 0.8833333333333333, 'f1-score': 0.8995756718528995, 'support': 360}, '1': {'precision': 0.7850467289719626, 'recall': 0.7706422018348624, 'f1-score': 0.7777777777777778, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.8333333333333334, 'f1-score': 0.8653846153846153, 'support': 108}, '3': {'precision': 0.8571428571428571, 'recall': 0.42857142857142855, 'f1-score': 0.5714285714285714, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.9411764705882353, 'recall': 0.9142857142857143, 'f1-score': 0.9275362318840579, 'support': 35}, '6': {'precision': 0.9111111111111111, 'recall': 0.803921568627451, 'f1-score': 0.8541666666666666, 'support': 51}, '7': {'precision': 0.7176470588235294, 'recall': 0.8097345132743363, 'f1-score': 0.760914760914761, 'support': 226}, '8': {'precision': 0.5591397849462365, 'recall': 0.6303030303030303, 'f1-score': 0.5925925925925924, 'support': 165}, '9': {'precision': 0.6481481481481481, 'recall': 0.42168674698795183, 'f1-score': 0.510948905109489, 'support': 83}, '10': {'precision': 0.8888888888888888, 'recall': 0.5714285714285714, 'f1-score': 0.6956521739130435, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7932584269662921, 'recall': 0.7564285714285715, 'f1-score': 0.7744058500914077, 'support': 1400}, 'macro avg': {'precision': 0.760442441820468, 'recall': 0.6684038470275386, 'f1-score': 0.7033178799283992, 'support': 1400}, 'weighted avg': {'precision': 0.7941384642722218, 'recall': 0.7564285714285715, 'f1-score': 0.7688621945315101, 'support': 1400}, 'samples avg': {'precision': 0.7564285714285715, 'recall': 0.7564285714285715, 'f1-score': 0.7564285714285715, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 37s - loss: 0.5686 - acc: 0.8270 - precision: 0.8563 - recall: 0.7974 - val_loss: 0.9602 - val_acc: 0.7864 - val_precision: 0.7996 - val_recall: 0.7750 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8285714285714286, 'recall': 0.9354838709677419, 'f1-score': 0.8787878787878788, 'support': 372}, '1': {'precision': 0.7245762711864406, 'recall': 0.7702702702702703, 'f1-score': 0.7467248908296943, 'support': 222}, '2': {'precision': 0.8333333333333334, 'recall': 0.9090909090909091, 'f1-score': 0.8695652173913043, 'support': 88}, '3': {'precision': 0.9, 'recall': 0.35294117647058826, 'f1-score': 0.5070422535211269, 'support': 51}, '4': {'precision': 0.7692307692307693, 'recall': 0.35714285714285715, 'f1-score': 0.48780487804878053, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.8235294117647058, 'f1-score': 0.9032258064516129, 'support': 17}, '6': {'precision': 0.84, 'recall': 0.875, 'f1-score': 0.8571428571428572, 'support': 24}, '7': {'precision': 0.7043189368770764, 'recall': 0.8153846153846154, 'f1-score': 0.7557932263814616, 'support': 260}, '8': {'precision': 0.6645569620253164, 'recall': 0.525, 'f1-score': 0.5865921787709498, 'support': 200}, '9': {'precision': 0.6470588235294118, 'recall': 0.26506024096385544, 'f1-score': 0.37606837606837606, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7650957290132547, 'recall': 0.7421428571428571, 'f1-score': 0.7534445250181291, 'support': 1400}, 'macro avg': {'precision': 0.7556470177412409, 'recall': 0.6102621428123114, 'f1-score': 0.6521808181828768, 'support': 1400}, 'weighted avg': {'precision': 0.7610655649767483, 'recall': 0.7421428571428571, 'f1-score': 0.7368152700908546, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9010989010989011, 'recall': 0.9111111111111111, 'f1-score': 0.9060773480662984, 'support': 360}, '1': {'precision': 0.7758620689655172, 'recall': 0.8256880733944955, 'f1-score': 0.8, 'support': 218}, '2': {'precision': 0.92, 'recall': 0.8518518518518519, 'f1-score': 0.8846153846153846, 'support': 108}, '3': {'precision': 0.96875, 'recall': 0.44285714285714284, 'f1-score': 0.6078431372549019, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.8627450980392157, 'recall': 0.8627450980392157, 'f1-score': 0.8627450980392157, 'support': 51}, '7': {'precision': 0.759656652360515, 'recall': 0.7831858407079646, 'f1-score': 0.7712418300653595, 'support': 226}, '8': {'precision': 0.5611111111111111, 'recall': 0.6121212121212121, 'f1-score': 0.5855072463768115, 'support': 165}, '9': {'precision': 0.6307692307692307, 'recall': 0.4939759036144578, 'f1-score': 0.5540540540540541, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6428571428571429, 'f1-score': 0.782608695652174, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7995578481945468, 'recall': 0.775, 'f1-score': 0.7870874138556402, 'support': 1400}, 'macro avg': {'precision': 0.7751299814647067, 'recall': 0.6894375892475615, 'f1-score': 0.7202129162688533, 'support': 1400}, 'weighted avg': {'precision': 0.8006508599545206, 'recall': 0.775, 'f1-score': 0.7815216521647969, 'support': 1400}, 'samples avg': {'precision': 0.775, 'recall': 0.775, 'f1-score': 0.775, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 37s - loss: 0.4972 - acc: 0.8536 - precision: 0.8779 - recall: 0.8286 - val_loss: 1.0529 - val_acc: 0.7793 - val_precision: 0.7925 - val_recall: 0.7750 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8446601941747572, 'recall': 0.9354838709677419, 'f1-score': 0.8877551020408163, 'support': 372}, '1': {'precision': 0.7534883720930232, 'recall': 0.7297297297297297, 'f1-score': 0.7414187643020596, 'support': 222}, '2': {'precision': 0.8080808080808081, 'recall': 0.9090909090909091, 'f1-score': 0.8556149732620321, 'support': 88}, '3': {'precision': 0.7741935483870968, 'recall': 0.47058823529411764, 'f1-score': 0.5853658536585367, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.8235294117647058, 'f1-score': 0.9032258064516129, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.6967741935483871, 'recall': 0.8307692307692308, 'f1-score': 0.7578947368421053, 'support': 260}, '8': {'precision': 0.6379310344827587, 'recall': 0.555, 'f1-score': 0.5935828877005349, 'support': 200}, '9': {'precision': 0.5555555555555556, 'recall': 0.24096385542168675, 'f1-score': 0.3361344537815126, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7607900512070227, 'recall': 0.7428571428571429, 'f1-score': 0.751716660643296, 'support': 1400}, 'macro avg': {'precision': 0.7312506104626356, 'recall': 0.6030873798476013, 'f1-score': 0.6439059127044052, 'support': 1400}, 'weighted avg': {'precision': 0.7513678504303569, 'recall': 0.7428571428571429, 'f1-score': 0.7372252791791386, 'support': 1400}, 'samples avg': {'precision': 0.7428571428571429, 'recall': 0.7428571428571429, 'f1-score': 0.7428571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9183098591549296, 'recall': 0.9055555555555556, 'f1-score': 0.9118881118881119, 'support': 360}, '1': {'precision': 0.7916666666666666, 'recall': 0.7844036697247706, 'f1-score': 0.7880184331797234, 'support': 218}, '2': {'precision': 0.8846153846153846, 'recall': 0.8518518518518519, 'f1-score': 0.8679245283018868, 'support': 108}, '3': {'precision': 0.8571428571428571, 'recall': 0.5142857142857142, 'f1-score': 0.6428571428571428, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.8775510204081632, 'recall': 0.8431372549019608, 'f1-score': 0.86, 'support': 51}, '7': {'precision': 0.7439024390243902, 'recall': 0.8097345132743363, 'f1-score': 0.7754237288135594, 'support': 226}, '8': {'precision': 0.5360824742268041, 'recall': 0.6303030303030303, 'f1-score': 0.5793871866295265, 'support': 165}, '9': {'precision': 0.6349206349206349, 'recall': 0.4819277108433735, 'f1-score': 0.547945205479452, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7925493060628196, 'recall': 0.775, 'f1-score': 0.7836764174792343, 'support': 1400}, 'macro avg': {'precision': 0.7610849543942718, 'recall': 0.6868402427563746, 'f1-score': 0.7145599989746978, 'support': 1400}, 'weighted avg': {'precision': 0.7937848315665981, 'recall': 0.775, 'f1-score': 0.7802449052336794, 'support': 1400}, 'samples avg': {'precision': 0.775, 'recall': 0.775, 'f1-score': 0.775, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 37s - loss: 0.4310 - acc: 0.8668 - precision: 0.8849 - recall: 0.8442 - val_loss: 1.1075 - val_acc: 0.7771 - val_precision: 0.7871 - val_recall: 0.7686 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8293269230769231, 'recall': 0.9274193548387096, 'f1-score': 0.8756345177664974, 'support': 372}, '1': {'precision': 0.7958115183246073, 'recall': 0.6846846846846847, 'f1-score': 0.7360774818401936, 'support': 222}, '2': {'precision': 0.7545454545454545, 'recall': 0.9431818181818182, 'f1-score': 0.8383838383838385, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.8235294117647058, 'f1-score': 0.9032258064516129, 'support': 17}, '6': {'precision': 0.8076923076923077, 'recall': 0.875, 'f1-score': 0.8400000000000001, 'support': 24}, '7': {'precision': 0.6786786786786787, 'recall': 0.8692307692307693, 'f1-score': 0.7622259696458684, 'support': 260}, '8': {'precision': 0.6481481481481481, 'recall': 0.525, 'f1-score': 0.580110497237569, 'support': 200}, '9': {'precision': 0.6176470588235294, 'recall': 0.25301204819277107, 'f1-score': 0.3589743589743589, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7563636363636363, 'recall': 0.7428571428571429, 'f1-score': 0.7495495495495496, 'support': 1400}, 'macro avg': {'precision': 0.7307550351734629, 'recall': 0.6194539636132456, 'f1-score': 0.6518689398004267, 'support': 1400}, 'weighted avg': {'precision': 0.7510723764227712, 'recall': 0.7428571428571429, 'f1-score': 0.7340964004688147, 'support': 1400}, 'samples avg': {'precision': 0.7428571428571429, 'recall': 0.7428571428571429, 'f1-score': 0.7428571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9266862170087976, 'recall': 0.8777777777777778, 'f1-score': 0.9015691868758915, 'support': 360}, '1': {'precision': 0.8082901554404145, 'recall': 0.7155963302752294, 'f1-score': 0.7591240875912411, 'support': 218}, '2': {'precision': 0.8571428571428571, 'recall': 0.8888888888888888, 'f1-score': 0.8727272727272727, 'support': 108}, '3': {'precision': 0.7446808510638298, 'recall': 0.5, 'f1-score': 0.5982905982905983, 'support': 70}, '4': {'precision': 0.8333333333333334, 'recall': 0.6818181818181818, 'f1-score': 0.7499999999999999, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.8823529411764706, 'recall': 0.8823529411764706, 'f1-score': 0.8823529411764706, 'support': 51}, '7': {'precision': 0.7078651685393258, 'recall': 0.8362831858407079, 'f1-score': 0.7667342799188641, 'support': 226}, '8': {'precision': 0.5549738219895288, 'recall': 0.6424242424242425, 'f1-score': 0.5955056179775281, 'support': 165}, '9': {'precision': 0.6612903225806451, 'recall': 0.4939759036144578, 'f1-score': 0.5655172413793104, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.787125091441112, 'recall': 0.7685714285714286, 'f1-score': 0.7777376219732562, 'support': 1400}, 'macro avg': {'precision': 0.7507877999437965, 'recall': 0.7010657149170169, 'f1-score': 0.7206128091343589, 'support': 1400}, 'weighted avg': {'precision': 0.7881379500656229, 'recall': 0.7685714285714286, 'f1-score': 0.7743117476729893, 'support': 1400}, 'samples avg': {'precision': 0.7685714285714286, 'recall': 0.7685714285714286, 'f1-score': 0.7685714285714286, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 37s - loss: 0.3961 - acc: 0.8756 - precision: 0.8941 - recall: 0.8580 - val_loss: 1.1911 - val_acc: 0.7786 - val_precision: 0.7881 - val_recall: 0.7729 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8410757946210269, 'recall': 0.9247311827956989, 'f1-score': 0.8809218950064021, 'support': 372}, '1': {'precision': 0.7605633802816901, 'recall': 0.7297297297297297, 'f1-score': 0.7448275862068966, 'support': 222}, '2': {'precision': 0.8058252427184466, 'recall': 0.9431818181818182, 'f1-score': 0.8691099476439791, 'support': 88}, '3': {'precision': 0.7105263157894737, 'recall': 0.5294117647058824, 'f1-score': 0.6067415730337078, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8076923076923077, 'recall': 0.875, 'f1-score': 0.8400000000000001, 'support': 24}, '7': {'precision': 0.6735294117647059, 'recall': 0.8807692307692307, 'f1-score': 0.7633333333333334, 'support': 260}, '8': {'precision': 0.6625, 'recall': 0.53, 'f1-score': 0.588888888888889, 'support': 200}, '9': {'precision': 0.6428571428571429, 'recall': 0.21686746987951808, 'f1-score': 0.32432432432432434, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7595667870036101, 'recall': 0.7514285714285714, 'f1-score': 0.755475763016158, 'support': 1400}, 'macro avg': {'precision': 0.7338450971070353, 'recall': 0.6254272495372116, 'f1-score': 0.6584154430031949, 'support': 1400}, 'weighted avg': {'precision': 0.7541032510380659, 'recall': 0.7514285714285714, 'f1-score': 0.7395658044313245, 'support': 1400}, 'samples avg': {'precision': 0.7514285714285714, 'recall': 0.7514285714285714, 'f1-score': 0.7514285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9197707736389685, 'recall': 0.8916666666666667, 'f1-score': 0.9055007052186178, 'support': 360}, '1': {'precision': 0.8, 'recall': 0.7706422018348624, 'f1-score': 0.7850467289719626, 'support': 218}, '2': {'precision': 0.9029126213592233, 'recall': 0.8611111111111112, 'f1-score': 0.8815165876777251, 'support': 108}, '3': {'precision': 0.7333333333333333, 'recall': 0.4714285714285714, 'f1-score': 0.5739130434782609, 'support': 70}, '4': {'precision': 0.8333333333333334, 'recall': 0.6818181818181818, 'f1-score': 0.7499999999999999, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.8490566037735849, 'recall': 0.8823529411764706, 'f1-score': 0.8653846153846154, 'support': 51}, '7': {'precision': 0.6923076923076923, 'recall': 0.8362831858407079, 'f1-score': 0.7575150300601203, 'support': 226}, '8': {'precision': 0.5659340659340659, 'recall': 0.6242424242424243, 'f1-score': 0.5936599423631124, 'support': 165}, '9': {'precision': 0.6851851851851852, 'recall': 0.4457831325301205, 'f1-score': 0.5401459854014597, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7880553532410779, 'recall': 0.7728571428571429, 'f1-score': 0.7803822574828705, 'support': 1400}, 'macro avg': {'precision': 0.7511891799891953, 'recall': 0.7024226023217656, 'f1-score': 0.7209157580340221, 'support': 1400}, 'weighted avg': {'precision': 0.7870162399272038, 'recall': 0.7728571428571429, 'f1-score': 0.7754210981867319, 'support': 1400}, 'samples avg': {'precision': 0.7728571428571429, 'recall': 0.7728571428571429, 'f1-score': 0.7728571428571429, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:34:44.407662: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:34:44.644550: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:34:46.173022: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:34:46.173224: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:34:46.173239: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:34:54.309816: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:34:54.841921: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    3layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 05:34:58.117241: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 53s - loss: 0.8123 - acc: 0.7554 - precision: 0.8313 - recall: 0.6916 - val_loss: 0.9301 - val_acc: 0.7814 - val_precision: 0.7999 - val_recall: 0.7679 - 53s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8087557603686636, 'recall': 0.9435483870967742, 'f1-score': 0.870967741935484, 'support': 372}, '1': {'precision': 0.7623762376237624, 'recall': 0.6936936936936937, 'f1-score': 0.7264150943396227, 'support': 222}, '2': {'precision': 0.826530612244898, 'recall': 0.9204545454545454, 'f1-score': 0.870967741935484, 'support': 88}, '3': {'precision': 0.9, 'recall': 0.35294117647058826, 'f1-score': 0.5070422535211269, 'support': 51}, '4': {'precision': 0.8333333333333334, 'recall': 0.35714285714285715, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.84, 'recall': 0.875, 'f1-score': 0.8571428571428572, 'support': 24}, '7': {'precision': 0.707641196013289, 'recall': 0.8192307692307692, 'f1-score': 0.7593582887700534, 'support': 260}, '8': {'precision': 0.6089385474860335, 'recall': 0.545, 'f1-score': 0.575197889182058, 'support': 200}, '9': {'precision': 0.5161290322580645, 'recall': 0.1927710843373494, 'f1-score': 0.28070175438596495, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7555391432791728, 'recall': 0.7307142857142858, 'f1-score': 0.7429193899782136, 'support': 1400}, 'macro avg': {'precision': 0.7494691275939988, 'recall': 0.5924866333551813, 'f1-score': 0.6362771650017057, 'support': 1400}, 'weighted avg': {'precision': 0.7482881433686853, 'recall': 0.7307142857142858, 'f1-score': 0.7244193319582686, 'support': 1400}, 'samples avg': {'precision': 0.7307142857142858, 'recall': 0.7307142857142858, 'f1-score': 0.7307142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8882978723404256, 'recall': 0.9277777777777778, 'f1-score': 0.907608695652174, 'support': 360}, '1': {'precision': 0.7892156862745098, 'recall': 0.7385321100917431, 'f1-score': 0.7630331753554502, 'support': 218}, '2': {'precision': 0.9183673469387755, 'recall': 0.8333333333333334, 'f1-score': 0.8737864077669903, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.42857142857142855, 'f1-score': 0.6, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.9411764705882353, 'recall': 0.9142857142857143, 'f1-score': 0.9275362318840579, 'support': 35}, '6': {'precision': 0.8490566037735849, 'recall': 0.8823529411764706, 'f1-score': 0.8653846153846154, 'support': 51}, '7': {'precision': 0.7729257641921398, 'recall': 0.7831858407079646, 'f1-score': 0.7780219780219781, 'support': 226}, '8': {'precision': 0.5555555555555556, 'recall': 0.6363636363636364, 'f1-score': 0.5932203389830508, 'support': 165}, '9': {'precision': 0.6461538461538462, 'recall': 0.5060240963855421, 'f1-score': 0.5675675675675675, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.875, 'recall': 0.9210526315789473, 'f1-score': 0.8974358974358975, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7998511904761905, 'recall': 0.7678571428571429, 'f1-score': 0.7835276967930028, 'support': 1400}, 'macro avg': {'precision': 0.7788183103619969, 'recall': 0.6823216006902968, 'f1-score': 0.7154513565634238, 'support': 1400}, 'weighted avg': {'precision': 0.8028908603880287, 'recall': 0.7678571428571429, 'f1-score': 0.7776817796852316, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 51s - loss: 0.5856 - acc: 0.8298 - precision: 0.8603 - recall: 0.7978 - val_loss: 1.0579 - val_acc: 0.7807 - val_precision: 0.7873 - val_recall: 0.7721 - 51s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8549618320610687, 'recall': 0.9032258064516129, 'f1-score': 0.8784313725490195, 'support': 372}, '1': {'precision': 0.78, 'recall': 0.7027027027027027, 'f1-score': 0.7393364928909952, 'support': 222}, '2': {'precision': 0.7685185185185185, 'recall': 0.9431818181818182, 'f1-score': 0.8469387755102041, 'support': 88}, '3': {'precision': 0.7631578947368421, 'recall': 0.5686274509803921, 'f1-score': 0.651685393258427, 'support': 51}, '4': {'precision': 0.625, 'recall': 0.35714285714285715, 'f1-score': 0.45454545454545453, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.6577380952380952, 'recall': 0.85, 'f1-score': 0.7416107382550335, 'support': 260}, '8': {'precision': 0.6294117647058823, 'recall': 0.535, 'f1-score': 0.5783783783783784, 'support': 200}, '9': {'precision': 0.5714285714285714, 'recall': 0.1927710843373494, 'f1-score': 0.28828828828828834, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7536656891495601, 'recall': 0.7342857142857143, 'f1-score': 0.743849493487699, 'support': 1400}, 'macro avg': {'precision': 0.7266733440942903, 'recall': 0.6106560594862188, 'f1-score': 0.6482498476899844, 'support': 1400}, 'weighted avg': {'precision': 0.7477916551775593, 'recall': 0.7342857142857143, 'f1-score': 0.7292606800726832, 'support': 1400}, 'samples avg': {'precision': 0.7342857142857143, 'recall': 0.7342857142857143, 'f1-score': 0.7342857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9142857142857143, 'recall': 0.8888888888888888, 'f1-score': 0.9014084507042254, 'support': 360}, '1': {'precision': 0.8059701492537313, 'recall': 0.7431192660550459, 'f1-score': 0.7732696897374702, 'support': 218}, '2': {'precision': 0.8611111111111112, 'recall': 0.8611111111111112, 'f1-score': 0.8611111111111112, 'support': 108}, '3': {'precision': 0.7872340425531915, 'recall': 0.5285714285714286, 'f1-score': 0.6324786324786325, 'support': 70}, '4': {'precision': 0.85, 'recall': 0.7727272727272727, 'f1-score': 0.8095238095238095, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.9148936170212766, 'recall': 0.8431372549019608, 'f1-score': 0.8775510204081632, 'support': 51}, '7': {'precision': 0.7078651685393258, 'recall': 0.8362831858407079, 'f1-score': 0.7667342799188641, 'support': 226}, '8': {'precision': 0.5531914893617021, 'recall': 0.6303030303030303, 'f1-score': 0.5892351274787535, 'support': 165}, '9': {'precision': 0.6724137931034483, 'recall': 0.46987951807228917, 'f1-score': 0.5531914893617021, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7873270211216314, 'recall': 0.7721428571428571, 'f1-score': 0.7796610169491525, 'support': 1400}, 'macro avg': {'precision': 0.7494794968358689, 'recall': 0.7052890614289998, 'f1-score': 0.7226371682977485, 'support': 1400}, 'weighted avg': {'precision': 0.787484556709098, 'recall': 0.7721428571428571, 'f1-score': 0.7759256190071985, 'support': 1400}, 'samples avg': {'precision': 0.7721428571428571, 'recall': 0.7721428571428571, 'f1-score': 0.7721428571428571, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 51s - loss: 0.5091 - acc: 0.8430 - precision: 0.8724 - recall: 0.8230 - val_loss: 1.0576 - val_acc: 0.7629 - val_precision: 0.7802 - val_recall: 0.7557 - 51s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8553299492385786, 'recall': 0.9059139784946236, 'f1-score': 0.8798955613577024, 'support': 372}, '1': {'precision': 0.7724867724867724, 'recall': 0.6576576576576577, 'f1-score': 0.710462287104623, 'support': 222}, '2': {'precision': 0.803921568627451, 'recall': 0.9318181818181818, 'f1-score': 0.8631578947368421, 'support': 88}, '3': {'precision': 0.7222222222222222, 'recall': 0.5098039215686274, 'f1-score': 0.5977011494252873, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.8260869565217391, 'recall': 0.7916666666666666, 'f1-score': 0.8085106382978724, 'support': 24}, '7': {'precision': 0.661849710982659, 'recall': 0.8807692307692307, 'f1-score': 0.7557755775577557, 'support': 260}, '8': {'precision': 0.6277777777777778, 'recall': 0.565, 'f1-score': 0.5947368421052631, 'support': 200}, '9': {'precision': 0.6, 'recall': 0.18072289156626506, 'f1-score': 0.2777777777777778, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7536656891495601, 'recall': 0.7342857142857143, 'f1-score': 0.743849493487699, 'support': 1400}, 'macro avg': {'precision': 0.723262542545792, 'recall': 0.606872724013938, 'f1-score': 0.6428508520120457, 'support': 1400}, 'weighted avg': {'precision': 0.749039774500938, 'recall': 0.7342857142857143, 'f1-score': 0.728059482402038, 'support': 1400}, 'samples avg': {'precision': 0.7342857142857143, 'recall': 0.7342857142857143, 'f1-score': 0.7342857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9186046511627907, 'recall': 0.8777777777777778, 'f1-score': 0.8977272727272728, 'support': 360}, '1': {'precision': 0.8148148148148148, 'recall': 0.7064220183486238, 'f1-score': 0.7567567567567567, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.8333333333333334, 'f1-score': 0.8653846153846153, 'support': 108}, '3': {'precision': 0.7659574468085106, 'recall': 0.5142857142857142, 'f1-score': 0.6153846153846153, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.8947368421052632, 'recall': 0.6666666666666666, 'f1-score': 0.7640449438202247, 'support': 51}, '7': {'precision': 0.6959706959706959, 'recall': 0.8407079646017699, 'f1-score': 0.7615230460921844, 'support': 226}, '8': {'precision': 0.5148514851485149, 'recall': 0.6303030303030303, 'f1-score': 0.5667574931880108, 'support': 165}, '9': {'precision': 0.6964285714285714, 'recall': 0.46987951807228917, 'f1-score': 0.5611510791366906, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7802359882005899, 'recall': 0.7557142857142857, 'f1-score': 0.7677793904208997, 'support': 1400}, 'macro avg': {'precision': 0.750448075611713, 'recall': 0.6926340565864876, 'f1-score': 0.7148726624227233, 'support': 1400}, 'weighted avg': {'precision': 0.7868106092987964, 'recall': 0.7557142857142857, 'f1-score': 0.765421039529319, 'support': 1400}, 'samples avg': {'precision': 0.7557142857142857, 'recall': 0.7557142857142857, 'f1-score': 0.7557142857142857, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 51s - loss: 0.4680 - acc: 0.8582 - precision: 0.8802 - recall: 0.8350 - val_loss: 1.1857 - val_acc: 0.7679 - val_precision: 0.7794 - val_recall: 0.7571 - 51s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8444444444444444, 'recall': 0.9193548387096774, 'f1-score': 0.8803088803088802, 'support': 372}, '1': {'precision': 0.7638190954773869, 'recall': 0.6846846846846847, 'f1-score': 0.7220902612826604, 'support': 222}, '2': {'precision': 0.8350515463917526, 'recall': 0.9204545454545454, 'f1-score': 0.8756756756756756, 'support': 88}, '3': {'precision': 0.7575757575757576, 'recall': 0.49019607843137253, 'f1-score': 0.5952380952380952, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8260869565217391, 'recall': 0.7916666666666666, 'f1-score': 0.8085106382978724, 'support': 24}, '7': {'precision': 0.6444444444444445, 'recall': 0.8923076923076924, 'f1-score': 0.7483870967741936, 'support': 260}, '8': {'precision': 0.6481481481481481, 'recall': 0.525, 'f1-score': 0.580110497237569, 'support': 200}, '9': {'precision': 0.6153846153846154, 'recall': 0.1927710843373494, 'f1-score': 0.29357798165137616, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7527193618564177, 'recall': 0.7414285714285714, 'f1-score': 0.7470313062252609, 'support': 1400}, 'macro avg': {'precision': 0.7363426929529453, 'recall': 0.6224578679812107, 'f1-score': 0.6594972572198174, 'support': 1400}, 'weighted avg': {'precision': 0.7501412624762723, 'recall': 0.7414285714285714, 'f1-score': 0.7314714970795848, 'support': 1400}, 'samples avg': {'precision': 0.7414285714285714, 'recall': 0.7414285714285714, 'f1-score': 0.7414285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9176470588235294, 'recall': 0.8666666666666667, 'f1-score': 0.8914285714285715, 'support': 360}, '1': {'precision': 0.7980295566502463, 'recall': 0.7431192660550459, 'f1-score': 0.7695961995249406, 'support': 218}, '2': {'precision': 0.9278350515463918, 'recall': 0.8333333333333334, 'f1-score': 0.8780487804878049, 'support': 108}, '3': {'precision': 0.7209302325581395, 'recall': 0.44285714285714284, 'f1-score': 0.5486725663716814, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.868421052631579, 'recall': 0.9428571428571428, 'f1-score': 0.904109589041096, 'support': 35}, '6': {'precision': 0.8536585365853658, 'recall': 0.6862745098039216, 'f1-score': 0.7608695652173912, 'support': 51}, '7': {'precision': 0.6701388888888888, 'recall': 0.8539823008849557, 'f1-score': 0.7509727626459143, 'support': 226}, '8': {'precision': 0.5591397849462365, 'recall': 0.6303030303030303, 'f1-score': 0.5925925925925924, 'support': 165}, '9': {'precision': 0.6851851851851852, 'recall': 0.4457831325301205, 'f1-score': 0.5401459854014597, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.9444444444444444, 'recall': 0.8947368421052632, 'f1-score': 0.918918918918919, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7794117647058824, 'recall': 0.7571428571428571, 'f1-score': 0.7681159420289856, 'support': 1400}, 'macro avg': {'precision': 0.7441539400639565, 'recall': 0.6919813479415983, 'f1-score': 0.7112178247774279, 'support': 1400}, 'weighted avg': {'precision': 0.7828533723175288, 'recall': 0.7571428571428571, 'f1-score': 0.7638438222834629, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 51s - loss: 0.4216 - acc: 0.8690 - precision: 0.8879 - recall: 0.8526 - val_loss: 1.4243 - val_acc: 0.7621 - val_precision: 0.7650 - val_recall: 0.7557 - 51s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8808864265927978, 'recall': 0.8548387096774194, 'f1-score': 0.8676671214188266, 'support': 372}, '1': {'precision': 0.7681159420289855, 'recall': 0.7162162162162162, 'f1-score': 0.7412587412587412, 'support': 222}, '2': {'precision': 0.7345132743362832, 'recall': 0.9431818181818182, 'f1-score': 0.8258706467661692, 'support': 88}, '3': {'precision': 0.6170212765957447, 'recall': 0.5686274509803921, 'f1-score': 0.5918367346938775, 'support': 51}, '4': {'precision': 0.7368421052631579, 'recall': 0.5, 'f1-score': 0.5957446808510638, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.7916666666666666, 'recall': 0.7916666666666666, 'f1-score': 0.7916666666666666, 'support': 24}, '7': {'precision': 0.623342175066313, 'recall': 0.9038461538461539, 'f1-score': 0.7378335949764521, 'support': 260}, '8': {'precision': 0.6474358974358975, 'recall': 0.505, 'f1-score': 0.5674157303370787, 'support': 200}, '9': {'precision': 0.6363636363636364, 'recall': 0.1686746987951807, 'f1-score': 0.26666666666666666, 'support': 83}, '10': {'precision': 0.9, 'recall': 0.6, 'f1-score': 0.7200000000000001, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7409551374819102, 'recall': 0.7314285714285714, 'f1-score': 0.7361610352264557, 'support': 1400}, 'macro avg': {'precision': 0.707866063763147, 'recall': 0.6251975698098153, 'f1-score': 0.6472488829574001, 'support': 1400}, 'weighted avg': {'precision': 0.7444970450904407, 'recall': 0.7314285714285714, 'f1-score': 0.7218271020215132, 'support': 1400}, 'samples avg': {'precision': 0.7314285714285714, 'recall': 0.7314285714285714, 'f1-score': 0.7314285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9347826086956522, 'recall': 0.8361111111111111, 'f1-score': 0.8826979472140762, 'support': 360}, '1': {'precision': 0.7793427230046949, 'recall': 0.7614678899082569, 'f1-score': 0.7703016241299304, 'support': 218}, '2': {'precision': 0.8666666666666667, 'recall': 0.8425925925925926, 'f1-score': 0.8544600938967136, 'support': 108}, '3': {'precision': 0.6724137931034483, 'recall': 0.5571428571428572, 'f1-score': 0.609375, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.8695652173913043, 'recall': 0.7843137254901961, 'f1-score': 0.8247422680412372, 'support': 51}, '7': {'precision': 0.6390728476821192, 'recall': 0.8539823008849557, 'f1-score': 0.7310606060606061, 'support': 226}, '8': {'precision': 0.5580110497237569, 'recall': 0.6121212121212121, 'f1-score': 0.5838150289017341, 'support': 165}, '9': {'precision': 0.6666666666666666, 'recall': 0.3855421686746988, 'f1-score': 0.48854961832061067, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.765003615328995, 'recall': 0.7557142857142857, 'f1-score': 0.7603305785123967, 'support': 1400}, 'macro avg': {'precision': 0.7306828296376555, 'recall': 0.6998569669354626, 'f1-score': 0.7100795332766657, 'support': 1400}, 'weighted avg': {'precision': 0.770757181180541, 'recall': 0.7557142857142857, 'f1-score': 0.7572299679527024, 'support': 1400}, 'samples avg': {'precision': 0.7557142857142857, 'recall': 0.7557142857142857, 'f1-score': 0.7557142857142857, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 2 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:40:04.090399: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:40:04.331084: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:40:05.814276: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:40:05.814478: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:40:05.814492: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=2, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:40:13.462207: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:40:13.996070: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3415000.81it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3125080.15it/s]
Mon May 22 05:40:16 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:40:19.639587: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
 1/26 [>.............................] - ETA: 19s26/26 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2321399.16it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2296451.15it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2726406.66it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 79938.10it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2640299.28it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 80406.76it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3111831.27it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3061535.77it/s]
Mon May 22 05:40:20 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2183720.94it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2434504.81it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2698541.18it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 80309.99it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2687425.90it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 80249.63it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               2 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 39s - loss: 0.7577 - acc: 0.7796 - precision: 0.8506 - recall: 0.7164 - val_loss: 0.9354 - val_acc: 0.7771 - val_precision: 0.7914 - val_recall: 0.7643 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8353221957040573, 'recall': 0.9408602150537635, 'f1-score': 0.8849557522123894, 'support': 372}, '1': {'precision': 0.75, 'recall': 0.7297297297297297, 'f1-score': 0.7397260273972601, 'support': 222}, '2': {'precision': 0.8247422680412371, 'recall': 0.9090909090909091, 'f1-score': 0.8648648648648649, 'support': 88}, '3': {'precision': 0.8064516129032258, 'recall': 0.49019607843137253, 'f1-score': 0.6097560975609755, 'support': 51}, '4': {'precision': 0.8333333333333334, 'recall': 0.35714285714285715, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8695652173913043, 'recall': 0.8333333333333334, 'f1-score': 0.851063829787234, 'support': 24}, '7': {'precision': 0.6833855799373041, 'recall': 0.8384615384615385, 'f1-score': 0.7530224525043178, 'support': 260}, '8': {'precision': 0.6369047619047619, 'recall': 0.535, 'f1-score': 0.5815217391304348, 'support': 200}, '9': {'precision': 0.6363636363636364, 'recall': 0.1686746987951807, 'f1-score': 0.26666666666666666, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7615894039735099, 'recall': 0.7392857142857143, 'f1-score': 0.7502718376223269, 'support': 1400}, 'macro avg': {'precision': 0.7529102547277857, 'recall': 0.595862273139823, 'f1-score': 0.6402947419283833, 'support': 1400}, 'weighted avg': {'precision': 0.7562598473562914, 'recall': 0.7392857142857143, 'f1-score': 0.7315912078271104, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9106145251396648, 'recall': 0.9055555555555556, 'f1-score': 0.9080779944289693, 'support': 360}, '1': {'precision': 0.7830188679245284, 'recall': 0.7614678899082569, 'f1-score': 0.772093023255814, 'support': 218}, '2': {'precision': 0.89, 'recall': 0.8240740740740741, 'f1-score': 0.8557692307692307, 'support': 108}, '3': {'precision': 0.8717948717948718, 'recall': 0.4857142857142857, 'f1-score': 0.6238532110091742, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.9393939393939394, 'recall': 0.8857142857142857, 'f1-score': 0.9117647058823529, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7351778656126482, 'recall': 0.8230088495575221, 'f1-score': 0.7766179540709812, 'support': 226}, '8': {'precision': 0.5226130653266332, 'recall': 0.6303030303030303, 'f1-score': 0.5714285714285714, 'support': 165}, '9': {'precision': 0.7111111111111111, 'recall': 0.3855421686746988, 'f1-score': 0.5, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7914201183431953, 'recall': 0.7642857142857142, 'f1-score': 0.7776162790697674, 'support': 1400}, 'macro avg': {'precision': 0.7704655981697152, 'recall': 0.6856173510170336, 'f1-score': 0.7178553836255445, 'support': 1400}, 'weighted avg': {'precision': 0.7948922165995385, 'recall': 0.7642857142857142, 'f1-score': 0.7725626874800428, 'support': 1400}, 'samples avg': {'precision': 0.7642857142857142, 'recall': 0.7642857142857142, 'f1-score': 0.7642857142857142, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 38s - loss: 0.5462 - acc: 0.8330 - precision: 0.8662 - recall: 0.8068 - val_loss: 0.9232 - val_acc: 0.7807 - val_precision: 0.7987 - val_recall: 0.7707 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8361858190709046, 'recall': 0.9193548387096774, 'f1-score': 0.8758002560819462, 'support': 372}, '1': {'precision': 0.7619047619047619, 'recall': 0.7207207207207207, 'f1-score': 0.7407407407407407, 'support': 222}, '2': {'precision': 0.7961165048543689, 'recall': 0.9318181818181818, 'f1-score': 0.8586387434554973, 'support': 88}, '3': {'precision': 0.6744186046511628, 'recall': 0.5686274509803921, 'f1-score': 0.6170212765957446, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8695652173913043, 'recall': 0.8333333333333334, 'f1-score': 0.851063829787234, 'support': 24}, '7': {'precision': 0.67601246105919, 'recall': 0.8346153846153846, 'f1-score': 0.7469879518072289, 'support': 260}, '8': {'precision': 0.6645962732919255, 'recall': 0.535, 'f1-score': 0.5927977839335179, 'support': 200}, '9': {'precision': 0.6666666666666666, 'recall': 0.21686746987951808, 'f1-score': 0.32727272727272727, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.8857142857142857, 'recall': 0.8378378378378378, 'f1-score': 0.8611111111111112, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7580409356725146, 'recall': 0.7407142857142858, 'f1-score': 0.7492774566473989, 'support': 1400}, 'macro avg': {'precision': 0.7306036354824029, 'recall': 0.6194890223633982, 'f1-score': 0.6537591954180944, 'support': 1400}, 'weighted avg': {'precision': 0.7521293367315871, 'recall': 0.7407142857142858, 'f1-score': 0.7340632211711441, 'support': 1400}, 'samples avg': {'precision': 0.7407142857142858, 'recall': 0.7407142857142858, 'f1-score': 0.7407142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9152542372881356, 'recall': 0.9, 'f1-score': 0.9075630252100839, 'support': 360}, '1': {'precision': 0.7980295566502463, 'recall': 0.7431192660550459, 'f1-score': 0.7695961995249406, 'support': 218}, '2': {'precision': 0.8518518518518519, 'recall': 0.8518518518518519, 'f1-score': 0.8518518518518519, 'support': 108}, '3': {'precision': 0.7307692307692307, 'recall': 0.5428571428571428, 'f1-score': 0.6229508196721311, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.8936170212765957, 'recall': 0.8235294117647058, 'f1-score': 0.8571428571428571, 'support': 51}, '7': {'precision': 0.7469879518072289, 'recall': 0.8230088495575221, 'f1-score': 0.783157894736842, 'support': 226}, '8': {'precision': 0.572972972972973, 'recall': 0.6424242424242425, 'f1-score': 0.6057142857142858, 'support': 165}, '9': {'precision': 0.7083333333333334, 'recall': 0.40963855421686746, 'f1-score': 0.5190839694656489, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7986676535899334, 'recall': 0.7707142857142857, 'f1-score': 0.7844420210832425, 'support': 1400}, 'macro avg': {'precision': 0.7590560943780998, 'recall': 0.7077920023817317, 'f1-score': 0.728352829886965, 'support': 1400}, 'weighted avg': {'precision': 0.7949272236768428, 'recall': 0.7707142857142857, 'f1-score': 0.7789220405565818, 'support': 1400}, 'samples avg': {'precision': 0.7707142857142857, 'recall': 0.7707142857142857, 'f1-score': 0.7707142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 38s - loss: 0.4807 - acc: 0.8524 - precision: 0.8794 - recall: 0.8312 - val_loss: 0.9514 - val_acc: 0.7800 - val_precision: 0.7930 - val_recall: 0.7714 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8560411311053985, 'recall': 0.8951612903225806, 'f1-score': 0.8751642575558476, 'support': 372}, '1': {'precision': 0.7547169811320755, 'recall': 0.7207207207207207, 'f1-score': 0.7373271889400921, 'support': 222}, '2': {'precision': 0.8163265306122449, 'recall': 0.9090909090909091, 'f1-score': 0.8602150537634408, 'support': 88}, '3': {'precision': 0.6222222222222222, 'recall': 0.5490196078431373, 'f1-score': 0.5833333333333334, 'support': 51}, '4': {'precision': 0.8333333333333334, 'recall': 0.35714285714285715, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8636363636363636, 'recall': 0.7916666666666666, 'f1-score': 0.8260869565217391, 'support': 24}, '7': {'precision': 0.6656626506024096, 'recall': 0.85, 'f1-score': 0.7466216216216215, 'support': 260}, '8': {'precision': 0.6303030303030303, 'recall': 0.52, 'f1-score': 0.5698630136986301, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.24096385542168675, 'f1-score': 0.34782608695652173, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7538574577516532, 'recall': 0.7328571428571429, 'f1-score': 0.743208982252807, 'support': 1400}, 'macro avg': {'precision': 0.7368466883714948, 'recall': 0.6085245716400697, 'f1-score': 0.6494550253708108, 'support': 1400}, 'weighted avg': {'precision': 0.7502630957180182, 'recall': 0.7328571428571429, 'f1-score': 0.730214391644847, 'support': 1400}, 'samples avg': {'precision': 0.7328571428571429, 'recall': 0.7328571428571429, 'f1-score': 0.7328571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9285714285714286, 'recall': 0.8666666666666667, 'f1-score': 0.896551724137931, 'support': 360}, '1': {'precision': 0.7904761904761904, 'recall': 0.7614678899082569, 'f1-score': 0.7757009345794392, 'support': 218}, '2': {'precision': 0.9263157894736842, 'recall': 0.8148148148148148, 'f1-score': 0.8669950738916257, 'support': 108}, '3': {'precision': 0.7115384615384616, 'recall': 0.5285714285714286, 'f1-score': 0.6065573770491803, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.9411764705882353, 'recall': 0.9142857142857143, 'f1-score': 0.9275362318840579, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7153558052434457, 'recall': 0.8451327433628318, 'f1-score': 0.7748478701825556, 'support': 226}, '8': {'precision': 0.5684210526315789, 'recall': 0.6545454545454545, 'f1-score': 0.6084507042253521, 'support': 165}, '9': {'precision': 0.6666666666666666, 'recall': 0.4819277108433735, 'f1-score': 0.5594405594405594, 'support': 83}, '10': {'precision': 1.0, 'recall': 1.0, 'f1-score': 1.0, 'support': 14}, '11': {'precision': 0.8974358974358975, 'recall': 0.9210526315789473, 'f1-score': 0.9090909090909091, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7929515418502202, 'recall': 0.7714285714285715, 'f1-score': 0.7820419985517741, 'support': 1400}, 'macro avg': {'precision': 0.7599513364315056, 'recall': 0.7168968731136667, 'f1-score': 0.7346938472386098, 'support': 1400}, 'weighted avg': {'precision': 0.7944850846319236, 'recall': 0.7714285714285715, 'f1-score': 0.7794234403744911, 'support': 1400}, 'samples avg': {'precision': 0.7714285714285715, 'recall': 0.7714285714285715, 'f1-score': 0.7714285714285715, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 38s - loss: 0.4136 - acc: 0.8714 - precision: 0.8911 - recall: 0.8530 - val_loss: 1.0578 - val_acc: 0.7843 - val_precision: 0.7894 - val_recall: 0.7764 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8415841584158416, 'recall': 0.9139784946236559, 'f1-score': 0.8762886597938144, 'support': 372}, '1': {'precision': 0.7684729064039408, 'recall': 0.7027027027027027, 'f1-score': 0.7341176470588235, 'support': 222}, '2': {'precision': 0.81, 'recall': 0.9204545454545454, 'f1-score': 0.8617021276595745, 'support': 88}, '3': {'precision': 0.6904761904761905, 'recall': 0.5686274509803921, 'f1-score': 0.6236559139784946, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.875, 'recall': 0.875, 'f1-score': 0.875, 'support': 24}, '7': {'precision': 0.6815286624203821, 'recall': 0.823076923076923, 'f1-score': 0.745644599303136, 'support': 260}, '8': {'precision': 0.6141304347826086, 'recall': 0.565, 'f1-score': 0.5885416666666666, 'support': 200}, '9': {'precision': 0.6363636363636364, 'recall': 0.25301204819277107, 'f1-score': 0.3620689655172414, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7552804078659869, 'recall': 0.7407142857142858, 'f1-score': 0.7479264334655608, 'support': 1400}, 'macro avg': {'precision': 0.7341235699254359, 'recall': 0.624220928899843, 'f1-score': 0.6599052564128967, 'support': 1400}, 'weighted avg': {'precision': 0.7498154235630741, 'recall': 0.7407142857142858, 'f1-score': 0.7357347854697681, 'support': 1400}, 'samples avg': {'precision': 0.7407142857142858, 'recall': 0.7407142857142858, 'f1-score': 0.7407142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9235294117647059, 'recall': 0.8722222222222222, 'f1-score': 0.8971428571428572, 'support': 360}, '1': {'precision': 0.8097560975609757, 'recall': 0.7614678899082569, 'f1-score': 0.7848699763593381, 'support': 218}, '2': {'precision': 0.883495145631068, 'recall': 0.8425925925925926, 'f1-score': 0.8625592417061612, 'support': 108}, '3': {'precision': 0.7037037037037037, 'recall': 0.5428571428571428, 'f1-score': 0.6129032258064516, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.8823529411764706, 'f1-score': 0.8910891089108911, 'support': 51}, '7': {'precision': 0.7449392712550608, 'recall': 0.8141592920353983, 'f1-score': 0.7780126849894291, 'support': 226}, '8': {'precision': 0.5283018867924528, 'recall': 0.6787878787878788, 'f1-score': 0.5941644562334217, 'support': 165}, '9': {'precision': 0.6984126984126984, 'recall': 0.5301204819277109, 'f1-score': 0.6027397260273972, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.9444444444444444, 'recall': 0.8947368421052632, 'f1-score': 0.918918918918919, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7893972403776325, 'recall': 0.7764285714285715, 'f1-score': 0.7828592005761613, 'support': 1400}, 'macro avg': {'precision': 0.7571963682759899, 'recall': 0.7112746162219742, 'f1-score': 0.7301366838355234, 'support': 1400}, 'weighted avg': {'precision': 0.7941099771659191, 'recall': 0.7764285714285715, 'f1-score': 0.7821388664047738, 'support': 1400}, 'samples avg': {'precision': 0.7764285714285715, 'recall': 0.7764285714285715, 'f1-score': 0.7764285714285715, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 38s - loss: 0.3753 - acc: 0.8782 - precision: 0.8965 - recall: 0.8660 - val_loss: 1.1331 - val_acc: 0.7821 - val_precision: 0.7884 - val_recall: 0.7743 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8258823529411765, 'recall': 0.9435483870967742, 'f1-score': 0.8808030112923463, 'support': 372}, '1': {'precision': 0.7559808612440191, 'recall': 0.7117117117117117, 'f1-score': 0.7331786542923432, 'support': 222}, '2': {'precision': 0.8315789473684211, 'recall': 0.8977272727272727, 'f1-score': 0.8633879781420765, 'support': 88}, '3': {'precision': 0.8148148148148148, 'recall': 0.43137254901960786, 'f1-score': 0.5641025641025642, 'support': 51}, '4': {'precision': 0.7692307692307693, 'recall': 0.35714285714285715, 'f1-score': 0.48780487804878053, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.84, 'recall': 0.875, 'f1-score': 0.8571428571428572, 'support': 24}, '7': {'precision': 0.6666666666666666, 'recall': 0.8615384615384616, 'f1-score': 0.7516778523489933, 'support': 260}, '8': {'precision': 0.625, 'recall': 0.525, 'f1-score': 0.5706521739130436, 'support': 200}, '9': {'precision': 0.7241379310344828, 'recall': 0.25301204819277107, 'f1-score': 0.375, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7545126353790613, 'recall': 0.7464285714285714, 'f1-score': 0.7504488330341113, 'support': 1400}, 'macro avg': {'precision': 0.7456637290580103, 'recall': 0.625020282637454, 'f1-score': 0.6612076217940059, 'support': 1400}, 'weighted avg': {'precision': 0.753176243546632, 'recall': 0.7464285714285714, 'f1-score': 0.7347580853718476, 'support': 1400}, 'samples avg': {'precision': 0.7464285714285714, 'recall': 0.7464285714285714, 'f1-score': 0.7464285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9129213483146067, 'recall': 0.9027777777777778, 'f1-score': 0.9078212290502793, 'support': 360}, '1': {'precision': 0.803921568627451, 'recall': 0.7522935779816514, 'f1-score': 0.7772511848341231, 'support': 218}, '2': {'precision': 0.9361702127659575, 'recall': 0.8148148148148148, 'f1-score': 0.8712871287128713, 'support': 108}, '3': {'precision': 0.7631578947368421, 'recall': 0.4142857142857143, 'f1-score': 0.5370370370370371, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.868421052631579, 'recall': 0.9428571428571428, 'f1-score': 0.904109589041096, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.8823529411764706, 'f1-score': 0.8910891089108911, 'support': 51}, '7': {'precision': 0.6884057971014492, 'recall': 0.8407079646017699, 'f1-score': 0.7569721115537847, 'support': 226}, '8': {'precision': 0.5572916666666666, 'recall': 0.6484848484848484, 'f1-score': 0.5994397759103641, 'support': 165}, '9': {'precision': 0.7017543859649122, 'recall': 0.4819277108433735, 'f1-score': 0.5714285714285715, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7883636363636364, 'recall': 0.7742857142857142, 'f1-score': 0.7812612612612612, 'support': 1400}, 'macro avg': {'precision': 0.7591450793902018, 'recall': 0.7100833454440756, 'f1-score': 0.7272787189557918, 'support': 1400}, 'weighted avg': {'precision': 0.7907382319828139, 'recall': 0.7742857142857142, 'f1-score': 0.7765010201929652, 'support': 1400}, 'samples avg': {'precision': 0.7742857142857142, 'recall': 0.7742857142857142, 'f1-score': 0.7742857142857142, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:44:18.517743: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:44:18.747459: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:44:20.328545: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:44:20.328741: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:44:20.328755: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:44:29.220300: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:44:29.757764: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3432327.33it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3180945.61it/s]
Mon May 22 05:44:31 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:44:34.950964: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
 1/26 [>.............................] - ETA: 18s26/26 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2328357.94it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2312731.63it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2736367.43it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 79371.73it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2669102.55it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 80013.43it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3084047.06it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3093796.42it/s]
Mon May 22 05:44:35 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2212519.07it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2444640.13it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2696063.18it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 79386.03it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2688656.41it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 79456.92it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               3 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 54s - loss: 0.7986 - acc: 0.7652 - precision: 0.8402 - recall: 0.6994 - val_loss: 0.9299 - val_acc: 0.7821 - val_precision: 0.7987 - val_recall: 0.7679 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8133640552995391, 'recall': 0.9489247311827957, 'f1-score': 0.8759305210918115, 'support': 372}, '1': {'precision': 0.7684729064039408, 'recall': 0.7027027027027027, 'f1-score': 0.7341176470588235, 'support': 222}, '2': {'precision': 0.8421052631578947, 'recall': 0.9090909090909091, 'f1-score': 0.8743169398907102, 'support': 88}, '3': {'precision': 0.7931034482758621, 'recall': 0.45098039215686275, 'f1-score': 0.5750000000000001, 'support': 51}, '4': {'precision': 0.8333333333333334, 'recall': 0.35714285714285715, 'f1-score': 0.5, 'support': 28}, '5': {'precision': 0.9333333333333333, 'recall': 0.8235294117647058, 'f1-score': 0.8749999999999999, 'support': 17}, '6': {'precision': 0.8333333333333334, 'recall': 0.8333333333333334, 'f1-score': 0.8333333333333334, 'support': 24}, '7': {'precision': 0.6705882352941176, 'recall': 0.8769230769230769, 'f1-score': 0.76, 'support': 260}, '8': {'precision': 0.6834532374100719, 'recall': 0.475, 'f1-score': 0.56047197640118, 'support': 200}, '9': {'precision': 0.5757575757575758, 'recall': 0.2289156626506024, 'f1-score': 0.3275862068965517, 'support': 83}, '10': {'precision': 0.8, 'recall': 0.26666666666666666, 'f1-score': 0.4, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7582659808963997, 'recall': 0.7371428571428571, 'f1-score': 0.7475552336110104, 'support': 1400}, 'macro avg': {'precision': 0.7295649785845387, 'recall': 0.5910785041865634, 'f1-score': 0.6296401416972088, 'support': 1400}, 'weighted avg': {'precision': 0.7517463716138791, 'recall': 0.7371428571428571, 'f1-score': 0.7278700897855166, 'support': 1400}, 'samples avg': {'precision': 0.7371428571428571, 'recall': 0.7371428571428571, 'f1-score': 0.7371428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8877284595300261, 'recall': 0.9444444444444444, 'f1-score': 0.9152086137281292, 'support': 360}, '1': {'precision': 0.7931034482758621, 'recall': 0.7385321100917431, 'f1-score': 0.7648456057007127, 'support': 218}, '2': {'precision': 0.9072164948453608, 'recall': 0.8148148148148148, 'f1-score': 0.8585365853658536, 'support': 108}, '3': {'precision': 0.8333333333333334, 'recall': 0.42857142857142855, 'f1-score': 0.5660377358490566, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.868421052631579, 'recall': 0.9428571428571428, 'f1-score': 0.904109589041096, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7276264591439688, 'recall': 0.827433628318584, 'f1-score': 0.7743271221532091, 'support': 226}, '8': {'precision': 0.6064516129032258, 'recall': 0.5696969696969697, 'f1-score': 0.5875, 'support': 165}, '9': {'precision': 0.640625, 'recall': 0.4939759036144578, 'f1-score': 0.5578231292517006, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.7142857142857143, 'f1-score': 0.8, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7986627043090639, 'recall': 0.7678571428571429, 'f1-score': 0.7829570284049526, 'support': 1400}, 'macro avg': {'precision': 0.7575789883518849, 'recall': 0.6846571765154417, 'f1-score': 0.7129604652259454, 'support': 1400}, 'weighted avg': {'precision': 0.7918611212080092, 'recall': 0.7678571428571429, 'f1-score': 0.7745343019475989, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 52s - loss: 0.5632 - acc: 0.8358 - precision: 0.8599 - recall: 0.8054 - val_loss: 1.0721 - val_acc: 0.7671 - val_precision: 0.7814 - val_recall: 0.7557 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.851010101010101, 'recall': 0.9059139784946236, 'f1-score': 0.8776041666666666, 'support': 372}, '1': {'precision': 0.7616822429906542, 'recall': 0.7342342342342343, 'f1-score': 0.7477064220183487, 'support': 222}, '2': {'precision': 0.8333333333333334, 'recall': 0.9090909090909091, 'f1-score': 0.8695652173913043, 'support': 88}, '3': {'precision': 0.782608695652174, 'recall': 0.35294117647058826, 'f1-score': 0.48648648648648657, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.9, 'recall': 0.75, 'f1-score': 0.8181818181818182, 'support': 24}, '7': {'precision': 0.6430594900849859, 'recall': 0.8730769230769231, 'f1-score': 0.7406199021207177, 'support': 260}, '8': {'precision': 0.622093023255814, 'recall': 0.535, 'f1-score': 0.5752688172043011, 'support': 200}, '9': {'precision': 0.5454545454545454, 'recall': 0.21686746987951808, 'f1-score': 0.31034482758620685, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7485422740524781, 'recall': 0.7335714285714285, 'f1-score': 0.740981240981241, 'support': 1400}, 'macro avg': {'precision': 0.7377713189282555, 'recall': 0.5853680185810313, 'f1-score': 0.6315098914871438, 'support': 1400}, 'weighted avg': {'precision': 0.7457784940551883, 'recall': 0.7335714285714285, 'f1-score': 0.7254386115922558, 'support': 1400}, 'samples avg': {'precision': 0.7335714285714285, 'recall': 0.7335714285714285, 'f1-score': 0.7335714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.933933933933934, 'recall': 0.8638888888888889, 'f1-score': 0.8975468975468976, 'support': 360}, '1': {'precision': 0.7924528301886793, 'recall': 0.7706422018348624, 'f1-score': 0.7813953488372094, 'support': 218}, '2': {'precision': 0.9270833333333334, 'recall': 0.8240740740740741, 'f1-score': 0.8725490196078431, 'support': 108}, '3': {'precision': 0.84, 'recall': 0.3, 'f1-score': 0.4421052631578948, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8918918918918919, 'recall': 0.9428571428571428, 'f1-score': 0.9166666666666667, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.6823104693140795, 'recall': 0.8362831858407079, 'f1-score': 0.7514910536779325, 'support': 226}, '8': {'precision': 0.5404040404040404, 'recall': 0.6484848484848484, 'f1-score': 0.5895316804407713, 'support': 165}, '9': {'precision': 0.6417910447761194, 'recall': 0.5180722891566265, 'f1-score': 0.5733333333333333, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6428571428571429, 'f1-score': 0.782608695652174, 'support': 14}, '11': {'precision': 0.8974358974358975, 'recall': 0.9210526315789473, 'f1-score': 0.9090909090909091, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7813884785819794, 'recall': 0.7557142857142857, 'f1-score': 0.7683369644153959, 'support': 1400}, 'macro avg': {'precision': 0.7576724973590938, 'recall': 0.6708442560711076, 'f1-score': 0.6986593427694885, 'support': 1400}, 'weighted avg': {'precision': 0.7910547094343555, 'recall': 0.7557142857142857, 'f1-score': 0.7633636123449707, 'support': 1400}, 'samples avg': {'precision': 0.7557142857142857, 'recall': 0.7557142857142857, 'f1-score': 0.7557142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 52s - loss: 0.5032 - acc: 0.8470 - precision: 0.8735 - recall: 0.8220 - val_loss: 1.0630 - val_acc: 0.7814 - val_precision: 0.7898 - val_recall: 0.7729 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8419753086419753, 'recall': 0.9166666666666666, 'f1-score': 0.8777348777348777, 'support': 372}, '1': {'precision': 0.7766497461928934, 'recall': 0.6891891891891891, 'f1-score': 0.7303102625298329, 'support': 222}, '2': {'precision': 0.8367346938775511, 'recall': 0.9318181818181818, 'f1-score': 0.8817204301075268, 'support': 88}, '3': {'precision': 0.6086956521739131, 'recall': 0.5490196078431373, 'f1-score': 0.577319587628866, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 0.9333333333333333, 'recall': 0.8235294117647058, 'f1-score': 0.8749999999999999, 'support': 17}, '6': {'precision': 0.9, 'recall': 0.75, 'f1-score': 0.8181818181818182, 'support': 24}, '7': {'precision': 0.6899696048632219, 'recall': 0.8730769230769231, 'f1-score': 0.7707979626485569, 'support': 260}, '8': {'precision': 0.6424242424242425, 'recall': 0.53, 'f1-score': 0.5808219178082192, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.30120481927710846, 'f1-score': 0.40650406504065045, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7611395178962747, 'recall': 0.7442857142857143, 'f1-score': 0.7526182737450343, 'support': 1400}, 'macro avg': {'precision': 0.731420171937445, 'recall': 0.6173963200987134, 'f1-score': 0.6551276399960574, 'support': 1400}, 'weighted avg': {'precision': 0.7552024128323285, 'recall': 0.7442857142857143, 'f1-score': 0.7401101578233961, 'support': 1400}, 'samples avg': {'precision': 0.7442857142857143, 'recall': 0.7442857142857143, 'f1-score': 0.7442857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9294117647058824, 'recall': 0.8777777777777778, 'f1-score': 0.9028571428571429, 'support': 360}, '1': {'precision': 0.8078817733990148, 'recall': 0.7522935779816514, 'f1-score': 0.7790973871733967, 'support': 218}, '2': {'precision': 0.91, 'recall': 0.8425925925925926, 'f1-score': 0.8749999999999999, 'support': 108}, '3': {'precision': 0.6607142857142857, 'recall': 0.5285714285714286, 'f1-score': 0.5873015873015873, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.8918918918918919, 'recall': 0.9428571428571428, 'f1-score': 0.9166666666666667, 'support': 35}, '6': {'precision': 0.9130434782608695, 'recall': 0.8235294117647058, 'f1-score': 0.865979381443299, 'support': 51}, '7': {'precision': 0.7265625, 'recall': 0.8230088495575221, 'f1-score': 0.7717842323651452, 'support': 226}, '8': {'precision': 0.5463917525773195, 'recall': 0.6424242424242425, 'f1-score': 0.5905292479108635, 'support': 165}, '9': {'precision': 0.6619718309859155, 'recall': 0.5662650602409639, 'f1-score': 0.6103896103896105, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6428571428571429, 'f1-score': 0.782608695652174, 'support': 14}, '11': {'precision': 0.875, 'recall': 0.9210526315789473, 'f1-score': 0.8974358974358975, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7897810218978102, 'recall': 0.7728571428571429, 'f1-score': 0.7812274368231047, 'support': 1400}, 'macro avg': {'precision': 0.7547506281864668, 'recall': 0.699269429652065, 'f1-score': 0.721511526861214, 'support': 1400}, 'weighted avg': {'precision': 0.7922320551466198, 'recall': 0.7728571428571429, 'f1-score': 0.7799379861816231, 'support': 1400}, 'samples avg': {'precision': 0.7728571428571429, 'recall': 0.7728571428571429, 'f1-score': 0.7728571428571429, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 52s - loss: 0.4516 - acc: 0.8604 - precision: 0.8823 - recall: 0.8408 - val_loss: 1.1847 - val_acc: 0.7793 - val_precision: 0.7888 - val_recall: 0.7736 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8329297820823245, 'recall': 0.9247311827956989, 'f1-score': 0.8764331210191084, 'support': 372}, '1': {'precision': 0.7477064220183486, 'recall': 0.7342342342342343, 'f1-score': 0.7409090909090909, 'support': 222}, '2': {'precision': 0.8247422680412371, 'recall': 0.9090909090909091, 'f1-score': 0.8648648648648649, 'support': 88}, '3': {'precision': 0.7105263157894737, 'recall': 0.5294117647058824, 'f1-score': 0.6067415730337078, 'support': 51}, '4': {'precision': 0.631578947368421, 'recall': 0.42857142857142855, 'f1-score': 0.5106382978723404, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8333333333333334, 'recall': 0.8333333333333334, 'f1-score': 0.8333333333333334, 'support': 24}, '7': {'precision': 0.6952380952380952, 'recall': 0.8423076923076923, 'f1-score': 0.7617391304347827, 'support': 260}, '8': {'precision': 0.6337209302325582, 'recall': 0.545, 'f1-score': 0.586021505376344, 'support': 200}, '9': {'precision': 0.6896551724137931, 'recall': 0.24096385542168675, 'f1-score': 0.35714285714285715, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7588703837798697, 'recall': 0.7485714285714286, 'f1-score': 0.753685724559511, 'support': 1400}, 'macro avg': {'precision': 0.7337557850701172, 'recall': 0.6351426759475625, 'f1-score': 0.6684772866436448, 'support': 1400}, 'weighted avg': {'precision': 0.7527458019416021, 'recall': 0.7485714285714286, 'f1-score': 0.7401920242215075, 'support': 1400}, 'samples avg': {'precision': 0.7485714285714286, 'recall': 0.7485714285714286, 'f1-score': 0.7485714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9217391304347826, 'recall': 0.8833333333333333, 'f1-score': 0.902127659574468, 'support': 360}, '1': {'precision': 0.7870370370370371, 'recall': 0.7798165137614679, 'f1-score': 0.7834101382488479, 'support': 218}, '2': {'precision': 0.8823529411764706, 'recall': 0.8333333333333334, 'f1-score': 0.8571428571428571, 'support': 108}, '3': {'precision': 0.7659574468085106, 'recall': 0.5142857142857142, 'f1-score': 0.6153846153846153, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8918918918918919, 'recall': 0.9428571428571428, 'f1-score': 0.9166666666666667, 'support': 35}, '6': {'precision': 0.8461538461538461, 'recall': 0.8627450980392157, 'f1-score': 0.854368932038835, 'support': 51}, '7': {'precision': 0.7181467181467182, 'recall': 0.8230088495575221, 'f1-score': 0.7670103092783505, 'support': 226}, '8': {'precision': 0.5621621621621622, 'recall': 0.6303030303030303, 'f1-score': 0.5942857142857142, 'support': 165}, '9': {'precision': 0.6785714285714286, 'recall': 0.4578313253012048, 'f1-score': 0.5467625899280576, 'support': 83}, '10': {'precision': 0.9333333333333333, 'recall': 1.0, 'f1-score': 0.9655172413793104, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7887836853605243, 'recall': 0.7735714285714286, 'f1-score': 0.7811034980165885, 'support': 1400}, 'macro avg': {'precision': 0.7418451953635544, 'recall': 0.7191941469346119, 'f1-score': 0.7262768932726626, 'support': 1400}, 'weighted avg': {'precision': 0.7870637695587342, 'recall': 0.7735714285714286, 'f1-score': 0.7768042644438341, 'support': 1400}, 'samples avg': {'precision': 0.7735714285714286, 'recall': 0.7735714285714286, 'f1-score': 0.7735714285714286, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 52s - loss: 0.4043 - acc: 0.8768 - precision: 0.8941 - recall: 0.8576 - val_loss: 1.2160 - val_acc: 0.7764 - val_precision: 0.7866 - val_recall: 0.7714 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8447837150127226, 'recall': 0.8924731182795699, 'f1-score': 0.8679738562091504, 'support': 372}, '1': {'precision': 0.7572815533980582, 'recall': 0.7027027027027027, 'f1-score': 0.7289719626168224, 'support': 222}, '2': {'precision': 0.8181818181818182, 'recall': 0.9204545454545454, 'f1-score': 0.8663101604278074, 'support': 88}, '3': {'precision': 0.627906976744186, 'recall': 0.5294117647058824, 'f1-score': 0.5744680851063829, 'support': 51}, '4': {'precision': 0.5882352941176471, 'recall': 0.35714285714285715, 'f1-score': 0.4444444444444445, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8333333333333334, 'recall': 0.8333333333333334, 'f1-score': 0.8333333333333334, 'support': 24}, '7': {'precision': 0.6927899686520376, 'recall': 0.85, 'f1-score': 0.7633851468048359, 'support': 260}, '8': {'precision': 0.5894736842105263, 'recall': 0.56, 'f1-score': 0.5743589743589743, 'support': 200}, '9': {'precision': 0.6060606060606061, 'recall': 0.24096385542168675, 'f1-score': 0.3448275862068966, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7474600870827286, 'recall': 0.7357142857142858, 'f1-score': 0.7415406767458604, 'support': 1400}, 'macro avg': {'precision': 0.7130624350456376, 'recall': 0.6119763510690788, 'f1-score': 0.6441802530122053, 'support': 1400}, 'weighted avg': {'precision': 0.7406631028576154, 'recall': 0.7357142857142858, 'f1-score': 0.7294692363165697, 'support': 1400}, 'samples avg': {'precision': 0.7357142857142858, 'recall': 0.7357142857142858, 'f1-score': 0.7357142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9359756097560976, 'recall': 0.8527777777777777, 'f1-score': 0.8924418604651162, 'support': 360}, '1': {'precision': 0.7914691943127962, 'recall': 0.7660550458715596, 'f1-score': 0.7785547785547784, 'support': 218}, '2': {'precision': 0.8857142857142857, 'recall': 0.8611111111111112, 'f1-score': 0.8732394366197184, 'support': 108}, '3': {'precision': 0.6842105263157895, 'recall': 0.5571428571428572, 'f1-score': 0.6141732283464566, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8918918918918919, 'recall': 0.9428571428571428, 'f1-score': 0.9166666666666667, 'support': 35}, '6': {'precision': 0.8653846153846154, 'recall': 0.8823529411764706, 'f1-score': 0.8737864077669903, 'support': 51}, '7': {'precision': 0.7312252964426877, 'recall': 0.8185840707964602, 'f1-score': 0.7724425887265135, 'support': 226}, '8': {'precision': 0.551219512195122, 'recall': 0.6848484848484848, 'f1-score': 0.6108108108108108, 'support': 165}, '9': {'precision': 0.6440677966101694, 'recall': 0.4578313253012048, 'f1-score': 0.5352112676056338, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.9444444444444444, 'recall': 0.8947368421052632, 'f1-score': 0.918918918918919, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.786598689002185, 'recall': 0.7714285714285715, 'f1-score': 0.7789397764154344, 'support': 1400}, 'macro avg': {'precision': 0.7481233210052232, 'recall': 0.7046043108112904, 'f1-score': 0.7216526199784384, 'support': 1400}, 'weighted avg': {'precision': 0.7896777626344572, 'recall': 0.7714285714285715, 'f1-score': 0.7771987651112491, 'support': 1400}, 'samples avg': {'precision': 0.7714285714285715, 'recall': 0.7714285714285715, 'f1-score': 0.7714285714285715, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --layers_from_end 1 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:49:54.220993: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:49:54.581282: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:49:56.199529: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:49:56.200294: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:49:56.200312: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=False, layers_from_end=1, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:50:05.777813: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:50:06.318644: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3401154.72it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3200013.95it/s]
Mon May 22 05:50:08 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 05:50:11.775581: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
 1/26 [>.............................] - ETA: 18s26/26 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2295732.90it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2233558.62it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2685213.83it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 78729.61it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2617933.84it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 79364.57it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3061535.77it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3033071.07it/s]
Mon May 22 05:50:12 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_1_layers_concatenated/embedder_pumap_64dims_metric_cosine/parametric_model
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step
1/6 [====>.........................] - ETA: 0s6/6 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2103161.03it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2400664.60it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2624955.57it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 78637.58it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2602848.23it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 78462.11it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               1 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 23s - loss: 0.6854 - acc: 0.7988 - precision: 0.8571 - recall: 0.7450 - val_loss: 0.8517 - val_acc: 0.7807 - val_precision: 0.8046 - val_recall: 0.7679 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8329297820823245, 'recall': 0.9247311827956989, 'f1-score': 0.8764331210191084, 'support': 372}, '1': {'precision': 0.7875647668393783, 'recall': 0.6846846846846847, 'f1-score': 0.7325301204819277, 'support': 222}, '2': {'precision': 0.81, 'recall': 0.9204545454545454, 'f1-score': 0.8617021276595745, 'support': 88}, '3': {'precision': 0.8695652173913043, 'recall': 0.39215686274509803, 'f1-score': 0.5405405405405406, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 0.9333333333333333, 'recall': 0.8235294117647058, 'f1-score': 0.8749999999999999, 'support': 17}, '6': {'precision': 0.9090909090909091, 'recall': 0.8333333333333334, 'f1-score': 0.8695652173913043, 'support': 24}, '7': {'precision': 0.665680473372781, 'recall': 0.8653846153846154, 'f1-score': 0.7525083612040134, 'support': 260}, '8': {'precision': 0.6415094339622641, 'recall': 0.51, 'f1-score': 0.5682451253481894, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.18072289156626506, 'f1-score': 0.2803738317757009, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.760268857356236, 'recall': 0.7271428571428571, 'f1-score': 0.7433369843008397, 'support': 1400}, 'macro avg': {'precision': 0.7445261986722278, 'recall': 0.587406502231996, 'f1-score': 0.6301215339908792, 'support': 1400}, 'weighted avg': {'precision': 0.7568642202005815, 'recall': 0.7271428571428571, 'f1-score': 0.7236186597589958, 'support': 1400}, 'samples avg': {'precision': 0.7271428571428571, 'recall': 0.7271428571428571, 'f1-score': 0.7271428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9180790960451978, 'recall': 0.9027777777777778, 'f1-score': 0.9103641456582634, 'support': 360}, '1': {'precision': 0.801980198019802, 'recall': 0.7431192660550459, 'f1-score': 0.7714285714285715, 'support': 218}, '2': {'precision': 0.92, 'recall': 0.8518518518518519, 'f1-score': 0.8846153846153846, 'support': 108}, '3': {'precision': 0.96875, 'recall': 0.44285714285714284, 'f1-score': 0.6078431372549019, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9148936170212766, 'recall': 0.8431372549019608, 'f1-score': 0.8775510204081632, 'support': 51}, '7': {'precision': 0.735632183908046, 'recall': 0.8495575221238938, 'f1-score': 0.7885010266940452, 'support': 226}, '8': {'precision': 0.5659340659340659, 'recall': 0.6242424242424243, 'f1-score': 0.5936599423631124, 'support': 165}, '9': {'precision': 0.6551724137931034, 'recall': 0.4578313253012048, 'f1-score': 0.5390070921985816, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.9166666666666666, 'recall': 0.868421052631579, 'f1-score': 0.8918918918918918, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8046407185628742, 'recall': 0.7678571428571429, 'f1-score': 0.7858187134502925, 'support': 1400}, 'macro avg': {'precision': 0.7790847994949955, 'recall': 0.6766755869792227, 'f1-score': 0.712988251427136, 'support': 1400}, 'weighted avg': {'precision': 0.8078900786423251, 'recall': 0.7678571428571429, 'f1-score': 0.7799974692509529, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 23s - loss: 0.4819 - acc: 0.8500 - precision: 0.8736 - recall: 0.8222 - val_loss: 0.8743 - val_acc: 0.7757 - val_precision: 0.7919 - val_recall: 0.7636 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8473282442748091, 'recall': 0.8951612903225806, 'f1-score': 0.8705882352941176, 'support': 372}, '1': {'precision': 0.7714285714285715, 'recall': 0.7297297297297297, 'f1-score': 0.75, 'support': 222}, '2': {'precision': 0.7980769230769231, 'recall': 0.9431818181818182, 'f1-score': 0.8645833333333335, 'support': 88}, '3': {'precision': 0.6486486486486487, 'recall': 0.47058823529411764, 'f1-score': 0.5454545454545454, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6901840490797546, 'recall': 0.8653846153846154, 'f1-score': 0.7679180887372015, 'support': 260}, '8': {'precision': 0.6432748538011696, 'recall': 0.55, 'f1-score': 0.5929919137466307, 'support': 200}, '9': {'precision': 0.6333333333333333, 'recall': 0.2289156626506024, 'f1-score': 0.336283185840708, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7621502209131075, 'recall': 0.7392857142857143, 'f1-score': 0.7505438723712835, 'support': 1400}, 'macro avg': {'precision': 0.7353053961799028, 'recall': 0.6064857381202897, 'f1-score': 0.6487392096282698, 'support': 1400}, 'weighted avg': {'precision': 0.7561818192405826, 'recall': 0.7392857142857143, 'f1-score': 0.7361822209891872, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9264705882352942, 'recall': 0.875, 'f1-score': 0.9, 'support': 360}, '1': {'precision': 0.8048780487804879, 'recall': 0.7568807339449541, 'f1-score': 0.7801418439716312, 'support': 218}, '2': {'precision': 0.8545454545454545, 'recall': 0.8703703703703703, 'f1-score': 0.8623853211009175, 'support': 108}, '3': {'precision': 0.8, 'recall': 0.45714285714285713, 'f1-score': 0.5818181818181818, 'support': 70}, '4': {'precision': 0.8888888888888888, 'recall': 0.7272727272727273, 'f1-score': 0.7999999999999999, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 51}, '7': {'precision': 0.7349397590361446, 'recall': 0.8097345132743363, 'f1-score': 0.7705263157894737, 'support': 226}, '8': {'precision': 0.5404040404040404, 'recall': 0.6484848484848484, 'f1-score': 0.5895316804407713, 'support': 165}, '9': {'precision': 0.6615384615384615, 'recall': 0.5180722891566265, 'f1-score': 0.581081081081081, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6428571428571429, 'f1-score': 0.782608695652174, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7918518518518518, 'recall': 0.7635714285714286, 'f1-score': 0.7774545454545454, 'support': 1400}, 'macro avg': {'precision': 0.7633740308457195, 'recall': 0.6830418400959832, 'f1-score': 0.7140729300063904, 'support': 1400}, 'weighted avg': {'precision': 0.7953416353786418, 'recall': 0.7635714285714286, 'f1-score': 0.7746123034464507, 'support': 1400}, 'samples avg': {'precision': 0.7635714285714286, 'recall': 0.7635714285714286, 'f1-score': 0.7635714285714286, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 23s - loss: 0.3965 - acc: 0.8724 - precision: 0.8934 - recall: 0.8528 - val_loss: 0.9555 - val_acc: 0.7786 - val_precision: 0.7873 - val_recall: 0.7693 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8349753694581281, 'recall': 0.9112903225806451, 'f1-score': 0.8714652956298201, 'support': 372}, '1': {'precision': 0.788659793814433, 'recall': 0.6891891891891891, 'f1-score': 0.735576923076923, 'support': 222}, '2': {'precision': 0.8315789473684211, 'recall': 0.8977272727272727, 'f1-score': 0.8633879781420765, 'support': 88}, '3': {'precision': 0.6578947368421053, 'recall': 0.49019607843137253, 'f1-score': 0.5617977528089888, 'support': 51}, '4': {'precision': 0.7142857142857143, 'recall': 0.35714285714285715, 'f1-score': 0.4761904761904762, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.9047619047619048, 'recall': 0.7916666666666666, 'f1-score': 0.8444444444444444, 'support': 24}, '7': {'precision': 0.6628242074927954, 'recall': 0.8846153846153846, 'f1-score': 0.757825370675453, 'support': 260}, '8': {'precision': 0.6272189349112426, 'recall': 0.53, 'f1-score': 0.5745257452574526, 'support': 200}, '9': {'precision': 0.6785714285714286, 'recall': 0.2289156626506024, 'f1-score': 0.34234234234234234, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7554904831625183, 'recall': 0.7371428571428571, 'f1-score': 0.7462039045553144, 'support': 1400}, 'macro avg': {'precision': 0.7415511520692395, 'recall': 0.609574124983308, 'f1-score': 0.6531428323983703, 'support': 1400}, 'weighted avg': {'precision': 0.7535687582759012, 'recall': 0.7371428571428571, 'f1-score': 0.7315411059266598, 'support': 1400}, 'samples avg': {'precision': 0.7371428571428571, 'recall': 0.7371428571428571, 'f1-score': 0.7371428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9166666666666666, 'recall': 0.8861111111111111, 'f1-score': 0.9011299435028248, 'support': 360}, '1': {'precision': 0.8109452736318408, 'recall': 0.7477064220183486, 'f1-score': 0.7780429594272076, 'support': 218}, '2': {'precision': 0.9166666666666666, 'recall': 0.8148148148148148, 'f1-score': 0.8627450980392156, 'support': 108}, '3': {'precision': 0.7291666666666666, 'recall': 0.5, 'f1-score': 0.5932203389830509, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8918918918918919, 'recall': 0.9428571428571428, 'f1-score': 0.9166666666666667, 'support': 35}, '6': {'precision': 0.9318181818181818, 'recall': 0.803921568627451, 'f1-score': 0.8631578947368421, 'support': 51}, '7': {'precision': 0.7037037037037037, 'recall': 0.8407079646017699, 'f1-score': 0.7661290322580645, 'support': 226}, '8': {'precision': 0.5459183673469388, 'recall': 0.6484848484848484, 'f1-score': 0.592797783933518, 'support': 165}, '9': {'precision': 0.6779661016949152, 'recall': 0.4819277108433735, 'f1-score': 0.5633802816901408, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7872807017543859, 'recall': 0.7692857142857142, 'f1-score': 0.778179190751445, 'support': 1400}, 'macro avg': {'precision': 0.7521732532320998, 'recall': 0.698019649111626, 'f1-score': 0.7198960378749761, 'support': 1400}, 'weighted avg': {'precision': 0.7902222021572274, 'recall': 0.7692857142857142, 'f1-score': 0.7754004783365821, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 23s - loss: 0.3385 - acc: 0.8916 - precision: 0.9054 - recall: 0.8770 - val_loss: 1.0030 - val_acc: 0.7814 - val_precision: 0.7934 - val_recall: 0.7707 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8221153846153846, 'recall': 0.9193548387096774, 'f1-score': 0.8680203045685279, 'support': 372}, '1': {'precision': 0.7799043062200957, 'recall': 0.7342342342342343, 'f1-score': 0.7563805104408352, 'support': 222}, '2': {'precision': 0.8076923076923077, 'recall': 0.9545454545454546, 'f1-score': 0.875, 'support': 88}, '3': {'precision': 0.6857142857142857, 'recall': 0.47058823529411764, 'f1-score': 0.558139534883721, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.875, 'recall': 0.875, 'f1-score': 0.875, 'support': 24}, '7': {'precision': 0.6808510638297872, 'recall': 0.8615384615384616, 'f1-score': 0.7606112054329371, 'support': 260}, '8': {'precision': 0.6545454545454545, 'recall': 0.54, 'f1-score': 0.5917808219178082, 'support': 200}, '9': {'precision': 0.7037037037037037, 'recall': 0.2289156626506024, 'f1-score': 0.34545454545454546, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7603485838779956, 'recall': 0.7478571428571429, 'f1-score': 0.754051134317609, 'support': 1400}, 'macro avg': {'precision': 0.7419187056144374, 'recall': 0.6213228305876553, 'f1-score': 0.6581825205373488, 'support': 1400}, 'weighted avg': {'precision': 0.7563301587750324, 'recall': 0.7478571428571429, 'f1-score': 0.7382219260948978, 'support': 1400}, 'samples avg': {'precision': 0.7478571428571429, 'recall': 0.7478571428571429, 'f1-score': 0.7478571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9085714285714286, 'recall': 0.8833333333333333, 'f1-score': 0.895774647887324, 'support': 360}, '1': {'precision': 0.8038277511961722, 'recall': 0.7706422018348624, 'f1-score': 0.7868852459016393, 'support': 218}, '2': {'precision': 0.9029126213592233, 'recall': 0.8611111111111112, 'f1-score': 0.8815165876777251, 'support': 108}, '3': {'precision': 0.7441860465116279, 'recall': 0.45714285714285713, 'f1-score': 0.5663716814159292, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8888888888888888, 'recall': 0.9142857142857143, 'f1-score': 0.9014084507042254, 'support': 35}, '6': {'precision': 0.9333333333333333, 'recall': 0.8235294117647058, 'f1-score': 0.8749999999999999, 'support': 51}, '7': {'precision': 0.7269230769230769, 'recall': 0.8362831858407079, 'f1-score': 0.7777777777777778, 'support': 226}, '8': {'precision': 0.5595854922279793, 'recall': 0.6545454545454545, 'f1-score': 0.6033519553072626, 'support': 165}, '9': {'precision': 0.6785714285714286, 'recall': 0.4578313253012048, 'f1-score': 0.5467625899280576, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.9428571428571428, 'recall': 0.868421052631579, 'f1-score': 0.904109589041096, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7933823529411764, 'recall': 0.7707142857142857, 'f1-score': 0.7818840579710145, 'support': 1400}, 'macro avg': {'precision': 0.7607428623415616, 'recall': 0.6898987761038439, 'f1-score': 0.7180151246830102, 'support': 1400}, 'weighted avg': {'precision': 0.7935750593731664, 'recall': 0.7707142857142857, 'f1-score': 0.7775291735489923, 'support': 1400}, 'samples avg': {'precision': 0.7707142857142857, 'recall': 0.7707142857142857, 'f1-score': 0.7707142857142857, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 22s - loss: 0.2729 - acc: 0.9078 - precision: 0.9205 - recall: 0.8960 - val_loss: 1.1124 - val_acc: 0.7786 - val_precision: 0.7838 - val_recall: 0.7693 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8060046189376443, 'recall': 0.9381720430107527, 'f1-score': 0.867080745341615, 'support': 372}, '1': {'precision': 0.7641509433962265, 'recall': 0.7297297297297297, 'f1-score': 0.7465437788018433, 'support': 222}, '2': {'precision': 0.8, 'recall': 0.9545454545454546, 'f1-score': 0.8704663212435233, 'support': 88}, '3': {'precision': 0.6451612903225806, 'recall': 0.39215686274509803, 'f1-score': 0.4878048780487804, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.35714285714285715, 'f1-score': 0.46511627906976744, 'support': 28}, '5': {'precision': 0.8666666666666667, 'recall': 0.7647058823529411, 'f1-score': 0.8125, 'support': 17}, '6': {'precision': 0.8636363636363636, 'recall': 0.7916666666666666, 'f1-score': 0.8260869565217391, 'support': 24}, '7': {'precision': 0.6428571428571429, 'recall': 0.8653846153846154, 'f1-score': 0.7377049180327869, 'support': 260}, '8': {'precision': 0.6967213114754098, 'recall': 0.425, 'f1-score': 0.5279503105590062, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.21686746987951808, 'f1-score': 0.3364485981308411, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7478134110787172, 'recall': 0.7328571428571429, 'f1-score': 0.7402597402597403, 'support': 1400}, 'macro avg': {'precision': 0.7262506879502032, 'recall': 0.6107596989201645, 'f1-score': 0.6433397747280144, 'support': 1400}, 'weighted avg': {'precision': 0.7467145867200038, 'recall': 0.7328571428571429, 'f1-score': 0.718941204998641, 'support': 1400}, 'samples avg': {'precision': 0.7328571428571429, 'recall': 0.7328571428571429, 'f1-score': 0.7328571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.896457765667575, 'recall': 0.9138888888888889, 'f1-score': 0.9050894085281981, 'support': 360}, '1': {'precision': 0.7904761904761904, 'recall': 0.7614678899082569, 'f1-score': 0.7757009345794392, 'support': 218}, '2': {'precision': 0.8691588785046729, 'recall': 0.8611111111111112, 'f1-score': 0.8651162790697675, 'support': 108}, '3': {'precision': 0.7555555555555555, 'recall': 0.4857142857142857, 'f1-score': 0.5913043478260869, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.9069767441860465, 'recall': 0.7647058823529411, 'f1-score': 0.8297872340425532, 'support': 51}, '7': {'precision': 0.6749116607773852, 'recall': 0.8451327433628318, 'f1-score': 0.75049115913556, 'support': 226}, '8': {'precision': 0.5886075949367089, 'recall': 0.5636363636363636, 'f1-score': 0.5758513931888546, 'support': 165}, '9': {'precision': 0.7115384615384616, 'recall': 0.4457831325301205, 'f1-score': 0.5481481481481482, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.9166666666666666, 'recall': 0.868421052631579, 'f1-score': 0.8918918918918918, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7838427947598253, 'recall': 0.7692857142857142, 'f1-score': 0.7764960346070656, 'support': 1400}, 'macro avg': {'precision': 0.7450057533103489, 'recall': 0.7006586652952058, 'f1-score': 0.7165960675983525, 'support': 1400}, 'weighted avg': {'precision': 0.7798708326011963, 'recall': 0.7692857142857142, 'f1-score': 0.7693362808850763, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:52:42.021859: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:52:42.293902: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:52:43.950877: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:52:43.951105: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:52:43.951121: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:52:54.288682: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:52:54.755994: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    1layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 05:52:56.949258: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 24s - loss: 0.6481 - acc: 0.8038 - precision: 0.8648 - recall: 0.7510 - val_loss: 0.8061 - val_acc: 0.7779 - val_precision: 0.8088 - val_recall: 0.7643 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8503740648379052, 'recall': 0.9166666666666666, 'f1-score': 0.8822768434670116, 'support': 372}, '1': {'precision': 0.7817258883248731, 'recall': 0.6936936936936937, 'f1-score': 0.7350835322195705, 'support': 222}, '2': {'precision': 0.8333333333333334, 'recall': 0.8522727272727273, 'f1-score': 0.8426966292134833, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5294117647058824, 'f1-score': 0.6923076923076924, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.660056657223796, 'recall': 0.8961538461538462, 'f1-score': 0.7601957585644371, 'support': 260}, '8': {'precision': 0.7430555555555556, 'recall': 0.535, 'f1-score': 0.6220930232558141, 'support': 200}, '9': {'precision': 0.7272727272727273, 'recall': 0.1927710843373494, 'f1-score': 0.30476190476190484, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7732426303854876, 'recall': 0.7307142857142858, 'f1-score': 0.7513771575468234, 'support': 1400}, 'macro avg': {'precision': 0.7562443644437515, 'recall': 0.571140567686389, 'f1-score': 0.629946393062704, 'support': 1400}, 'weighted avg': {'precision': 0.7771127288383545, 'recall': 0.7307142857142858, 'f1-score': 0.7344084076454461, 'support': 1400}, 'samples avg': {'precision': 0.7307142857142858, 'recall': 0.7307142857142858, 'f1-score': 0.7307142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9120879120879121, 'recall': 0.9222222222222223, 'f1-score': 0.9171270718232044, 'support': 360}, '1': {'precision': 0.8350515463917526, 'recall': 0.7431192660550459, 'f1-score': 0.7864077669902914, 'support': 218}, '2': {'precision': 0.9019607843137255, 'recall': 0.8518518518518519, 'f1-score': 0.8761904761904761, 'support': 108}, '3': {'precision': 0.8648648648648649, 'recall': 0.45714285714285713, 'f1-score': 0.5981308411214953, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.9310344827586207, 'recall': 0.7714285714285715, 'f1-score': 0.8437500000000001, 'support': 35}, '6': {'precision': 0.8478260869565217, 'recall': 0.7647058823529411, 'f1-score': 0.8041237113402062, 'support': 51}, '7': {'precision': 0.6818181818181818, 'recall': 0.8628318584070797, 'f1-score': 0.76171875, 'support': 226}, '8': {'precision': 0.64375, 'recall': 0.6242424242424243, 'f1-score': 0.633846153846154, 'support': 165}, '9': {'precision': 0.7714285714285715, 'recall': 0.3253012048192771, 'f1-score': 0.45762711864406785, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8087679516250945, 'recall': 0.7642857142857142, 'f1-score': 0.7858979067205288, 'support': 1400}, 'macro avg': {'precision': 0.7693250722609293, 'recall': 0.6715823072011189, 'f1-score': 0.7062859492399821, 'support': 1400}, 'weighted avg': {'precision': 0.8092443513540153, 'recall': 0.7642857142857142, 'f1-score': 0.7756900649898538, 'support': 1400}, 'samples avg': {'precision': 0.7642857142857142, 'recall': 0.7642857142857142, 'f1-score': 0.7642857142857142, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 22s - loss: 0.3721 - acc: 0.8850 - precision: 0.9010 - recall: 0.8682 - val_loss: 0.8074 - val_acc: 0.7921 - val_precision: 0.8092 - val_recall: 0.7757 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8232558139534883, 'recall': 0.9516129032258065, 'f1-score': 0.8827930174563592, 'support': 372}, '1': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 222}, '2': {'precision': 0.8478260869565217, 'recall': 0.8863636363636364, 'f1-score': 0.8666666666666666, 'support': 88}, '3': {'precision': 0.8214285714285714, 'recall': 0.45098039215686275, 'f1-score': 0.5822784810126583, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.8421052631578947, 'recall': 0.6666666666666666, 'f1-score': 0.744186046511628, 'support': 24}, '7': {'precision': 0.6704545454545454, 'recall': 0.9076923076923077, 'f1-score': 0.7712418300653594, 'support': 260}, '8': {'precision': 0.7414965986394558, 'recall': 0.545, 'f1-score': 0.6282420749279539, 'support': 200}, '9': {'precision': 0.7142857142857143, 'recall': 0.24096385542168675, 'f1-score': 0.36036036036036034, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.774721189591078, 'recall': 0.7442857142857143, 'f1-score': 0.7591985428051002, 'support': 1400}, 'macro avg': {'precision': 0.7640193990920522, 'recall': 0.5863725569979076, 'f1-score': 0.6447117154419753, 'support': 1400}, 'weighted avg': {'precision': 0.7785395011047807, 'recall': 0.7442857142857143, 'f1-score': 0.7422233792171123, 'support': 1400}, 'samples avg': {'precision': 0.7442857142857143, 'recall': 0.7442857142857143, 'f1-score': 0.7442857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8992042440318302, 'recall': 0.9416666666666667, 'f1-score': 0.9199457259158751, 'support': 360}, '1': {'precision': 0.8587570621468926, 'recall': 0.6972477064220184, 'f1-score': 0.7696202531645571, 'support': 218}, '2': {'precision': 0.8839285714285714, 'recall': 0.9166666666666666, 'f1-score': 0.8999999999999999, 'support': 108}, '3': {'precision': 0.8648648648648649, 'recall': 0.45714285714285713, 'f1-score': 0.5981308411214953, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8484848484848485, 'recall': 0.8, 'f1-score': 0.823529411764706, 'support': 35}, '6': {'precision': 0.926829268292683, 'recall': 0.7450980392156863, 'f1-score': 0.8260869565217392, 'support': 51}, '7': {'precision': 0.7003610108303249, 'recall': 0.8584070796460177, 'f1-score': 0.7713717693836978, 'support': 226}, '8': {'precision': 0.6167664670658682, 'recall': 0.6242424242424243, 'f1-score': 0.6204819277108434, 'support': 165}, '9': {'precision': 0.7843137254901961, 'recall': 0.4819277108433735, 'f1-score': 0.5970149253731343, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8918918918918919, 'recall': 0.868421052631579, 'f1-score': 0.88, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8092399403874814, 'recall': 0.7757142857142857, 'f1-score': 0.7921225382932167, 'support': 1400}, 'macro avg': {'precision': 0.7721005166486717, 'recall': 0.6904027529148364, 'f1-score': 0.7210342138880462, 'support': 1400}, 'weighted avg': {'precision': 0.8097803910122919, 'recall': 0.7757142857142857, 'f1-score': 0.7842698187841245, 'support': 1400}, 'samples avg': {'precision': 0.7757142857142857, 'recall': 0.7757142857142857, 'f1-score': 0.7757142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 23s - loss: 0.2784 - acc: 0.9102 - precision: 0.9224 - recall: 0.8986 - val_loss: 0.8897 - val_acc: 0.7836 - val_precision: 0.7994 - val_recall: 0.7743 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8301435406698564, 'recall': 0.9327956989247311, 'f1-score': 0.8784810126582279, 'support': 372}, '1': {'precision': 0.7967914438502673, 'recall': 0.6711711711711712, 'f1-score': 0.7286063569682152, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.7428571428571429, 'recall': 0.5098039215686274, 'f1-score': 0.6046511627906976, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.6194225721784777, 'recall': 0.9076923076923077, 'f1-score': 0.7363494539781591, 'support': 260}, '8': {'precision': 0.7426470588235294, 'recall': 0.505, 'f1-score': 0.6011904761904763, 'support': 200}, '9': {'precision': 0.7272727272727273, 'recall': 0.1927710843373494, 'f1-score': 0.30476190476190484, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7573746312684366, 'recall': 0.7335714285714285, 'f1-score': 0.7452830188679245, 'support': 1400}, 'macro avg': {'precision': 0.7547431101483036, 'recall': 0.5854870924817533, 'f1-score': 0.6379217049194481, 'support': 1400}, 'weighted avg': {'precision': 0.7672221713531913, 'recall': 0.7335714285714285, 'f1-score': 0.7280064668065863, 'support': 1400}, 'samples avg': {'precision': 0.7335714285714285, 'recall': 0.7335714285714285, 'f1-score': 0.7335714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.907608695652174, 'recall': 0.9277777777777778, 'f1-score': 0.9175824175824175, 'support': 360}, '1': {'precision': 0.8695652173913043, 'recall': 0.7339449541284404, 'f1-score': 0.7960199004975125, 'support': 218}, '2': {'precision': 0.9134615384615384, 'recall': 0.8796296296296297, 'f1-score': 0.8962264150943395, 'support': 108}, '3': {'precision': 0.7692307692307693, 'recall': 0.42857142857142855, 'f1-score': 0.5504587155963303, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.8787878787878788, 'recall': 0.8285714285714286, 'f1-score': 0.8529411764705883, 'support': 35}, '6': {'precision': 0.926829268292683, 'recall': 0.7450980392156863, 'f1-score': 0.8260869565217392, 'support': 51}, '7': {'precision': 0.6444444444444445, 'recall': 0.8982300884955752, 'f1-score': 0.7504621072088725, 'support': 226}, '8': {'precision': 0.639751552795031, 'recall': 0.6242424242424243, 'f1-score': 0.6319018404907976, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.3373493975903614, 'f1-score': 0.4745762711864407, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.799410029498525, 'recall': 0.7742857142857142, 'f1-score': 0.7866473149492016, 'support': 1400}, 'macro avg': {'precision': 0.76195115259884, 'recall': 0.6902674373578992, 'f1-score': 0.7120722739486769, 'support': 1400}, 'weighted avg': {'precision': 0.8049100965354564, 'recall': 0.7742857142857142, 'f1-score': 0.7768576196503213, 'support': 1400}, 'samples avg': {'precision': 0.7742857142857142, 'recall': 0.7742857142857142, 'f1-score': 0.7742857142857142, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 23s - loss: 0.1988 - acc: 0.9362 - precision: 0.9467 - recall: 0.9298 - val_loss: 0.8817 - val_acc: 0.7943 - val_precision: 0.8060 - val_recall: 0.7836 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8060046189376443, 'recall': 0.9381720430107527, 'f1-score': 0.867080745341615, 'support': 372}, '1': {'precision': 0.7959183673469388, 'recall': 0.7027027027027027, 'f1-score': 0.7464114832535885, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.8275862068965517, 'recall': 0.47058823529411764, 'f1-score': 0.6, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.6834319526627219, 'recall': 0.8884615384615384, 'f1-score': 0.7725752508361203, 'support': 260}, '8': {'precision': 0.7116564417177914, 'recall': 0.58, 'f1-score': 0.6391184573002754, 'support': 200}, '9': {'precision': 0.7037037037037037, 'recall': 0.2289156626506024, 'f1-score': 0.34545454545454546, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.8823529411764706, 'recall': 0.8108108108108109, 'f1-score': 0.8450704225352113, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7664233576642335, 'recall': 0.75, 'f1-score': 0.7581227436823106, 'support': 1400}, 'macro avg': {'precision': 0.7450996352371422, 'recall': 0.6032500724616201, 'f1-score': 0.6492988392228877, 'support': 1400}, 'weighted avg': {'precision': 0.7665203490573467, 'recall': 0.75, 'f1-score': 0.7423980450725726, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8947368421052632, 'recall': 0.9444444444444444, 'f1-score': 0.918918918918919, 'support': 360}, '1': {'precision': 0.8402061855670103, 'recall': 0.7477064220183486, 'f1-score': 0.7912621359223301, 'support': 218}, '2': {'precision': 0.9238095238095239, 'recall': 0.8981481481481481, 'f1-score': 0.9107981220657277, 'support': 108}, '3': {'precision': 0.8055555555555556, 'recall': 0.4142857142857143, 'f1-score': 0.5471698113207547, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7011070110701108, 'recall': 0.8407079646017699, 'f1-score': 0.7645875251509056, 'support': 226}, '8': {'precision': 0.6235294117647059, 'recall': 0.6424242424242425, 'f1-score': 0.6328358208955224, 'support': 165}, '9': {'precision': 0.7872340425531915, 'recall': 0.4457831325301205, 'f1-score': 0.5692307692307692, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8060249816311535, 'recall': 0.7835714285714286, 'f1-score': 0.7946396233248822, 'support': 1400}, 'macro avg': {'precision': 0.754283619881199, 'recall': 0.7056705323649187, 'f1-score': 0.7203945917788269, 'support': 1400}, 'weighted avg': {'precision': 0.8035055580954679, 'recall': 0.7835714285714286, 'f1-score': 0.7858353107613019, 'support': 1400}, 'samples avg': {'precision': 0.7835714285714286, 'recall': 0.7835714285714286, 'f1-score': 0.7835714285714286, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 23s - loss: 0.1331 - acc: 0.9568 - precision: 0.9634 - recall: 0.9524 - val_loss: 0.9507 - val_acc: 0.7950 - val_precision: 0.8047 - val_recall: 0.7886 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8215962441314554, 'recall': 0.9408602150537635, 'f1-score': 0.8771929824561404, 'support': 372}, '1': {'precision': 0.7931034482758621, 'recall': 0.7252252252252253, 'f1-score': 0.7576470588235296, 'support': 222}, '2': {'precision': 0.8279569892473119, 'recall': 0.875, 'f1-score': 0.8508287292817679, 'support': 88}, '3': {'precision': 0.75, 'recall': 0.47058823529411764, 'f1-score': 0.5783132530120481, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 0.8461538461538461, 'recall': 0.6470588235294118, 'f1-score': 0.7333333333333334, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.6822157434402333, 'recall': 0.9, 'f1-score': 0.7761194029850746, 'support': 260}, '8': {'precision': 0.7177914110429447, 'recall': 0.585, 'f1-score': 0.6446280991735537, 'support': 200}, '9': {'precision': 0.7083333333333334, 'recall': 0.20481927710843373, 'f1-score': 0.3177570093457944, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7695113056163384, 'recall': 0.7535714285714286, 'f1-score': 0.7614579574160952, 'support': 1400}, 'macro avg': {'precision': 0.7412675216010631, 'recall': 0.5910676893491644, 'f1-score': 0.6367286475968803, 'support': 1400}, 'weighted avg': {'precision': 0.7692041957938339, 'recall': 0.7535714285714286, 'f1-score': 0.7444368337740411, 'support': 1400}, 'samples avg': {'precision': 0.7535714285714286, 'recall': 0.7535714285714286, 'f1-score': 0.7535714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9068493150684932, 'recall': 0.9194444444444444, 'f1-score': 0.913103448275862, 'support': 360}, '1': {'precision': 0.8407960199004975, 'recall': 0.7752293577981652, 'f1-score': 0.8066825775656324, 'support': 218}, '2': {'precision': 0.9333333333333333, 'recall': 0.9074074074074074, 'f1-score': 0.9201877934272301, 'support': 108}, '3': {'precision': 0.8048780487804879, 'recall': 0.4714285714285714, 'f1-score': 0.5945945945945947, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.9090909090909091, 'recall': 0.7843137254901961, 'f1-score': 0.8421052631578948, 'support': 51}, '7': {'precision': 0.6903914590747331, 'recall': 0.8584070796460177, 'f1-score': 0.7652859960552267, 'support': 226}, '8': {'precision': 0.6145251396648045, 'recall': 0.6666666666666666, 'f1-score': 0.6395348837209303, 'support': 165}, '9': {'precision': 0.8333333333333334, 'recall': 0.42168674698795183, 'f1-score': 0.56, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8333333333333334, 'recall': 0.9210526315789473, 'f1-score': 0.875, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8046647230320699, 'recall': 0.7885714285714286, 'f1-score': 0.7965367965367965, 'support': 1400}, 'macro avg': {'precision': 0.7580552599821088, 'recall': 0.7073666539675567, 'f1-score': 0.7225974833900076, 'support': 1400}, 'weighted avg': {'precision': 0.8069787413696811, 'recall': 0.7885714285714286, 'f1-score': 0.7895103851980009, 'support': 1400}, 'samples avg': {'precision': 0.7885714285714286, 'recall': 0.7885714285714286, 'f1-score': 0.7885714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:55:24.642803: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:55:24.907148: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:55:26.846863: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:55:26.847093: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:55:26.847110: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:55:37.815206: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:55:38.277072: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    2layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 05:55:41.225173: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 40s - loss: 0.7934 - acc: 0.7700 - precision: 0.8559 - recall: 0.7106 - val_loss: 0.9189 - val_acc: 0.7550 - val_precision: 0.7774 - val_recall: 0.7257 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8484107579462102, 'recall': 0.9327956989247311, 'f1-score': 0.8886043533930857, 'support': 372}, '1': {'precision': 0.8095238095238095, 'recall': 0.6891891891891891, 'f1-score': 0.7445255474452555, 'support': 222}, '2': {'precision': 0.8105263157894737, 'recall': 0.875, 'f1-score': 0.8415300546448087, 'support': 88}, '3': {'precision': 0.9411764705882353, 'recall': 0.3137254901960784, 'f1-score': 0.47058823529411764, 'support': 51}, '4': {'precision': 0.8888888888888888, 'recall': 0.2857142857142857, 'f1-score': 0.43243243243243246, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.35294117647058826, 'f1-score': 0.5217391304347826, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.6628895184135978, 'recall': 0.9, 'f1-score': 0.7634584013050572, 'support': 260}, '8': {'precision': 0.6363636363636364, 'recall': 0.595, 'f1-score': 0.6149870801033591, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.0963855421686747, 'f1-score': 0.17204301075268819, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7656367746797287, 'recall': 0.7257142857142858, 'f1-score': 0.7451411807847451, 'support': 1400}, 'macro avg': {'precision': 0.787489440834399, 'recall': 0.5185539871626152, 'f1-score': 0.5775720518384024, 'support': 1400}, 'weighted avg': {'precision': 0.7810668174349295, 'recall': 0.7257142857142858, 'f1-score': 0.7189187127770775, 'support': 1400}, 'samples avg': {'precision': 0.7257142857142858, 'recall': 0.7257142857142858, 'f1-score': 0.7257142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.900804289544236, 'recall': 0.9333333333333333, 'f1-score': 0.916780354706685, 'support': 360}, '1': {'precision': 0.8406593406593407, 'recall': 0.7018348623853211, 'f1-score': 0.765, 'support': 218}, '2': {'precision': 0.8981481481481481, 'recall': 0.8981481481481481, 'f1-score': 0.8981481481481481, 'support': 108}, '3': {'precision': 0.8823529411764706, 'recall': 0.21428571428571427, 'f1-score': 0.3448275862068966, 'support': 70}, '4': {'precision': 0.8823529411764706, 'recall': 0.6818181818181818, 'f1-score': 0.7692307692307693, 'support': 22}, '5': {'precision': 1.0, 'recall': 0.37142857142857144, 'f1-score': 0.5416666666666666, 'support': 35}, '6': {'precision': 0.84, 'recall': 0.4117647058823529, 'f1-score': 0.5526315789473684, 'support': 51}, '7': {'precision': 0.6931407942238267, 'recall': 0.8495575221238938, 'f1-score': 0.7634194831013916, 'support': 226}, '8': {'precision': 0.5, 'recall': 0.6787878787878788, 'f1-score': 0.5758354755784062, 'support': 165}, '9': {'precision': 0.8636363636363636, 'recall': 0.2289156626506024, 'f1-score': 0.3619047619047619, 'support': 83}, '10': {'precision': 0.9, 'recall': 0.6428571428571429, 'f1-score': 0.75, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7773527161438408, 'recall': 0.7257142857142858, 'f1-score': 0.7506464721093461, 'support': 1400}, 'macro avg': {'precision': 0.7748376684892099, 'recall': 0.577497581985108, 'f1-score': 0.6248124390467674, 'support': 1400}, 'weighted avg': {'precision': 0.8000925670660747, 'recall': 0.7257142857142858, 'f1-score': 0.731183337828217, 'support': 1400}, 'samples avg': {'precision': 0.7257142857142858, 'recall': 0.7257142857142858, 'f1-score': 0.7257142857142858, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 37s - loss: 0.4848 - acc: 0.8552 - precision: 0.8833 - recall: 0.8282 - val_loss: 0.8363 - val_acc: 0.7879 - val_precision: 0.8015 - val_recall: 0.7729 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8546365914786967, 'recall': 0.9166666666666666, 'f1-score': 0.8845654993514915, 'support': 372}, '1': {'precision': 0.8010471204188482, 'recall': 0.6891891891891891, 'f1-score': 0.7409200968523002, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.6857142857142857, 'recall': 0.47058823529411764, 'f1-score': 0.558139534883721, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.42857142857142855, 'f1-score': 0.5581395348837209, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8636363636363636, 'recall': 0.7916666666666666, 'f1-score': 0.8260869565217391, 'support': 24}, '7': {'precision': 0.6916167664670658, 'recall': 0.8884615384615384, 'f1-score': 0.7777777777777778, 'support': 260}, '8': {'precision': 0.6648351648351648, 'recall': 0.605, 'f1-score': 0.6335078534031414, 'support': 200}, '9': {'precision': 0.7368421052631579, 'recall': 0.1686746987951807, 'f1-score': 0.2745098039215686, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9090909090909091, 'recall': 0.8108108108108109, 'f1-score': 0.8571428571428571, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.774888558692422, 'recall': 0.745, 'f1-score': 0.7596504005826656, 'support': 1400}, 'macro avg': {'precision': 0.7553784082234223, 'recall': 0.6079270534114343, 'f1-score': 0.6534100221083943, 'support': 1400}, 'weighted avg': {'precision': 0.7749554462024548, 'recall': 0.745, 'f1-score': 0.7429285488030317, 'support': 1400}, 'samples avg': {'precision': 0.745, 'recall': 0.745, 'f1-score': 0.745, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9116022099447514, 'recall': 0.9166666666666666, 'f1-score': 0.9141274238227146, 'support': 360}, '1': {'precision': 0.8579234972677595, 'recall': 0.7201834862385321, 'f1-score': 0.7830423940149627, 'support': 218}, '2': {'precision': 0.8909090909090909, 'recall': 0.9074074074074074, 'f1-score': 0.8990825688073394, 'support': 108}, '3': {'precision': 0.75, 'recall': 0.4714285714285714, 'f1-score': 0.5789473684210525, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8709677419354839, 'recall': 0.7714285714285715, 'f1-score': 0.8181818181818182, 'support': 35}, '6': {'precision': 0.86, 'recall': 0.8431372549019608, 'f1-score': 0.8514851485148515, 'support': 51}, '7': {'precision': 0.7392996108949417, 'recall': 0.8407079646017699, 'f1-score': 0.7867494824016563, 'support': 226}, '8': {'precision': 0.5555555555555556, 'recall': 0.696969696969697, 'f1-score': 0.6182795698924732, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.3373493975903614, 'f1-score': 0.4745762711864407, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8014814814814815, 'recall': 0.7728571428571429, 'f1-score': 0.786909090909091, 'support': 1400}, 'macro avg': {'precision': 0.755747634228394, 'recall': 0.6856156055635243, 'f1-score': 0.7088959643399078, 'support': 1400}, 'weighted avg': {'precision': 0.8049829199720484, 'recall': 0.7728571428571429, 'f1-score': 0.779183069023381, 'support': 1400}, 'samples avg': {'precision': 0.7728571428571429, 'recall': 0.7728571428571429, 'f1-score': 0.7728571428571429, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 38s - loss: 0.4133 - acc: 0.8758 - precision: 0.8955 - recall: 0.8550 - val_loss: 0.8588 - val_acc: 0.7871 - val_precision: 0.8043 - val_recall: 0.7750 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8313253012048193, 'recall': 0.9274193548387096, 'f1-score': 0.8767471410419313, 'support': 372}, '1': {'precision': 0.7902439024390244, 'recall': 0.7297297297297297, 'f1-score': 0.7587822014051524, 'support': 222}, '2': {'precision': 0.8020833333333334, 'recall': 0.875, 'f1-score': 0.8369565217391305, 'support': 88}, '3': {'precision': 0.6944444444444444, 'recall': 0.49019607843137253, 'f1-score': 0.5747126436781609, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 24}, '7': {'precision': 0.6629213483146067, 'recall': 0.9076923076923077, 'f1-score': 0.7662337662337663, 'support': 260}, '8': {'precision': 0.7417218543046358, 'recall': 0.56, 'f1-score': 0.6381766381766382, 'support': 200}, '9': {'precision': 0.7222222222222222, 'recall': 0.1566265060240964, 'f1-score': 0.25742574257425743, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7702503681885126, 'recall': 0.7471428571428571, 'f1-score': 0.7585206671501087, 'support': 1400}, 'macro avg': {'precision': 0.7667828224597978, 'recall': 0.5921069810702755, 'f1-score': 0.6449058350520919, 'support': 1400}, 'weighted avg': {'precision': 0.7743021601834468, 'recall': 0.7471428571428571, 'f1-score': 0.739726466132804, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8972972972972973, 'recall': 0.9222222222222223, 'f1-score': 0.9095890410958904, 'support': 360}, '1': {'precision': 0.8333333333333334, 'recall': 0.7568807339449541, 'f1-score': 0.7932692307692308, 'support': 218}, '2': {'precision': 0.9074074074074074, 'recall': 0.9074074074074074, 'f1-score': 0.9074074074074074, 'support': 108}, '3': {'precision': 0.7391304347826086, 'recall': 0.4857142857142857, 'f1-score': 0.5862068965517241, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.875, 'recall': 0.8, 'f1-score': 0.8358208955223881, 'support': 35}, '6': {'precision': 0.9459459459459459, 'recall': 0.6862745098039216, 'f1-score': 0.7954545454545455, 'support': 51}, '7': {'precision': 0.7014388489208633, 'recall': 0.8628318584070797, 'f1-score': 0.7738095238095238, 'support': 226}, '8': {'precision': 0.6264367816091954, 'recall': 0.6606060606060606, 'f1-score': 0.6430678466076697, 'support': 165}, '9': {'precision': 0.7941176470588235, 'recall': 0.3253012048192771, 'f1-score': 0.4615384615384615, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8042994810971089, 'recall': 0.775, 'f1-score': 0.7893779556202255, 'support': 1400}, 'macro avg': {'precision': 0.7615250941109557, 'recall': 0.683568516111235, 'f1-score': 0.7103058174048171, 'support': 1400}, 'weighted avg': {'precision': 0.8034179018458685, 'recall': 0.775, 'f1-score': 0.7795375141920782, 'support': 1400}, 'samples avg': {'precision': 0.775, 'recall': 0.775, 'f1-score': 0.775, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 38s - loss: 0.3582 - acc: 0.8888 - precision: 0.9056 - recall: 0.8726 - val_loss: 0.9372 - val_acc: 0.7686 - val_precision: 0.7893 - val_recall: 0.7600 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.870026525198939, 'recall': 0.8817204301075269, 'f1-score': 0.8758344459279039, 'support': 372}, '1': {'precision': 0.8285714285714286, 'recall': 0.6531531531531531, 'f1-score': 0.7304785894206549, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.8125, 'recall': 0.4642857142857143, 'f1-score': 0.5909090909090908, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6686046511627907, 'recall': 0.8846153846153846, 'f1-score': 0.7615894039735099, 'support': 260}, '8': {'precision': 0.5964125560538116, 'recall': 0.665, 'f1-score': 0.6288416075650118, 'support': 200}, '9': {'precision': 0.8181818181818182, 'recall': 0.21686746987951808, 'f1-score': 0.34285714285714286, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.763448784082535, 'recall': 0.74, 'f1-score': 0.7515415306492564, 'support': 1400}, 'macro avg': {'precision': 0.7677951366876212, 'recall': 0.6093090343940365, 'f1-score': 0.6603560403895987, 'support': 1400}, 'weighted avg': {'precision': 0.777498521077981, 'recall': 0.74, 'f1-score': 0.7405346496894845, 'support': 1400}, 'samples avg': {'precision': 0.74, 'recall': 0.74, 'f1-score': 0.74, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9292035398230089, 'recall': 0.875, 'f1-score': 0.9012875536480688, 'support': 360}, '1': {'precision': 0.8598726114649682, 'recall': 0.6192660550458715, 'f1-score': 0.72, 'support': 218}, '2': {'precision': 0.9090909090909091, 'recall': 0.9259259259259259, 'f1-score': 0.9174311926605504, 'support': 108}, '3': {'precision': 0.8421052631578947, 'recall': 0.45714285714285713, 'f1-score': 0.5925925925925926, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.9117647058823529, 'recall': 0.8857142857142857, 'f1-score': 0.8985507246376812, 'support': 35}, '6': {'precision': 0.95, 'recall': 0.7450980392156863, 'f1-score': 0.8351648351648352, 'support': 51}, '7': {'precision': 0.7132352941176471, 'recall': 0.8584070796460177, 'f1-score': 0.7791164658634538, 'support': 226}, '8': {'precision': 0.5020408163265306, 'recall': 0.7454545454545455, 'f1-score': 0.6000000000000001, 'support': 165}, '9': {'precision': 0.8461538461538461, 'recall': 0.39759036144578314, 'f1-score': 0.540983606557377, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7893175074183977, 'recall': 0.76, 'f1-score': 0.7743813682678311, 'support': 1400}, 'macro avg': {'precision': 0.7712106190990938, 'recall': 0.696936934426184, 'f1-score': 0.7185385637941923, 'support': 1400}, 'weighted avg': {'precision': 0.8118608894498173, 'recall': 0.76, 'f1-score': 0.7706733905492508, 'support': 1400}, 'samples avg': {'precision': 0.76, 'recall': 0.76, 'f1-score': 0.76, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 38s - loss: 0.3145 - acc: 0.9008 - precision: 0.9159 - recall: 0.8904 - val_loss: 1.0117 - val_acc: 0.7829 - val_precision: 0.7933 - val_recall: 0.7757 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8695652173913043, 'recall': 0.9139784946236559, 'f1-score': 0.891218872870249, 'support': 372}, '1': {'precision': 0.8031088082901554, 'recall': 0.6981981981981982, 'f1-score': 0.7469879518072289, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.7142857142857143, 'recall': 0.49019607843137253, 'f1-score': 0.5813953488372093, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.7916666666666666, 'recall': 0.7916666666666666, 'f1-score': 0.7916666666666666, 'support': 24}, '7': {'precision': 0.6498599439775911, 'recall': 0.8923076923076924, 'f1-score': 0.7520259319286873, 'support': 260}, '8': {'precision': 0.655367231638418, 'recall': 0.58, 'f1-score': 0.6153846153846154, 'support': 200}, '9': {'precision': 0.7727272727272727, 'recall': 0.20481927710843373, 'f1-score': 0.3238095238095238, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7642752562225475, 'recall': 0.7457142857142857, 'f1-score': 0.7548806941431669, 'support': 1400}, 'macro avg': {'precision': 0.7381788034400548, 'recall': 0.610471382258185, 'f1-score': 0.6490208861538332, 'support': 1400}, 'weighted avg': {'precision': 0.769226326782676, 'recall': 0.7457142857142857, 'f1-score': 0.7406584654362351, 'support': 1400}, 'samples avg': {'precision': 0.7457142857142857, 'recall': 0.7457142857142857, 'f1-score': 0.7457142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9219653179190751, 'recall': 0.8861111111111111, 'f1-score': 0.9036827195467422, 'support': 360}, '1': {'precision': 0.8324607329842932, 'recall': 0.7293577981651376, 'f1-score': 0.7775061124694376, 'support': 218}, '2': {'precision': 0.9150943396226415, 'recall': 0.8981481481481481, 'f1-score': 0.9065420560747663, 'support': 108}, '3': {'precision': 0.7674418604651163, 'recall': 0.4714285714285714, 'f1-score': 0.5840707964601769, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 0.9130434782608695, 'recall': 0.8235294117647058, 'f1-score': 0.865979381443299, 'support': 51}, '7': {'precision': 0.6931407942238267, 'recall': 0.8495575221238938, 'f1-score': 0.7634194831013916, 'support': 226}, '8': {'precision': 0.5555555555555556, 'recall': 0.696969696969697, 'f1-score': 0.6182795698924732, 'support': 165}, '9': {'precision': 0.8333333333333334, 'recall': 0.42168674698795183, 'f1-score': 0.56, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7932797662527392, 'recall': 0.7757142857142857, 'f1-score': 0.7843986998916577, 'support': 1400}, 'macro avg': {'precision': 0.7568423630215398, 'recall': 0.7067007895683767, 'f1-score': 0.7220100453091569, 'support': 1400}, 'weighted avg': {'precision': 0.8016752922745962, 'recall': 0.7757142857142857, 'f1-score': 0.7799596570604086, 'support': 1400}, 'samples avg': {'precision': 0.7757142857142857, 'recall': 0.7757142857142857, 'f1-score': 0.7757142857142857, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 05:59:39.326805: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:59:39.593166: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 05:59:41.782280: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:59:41.782498: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 05:59:41.782514: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 05:59:58.200222: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 05:59:58.734567: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    3layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 06:00:02.145509: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 55s - loss: 0.7965 - acc: 0.7722 - precision: 0.8413 - recall: 0.7134 - val_loss: 0.8380 - val_acc: 0.7757 - val_precision: 0.7988 - val_recall: 0.7543 - 55s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.854679802955665, 'recall': 0.9327956989247311, 'f1-score': 0.8920308483290489, 'support': 372}, '1': {'precision': 0.8051282051282052, 'recall': 0.7072072072072072, 'f1-score': 0.7529976019184653, 'support': 222}, '2': {'precision': 0.8260869565217391, 'recall': 0.8636363636363636, 'f1-score': 0.8444444444444444, 'support': 88}, '3': {'precision': 0.8888888888888888, 'recall': 0.1568627450980392, 'f1-score': 0.26666666666666666, 'support': 51}, '4': {'precision': 0.8181818181818182, 'recall': 0.32142857142857145, 'f1-score': 0.46153846153846156, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.9285714285714286, 'recall': 0.5416666666666666, 'f1-score': 0.6842105263157894, 'support': 24}, '7': {'precision': 0.66189111747851, 'recall': 0.8884615384615384, 'f1-score': 0.7586206896551725, 'support': 260}, '8': {'precision': 0.6612903225806451, 'recall': 0.615, 'f1-score': 0.6373056994818652, 'support': 200}, '9': {'precision': 0.6818181818181818, 'recall': 0.18072289156626506, 'f1-score': 0.2857142857142857, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7706766917293233, 'recall': 0.7321428571428571, 'f1-score': 0.750915750915751, 'support': 1400}, 'macro avg': {'precision': 0.778964363240391, 'recall': 0.548134362064366, 'f1-score': 0.6090784588311492, 'support': 1400}, 'weighted avg': {'precision': 0.7784598593510509, 'recall': 0.7321428571428571, 'f1-score': 0.728381665274049, 'support': 1400}, 'samples avg': {'precision': 0.7321428571428571, 'recall': 0.7321428571428571, 'f1-score': 0.7321428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9141274238227147, 'recall': 0.9166666666666666, 'f1-score': 0.9153952843273232, 'support': 360}, '1': {'precision': 0.8342245989304813, 'recall': 0.7155963302752294, 'f1-score': 0.7703703703703705, 'support': 218}, '2': {'precision': 0.9230769230769231, 'recall': 0.8888888888888888, 'f1-score': 0.9056603773584906, 'support': 108}, '3': {'precision': 0.9523809523809523, 'recall': 0.2857142857142857, 'f1-score': 0.4395604395604395, 'support': 70}, '4': {'precision': 0.8333333333333334, 'recall': 0.6818181818181818, 'f1-score': 0.7499999999999999, 'support': 22}, '5': {'precision': 0.9032258064516129, 'recall': 0.8, 'f1-score': 0.8484848484848486, 'support': 35}, '6': {'precision': 0.9444444444444444, 'recall': 0.6666666666666666, 'f1-score': 0.7816091954022987, 'support': 51}, '7': {'precision': 0.6920289855072463, 'recall': 0.8451327433628318, 'f1-score': 0.7609561752988048, 'support': 226}, '8': {'precision': 0.5609756097560976, 'recall': 0.696969696969697, 'f1-score': 0.6216216216216217, 'support': 165}, '9': {'precision': 0.7692307692307693, 'recall': 0.3614457831325301, 'f1-score': 0.4918032786885246, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.9117647058823529, 'recall': 0.8157894736842105, 'f1-score': 0.861111111111111, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7987897125567323, 'recall': 0.7542857142857143, 'f1-score': 0.7759000734753858, 'support': 1400}, 'macro avg': {'precision': 0.7876010425243791, 'recall': 0.6453057254973003, 'f1-score': 0.6907620027351667, 'support': 1400}, 'weighted avg': {'precision': 0.812051036951343, 'recall': 0.7542857142857143, 'f1-score': 0.765624898207247, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 52s - loss: 0.4927 - acc: 0.8564 - precision: 0.8841 - recall: 0.8314 - val_loss: 0.8252 - val_acc: 0.7786 - val_precision: 0.8012 - val_recall: 0.7686 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8618090452261307, 'recall': 0.9220430107526881, 'f1-score': 0.8909090909090909, 'support': 372}, '1': {'precision': 0.7941176470588235, 'recall': 0.7297297297297297, 'f1-score': 0.7605633802816901, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.35294117647058826, 'f1-score': 0.5, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.42857142857142855, 'f1-score': 0.5581395348837209, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.691131498470948, 'recall': 0.8692307692307693, 'f1-score': 0.7700170357751278, 'support': 260}, '8': {'precision': 0.6183574879227053, 'recall': 0.64, 'f1-score': 0.628992628992629, 'support': 200}, '9': {'precision': 0.6956521739130435, 'recall': 0.1927710843373494, 'f1-score': 0.30188679245283023, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.2, 'f1-score': 0.33333333333333337, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7706013363028953, 'recall': 0.7414285714285714, 'f1-score': 0.7557335274845286, 'support': 1400}, 'macro avg': {'precision': 0.7741572340821417, 'recall': 0.5524440555422049, 'f1-score': 0.6106985297883036, 'support': 1400}, 'weighted avg': {'precision': 0.7764329898623108, 'recall': 0.7414285714285714, 'f1-score': 0.7384757684508507, 'support': 1400}, 'samples avg': {'precision': 0.7414285714285714, 'recall': 0.7414285714285714, 'f1-score': 0.7414285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9220055710306406, 'recall': 0.9194444444444444, 'f1-score': 0.9207232267037551, 'support': 360}, '1': {'precision': 0.8300970873786407, 'recall': 0.7844036697247706, 'f1-score': 0.8066037735849056, 'support': 218}, '2': {'precision': 0.9245283018867925, 'recall': 0.9074074074074074, 'f1-score': 0.9158878504672898, 'support': 108}, '3': {'precision': 0.896551724137931, 'recall': 0.37142857142857144, 'f1-score': 0.5252525252525253, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 35}, '6': {'precision': 0.8947368421052632, 'recall': 0.6666666666666666, 'f1-score': 0.7640449438202247, 'support': 51}, '7': {'precision': 0.7418032786885246, 'recall': 0.8008849557522124, 'f1-score': 0.7702127659574467, 'support': 226}, '8': {'precision': 0.5412844036697247, 'recall': 0.7151515151515152, 'f1-score': 0.6161879895561357, 'support': 165}, '9': {'precision': 0.7021276595744681, 'recall': 0.39759036144578314, 'f1-score': 0.5076923076923077, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.42857142857142855, 'f1-score': 0.6, 'support': 14}, '11': {'precision': 0.9142857142857143, 'recall': 0.8421052631578947, 'f1-score': 0.8767123287671234, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8011913626209978, 'recall': 0.7685714285714286, 'f1-score': 0.7845424717462631, 'support': 1400}, 'macro avg': {'precision': 0.7711202646077352, 'recall': 0.6475438360127905, 'f1-score': 0.6863357946807179, 'support': 1400}, 'weighted avg': {'precision': 0.8090723909550148, 'recall': 0.7685714285714286, 'f1-score': 0.777360270846071, 'support': 1400}, 'samples avg': {'precision': 0.7685714285714286, 'recall': 0.7685714285714286, 'f1-score': 0.7685714285714286, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 52s - loss: 0.4429 - acc: 0.8684 - precision: 0.8928 - recall: 0.8478 - val_loss: 0.8242 - val_acc: 0.7886 - val_precision: 0.8098 - val_recall: 0.7786 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8478260869565217, 'recall': 0.9435483870967742, 'f1-score': 0.8931297709923665, 'support': 372}, '1': {'precision': 0.8041237113402062, 'recall': 0.7027027027027027, 'f1-score': 0.7499999999999999, 'support': 222}, '2': {'precision': 0.8369565217391305, 'recall': 0.875, 'f1-score': 0.8555555555555556, 'support': 88}, '3': {'precision': 0.95, 'recall': 0.37254901960784315, 'f1-score': 0.5352112676056339, 'support': 51}, '4': {'precision': 0.7333333333333333, 'recall': 0.39285714285714285, 'f1-score': 0.5116279069767441, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.7269736842105263, 'recall': 0.85, 'f1-score': 0.7836879432624114, 'support': 260}, '8': {'precision': 0.6267942583732058, 'recall': 0.655, 'f1-score': 0.6405867970660147, 'support': 200}, '9': {'precision': 0.7391304347826086, 'recall': 0.20481927710843373, 'f1-score': 0.3207547169811321, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7831594634873323, 'recall': 0.7507142857142857, 'f1-score': 0.7665937272064187, 'support': 1400}, 'macro avg': {'precision': 0.7756116766090553, 'recall': 0.6016540789583243, 'f1-score': 0.6559056939167819, 'support': 1400}, 'weighted avg': {'precision': 0.7867343593363553, 'recall': 0.7507142857142857, 'f1-score': 0.7507960417545748, 'support': 1400}, 'samples avg': {'precision': 0.7507142857142857, 'recall': 0.7507142857142857, 'f1-score': 0.7507142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8994708994708994, 'recall': 0.9444444444444444, 'f1-score': 0.9214092140921409, 'support': 360}, '1': {'precision': 0.8534031413612565, 'recall': 0.7477064220183486, 'f1-score': 0.7970660146699265, 'support': 218}, '2': {'precision': 0.95, 'recall': 0.8796296296296297, 'f1-score': 0.9134615384615385, 'support': 108}, '3': {'precision': 0.9655172413793104, 'recall': 0.4, 'f1-score': 0.5656565656565657, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8857142857142857, 'recall': 0.8857142857142857, 'f1-score': 0.8857142857142857, 'support': 35}, '6': {'precision': 0.9069767441860465, 'recall': 0.7647058823529411, 'f1-score': 0.8297872340425532, 'support': 51}, '7': {'precision': 0.7583333333333333, 'recall': 0.8053097345132744, 'f1-score': 0.7811158798283261, 'support': 226}, '8': {'precision': 0.5352112676056338, 'recall': 0.6909090909090909, 'f1-score': 0.6031746031746031, 'support': 165}, '9': {'precision': 0.7608695652173914, 'recall': 0.42168674698795183, 'f1-score': 0.5426356589147286, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.9285714285714286, 'f1-score': 0.962962962962963, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8098068350668648, 'recall': 0.7785714285714286, 'f1-score': 0.7938820101966496, 'support': 1400}, 'macro avg': {'precision': 0.7854025631056477, 'recall': 0.6992836334245681, 'f1-score': 0.7276635047328968, 'support': 1400}, 'weighted avg': {'precision': 0.818384854198303, 'recall': 0.7785714285714286, 'f1-score': 0.787410576611079, 'support': 1400}, 'samples avg': {'precision': 0.7785714285714286, 'recall': 0.7785714285714286, 'f1-score': 0.7785714285714286, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 53s - loss: 0.3827 - acc: 0.8878 - precision: 0.9044 - recall: 0.8700 - val_loss: 0.8715 - val_acc: 0.7929 - val_precision: 0.8119 - val_recall: 0.7864 - 53s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8639798488664987, 'recall': 0.9220430107526881, 'f1-score': 0.8920676202860857, 'support': 372}, '1': {'precision': 0.8040201005025126, 'recall': 0.7207207207207207, 'f1-score': 0.7600950118764845, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.7931034482758621, 'recall': 0.45098039215686275, 'f1-score': 0.5750000000000001, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.5, 'f1-score': 0.6086956521739131, 'support': 28}, '5': {'precision': 0.9166666666666666, 'recall': 0.6470588235294118, 'f1-score': 0.7586206896551724, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6834319526627219, 'recall': 0.8884615384615384, 'f1-score': 0.7725752508361203, 'support': 260}, '8': {'precision': 0.6702702702702703, 'recall': 0.62, 'f1-score': 0.6441558441558443, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.25301204819277107, 'f1-score': 0.3716814159292035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7785923753665689, 'recall': 0.7585714285714286, 'f1-score': 0.7684515195369029, 'support': 1400}, 'macro avg': {'precision': 0.7636583764561706, 'recall': 0.6168575346681084, 'f1-score': 0.6672485077849617, 'support': 1400}, 'weighted avg': {'precision': 0.7799718632851508, 'recall': 0.7585714285714286, 'f1-score': 0.7560599195448849, 'support': 1400}, 'samples avg': {'precision': 0.7585714285714286, 'recall': 0.7585714285714286, 'f1-score': 0.7585714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9275766016713092, 'recall': 0.925, 'f1-score': 0.9262865090403338, 'support': 360}, '1': {'precision': 0.8609625668449198, 'recall': 0.7385321100917431, 'f1-score': 0.7950617283950618, 'support': 218}, '2': {'precision': 0.8918918918918919, 'recall': 0.9166666666666666, 'f1-score': 0.9041095890410958, 'support': 108}, '3': {'precision': 0.8888888888888888, 'recall': 0.45714285714285713, 'f1-score': 0.6037735849056604, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.9047619047619048, 'recall': 0.7450980392156863, 'f1-score': 0.8172043010752689, 'support': 51}, '7': {'precision': 0.7283018867924528, 'recall': 0.8539823008849557, 'f1-score': 0.7861507128309572, 'support': 226}, '8': {'precision': 0.5885416666666666, 'recall': 0.6848484848484848, 'f1-score': 0.6330532212885154, 'support': 165}, '9': {'precision': 0.7450980392156863, 'recall': 0.4578313253012048, 'f1-score': 0.5671641791044776, 'support': 83}, '10': {'precision': 0.7647058823529411, 'recall': 0.9285714285714286, 'f1-score': 0.8387096774193549, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8119469026548672, 'recall': 0.7864285714285715, 'f1-score': 0.7989840348330915, 'support': 1400}, 'macro avg': {'precision': 0.754643233747644, 'recall': 0.7088766975242542, 'f1-score': 0.7213574045564217, 'support': 1400}, 'weighted avg': {'precision': 0.8147242645276674, 'recall': 0.7864285714285715, 'f1-score': 0.7926940329503543, 'support': 1400}, 'samples avg': {'precision': 0.7864285714285715, 'recall': 0.7864285714285715, 'f1-score': 0.7864285714285715, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 52s - loss: 0.3442 - acc: 0.8952 - precision: 0.9097 - recall: 0.8824 - val_loss: 1.0098 - val_acc: 0.7721 - val_precision: 0.7860 - val_recall: 0.7607 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8639798488664987, 'recall': 0.9220430107526881, 'f1-score': 0.8920676202860857, 'support': 372}, '1': {'precision': 0.8108108108108109, 'recall': 0.6756756756756757, 'f1-score': 0.7371007371007371, 'support': 222}, '2': {'precision': 0.8085106382978723, 'recall': 0.8636363636363636, 'f1-score': 0.8351648351648351, 'support': 88}, '3': {'precision': 0.7297297297297297, 'recall': 0.5294117647058824, 'f1-score': 0.6136363636363636, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.5, 'f1-score': 0.6086956521739131, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5833333333333334, 'f1-score': 0.7368421052631579, 'support': 24}, '7': {'precision': 0.6438356164383562, 'recall': 0.9038461538461539, 'f1-score': 0.752, 'support': 260}, '8': {'precision': 0.6648936170212766, 'recall': 0.625, 'f1-score': 0.6443298969072165, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.18072289156626506, 'f1-score': 0.2912621359223301, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7659574468085106, 'recall': 0.7457142857142857, 'f1-score': 0.7557003257328989, 'support': 1400}, 'macro avg': {'precision': 0.773041387610948, 'recall': 0.5867018779570901, 'f1-score': 0.6443790206563509, 'support': 1400}, 'weighted avg': {'precision': 0.7765495840148373, 'recall': 0.7457142857142857, 'f1-score': 0.7412037509110907, 'support': 1400}, 'samples avg': {'precision': 0.7457142857142857, 'recall': 0.7457142857142857, 'f1-score': 0.7457142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.92, 'recall': 0.8944444444444445, 'f1-score': 0.9070422535211269, 'support': 360}, '1': {'precision': 0.8682634730538922, 'recall': 0.6651376146788991, 'f1-score': 0.7532467532467533, 'support': 218}, '2': {'precision': 0.8888888888888888, 'recall': 0.8888888888888888, 'f1-score': 0.8888888888888888, 'support': 108}, '3': {'precision': 0.7906976744186046, 'recall': 0.4857142857142857, 'f1-score': 0.6017699115044247, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.90625, 'recall': 0.8285714285714286, 'f1-score': 0.8656716417910447, 'support': 35}, '6': {'precision': 0.967741935483871, 'recall': 0.5882352941176471, 'f1-score': 0.7317073170731707, 'support': 51}, '7': {'precision': 0.656957928802589, 'recall': 0.8982300884955752, 'f1-score': 0.7588785046728973, 'support': 226}, '8': {'precision': 0.5507246376811594, 'recall': 0.6909090909090909, 'f1-score': 0.6129032258064516, 'support': 165}, '9': {'precision': 0.8235294117647058, 'recall': 0.3373493975903614, 'f1-score': 0.47863247863247865, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7859778597785978, 'recall': 0.7607142857142857, 'f1-score': 0.7731397459165154, 'support': 1400}, 'macro avg': {'precision': 0.7661288255666666, 'recall': 0.682578159754968, 'f1-score': 0.7068872789177606, 'support': 1400}, 'weighted avg': {'precision': 0.8034133213086512, 'recall': 0.7607142857142857, 'f1-score': 0.766371502507369, 'support': 1400}, 'samples avg': {'precision': 0.7607142857142857, 'recall': 0.7607142857142857, 'f1-score': 0.7607142857142857, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 2 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:05:16.594501: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:05:16.844507: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:05:18.683358: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:05:18.683558: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:05:18.683573: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=2, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:05:30.300454: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:05:30.958811: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3411112.56it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3131746.99it/s]
Mon May 22 06:05:35 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:05:39.715358: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:37 22/148 [===>..........................] - ETA: 0s   46/148 [========>.....................] - ETA: 0s 68/148 [============>.................] - ETA: 0s 94/148 [==================>...........] - ETA: 0s123/148 [=======================>......] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2288967.47it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2640299.28it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2658324.25it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 84840.02it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2544205.20it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 85453.54it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3019036.30it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2997460.75it/s]
Mon May 22 06:05:41 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s17/44 [==========>...................] - ETA: 0s44/44 [==============================] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 0s18/44 [===========>..................] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2109204.60it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2331093.93it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2574320.74it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84597.91it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2549728.88it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 85480.91it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               2 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 40s - loss: 0.7414 - acc: 0.7788 - precision: 0.8512 - recall: 0.7130 - val_loss: 0.8324 - val_acc: 0.7736 - val_precision: 0.7950 - val_recall: 0.7536 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8329355608591885, 'recall': 0.9381720430107527, 'f1-score': 0.8824273072060682, 'support': 372}, '1': {'precision': 0.7740384615384616, 'recall': 0.7252252252252253, 'f1-score': 0.7488372093023257, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.9333333333333333, 'recall': 0.27450980392156865, 'f1-score': 0.42424242424242425, 'support': 51}, '4': {'precision': 0.8125, 'recall': 0.4642857142857143, 'f1-score': 0.5909090909090908, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5294117647058824, 'f1-score': 0.6923076923076924, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.693939393939394, 'recall': 0.8807692307692307, 'f1-score': 0.776271186440678, 'support': 260}, '8': {'precision': 0.6647398843930635, 'recall': 0.575, 'f1-score': 0.6166219839142092, 'support': 200}, '9': {'precision': 0.6363636363636364, 'recall': 0.1686746987951807, 'f1-score': 0.26666666666666666, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7567567567567568, 'f1-score': 0.8615384615384616, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7711293941660434, 'recall': 0.7364285714285714, 'f1-score': 0.7533796127146513, 'support': 1400}, 'macro avg': {'precision': 0.7815654054174674, 'recall': 0.5557052979872269, 'f1-score': 0.61910057308796, 'support': 1400}, 'weighted avg': {'precision': 0.773377834444424, 'recall': 0.7364285714285714, 'f1-score': 0.7323304943211701, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8957219251336899, 'recall': 0.9305555555555556, 'f1-score': 0.9128065395095368, 'support': 360}, '1': {'precision': 0.8090452261306532, 'recall': 0.7385321100917431, 'f1-score': 0.7721822541966428, 'support': 218}, '2': {'precision': 0.8909090909090909, 'recall': 0.9074074074074074, 'f1-score': 0.8990825688073394, 'support': 108}, '3': {'precision': 0.9, 'recall': 0.2571428571428571, 'f1-score': 0.39999999999999997, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 1.0, 'recall': 0.6285714285714286, 'f1-score': 0.7719298245614035, 'support': 35}, '6': {'precision': 0.9459459459459459, 'recall': 0.6862745098039216, 'f1-score': 0.7954545454545455, 'support': 51}, '7': {'precision': 0.734375, 'recall': 0.831858407079646, 'f1-score': 0.7800829875518672, 'support': 226}, '8': {'precision': 0.5533980582524272, 'recall': 0.6909090909090909, 'f1-score': 0.6145552560646901, 'support': 165}, '9': {'precision': 0.7435897435897436, 'recall': 0.3493975903614458, 'f1-score': 0.47540983606557385, 'support': 83}, '10': {'precision': 0.875, 'recall': 0.5, 'f1-score': 0.6363636363636364, 'support': 14}, '11': {'precision': 0.8888888888888888, 'recall': 0.8421052631578947, 'f1-score': 0.8648648648648649, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7950263752825923, 'recall': 0.7535714285714286, 'f1-score': 0.7737440410707738, 'support': 1400}, 'macro avg': {'precision': 0.7720672214500339, 'recall': 0.6223097651810553, 'f1-score': 0.6680490057957587, 'support': 1400}, 'weighted avg': {'precision': 0.8027988096524377, 'recall': 0.7535714285714286, 'f1-score': 0.7609485557957315, 'support': 1400}, 'samples avg': {'precision': 0.7535714285714286, 'recall': 0.7535714285714286, 'f1-score': 0.7535714285714286, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 39s - loss: 0.4631 - acc: 0.8592 - precision: 0.8831 - recall: 0.8336 - val_loss: 0.8281 - val_acc: 0.7757 - val_precision: 0.7941 - val_recall: 0.7550 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8848167539267016, 'recall': 0.9086021505376344, 'f1-score': 0.896551724137931, 'support': 372}, '1': {'precision': 0.8238341968911918, 'recall': 0.7162162162162162, 'f1-score': 0.7662650602409639, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.7666666666666667, 'recall': 0.45098039215686275, 'f1-score': 0.5679012345679013, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.5833333333333334, 'f1-score': 0.7368421052631579, 'support': 24}, '7': {'precision': 0.6493150684931507, 'recall': 0.9115384615384615, 'f1-score': 0.7584, 'support': 260}, '8': {'precision': 0.6878612716763006, 'recall': 0.595, 'f1-score': 0.6380697050938338, 'support': 200}, '9': {'precision': 0.6956521739130435, 'recall': 0.1927710843373494, 'f1-score': 0.30188679245283023, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7567567567567568, 'f1-score': 0.8615384615384616, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7793567688855647, 'recall': 0.7442857142857143, 'f1-score': 0.7614176105224698, 'support': 1400}, 'macro avg': {'precision': 0.7764542034999187, 'recall': 0.5779158899273367, 'f1-score': 0.6396026718930121, 'support': 1400}, 'weighted avg': {'precision': 0.7871005164526209, 'recall': 0.7442857142857143, 'f1-score': 0.7465210491145213, 'support': 1400}, 'samples avg': {'precision': 0.7442857142857143, 'recall': 0.7442857142857143, 'f1-score': 0.7442857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9329446064139941, 'recall': 0.8888888888888888, 'f1-score': 0.910384068278805, 'support': 360}, '1': {'precision': 0.8587570621468926, 'recall': 0.6972477064220184, 'f1-score': 0.7696202531645571, 'support': 218}, '2': {'precision': 0.9166666666666666, 'recall': 0.9166666666666666, 'f1-score': 0.9166666666666666, 'support': 108}, '3': {'precision': 0.7714285714285715, 'recall': 0.38571428571428573, 'f1-score': 0.5142857142857142, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 0.9393939393939394, 'recall': 0.6078431372549019, 'f1-score': 0.738095238095238, 'support': 51}, '7': {'precision': 0.6735395189003437, 'recall': 0.8672566371681416, 'f1-score': 0.758220502901354, 'support': 226}, '8': {'precision': 0.5612244897959183, 'recall': 0.6666666666666666, 'f1-score': 0.6094182825484764, 'support': 165}, '9': {'precision': 0.7209302325581395, 'recall': 0.37349397590361444, 'f1-score': 0.49206349206349204, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.7142857142857143, 'f1-score': 0.8, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7941397445529677, 'recall': 0.755, 'f1-score': 0.7740754302453313, 'support': 1400}, 'macro avg': {'precision': 0.7569095345855191, 'recall': 0.6635221180048596, 'f1-score': 0.6952796352795422, 'support': 1400}, 'weighted avg': {'precision': 0.8022168084088876, 'recall': 0.755, 'f1-score': 0.7667405300529785, 'support': 1400}, 'samples avg': {'precision': 0.755, 'recall': 0.755, 'f1-score': 0.755, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 39s - loss: 0.3786 - acc: 0.8762 - precision: 0.8970 - recall: 0.8588 - val_loss: 0.8419 - val_acc: 0.7750 - val_precision: 0.7939 - val_recall: 0.7679 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8753180661577609, 'recall': 0.9247311827956989, 'f1-score': 0.8993464052287582, 'support': 372}, '1': {'precision': 0.8201058201058201, 'recall': 0.6981981981981982, 'f1-score': 0.754257907542579, 'support': 222}, '2': {'precision': 0.8, 'recall': 0.9090909090909091, 'f1-score': 0.8510638297872342, 'support': 88}, '3': {'precision': 0.7027027027027027, 'recall': 0.5098039215686274, 'f1-score': 0.5909090909090909, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.5, 'f1-score': 0.6086956521739131, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6951219512195121, 'recall': 0.8769230769230769, 'f1-score': 0.7755102040816327, 'support': 260}, '8': {'precision': 0.64, 'recall': 0.64, 'f1-score': 0.64, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.18072289156626506, 'f1-score': 0.2912621359223301, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7837837837837838, 'f1-score': 0.8787878787878788, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7810650887573964, 'recall': 0.7542857142857143, 'f1-score': 0.7674418604651162, 'support': 1400}, 'macro avg': {'precision': 0.769651597108309, 'recall': 0.6137420092914849, 'f1-score': 0.6642362461285778, 'support': 1400}, 'weighted avg': {'precision': 0.7845327159096674, 'recall': 0.7542857142857143, 'f1-score': 0.7531670380583602, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9257142857142857, 'recall': 0.9, 'f1-score': 0.9126760563380283, 'support': 360}, '1': {'precision': 0.875, 'recall': 0.7064220183486238, 'f1-score': 0.7817258883248731, 'support': 218}, '2': {'precision': 0.8771929824561403, 'recall': 0.9259259259259259, 'f1-score': 0.9009009009009009, 'support': 108}, '3': {'precision': 0.7291666666666666, 'recall': 0.5, 'f1-score': 0.5932203389830509, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8181818181818182, 'recall': 0.7714285714285715, 'f1-score': 0.7941176470588236, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7330677290836654, 'recall': 0.8141592920353983, 'f1-score': 0.7714884696016772, 'support': 226}, '8': {'precision': 0.5242290748898678, 'recall': 0.7212121212121212, 'f1-score': 0.6071428571428572, 'support': 165}, '9': {'precision': 0.8095238095238095, 'recall': 0.40963855421686746, 'f1-score': 0.544, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7939438700147711, 'recall': 0.7678571428571429, 'f1-score': 0.7806826434277415, 'support': 1400}, 'macro avg': {'precision': 0.7499117633302161, 'recall': 0.6872170202022717, 'f1-score': 0.7086671360058772, 'support': 1400}, 'weighted avg': {'precision': 0.8046405588563111, 'recall': 0.7678571428571429, 'f1-score': 0.7771500396757305, 'support': 1400}, 'samples avg': {'precision': 0.7678571428571429, 'recall': 0.7678571428571429, 'f1-score': 0.7678571428571429, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 40s - loss: 0.3315 - acc: 0.8942 - precision: 0.9103 - recall: 0.8788 - val_loss: 0.9340 - val_acc: 0.7657 - val_precision: 0.7771 - val_recall: 0.7571 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8539603960396039, 'recall': 0.9274193548387096, 'f1-score': 0.8891752577319587, 'support': 372}, '1': {'precision': 0.8342857142857143, 'recall': 0.6576576576576577, 'f1-score': 0.7355163727959698, 'support': 222}, '2': {'precision': 0.8279569892473119, 'recall': 0.875, 'f1-score': 0.8508287292817679, 'support': 88}, '3': {'precision': 0.7916666666666666, 'recall': 0.37254901960784315, 'f1-score': 0.5066666666666667, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.7138263665594855, 'recall': 0.8538461538461538, 'f1-score': 0.7775831873905428, 'support': 260}, '8': {'precision': 0.5975103734439834, 'recall': 0.72, 'f1-score': 0.653061224489796, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.21686746987951808, 'f1-score': 0.3364485981308411, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9629629629629629, 'recall': 0.7027027027027027, 'f1-score': 0.8125, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7717872968980798, 'recall': 0.7464285714285714, 'f1-score': 0.7588961510530138, 'support': 1400}, 'macro avg': {'precision': 0.7626683935954505, 'recall': 0.5849649045456007, 'f1-score': 0.6385910815471151, 'support': 1400}, 'weighted avg': {'precision': 0.7804815908460954, 'recall': 0.7464285714285714, 'f1-score': 0.7449059404381445, 'support': 1400}, 'samples avg': {'precision': 0.7464285714285714, 'recall': 0.7464285714285714, 'f1-score': 0.7464285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9070422535211268, 'recall': 0.8944444444444445, 'f1-score': 0.9006993006993007, 'support': 360}, '1': {'precision': 0.8765432098765432, 'recall': 0.6513761467889908, 'f1-score': 0.7473684210526316, 'support': 218}, '2': {'precision': 0.9333333333333333, 'recall': 0.9074074074074074, 'f1-score': 0.9201877934272301, 'support': 108}, '3': {'precision': 0.8285714285714286, 'recall': 0.4142857142857143, 'f1-score': 0.5523809523809524, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8823529411764706, 'recall': 0.8571428571428571, 'f1-score': 0.8695652173913043, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7327935222672065, 'recall': 0.8008849557522124, 'f1-score': 0.7653276955602538, 'support': 226}, '8': {'precision': 0.4632352941176471, 'recall': 0.7636363636363637, 'f1-score': 0.5766590389016018, 'support': 165}, '9': {'precision': 0.7777777777777778, 'recall': 0.42168674698795183, 'f1-score': 0.546875, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7771260997067448, 'recall': 0.7571428571428571, 'f1-score': 0.7670043415340088, 'support': 1400}, 'macro avg': {'precision': 0.7691404328566954, 'recall': 0.6748192397067753, 'f1-score': 0.7056450909879685, 'support': 1400}, 'weighted avg': {'precision': 0.8039493495165193, 'recall': 0.7571428571428571, 'f1-score': 0.7661525222722236, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 39s - loss: 0.2818 - acc: 0.9110 - precision: 0.9232 - recall: 0.8994 - val_loss: 0.9346 - val_acc: 0.7936 - val_precision: 0.8070 - val_recall: 0.7886 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8148148148148148, 'recall': 0.946236559139785, 'f1-score': 0.8756218905472636, 'support': 372}, '1': {'precision': 0.806282722513089, 'recall': 0.6936936936936937, 'f1-score': 0.7457627118644068, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.6944444444444444, 'recall': 0.49019607843137253, 'f1-score': 0.5747126436781609, 'support': 51}, '4': {'precision': 0.7894736842105263, 'recall': 0.5357142857142857, 'f1-score': 0.6382978723404255, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.95, 'recall': 0.7916666666666666, 'f1-score': 0.8636363636363635, 'support': 24}, '7': {'precision': 0.6949685534591195, 'recall': 0.85, 'f1-score': 0.7647058823529412, 'support': 260}, '8': {'precision': 0.7005649717514124, 'recall': 0.62, 'f1-score': 0.6578249336870027, 'support': 200}, '9': {'precision': 0.7857142857142857, 'recall': 0.26506024096385544, 'f1-score': 0.3963963963963964, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7737226277372263, 'recall': 0.7571428571428571, 'f1-score': 0.7653429602888087, 'support': 1400}, 'macro avg': {'precision': 0.759340275033066, 'recall': 0.6314028413336843, 'f1-score': 0.6759587060254945, 'support': 1400}, 'weighted avg': {'precision': 0.775173196999986, 'recall': 0.7571428571428571, 'f1-score': 0.7526099755118795, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.888, 'recall': 0.925, 'f1-score': 0.9061224489795918, 'support': 360}, '1': {'precision': 0.8586387434554974, 'recall': 0.7522935779816514, 'f1-score': 0.8019559902200489, 'support': 218}, '2': {'precision': 0.9174311926605505, 'recall': 0.9259259259259259, 'f1-score': 0.9216589861751153, 'support': 108}, '3': {'precision': 0.7872340425531915, 'recall': 0.5285714285714286, 'f1-score': 0.6324786324786325, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.9090909090909091, 'recall': 0.7843137254901961, 'f1-score': 0.8421052631578948, 'support': 51}, '7': {'precision': 0.732, 'recall': 0.8097345132743363, 'f1-score': 0.76890756302521, 'support': 226}, '8': {'precision': 0.5957446808510638, 'recall': 0.6787878787878788, 'f1-score': 0.6345609065155807, 'support': 165}, '9': {'precision': 0.7755102040816326, 'recall': 0.4578313253012048, 'f1-score': 0.5757575757575758, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8070175438596491, 'recall': 0.7885714285714286, 'f1-score': 0.7976878612716762, 'support': 1400}, 'macro avg': {'precision': 0.7576384887688923, 'recall': 0.7231808508918254, 'f1-score': 0.7340525481111853, 'support': 1400}, 'weighted avg': {'precision': 0.8053696520078611, 'recall': 0.7885714285714286, 'f1-score': 0.7917506773611572, 'support': 1400}, 'samples avg': {'precision': 0.7885714285714286, 'recall': 0.7885714285714286, 'f1-score': 0.7885714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:09:58.033449: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:09:58.289068: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:10:02.250710: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:10:02.250908: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:10:02.250923: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:10:29.355795: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:10:30.266889: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3396197.57it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3118441.64it/s]
Mon May 22 06:10:34 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:10:38.495217: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 2:03 26/148 [====>.........................] - ETA: 0s   51/148 [=========>....................] - ETA: 0s 76/148 [==============>...............] - ETA: 0s102/148 [===================>..........] - ETA: 0s131/148 [=========================>....] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2286970.56it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2585656.36it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2655967.58it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 83753.75it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2546411.80it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84854.64it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3087290.01it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2944847.34it/s]
Mon May 22 06:10:40 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s23/44 [==============>...............] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 1s18/44 [===========>..................] - ETA: 0s44/44 [==============================] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2077857.61it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2310002.20it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2525602.41it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82187.15it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2405581.97it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83966.45it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               3 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 56s - loss: 0.7424 - acc: 0.7796 - precision: 0.8568 - recall: 0.7166 - val_loss: 0.8083 - val_acc: 0.7850 - val_precision: 0.8021 - val_recall: 0.7700 - 56s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8592964824120602, 'recall': 0.9193548387096774, 'f1-score': 0.8883116883116883, 'support': 372}, '1': {'precision': 0.7735849056603774, 'recall': 0.7387387387387387, 'f1-score': 0.7557603686635945, 'support': 222}, '2': {'precision': 0.8080808080808081, 'recall': 0.9090909090909091, 'f1-score': 0.8556149732620321, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.3333333333333333, 'f1-score': 0.5, 'support': 51}, '4': {'precision': 0.7692307692307693, 'recall': 0.35714285714285715, 'f1-score': 0.48780487804878053, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 24}, '7': {'precision': 0.7151898734177216, 'recall': 0.8692307692307693, 'f1-score': 0.7847222222222223, 'support': 260}, '8': {'precision': 0.644808743169399, 'recall': 0.59, 'f1-score': 0.6161879895561357, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.1686746987951807, 'f1-score': 0.27184466019417475, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7837837837837838, 'f1-score': 0.8787878787878788, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7805429864253394, 'recall': 0.7392857142857143, 'f1-score': 0.7593543653705064, 'support': 1400}, 'macro avg': {'precision': 0.7746301216900874, 'recall': 0.5781852886426662, 'f1-score': 0.6344364496881971, 'support': 1400}, 'weighted avg': {'precision': 0.7830391634899645, 'recall': 0.7392857142857143, 'f1-score': 0.7401953636059626, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9228571428571428, 'recall': 0.8972222222222223, 'f1-score': 0.9098591549295774, 'support': 360}, '1': {'precision': 0.8075117370892019, 'recall': 0.7889908256880734, 'f1-score': 0.7981438515081207, 'support': 218}, '2': {'precision': 0.8869565217391304, 'recall': 0.9444444444444444, 'f1-score': 0.914798206278027, 'support': 108}, '3': {'precision': 0.8571428571428571, 'recall': 0.34285714285714286, 'f1-score': 0.4897959183673469, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.9642857142857143, 'recall': 0.7714285714285715, 'f1-score': 0.8571428571428572, 'support': 35}, '6': {'precision': 0.8636363636363636, 'recall': 0.7450980392156863, 'f1-score': 0.8, 'support': 51}, '7': {'precision': 0.7489878542510121, 'recall': 0.8185840707964602, 'f1-score': 0.7822410147991543, 'support': 226}, '8': {'precision': 0.5533980582524272, 'recall': 0.6909090909090909, 'f1-score': 0.6145552560646901, 'support': 165}, '9': {'precision': 0.7333333333333333, 'recall': 0.39759036144578314, 'f1-score': 0.5156250000000001, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8888888888888888, 'recall': 0.8421052631578947, 'f1-score': 0.8648648648648649, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8020833333333334, 'recall': 0.77, 'f1-score': 0.7857142857142857, 'support': 1400}, 'macro avg': {'precision': 0.7713075747289285, 'recall': 0.6787419705062272, 'f1-score': 0.7101544468412556, 'support': 1400}, 'weighted avg': {'precision': 0.8061994772315155, 'recall': 0.77, 'f1-score': 0.7778309886516349, 'support': 1400}, 'samples avg': {'precision': 0.77, 'recall': 0.77, 'f1-score': 0.77, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 53s - loss: 0.4557 - acc: 0.8646 - precision: 0.8893 - recall: 0.8374 - val_loss: 0.8061 - val_acc: 0.7907 - val_precision: 0.8069 - val_recall: 0.7821 - 53s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8353221957040573, 'recall': 0.9408602150537635, 'f1-score': 0.8849557522123894, 'support': 372}, '1': {'precision': 0.7815533980582524, 'recall': 0.7252252252252253, 'f1-score': 0.7523364485981308, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.9444444444444444, 'recall': 0.3333333333333333, 'f1-score': 0.49275362318840576, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.7120253164556962, 'recall': 0.8653846153846154, 'f1-score': 0.78125, 'support': 260}, '8': {'precision': 0.6629834254143646, 'recall': 0.6, 'f1-score': 0.6299212598425197, 'support': 200}, '9': {'precision': 0.625, 'recall': 0.24096385542168675, 'f1-score': 0.34782608695652173, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7753891771682728, 'recall': 0.7471428571428571, 'f1-score': 0.7610040014550745, 'support': 1400}, 'macro avg': {'precision': 0.7714669781200527, 'recall': 0.5829293652011908, 'f1-score': 0.642389973772253, 'support': 1400}, 'weighted avg': {'precision': 0.7748686405798323, 'recall': 0.7471428571428571, 'f1-score': 0.7449195288071546, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9116022099447514, 'recall': 0.9166666666666666, 'f1-score': 0.9141274238227146, 'support': 360}, '1': {'precision': 0.8269230769230769, 'recall': 0.7889908256880734, 'f1-score': 0.807511737089202, 'support': 218}, '2': {'precision': 0.8859649122807017, 'recall': 0.9351851851851852, 'f1-score': 0.9099099099099098, 'support': 108}, '3': {'precision': 0.90625, 'recall': 0.4142857142857143, 'f1-score': 0.5686274509803921, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8709677419354839, 'recall': 0.7714285714285715, 'f1-score': 0.8181818181818182, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7698744769874477, 'recall': 0.8141592920353983, 'f1-score': 0.7913978494623656, 'support': 226}, '8': {'precision': 0.56, 'recall': 0.6787878787878788, 'f1-score': 0.6136986301369864, 'support': 165}, '9': {'precision': 0.7166666666666667, 'recall': 0.5180722891566265, 'f1-score': 0.6013986013986015, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7857142857142857, 'f1-score': 0.88, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8069270449521002, 'recall': 0.7821428571428571, 'f1-score': 0.7943416757344941, 'support': 1400}, 'macro avg': {'precision': 0.7678422091105972, 'recall': 0.6885525100975053, 'f1-score': 0.7171819339860994, 'support': 1400}, 'weighted avg': {'precision': 0.8097976306185752, 'recall': 0.7821428571428571, 'f1-score': 0.7889060296695797, 'support': 1400}, 'samples avg': {'precision': 0.7821428571428571, 'recall': 0.7821428571428571, 'f1-score': 0.7821428571428571, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 54s - loss: 0.4078 - acc: 0.8786 - precision: 0.8976 - recall: 0.8552 - val_loss: 0.8255 - val_acc: 0.7993 - val_precision: 0.8181 - val_recall: 0.7871 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8808290155440415, 'recall': 0.9139784946236559, 'f1-score': 0.8970976253298152, 'support': 372}, '1': {'precision': 0.7897196261682243, 'recall': 0.7612612612612613, 'f1-score': 0.7752293577981652, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.9166666666666666, 'recall': 0.43137254901960786, 'f1-score': 0.5866666666666666, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.782608695652174, 'recall': 0.75, 'f1-score': 0.7659574468085107, 'support': 24}, '7': {'precision': 0.6783625730994152, 'recall': 0.8923076923076924, 'f1-score': 0.7707641196013288, 'support': 260}, '8': {'precision': 0.7090909090909091, 'recall': 0.585, 'f1-score': 0.6410958904109589, 'support': 200}, '9': {'precision': 0.7407407407407407, 'recall': 0.24096385542168675, 'f1-score': 0.36363636363636365, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7333333333333333, 'f1-score': 0.846153846153846, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7859778597785978, 'recall': 0.7607142857142857, 'f1-score': 0.7731397459165154, 'support': 1400}, 'macro avg': {'precision': 0.7615733876920816, 'recall': 0.6370354732198664, 'f1-score': 0.6769584333789394, 'support': 1400}, 'weighted avg': {'precision': 0.7895168808583672, 'recall': 0.7607142857142857, 'f1-score': 0.759719523339276, 'support': 1400}, 'samples avg': {'precision': 0.7607142857142857, 'recall': 0.7607142857142857, 'f1-score': 0.7607142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9436201780415431, 'recall': 0.8833333333333333, 'f1-score': 0.9124820659971307, 'support': 360}, '1': {'precision': 0.8284313725490197, 'recall': 0.7752293577981652, 'f1-score': 0.8009478672985783, 'support': 218}, '2': {'precision': 0.865546218487395, 'recall': 0.9537037037037037, 'f1-score': 0.9074889867841409, 'support': 108}, '3': {'precision': 0.8888888888888888, 'recall': 0.45714285714285713, 'f1-score': 0.6037735849056604, 'support': 70}, '4': {'precision': 0.6956521739130435, 'recall': 0.7272727272727273, 'f1-score': 0.711111111111111, 'support': 22}, '5': {'precision': 0.8285714285714286, 'recall': 0.8285714285714286, 'f1-score': 0.8285714285714286, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7529411764705882, 'recall': 0.8495575221238938, 'f1-score': 0.7983367983367984, 'support': 226}, '8': {'precision': 0.6096256684491979, 'recall': 0.6909090909090909, 'f1-score': 0.6477272727272727, 'support': 165}, '9': {'precision': 0.7735849056603774, 'recall': 0.4939759036144578, 'f1-score': 0.6029411764705882, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8181143281365999, 'recall': 0.7871428571428571, 'f1-score': 0.8023298143429195, 'support': 1400}, 'macro avg': {'precision': 0.7616518945795586, 'recall': 0.7143789049056769, 'f1-score': 0.729388414432436, 'support': 1400}, 'weighted avg': {'precision': 0.8198027678864298, 'recall': 0.7871428571428571, 'f1-score': 0.7967673006597258, 'support': 1400}, 'samples avg': {'precision': 0.7871428571428571, 'recall': 0.7871428571428571, 'f1-score': 0.7871428571428571, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 54s - loss: 0.3615 - acc: 0.8856 - precision: 0.9049 - recall: 0.8716 - val_loss: 0.8826 - val_acc: 0.7743 - val_precision: 0.7942 - val_recall: 0.7607 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8475, 'recall': 0.9112903225806451, 'f1-score': 0.8782383419689119, 'support': 372}, '1': {'precision': 0.8417721518987342, 'recall': 0.5990990990990991, 'f1-score': 0.7000000000000001, 'support': 222}, '2': {'precision': 0.8387096774193549, 'recall': 0.8863636363636364, 'f1-score': 0.861878453038674, 'support': 88}, '3': {'precision': 0.6363636363636364, 'recall': 0.5490196078431373, 'f1-score': 0.5894736842105264, 'support': 51}, '4': {'precision': 0.8125, 'recall': 0.4642857142857143, 'f1-score': 0.5909090909090908, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.9285714285714286, 'recall': 0.5416666666666666, 'f1-score': 0.6842105263157894, 'support': 24}, '7': {'precision': 0.6715116279069767, 'recall': 0.8884615384615384, 'f1-score': 0.7649006622516555, 'support': 260}, '8': {'precision': 0.6614583333333334, 'recall': 0.635, 'f1-score': 0.6479591836734695, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.24096385542168675, 'f1-score': 0.37037037037037035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8, 'f1-score': 0.888888888888889, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.77066269545793, 'recall': 0.7392857142857143, 'f1-score': 0.7546481954064891, 'support': 1400}, 'macro avg': {'precision': 0.7562318141233895, 'recall': 0.6158320444190065, 'f1-score': 0.6618433789603895, 'support': 1400}, 'weighted avg': {'precision': 0.7792208219959983, 'recall': 0.7392857142857143, 'f1-score': 0.7415998778555712, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9279538904899135, 'recall': 0.8944444444444445, 'f1-score': 0.9108910891089109, 'support': 360}, '1': {'precision': 0.9027777777777778, 'recall': 0.5963302752293578, 'f1-score': 0.718232044198895, 'support': 218}, '2': {'precision': 0.8990825688073395, 'recall': 0.9074074074074074, 'f1-score': 0.903225806451613, 'support': 108}, '3': {'precision': 0.7169811320754716, 'recall': 0.5428571428571428, 'f1-score': 0.6178861788617885, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8205128205128205, 'recall': 0.9142857142857143, 'f1-score': 0.8648648648648648, 'support': 35}, '6': {'precision': 0.9714285714285714, 'recall': 0.6666666666666666, 'f1-score': 0.7906976744186046, 'support': 51}, '7': {'precision': 0.7142857142857143, 'recall': 0.8407079646017699, 'f1-score': 0.7723577235772359, 'support': 226}, '8': {'precision': 0.5223214285714286, 'recall': 0.7090909090909091, 'f1-score': 0.6015424164524421, 'support': 165}, '9': {'precision': 0.82, 'recall': 0.4939759036144578, 'f1-score': 0.6165413533834586, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7941834451901566, 'recall': 0.7607142857142857, 'f1-score': 0.7770886537759942, 'support': 1400}, 'macro avg': {'precision': 0.7573788386075737, 'recall': 0.7012574943190223, 'f1-score': 0.7189861653282487, 'support': 1400}, 'weighted avg': {'precision': 0.8107792612943308, 'recall': 0.7607142857142857, 'f1-score': 0.7741942325508722, 'support': 1400}, 'samples avg': {'precision': 0.7607142857142857, 'recall': 0.7607142857142857, 'f1-score': 0.7607142857142857, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 53s - loss: 0.3214 - acc: 0.8970 - precision: 0.9124 - recall: 0.8852 - val_loss: 1.0141 - val_acc: 0.7793 - val_precision: 0.7906 - val_recall: 0.7714 - 53s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8369304556354916, 'recall': 0.9381720430107527, 'f1-score': 0.8846641318124209, 'support': 372}, '1': {'precision': 0.8125, 'recall': 0.6441441441441441, 'f1-score': 0.7185929648241207, 'support': 222}, '2': {'precision': 0.8191489361702128, 'recall': 0.875, 'f1-score': 0.8461538461538463, 'support': 88}, '3': {'precision': 0.8214285714285714, 'recall': 0.45098039215686275, 'f1-score': 0.5822784810126583, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.6243386243386243, 'recall': 0.9076923076923077, 'f1-score': 0.7398119122257053, 'support': 260}, '8': {'precision': 0.7108433734939759, 'recall': 0.59, 'f1-score': 0.644808743169399, 'support': 200}, '9': {'precision': 0.7777777777777778, 'recall': 0.1686746987951807, 'f1-score': 0.2772277227722772, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.7297297297297297, 'f1-score': 0.8437499999999999, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7611721611721611, 'recall': 0.7421428571428571, 'f1-score': 0.7515370705244124, 'support': 1400}, 'macro avg': {'precision': 0.7626871962161897, 'recall': 0.6033545386002683, 'f1-score': 0.6525019920929633, 'support': 1400}, 'weighted avg': {'precision': 0.7738350047359093, 'recall': 0.7421428571428571, 'f1-score': 0.7346721290286208, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9164345403899722, 'recall': 0.9138888888888889, 'f1-score': 0.9151599443671767, 'support': 360}, '1': {'precision': 0.8571428571428571, 'recall': 0.6880733944954128, 'f1-score': 0.7633587786259541, 'support': 218}, '2': {'precision': 0.95, 'recall': 0.8796296296296297, 'f1-score': 0.9134615384615385, 'support': 108}, '3': {'precision': 0.7560975609756098, 'recall': 0.44285714285714284, 'f1-score': 0.5585585585585585, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.918918918918919, 'recall': 0.6666666666666666, 'f1-score': 0.7727272727272727, 'support': 51}, '7': {'precision': 0.6504854368932039, 'recall': 0.8893805309734514, 'f1-score': 0.7514018691588785, 'support': 226}, '8': {'precision': 0.5833333333333334, 'recall': 0.6787878787878788, 'f1-score': 0.6274509803921569, 'support': 165}, '9': {'precision': 0.868421052631579, 'recall': 0.39759036144578314, 'f1-score': 0.5454545454545454, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.875, 'recall': 0.9210526315789473, 'f1-score': 0.8974358974358975, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7906295754026355, 'recall': 0.7714285714285715, 'f1-score': 0.7809110629067245, 'support': 1400}, 'macro avg': {'precision': 0.7556179561830725, 'recall': 0.6918085800698628, 'f1-score': 0.7094110597958944, 'support': 1400}, 'weighted avg': {'precision': 0.8034378353373809, 'recall': 0.7714285714285715, 'f1-score': 0.7744176406082169, 'support': 1400}, 'samples avg': {'precision': 0.7714285714285715, 'recall': 0.7714285714285715, 'f1-score': 0.7714285714285715, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 4 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:16:20.234139: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:16:20.531326: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:16:22.231507: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:16:22.231721: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:16:22.231737: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=4, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:16:33.457639: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:16:33.934603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3419455.41it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3131746.99it/s]
Mon May 22 06:16:38 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:16:42.652635: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:52 26/148 [====>.........................] - ETA: 0s   53/148 [=========>....................] - ETA: 0s 79/148 [===============>..............] - ETA: 0s106/148 [====================>.........] - ETA: 0s134/148 [==========================>...] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2254274.97it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2576579.90it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2717574.19it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82529.62it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2532136.96it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84351.22it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3092167.25it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2964172.44it/s]
Mon May 22 06:16:44 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_4_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s19/44 [===========>..................] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 1s18/44 [===========>..................] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2032546.07it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2216695.21it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2413491.82it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 81800.18it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2462065.24it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83510.28it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               1 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 24s - loss: 0.6983 - acc: 0.7848 - precision: 0.8741 - recall: 0.7136 - val_loss: 0.7997 - val_acc: 0.7743 - val_precision: 0.8012 - val_recall: 0.7486 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8614609571788413, 'recall': 0.9193548387096774, 'f1-score': 0.8894668400520155, 'support': 372}, '1': {'precision': 0.7931034482758621, 'recall': 0.7252252252252253, 'f1-score': 0.7576470588235296, 'support': 222}, '2': {'precision': 0.8152173913043478, 'recall': 0.8522727272727273, 'f1-score': 0.8333333333333333, 'support': 88}, '3': {'precision': 0.875, 'recall': 0.4117647058823529, 'f1-score': 0.56, 'support': 51}, '4': {'precision': 0.8181818181818182, 'recall': 0.32142857142857145, 'f1-score': 0.46153846153846156, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.8636363636363636, 'recall': 0.7916666666666666, 'f1-score': 0.8260869565217391, 'support': 24}, '7': {'precision': 0.6827794561933535, 'recall': 0.8692307692307693, 'f1-score': 0.7648054145516074, 'support': 260}, '8': {'precision': 0.6779661016949152, 'recall': 0.6, 'f1-score': 0.636604774535809, 'support': 200}, '9': {'precision': 0.7857142857142857, 'recall': 0.13253012048192772, 'f1-score': 0.22680412371134023, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9090909090909091, 'recall': 0.8108108108108109, 'f1-score': 0.8571428571428571, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7804693414080243, 'recall': 0.7364285714285714, 'f1-score': 0.7578096288129363, 'support': 1400}, 'macro avg': {'precision': 0.775550056251592, 'recall': 0.5760912612686956, 'f1-score': 0.6300410921011592, 'support': 1400}, 'weighted avg': {'precision': 0.7860710456848722, 'recall': 0.7364285714285714, 'f1-score': 0.7375494618443279, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9118457300275482, 'recall': 0.9194444444444444, 'f1-score': 0.9156293222683265, 'support': 360}, '1': {'precision': 0.8263157894736842, 'recall': 0.7201834862385321, 'f1-score': 0.7696078431372548, 'support': 218}, '2': {'precision': 0.9134615384615384, 'recall': 0.8796296296296297, 'f1-score': 0.8962264150943395, 'support': 108}, '3': {'precision': 0.8571428571428571, 'recall': 0.34285714285714286, 'f1-score': 0.4897959183673469, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.9166666666666666, 'recall': 0.6285714285714286, 'f1-score': 0.7457627118644068, 'support': 35}, '6': {'precision': 0.8235294117647058, 'recall': 0.8235294117647058, 'f1-score': 0.8235294117647058, 'support': 51}, '7': {'precision': 0.71875, 'recall': 0.8141592920353983, 'f1-score': 0.7634854771784233, 'support': 226}, '8': {'precision': 0.5759162303664922, 'recall': 0.6666666666666666, 'f1-score': 0.6179775280898876, 'support': 165}, '9': {'precision': 0.7586206896551724, 'recall': 0.26506024096385544, 'f1-score': 0.3928571428571429, 'support': 83}, '10': {'precision': 0.8461538461538461, 'recall': 0.7857142857142857, 'f1-score': 0.8148148148148148, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8012232415902141, 'recall': 0.7485714285714286, 'f1-score': 0.774002954209749, 'support': 1400}, 'macro avg': {'precision': 0.7553998178082603, 'recall': 0.6513711998664676, 'f1-score': 0.6826698638814073, 'support': 1400}, 'weighted avg': {'precision': 0.8029585990204068, 'recall': 0.7485714285714286, 'f1-score': 0.76102131029552, 'support': 1400}, 'samples avg': {'precision': 0.7485714285714286, 'recall': 0.7485714285714286, 'f1-score': 0.7485714285714286, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 23s - loss: 0.4098 - acc: 0.8672 - precision: 0.8909 - recall: 0.8456 - val_loss: 0.8210 - val_acc: 0.7800 - val_precision: 0.7945 - val_recall: 0.7650 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8452088452088452, 'recall': 0.9247311827956989, 'f1-score': 0.883183568677792, 'support': 372}, '1': {'precision': 0.806282722513089, 'recall': 0.6936936936936937, 'f1-score': 0.7457627118644068, 'support': 222}, '2': {'precision': 0.8020833333333334, 'recall': 0.875, 'f1-score': 0.8369565217391305, 'support': 88}, '3': {'precision': 0.8461538461538461, 'recall': 0.43137254901960786, 'f1-score': 0.5714285714285715, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9047619047619048, 'recall': 0.7916666666666666, 'f1-score': 0.8444444444444444, 'support': 24}, '7': {'precision': 0.696319018404908, 'recall': 0.8730769230769231, 'f1-score': 0.7747440273037542, 'support': 260}, '8': {'precision': 0.6702127659574468, 'recall': 0.63, 'f1-score': 0.6494845360824743, 'support': 200}, '9': {'precision': 0.68, 'recall': 0.20481927710843373, 'f1-score': 0.3148148148148148, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7788533134772897, 'recall': 0.7471428571428571, 'f1-score': 0.7626686110098433, 'support': 1400}, 'macro avg': {'precision': 0.7707887081203187, 'recall': 0.6000444050489862, 'f1-score': 0.6530223528178758, 'support': 1400}, 'weighted avg': {'precision': 0.7798385952703158, 'recall': 0.7471428571428571, 'f1-score': 0.7470924745694791, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9093406593406593, 'recall': 0.9194444444444444, 'f1-score': 0.9143646408839778, 'support': 360}, '1': {'precision': 0.8685714285714285, 'recall': 0.6972477064220184, 'f1-score': 0.7735368956743003, 'support': 218}, '2': {'precision': 0.8521739130434782, 'recall': 0.9074074074074074, 'f1-score': 0.8789237668161435, 'support': 108}, '3': {'precision': 0.896551724137931, 'recall': 0.37142857142857144, 'f1-score': 0.5252525252525253, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.8541666666666666, 'recall': 0.803921568627451, 'f1-score': 0.8282828282828283, 'support': 51}, '7': {'precision': 0.7104247104247104, 'recall': 0.8141592920353983, 'f1-score': 0.7587628865979381, 'support': 226}, '8': {'precision': 0.5502392344497608, 'recall': 0.696969696969697, 'f1-score': 0.6149732620320857, 'support': 165}, '9': {'precision': 0.7446808510638298, 'recall': 0.42168674698795183, 'f1-score': 0.5384615384615385, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7142857142857143, 'f1-score': 0.8333333333333333, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7945103857566765, 'recall': 0.765, 'f1-score': 0.7794759825327511, 'support': 1400}, 'macro avg': {'precision': 0.7630703111532872, 'recall': 0.6767024728121596, 'f1-score': 0.7044095462044534, 'support': 1400}, 'weighted avg': {'precision': 0.8026820327323907, 'recall': 0.765, 'f1-score': 0.7723513378418131, 'support': 1400}, 'samples avg': {'precision': 0.765, 'recall': 0.765, 'f1-score': 0.765, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 23s - loss: 0.3323 - acc: 0.8958 - precision: 0.9109 - recall: 0.8810 - val_loss: 0.8807 - val_acc: 0.7821 - val_precision: 0.7931 - val_recall: 0.7693 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8333333333333334, 'recall': 0.9274193548387096, 'f1-score': 0.8778625954198473, 'support': 372}, '1': {'precision': 0.8138297872340425, 'recall': 0.6891891891891891, 'f1-score': 0.7463414634146341, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.6410256410256411, 'recall': 0.49019607843137253, 'f1-score': 0.5555555555555556, 'support': 51}, '4': {'precision': 0.8571428571428571, 'recall': 0.42857142857142855, 'f1-score': 0.5714285714285714, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6930091185410334, 'recall': 0.8769230769230769, 'f1-score': 0.7741935483870968, 'support': 260}, '8': {'precision': 0.6741573033707865, 'recall': 0.6, 'f1-score': 0.6349206349206349, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.18072289156626506, 'f1-score': 0.2912621359223301, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.772020725388601, 'recall': 0.745, 'f1-score': 0.7582697201017812, 'support': 1400}, 'macro avg': {'precision': 0.7558329380156471, 'recall': 0.595600216643051, 'f1-score': 0.6422205694001176, 'support': 1400}, 'weighted avg': {'precision': 0.7732062108026465, 'recall': 0.745, 'f1-score': 0.7412196571820268, 'support': 1400}, 'samples avg': {'precision': 0.745, 'recall': 0.745, 'f1-score': 0.745, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9030470914127424, 'recall': 0.9055555555555556, 'f1-score': 0.9042995839112343, 'support': 360}, '1': {'precision': 0.8522727272727273, 'recall': 0.6880733944954128, 'f1-score': 0.7614213197969545, 'support': 218}, '2': {'precision': 0.9009009009009009, 'recall': 0.9259259259259259, 'f1-score': 0.91324200913242, 'support': 108}, '3': {'precision': 0.7446808510638298, 'recall': 0.5, 'f1-score': 0.5982905982905983, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.8863636363636364, 'recall': 0.7647058823529411, 'f1-score': 0.8210526315789474, 'support': 51}, '7': {'precision': 0.7196969696969697, 'recall': 0.8407079646017699, 'f1-score': 0.7755102040816326, 'support': 226}, '8': {'precision': 0.5517241379310345, 'recall': 0.6787878787878788, 'f1-score': 0.608695652173913, 'support': 165}, '9': {'precision': 0.8205128205128205, 'recall': 0.3855421686746988, 'f1-score': 0.5245901639344261, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7930780559646539, 'recall': 0.7692857142857142, 'f1-score': 0.7810007251631617, 'support': 1400}, 'macro avg': {'precision': 0.7434886834402342, 'recall': 0.6964742678945629, 'f1-score': 0.7100232054874314, 'support': 1400}, 'weighted avg': {'precision': 0.7977920685723092, 'recall': 0.7692857142857142, 'f1-score': 0.774559125721636, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 23s - loss: 0.2673 - acc: 0.9122 - precision: 0.9249 - recall: 0.8990 - val_loss: 0.8763 - val_acc: 0.7807 - val_precision: 0.8001 - val_recall: 0.7779 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8455882352941176, 'recall': 0.9274193548387096, 'f1-score': 0.8846153846153846, 'support': 372}, '1': {'precision': 0.8144329896907216, 'recall': 0.7117117117117117, 'f1-score': 0.7596153846153846, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.6153846153846154, 'recall': 0.47058823529411764, 'f1-score': 0.5333333333333333, 'support': 51}, '4': {'precision': 0.8571428571428571, 'recall': 0.42857142857142855, 'f1-score': 0.5714285714285714, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.9047619047619048, 'recall': 0.7916666666666666, 'f1-score': 0.8444444444444444, 'support': 24}, '7': {'precision': 0.6953846153846154, 'recall': 0.8692307692307693, 'f1-score': 0.7726495726495726, 'support': 260}, '8': {'precision': 0.6666666666666666, 'recall': 0.62, 'f1-score': 0.6424870466321244, 'support': 200}, '9': {'precision': 0.8095238095238095, 'recall': 0.20481927710843373, 'f1-score': 0.32692307692307687, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7765486725663717, 'recall': 0.7521428571428571, 'f1-score': 0.7641509433962265, 'support': 1400}, 'macro avg': {'precision': 0.7660681302961007, 'recall': 0.6123382751439072, 'f1-score': 0.659702038446101, 'support': 1400}, 'weighted avg': {'precision': 0.7799808270453304, 'recall': 0.7521428571428571, 'f1-score': 0.749275339678374, 'support': 1400}, 'samples avg': {'precision': 0.7521428571428571, 'recall': 0.7521428571428571, 'f1-score': 0.7521428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9164345403899722, 'recall': 0.9138888888888889, 'f1-score': 0.9151599443671767, 'support': 360}, '1': {'precision': 0.8324324324324325, 'recall': 0.7064220183486238, 'f1-score': 0.7642679900744418, 'support': 218}, '2': {'precision': 0.8928571428571429, 'recall': 0.9259259259259259, 'f1-score': 0.9090909090909091, 'support': 108}, '3': {'precision': 0.7555555555555555, 'recall': 0.4857142857142857, 'f1-score': 0.5913043478260869, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.8888888888888888, 'recall': 0.7843137254901961, 'f1-score': 0.8333333333333334, 'support': 51}, '7': {'precision': 0.7297297297297297, 'recall': 0.8362831858407079, 'f1-score': 0.779381443298969, 'support': 226}, '8': {'precision': 0.558252427184466, 'recall': 0.696969696969697, 'f1-score': 0.6199460916442048, 'support': 165}, '9': {'precision': 0.868421052631579, 'recall': 0.39759036144578314, 'f1-score': 0.5454545454545454, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8001469507714916, 'recall': 0.7778571428571428, 'f1-score': 0.7888446215139442, 'support': 1400}, 'macro avg': {'precision': 0.7538360956670805, 'recall': 0.7066154442219397, 'f1-score': 0.7195396933247592, 'support': 1400}, 'weighted avg': {'precision': 0.8055717770920668, 'recall': 0.7778571428571428, 'f1-score': 0.7825754642714637, 'support': 1400}, 'samples avg': {'precision': 0.7778571428571428, 'recall': 0.7778571428571428, 'f1-score': 0.7778571428571428, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 24s - loss: 0.2138 - acc: 0.9280 - precision: 0.9382 - recall: 0.9174 - val_loss: 0.9499 - val_acc: 0.7964 - val_precision: 0.8064 - val_recall: 0.7886 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8246445497630331, 'recall': 0.9354838709677419, 'f1-score': 0.8765743073047859, 'support': 372}, '1': {'precision': 0.8010471204188482, 'recall': 0.6891891891891891, 'f1-score': 0.7409200968523002, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.6842105263157895, 'recall': 0.5098039215686274, 'f1-score': 0.5842696629213484, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5882352941176471, 'f1-score': 0.7407407407407407, 'support': 17}, '6': {'precision': 0.782608695652174, 'recall': 0.75, 'f1-score': 0.7659574468085107, 'support': 24}, '7': {'precision': 0.6676384839650146, 'recall': 0.8807692307692307, 'f1-score': 0.7595356550580432, 'support': 260}, '8': {'precision': 0.7017543859649122, 'recall': 0.6, 'f1-score': 0.6469002695417789, 'support': 200}, '9': {'precision': 0.7368421052631579, 'recall': 0.1686746987951807, 'f1-score': 0.2745098039215686, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9666666666666667, 'recall': 0.7837837837837838, 'f1-score': 0.8656716417910447, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7651792245793709, 'recall': 0.7471428571428571, 'f1-score': 0.7560534875316226, 'support': 1400}, 'macro avg': {'precision': 0.7489588588914263, 'recall': 0.6016057733943435, 'f1-score': 0.646384091291393, 'support': 1400}, 'weighted avg': {'precision': 0.7674226105635231, 'recall': 0.7471428571428571, 'f1-score': 0.738968455252952, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9098360655737705, 'recall': 0.925, 'f1-score': 0.9173553719008265, 'support': 360}, '1': {'precision': 0.8457446808510638, 'recall': 0.7293577981651376, 'f1-score': 0.7832512315270935, 'support': 218}, '2': {'precision': 0.8918918918918919, 'recall': 0.9166666666666666, 'f1-score': 0.9041095890410958, 'support': 108}, '3': {'precision': 0.8085106382978723, 'recall': 0.5428571428571428, 'f1-score': 0.6495726495726495, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.8936170212765957, 'recall': 0.8235294117647058, 'f1-score': 0.8571428571428571, 'support': 51}, '7': {'precision': 0.706959706959707, 'recall': 0.8539823008849557, 'f1-score': 0.7735470941883767, 'support': 226}, '8': {'precision': 0.6117021276595744, 'recall': 0.696969696969697, 'f1-score': 0.651558073654391, 'support': 165}, '9': {'precision': 0.8157894736842105, 'recall': 0.37349397590361444, 'f1-score': 0.512396694214876, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8064280496712929, 'recall': 0.7885714285714286, 'f1-score': 0.7973997833152762, 'support': 1400}, 'macro avg': {'precision': 0.7561147209759297, 'recall': 0.7119457795398834, 'f1-score': 0.7243637031608876, 'support': 1400}, 'weighted avg': {'precision': 0.8080105252888067, 'recall': 0.7885714285714286, 'f1-score': 0.7898720178982703, 'support': 1400}, 'samples avg': {'precision': 0.7885714285714286, 'recall': 0.7885714285714286, 'f1-score': 0.7885714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:19:30.183980: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:19:30.454948: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:19:32.747997: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:19:32.748196: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:19:32.748210: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:19:41.804604: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:19:42.311025: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    1layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder (Transf  (None, None, 2560)       47213056  
 ormerEncoder)                                                   
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout (Dropout)           (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 47,542,541
Trainable params: 47,542,541
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 06:19:44.701825: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 23s - loss: 0.6224 - acc: 0.8110 - precision: 0.8673 - recall: 0.7606 - val_loss: 0.8148 - val_acc: 0.7736 - val_precision: 0.8011 - val_recall: 0.7536 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8604060913705583, 'recall': 0.9112903225806451, 'f1-score': 0.8851174934725848, 'support': 372}, '1': {'precision': 0.8146067415730337, 'recall': 0.6531531531531531, 'f1-score': 0.725, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.7272727272727273, 'recall': 0.47058823529411764, 'f1-score': 0.5714285714285714, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8823529411764706, 'recall': 0.625, 'f1-score': 0.7317073170731708, 'support': 24}, '7': {'precision': 0.6971608832807571, 'recall': 0.85, 'f1-score': 0.7660311958405546, 'support': 260}, '8': {'precision': 0.6069651741293532, 'recall': 0.61, 'f1-score': 0.6084788029925187, 'support': 200}, '9': {'precision': 0.8181818181818182, 'recall': 0.21686746987951808, 'f1-score': 0.34285714285714286, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7731411229135053, 'recall': 0.7278571428571429, 'f1-score': 0.7498160412067697, 'support': 1400}, 'macro avg': {'precision': 0.7699720558219426, 'recall': 0.5728432744185701, 'f1-score': 0.6330576107326992, 'support': 1400}, 'weighted avg': {'precision': 0.7802163858451611, 'recall': 0.7278571428571429, 'f1-score': 0.7355476666736529, 'support': 1400}, 'samples avg': {'precision': 0.7278571428571429, 'recall': 0.7278571428571429, 'f1-score': 0.7278571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9148351648351648, 'recall': 0.925, 'f1-score': 0.9198895027624309, 'support': 360}, '1': {'precision': 0.86875, 'recall': 0.6376146788990825, 'f1-score': 0.7354497354497354, 'support': 218}, '2': {'precision': 0.8990825688073395, 'recall': 0.9074074074074074, 'f1-score': 0.903225806451613, 'support': 108}, '3': {'precision': 0.8378378378378378, 'recall': 0.44285714285714284, 'f1-score': 0.5794392523364486, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.9615384615384616, 'recall': 0.7142857142857143, 'f1-score': 0.819672131147541, 'support': 35}, '6': {'precision': 0.9, 'recall': 0.7058823529411765, 'f1-score': 0.7912087912087913, 'support': 51}, '7': {'precision': 0.7439024390243902, 'recall': 0.8097345132743363, 'f1-score': 0.7754237288135594, 'support': 226}, '8': {'precision': 0.5223214285714286, 'recall': 0.7090909090909091, 'f1-score': 0.6015424164524421, 'support': 165}, '9': {'precision': 0.7804878048780488, 'recall': 0.3855421686746988, 'f1-score': 0.5161290322580645, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8010630220197419, 'recall': 0.7535714285714286, 'f1-score': 0.7765918292234082, 'support': 1400}, 'macro avg': {'precision': 0.7723199395588155, 'recall': 0.6650106725017496, 'f1-score': 0.7034442959264998, 'support': 1400}, 'weighted avg': {'precision': 0.8125359854616829, 'recall': 0.7535714285714286, 'f1-score': 0.7704175719547505, 'support': 1400}, 'samples avg': {'precision': 0.7535714285714286, 'recall': 0.7535714285714286, 'f1-score': 0.7535714285714286, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 22s - loss: 0.3383 - acc: 0.8910 - precision: 0.9072 - recall: 0.8760 - val_loss: 0.8624 - val_acc: 0.7729 - val_precision: 0.7892 - val_recall: 0.7593 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8585858585858586, 'recall': 0.9139784946236559, 'f1-score': 0.8854166666666665, 'support': 372}, '1': {'precision': 0.8066298342541437, 'recall': 0.6576576576576577, 'f1-score': 0.7245657568238214, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.6470588235294118, 'recall': 0.43137254901960786, 'f1-score': 0.5176470588235293, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.6336898395721925, 'recall': 0.9115384615384615, 'f1-score': 0.7476340694006309, 'support': 260}, '8': {'precision': 0.7073170731707317, 'recall': 0.58, 'f1-score': 0.6373626373626374, 'support': 200}, '9': {'precision': 0.7727272727272727, 'recall': 0.20481927710843373, 'f1-score': 0.3238095238095238, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9629629629629629, 'recall': 0.7027027027027027, 'f1-score': 0.8125, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7652757078986587, 'recall': 0.7335714285714285, 'f1-score': 0.7490882567469, 'support': 1400}, 'macro avg': {'precision': 0.7616994024752661, 'recall': 0.5748374277328278, 'f1-score': 0.633340898207163, 'support': 1400}, 'weighted avg': {'precision': 0.7756255752735811, 'recall': 0.7335714285714285, 'f1-score': 0.7335508300018101, 'support': 1400}, 'samples avg': {'precision': 0.7335714285714285, 'recall': 0.7335714285714285, 'f1-score': 0.7335714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9136490250696379, 'recall': 0.9111111111111111, 'f1-score': 0.9123783031988875, 'support': 360}, '1': {'precision': 0.8685714285714285, 'recall': 0.6972477064220184, 'f1-score': 0.7735368956743003, 'support': 218}, '2': {'precision': 0.912621359223301, 'recall': 0.8703703703703703, 'f1-score': 0.8909952606635072, 'support': 108}, '3': {'precision': 0.825, 'recall': 0.4714285714285714, 'f1-score': 0.6000000000000001, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.896551724137931, 'recall': 0.7428571428571429, 'f1-score': 0.8125, 'support': 35}, '6': {'precision': 0.9411764705882353, 'recall': 0.6274509803921569, 'f1-score': 0.7529411764705882, 'support': 51}, '7': {'precision': 0.6466666666666666, 'recall': 0.8584070796460177, 'f1-score': 0.7376425855513308, 'support': 226}, '8': {'precision': 0.5751295336787565, 'recall': 0.6727272727272727, 'f1-score': 0.6201117318435755, 'support': 165}, '9': {'precision': 0.7804878048780488, 'recall': 0.3855421686746988, 'f1-score': 0.5161290322580645, 'support': 83}, '10': {'precision': 0.8461538461538461, 'recall': 0.7857142857142857, 'f1-score': 0.8148148148148148, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7891610987379362, 'recall': 0.7592857142857142, 'f1-score': 0.7739352020385876, 'support': 1400}, 'macro avg': {'precision': 0.756001340641988, 'recall': 0.6649897122093567, 'f1-score': 0.6963891822963892, 'support': 1400}, 'weighted avg': {'precision': 0.8011602278351989, 'recall': 0.7592857142857142, 'f1-score': 0.768159998381338, 'support': 1400}, 'samples avg': {'precision': 0.7592857142857142, 'recall': 0.7592857142857142, 'f1-score': 0.7592857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 22s - loss: 0.2411 - acc: 0.9192 - precision: 0.9297 - recall: 0.9094 - val_loss: 0.8997 - val_acc: 0.7821 - val_precision: 0.7960 - val_recall: 0.7721 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8469135802469135, 'recall': 0.9220430107526881, 'f1-score': 0.8828828828828829, 'support': 372}, '1': {'precision': 0.7989690721649485, 'recall': 0.6981981981981982, 'f1-score': 0.7451923076923077, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.6388888888888888, 'recall': 0.45098039215686275, 'f1-score': 0.5287356321839081, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.875, 'recall': 0.5833333333333334, 'f1-score': 0.7000000000000001, 'support': 24}, '7': {'precision': 0.6509695290858726, 'recall': 0.9038461538461539, 'f1-score': 0.7568438003220611, 'support': 260}, '8': {'precision': 0.6975308641975309, 'recall': 0.565, 'f1-score': 0.6243093922651933, 'support': 200}, '9': {'precision': 0.8095238095238095, 'recall': 0.20481927710843373, 'f1-score': 0.32692307692307687, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9615384615384616, 'recall': 0.6756756756756757, 'f1-score': 0.7936507936507937, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7659259259259259, 'recall': 0.7385714285714285, 'f1-score': 0.752, 'support': 1400}, 'macro avg': {'precision': 0.7583939568991522, 'recall': 0.576863327913012, 'f1-score': 0.6340385960111505, 'support': 1400}, 'weighted avg': {'precision': 0.7739666039077004, 'recall': 0.7385714285714285, 'f1-score': 0.7359034481679362, 'support': 1400}, 'samples avg': {'precision': 0.7385714285714285, 'recall': 0.7385714285714285, 'f1-score': 0.7385714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9088397790055248, 'recall': 0.9138888888888889, 'f1-score': 0.9113573407202216, 'support': 360}, '1': {'precision': 0.8324873096446701, 'recall': 0.7522935779816514, 'f1-score': 0.7903614457831326, 'support': 218}, '2': {'precision': 0.9411764705882353, 'recall': 0.8888888888888888, 'f1-score': 0.9142857142857143, 'support': 108}, '3': {'precision': 0.7857142857142857, 'recall': 0.4714285714285714, 'f1-score': 0.5892857142857143, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.875, 'recall': 0.8, 'f1-score': 0.8358208955223881, 'support': 35}, '6': {'precision': 0.9487179487179487, 'recall': 0.7254901960784313, 'f1-score': 0.8222222222222223, 'support': 51}, '7': {'precision': 0.6563573883161512, 'recall': 0.8451327433628318, 'f1-score': 0.7388781431334622, 'support': 226}, '8': {'precision': 0.6, 'recall': 0.6545454545454545, 'f1-score': 0.6260869565217392, 'support': 165}, '9': {'precision': 0.825, 'recall': 0.39759036144578314, 'f1-score': 0.5365853658536586, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7960235640648011, 'recall': 0.7721428571428571, 'f1-score': 0.7839013778100072, 'support': 1400}, 'macro avg': {'precision': 0.760544434087669, 'recall': 0.6868008545493345, 'f1-score': 0.7123807341606156, 'support': 1400}, 'weighted avg': {'precision': 0.8020677876243049, 'recall': 0.7721428571428571, 'f1-score': 0.7776906044448827, 'support': 1400}, 'samples avg': {'precision': 0.7721428571428571, 'recall': 0.7721428571428571, 'f1-score': 0.7721428571428571, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 22s - loss: 0.1680 - acc: 0.9444 - precision: 0.9521 - recall: 0.9390 - val_loss: 0.9864 - val_acc: 0.7793 - val_precision: 0.7875 - val_recall: 0.7757 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8374384236453202, 'recall': 0.9139784946236559, 'f1-score': 0.8740359897172236, 'support': 372}, '1': {'precision': 0.798941798941799, 'recall': 0.6801801801801802, 'f1-score': 0.734793187347932, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.6216216216216216, 'recall': 0.45098039215686275, 'f1-score': 0.5227272727272727, 'support': 51}, '4': {'precision': 0.6666666666666666, 'recall': 0.42857142857142855, 'f1-score': 0.5217391304347826, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8333333333333334, 'recall': 0.625, 'f1-score': 0.7142857142857143, 'support': 24}, '7': {'precision': 0.6456043956043956, 'recall': 0.9038461538461539, 'f1-score': 0.7532051282051283, 'support': 260}, '8': {'precision': 0.6666666666666666, 'recall': 0.57, 'f1-score': 0.61455525606469, 'support': 200}, '9': {'precision': 0.8260869565217391, 'recall': 0.2289156626506024, 'f1-score': 0.3584905660377358, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9642857142857143, 'recall': 0.7297297297297297, 'f1-score': 0.8307692307692307, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7543731778425656, 'recall': 0.7392857142857143, 'f1-score': 0.7467532467532466, 'support': 1400}, 'macro avg': {'precision': 0.7435975404820652, 'recall': 0.5898573077507997, 'f1-score': 0.638254017076208, 'support': 1400}, 'weighted avg': {'precision': 0.7625961306079027, 'recall': 0.7392857142857143, 'f1-score': 0.732264370595725, 'support': 1400}, 'samples avg': {'precision': 0.7392857142857143, 'recall': 0.7392857142857143, 'f1-score': 0.7392857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9065934065934066, 'recall': 0.9166666666666666, 'f1-score': 0.9116022099447513, 'support': 360}, '1': {'precision': 0.8516483516483516, 'recall': 0.7110091743119266, 'f1-score': 0.7749999999999999, 'support': 218}, '2': {'precision': 0.8859649122807017, 'recall': 0.9351851851851852, 'f1-score': 0.9099099099099098, 'support': 108}, '3': {'precision': 0.7804878048780488, 'recall': 0.45714285714285713, 'f1-score': 0.5765765765765766, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8709677419354839, 'recall': 0.7714285714285715, 'f1-score': 0.8181818181818182, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.6643598615916955, 'recall': 0.8495575221238938, 'f1-score': 0.7456310679611651, 'support': 226}, '8': {'precision': 0.5824742268041238, 'recall': 0.6848484848484848, 'f1-score': 0.6295264623955432, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.43373493975903615, 'f1-score': 0.5625, 'support': 83}, '10': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7875271936185642, 'recall': 0.7757142857142857, 'f1-score': 0.7815761065131341, 'support': 1400}, 'macro avg': {'precision': 0.7438828395946498, 'recall': 0.6930515822708035, 'f1-score': 0.7082102905712322, 'support': 1400}, 'weighted avg': {'precision': 0.7937758756728306, 'recall': 0.7757142857142857, 'f1-score': 0.7755847140098167, 'support': 1400}, 'samples avg': {'precision': 0.7757142857142857, 'recall': 0.7757142857142857, 'f1-score': 0.7757142857142857, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 22s - loss: 0.1104 - acc: 0.9674 - precision: 0.9716 - recall: 0.9640 - val_loss: 1.1420 - val_acc: 0.7757 - val_precision: 0.7802 - val_recall: 0.7707 - 22s/epoch - 4ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8431372549019608, 'recall': 0.9247311827956989, 'f1-score': 0.882051282051282, 'support': 372}, '1': {'precision': 0.7947368421052632, 'recall': 0.6801801801801802, 'f1-score': 0.7330097087378641, 'support': 222}, '2': {'precision': 0.8369565217391305, 'recall': 0.875, 'f1-score': 0.8555555555555556, 'support': 88}, '3': {'precision': 0.6666666666666666, 'recall': 0.43137254901960786, 'f1-score': 0.5238095238095237, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.7894736842105263, 'recall': 0.625, 'f1-score': 0.6976744186046512, 'support': 24}, '7': {'precision': 0.6297297297297297, 'recall': 0.8961538461538462, 'f1-score': 0.7396825396825397, 'support': 260}, '8': {'precision': 0.6724137931034483, 'recall': 0.585, 'f1-score': 0.6256684491978609, 'support': 200}, '9': {'precision': 0.782608695652174, 'recall': 0.21686746987951808, 'f1-score': 0.339622641509434, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9629629629629629, 'recall': 0.7027027027027027, 'f1-score': 0.8125, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7538349159970782, 'recall': 0.7371428571428571, 'f1-score': 0.7453954496208017, 'support': 1400}, 'macro avg': {'precision': 0.7483604731593742, 'recall': 0.5702029371409535, 'f1-score': 0.6240131939804703, 'support': 1400}, 'weighted avg': {'precision': 0.7631977284458381, 'recall': 0.7371428571428571, 'f1-score': 0.7303587292972736, 'support': 1400}, 'samples avg': {'precision': 0.7371428571428571, 'recall': 0.7371428571428571, 'f1-score': 0.7371428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9090909090909091, 'recall': 0.9166666666666666, 'f1-score': 0.9128630705394191, 'support': 360}, '1': {'precision': 0.8555555555555555, 'recall': 0.7064220183486238, 'f1-score': 0.7738693467336683, 'support': 218}, '2': {'precision': 0.9207920792079208, 'recall': 0.8611111111111112, 'f1-score': 0.8899521531100479, 'support': 108}, '3': {'precision': 0.7560975609756098, 'recall': 0.44285714285714284, 'f1-score': 0.5585585585585585, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.8666666666666667, 'recall': 0.7647058823529411, 'f1-score': 0.8125, 'support': 51}, '7': {'precision': 0.6456953642384106, 'recall': 0.8628318584070797, 'f1-score': 0.7386363636363636, 'support': 226}, '8': {'precision': 0.56, 'recall': 0.6787878787878788, 'f1-score': 0.6136986301369864, 'support': 165}, '9': {'precision': 0.8157894736842105, 'recall': 0.37349397590361444, 'f1-score': 0.512396694214876, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7801879971077368, 'recall': 0.7707142857142857, 'f1-score': 0.7754222062522458, 'support': 1400}, 'macro avg': {'precision': 0.7431671108378185, 'recall': 0.6982260039896152, 'f1-score': 0.7084896726833587, 'support': 1400}, 'weighted avg': {'precision': 0.790792679840257, 'recall': 0.7707142857142857, 'f1-score': 0.7692768193884769, 'support': 1400}, 'samples avg': {'precision': 0.7707142857142857, 'recall': 0.7707142857142857, 'f1-score': 0.7707142857142857, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:22:06.016761: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:22:06.259533: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:22:07.773018: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:22:07.773226: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:22:07.773241: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:22:16.210504: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:22:16.664510: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    2layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_1 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_2 (Dropout)         (None, 128)               0         
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 94,755,597
Trainable params: 94,755,597
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 06:22:19.452678: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 40s - loss: 0.7510 - acc: 0.7804 - precision: 0.8493 - recall: 0.7258 - val_loss: 0.8105 - val_acc: 0.7886 - val_precision: 0.8093 - val_recall: 0.7671 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8282352941176471, 'recall': 0.946236559139785, 'f1-score': 0.8833124215809286, 'support': 372}, '1': {'precision': 0.8097826086956522, 'recall': 0.6711711711711712, 'f1-score': 0.7339901477832512, 'support': 222}, '2': {'precision': 0.8279569892473119, 'recall': 0.875, 'f1-score': 0.8508287292817679, 'support': 88}, '3': {'precision': 0.875, 'recall': 0.4117647058823529, 'f1-score': 0.56, 'support': 51}, '4': {'precision': 0.7333333333333333, 'recall': 0.39285714285714285, 'f1-score': 0.5116279069767441, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.8260869565217391, 'recall': 0.7916666666666666, 'f1-score': 0.8085106382978724, 'support': 24}, '7': {'precision': 0.6888217522658611, 'recall': 0.8769230769230769, 'f1-score': 0.7715736040609138, 'support': 260}, '8': {'precision': 0.6890243902439024, 'recall': 0.565, 'f1-score': 0.6208791208791208, 'support': 200}, '9': {'precision': 0.631578947368421, 'recall': 0.14457831325301204, 'f1-score': 0.2352941176470588, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.775187969924812, 'recall': 0.7364285714285714, 'f1-score': 0.7553113553113552, 'support': 1400}, 'macro avg': {'precision': 0.7517147026357486, 'recall': 0.5860706020517094, 'f1-score': 0.6333199648961934, 'support': 1400}, 'weighted avg': {'precision': 0.7717781240037034, 'recall': 0.7364285714285714, 'f1-score': 0.7342557347617895, 'support': 1400}, 'samples avg': {'precision': 0.7364285714285714, 'recall': 0.7364285714285714, 'f1-score': 0.7364285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.896551724137931, 'recall': 0.9388888888888889, 'f1-score': 0.9172320217096337, 'support': 360}, '1': {'precision': 0.8547486033519553, 'recall': 0.7018348623853211, 'f1-score': 0.7707808564231737, 'support': 218}, '2': {'precision': 0.9326923076923077, 'recall': 0.8981481481481481, 'f1-score': 0.9150943396226415, 'support': 108}, '3': {'precision': 0.8709677419354839, 'recall': 0.38571428571428573, 'f1-score': 0.5346534653465347, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8571428571428571, 'recall': 0.8571428571428571, 'f1-score': 0.8571428571428571, 'support': 35}, '6': {'precision': 0.8490566037735849, 'recall': 0.8823529411764706, 'f1-score': 0.8653846153846154, 'support': 51}, '7': {'precision': 0.7234848484848485, 'recall': 0.8451327433628318, 'f1-score': 0.7795918367346939, 'support': 226}, '8': {'precision': 0.5942857142857143, 'recall': 0.6303030303030303, 'f1-score': 0.6117647058823529, 'support': 165}, '9': {'precision': 0.725, 'recall': 0.3493975903614458, 'f1-score': 0.4715447154471545, 'support': 83}, '10': {'precision': 0.9090909090909091, 'recall': 0.7142857142857143, 'f1-score': 0.8, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8093443858327054, 'recall': 0.7671428571428571, 'f1-score': 0.7876787678767878, 'support': 1400}, 'macro avg': {'precision': 0.7610649992860978, 'recall': 0.6788623562420757, 'f1-score': 0.7056955482209193, 'support': 1400}, 'weighted avg': {'precision': 0.807315735144216, 'recall': 0.7671428571428571, 'f1-score': 0.7763691931894072, 'support': 1400}, 'samples avg': {'precision': 0.7671428571428571, 'recall': 0.7671428571428571, 'f1-score': 0.7671428571428571, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 37s - loss: 0.4537 - acc: 0.8620 - precision: 0.8887 - recall: 0.8372 - val_loss: 0.7988 - val_acc: 0.7900 - val_precision: 0.8072 - val_recall: 0.7807 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8398058252427184, 'recall': 0.9301075268817204, 'f1-score': 0.8826530612244897, 'support': 372}, '1': {'precision': 0.8144329896907216, 'recall': 0.7117117117117117, 'f1-score': 0.7596153846153846, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.7352941176470589, 'recall': 0.49019607843137253, 'f1-score': 0.588235294117647, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.6965944272445821, 'recall': 0.8653846153846154, 'f1-score': 0.7718696397941682, 'support': 260}, '8': {'precision': 0.68, 'recall': 0.595, 'f1-score': 0.6346666666666667, 'support': 200}, '9': {'precision': 0.7307692307692307, 'recall': 0.2289156626506024, 'f1-score': 0.3486238532110092, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7775314116777532, 'recall': 0.7514285714285714, 'f1-score': 0.7642571739920088, 'support': 1400}, 'macro avg': {'precision': 0.7538545126844399, 'recall': 0.6172321899862863, 'f1-score': 0.6637080610678818, 'support': 1400}, 'weighted avg': {'precision': 0.7759622578600603, 'recall': 0.7514285714285714, 'f1-score': 0.7501717141921255, 'support': 1400}, 'samples avg': {'precision': 0.7514285714285714, 'recall': 0.7514285714285714, 'f1-score': 0.7514285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9, 'recall': 0.925, 'f1-score': 0.9123287671232876, 'support': 360}, '1': {'precision': 0.859375, 'recall': 0.7568807339449541, 'f1-score': 0.8048780487804877, 'support': 218}, '2': {'precision': 0.8947368421052632, 'recall': 0.9444444444444444, 'f1-score': 0.918918918918919, 'support': 108}, '3': {'precision': 0.9428571428571428, 'recall': 0.4714285714285714, 'f1-score': 0.6285714285714287, 'support': 70}, '4': {'precision': 0.6666666666666666, 'recall': 0.7272727272727273, 'f1-score': 0.6956521739130435, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 0.925, 'recall': 0.7254901960784313, 'f1-score': 0.8131868131868133, 'support': 51}, '7': {'precision': 0.7294117647058823, 'recall': 0.8230088495575221, 'f1-score': 0.7733887733887734, 'support': 226}, '8': {'precision': 0.5641025641025641, 'recall': 0.6666666666666666, 'f1-score': 0.611111111111111, 'support': 165}, '9': {'precision': 0.8048780487804879, 'recall': 0.39759036144578314, 'f1-score': 0.532258064516129, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8072378138847858, 'recall': 0.7807142857142857, 'f1-score': 0.793754538852578, 'support': 1400}, 'macro avg': {'precision': 0.7670344162312162, 'recall': 0.7036003928638521, 'f1-score': 0.7220647543697234, 'support': 1400}, 'weighted avg': {'precision': 0.8126319603229692, 'recall': 0.7807142857142857, 'f1-score': 0.7866299179257947, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 37s - loss: 0.3765 - acc: 0.8806 - precision: 0.8973 - recall: 0.8650 - val_loss: 0.9818 - val_acc: 0.7729 - val_precision: 0.7832 - val_recall: 0.7614 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8317307692307693, 'recall': 0.9301075268817204, 'f1-score': 0.8781725888324873, 'support': 372}, '1': {'precision': 0.8313953488372093, 'recall': 0.6441441441441441, 'f1-score': 0.7258883248730964, 'support': 222}, '2': {'precision': 0.8604651162790697, 'recall': 0.8409090909090909, 'f1-score': 0.8505747126436781, 'support': 88}, '3': {'precision': 0.8928571428571429, 'recall': 0.49019607843137253, 'f1-score': 0.6329113924050633, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 0.8235294117647058, 'recall': 0.8235294117647058, 'f1-score': 0.8235294117647058, 'support': 17}, '6': {'precision': 0.85, 'recall': 0.7083333333333334, 'f1-score': 0.7727272727272727, 'support': 24}, '7': {'precision': 0.703125, 'recall': 0.8653846153846154, 'f1-score': 0.7758620689655172, 'support': 260}, '8': {'precision': 0.6205357142857143, 'recall': 0.695, 'f1-score': 0.6556603773584906, 'support': 200}, '9': {'precision': 0.6956521739130435, 'recall': 0.1927710843373494, 'f1-score': 0.30188679245283023, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7701317715959004, 'recall': 0.7514285714285714, 'f1-score': 0.7606652205350686, 'support': 1400}, 'macro avg': {'precision': 0.7509424002679572, 'recall': 0.6224999105622988, 'f1-score': 0.6629965504632711, 'support': 1400}, 'weighted avg': {'precision': 0.7744933401019619, 'recall': 0.7514285714285714, 'f1-score': 0.7467146265202204, 'support': 1400}, 'samples avg': {'precision': 0.7514285714285714, 'recall': 0.7514285714285714, 'f1-score': 0.7514285714285714, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9101123595505618, 'recall': 0.9, 'f1-score': 0.9050279329608939, 'support': 360}, '1': {'precision': 0.8780487804878049, 'recall': 0.6605504587155964, 'f1-score': 0.7539267015706806, 'support': 218}, '2': {'precision': 0.9494949494949495, 'recall': 0.8703703703703703, 'f1-score': 0.9082125603864735, 'support': 108}, '3': {'precision': 0.8857142857142857, 'recall': 0.44285714285714284, 'f1-score': 0.5904761904761905, 'support': 70}, '4': {'precision': 0.7272727272727273, 'recall': 0.7272727272727273, 'f1-score': 0.7272727272727273, 'support': 22}, '5': {'precision': 0.8205128205128205, 'recall': 0.9142857142857143, 'f1-score': 0.8648648648648648, 'support': 35}, '6': {'precision': 0.925, 'recall': 0.7254901960784313, 'f1-score': 0.8131868131868133, 'support': 51}, '7': {'precision': 0.7094339622641509, 'recall': 0.831858407079646, 'f1-score': 0.7657841140529532, 'support': 226}, '8': {'precision': 0.4859437751004016, 'recall': 0.7333333333333333, 'f1-score': 0.5845410628019323, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.3855421686746988, 'f1-score': 0.5203252032520325, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7832476120499633, 'recall': 0.7614285714285715, 'f1-score': 0.7721839913074973, 'support': 1400}, 'macro avg': {'precision': 0.7626801485441843, 'recall': 0.693451445334181, 'f1-score': 0.7120712647309426, 'support': 1400}, 'weighted avg': {'precision': 0.8067187751508652, 'recall': 0.7614285714285715, 'f1-score': 0.7693090295817181, 'support': 1400}, 'samples avg': {'precision': 0.7614285714285715, 'recall': 0.7614285714285715, 'f1-score': 0.7614285714285715, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 37s - loss: 0.3266 - acc: 0.8980 - precision: 0.9117 - recall: 0.8838 - val_loss: 0.9207 - val_acc: 0.7836 - val_precision: 0.7956 - val_recall: 0.7729 - 37s/epoch - 7ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8423645320197044, 'recall': 0.9193548387096774, 'f1-score': 0.8791773778920309, 'support': 372}, '1': {'precision': 0.8206521739130435, 'recall': 0.6801801801801802, 'f1-score': 0.7438423645320198, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.6829268292682927, 'recall': 0.5490196078431373, 'f1-score': 0.6086956521739131, 'support': 51}, '4': {'precision': 0.7, 'recall': 0.5, 'f1-score': 0.5833333333333334, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.7916666666666666, 'recall': 0.7916666666666666, 'f1-score': 0.7916666666666666, 'support': 24}, '7': {'precision': 0.7335526315789473, 'recall': 0.8576923076923076, 'f1-score': 0.7907801418439715, 'support': 260}, '8': {'precision': 0.6473429951690821, 'recall': 0.67, 'f1-score': 0.6584766584766584, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.18072289156626506, 'f1-score': 0.2912621359223301, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7799113737075333, 'recall': 0.7542857142857143, 'f1-score': 0.766884531590414, 'support': 1400}, 'macro avg': {'precision': 0.7453163016322372, 'recall': 0.6321815353415788, 'f1-score': 0.6682100099354039, 'support': 1400}, 'weighted avg': {'precision': 0.7792399828271477, 'recall': 0.7542857142857143, 'f1-score': 0.7526516837175466, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9047619047619048, 'recall': 0.8972222222222223, 'f1-score': 0.900976290097629, 'support': 360}, '1': {'precision': 0.8728323699421965, 'recall': 0.6926605504587156, 'f1-score': 0.7723785166240409, 'support': 218}, '2': {'precision': 0.9279279279279279, 'recall': 0.9537037037037037, 'f1-score': 0.9406392694063928, 'support': 108}, '3': {'precision': 0.75, 'recall': 0.5142857142857142, 'f1-score': 0.6101694915254237, 'support': 70}, '4': {'precision': 0.6538461538461539, 'recall': 0.7727272727272727, 'f1-score': 0.7083333333333333, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.7489711934156379, 'recall': 0.8053097345132744, 'f1-score': 0.7761194029850746, 'support': 226}, '8': {'precision': 0.5217391304347826, 'recall': 0.7272727272727273, 'f1-score': 0.6075949367088608, 'support': 165}, '9': {'precision': 0.7948717948717948, 'recall': 0.37349397590361444, 'f1-score': 0.5081967213114753, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7955882352941176, 'recall': 0.7728571428571429, 'f1-score': 0.7840579710144926, 'support': 1400}, 'macro avg': {'precision': 0.751912021663688, 'recall': 0.7115092327773596, 'f1-score': 0.7214035629686393, 'support': 1400}, 'weighted avg': {'precision': 0.8056683633696333, 'recall': 0.7728571428571429, 'f1-score': 0.7797005807660795, 'support': 1400}, 'samples avg': {'precision': 0.7728571428571429, 'recall': 0.7728571428571429, 'f1-score': 0.7728571428571429, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 38s - loss: 0.2757 - acc: 0.9142 - precision: 0.9252 - recall: 0.9028 - val_loss: 1.1554 - val_acc: 0.7671 - val_precision: 0.7783 - val_recall: 0.7621 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.7955056179775281, 'recall': 0.9516129032258065, 'f1-score': 0.8665850673194614, 'support': 372}, '1': {'precision': 0.8263473053892215, 'recall': 0.6216216216216216, 'f1-score': 0.7095115681233933, 'support': 222}, '2': {'precision': 0.8461538461538461, 'recall': 0.875, 'f1-score': 0.8603351955307262, 'support': 88}, '3': {'precision': 0.8, 'recall': 0.39215686274509803, 'f1-score': 0.5263157894736842, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.8260869565217391, 'recall': 0.7916666666666666, 'f1-score': 0.8085106382978724, 'support': 24}, '7': {'precision': 0.6815476190476191, 'recall': 0.8807692307692307, 'f1-score': 0.7684563758389262, 'support': 260}, '8': {'precision': 0.6458333333333334, 'recall': 0.62, 'f1-score': 0.6326530612244898, 'support': 200}, '9': {'precision': 0.7272727272727273, 'recall': 0.1927710843373494, 'f1-score': 0.30476190476190484, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7583941605839416, 'recall': 0.7421428571428571, 'f1-score': 0.7501805054151625, 'support': 1400}, 'macro avg': {'precision': 0.749102929282745, 'recall': 0.597941839543857, 'f1-score': 0.6421398080211878, 'support': 1400}, 'weighted avg': {'precision': 0.7628479614107185, 'recall': 0.7421428571428571, 'f1-score': 0.7321379717734593, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8682170542635659, 'recall': 0.9333333333333333, 'f1-score': 0.8995983935742972, 'support': 360}, '1': {'precision': 0.86875, 'recall': 0.6376146788990825, 'f1-score': 0.7354497354497354, 'support': 218}, '2': {'precision': 0.9230769230769231, 'recall': 0.8888888888888888, 'f1-score': 0.9056603773584906, 'support': 108}, '3': {'precision': 0.8421052631578947, 'recall': 0.45714285714285713, 'f1-score': 0.5925925925925926, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8648648648648649, 'recall': 0.9142857142857143, 'f1-score': 0.888888888888889, 'support': 35}, '6': {'precision': 0.8837209302325582, 'recall': 0.7450980392156863, 'f1-score': 0.8085106382978724, 'support': 51}, '7': {'precision': 0.6900369003690037, 'recall': 0.827433628318584, 'f1-score': 0.7525150905432595, 'support': 226}, '8': {'precision': 0.5136363636363637, 'recall': 0.6848484848484848, 'f1-score': 0.5870129870129871, 'support': 165}, '9': {'precision': 0.8, 'recall': 0.3855421686746988, 'f1-score': 0.5203252032520325, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7782640408460978, 'recall': 0.7621428571428571, 'f1-score': 0.7701190905810177, 'support': 1400}, 'macro avg': {'precision': 0.7594016972910278, 'recall': 0.6887184784713984, 'f1-score': 0.7104680307591593, 'support': 1400}, 'weighted avg': {'precision': 0.7911048355477476, 'recall': 0.7621428571428571, 'f1-score': 0.7636716530796268, 'support': 1400}, 'samples avg': {'precision': 0.7621428571428571, 'recall': 0.7621428571428571, 'f1-score': 0.7621428571428571, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:26:07.780361: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:26:08.028480: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:26:09.549748: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:26:09.549958: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:26:09.549975: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=False, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:26:18.022107: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:26:18.483365: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0

 Compiling model

            Chunked CLS
            embeddings  ------------------------> Encoder Model -> output
        
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                          Encoder ----> Max pooled ---> dense ---> 
                                    3layers                        |
                   Encoder Model =                                                |-->dense-->output
                                                                                  
                
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 cls_chunks_ (InputLayer)    [(None, None, 2560)]      0         
                                                                 
 transformer_encoder_1 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout (Dropout)           (None, None, 2560)        0         
                                                                 
 transformer_encoder_2 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 dropout_1 (Dropout)         (None, None, 2560)        0         
                                                                 
 transformer_encoder_3 (Tran  (None, None, 2560)       47213056  
 sformerEncoder)                                                 
                                                                 
 global_max_pooling1d (Globa  (None, 2560)             0         
 lMaxPooling1D)                                                  
                                                                 
 dropout_2 (Dropout)         (None, 2560)              0         
                                                                 
 dense (Dense)               (None, 128)               327808    
                                                                 
 dropout_3 (Dropout)         (None, 128)               0         
                                                                 
 dropout_4 (Dropout)         (None, 128)               0         
                                                                 
 dense_1 (Dense)             (None, 13)                1677      
                                                                 
=================================================================
Total params: 141,968,653
Trainable params: 141,968,653
Non-trainable params: 0
_________________________________________________________________
None
epoch 0 of 5 

2023-05-22 06:26:21.773470: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
5000/5000 - 55s - loss: 0.7517 - acc: 0.7828 - precision: 0.8421 - recall: 0.7298 - val_loss: 1.0750 - val_acc: 0.7307 - val_precision: 0.7457 - val_recall: 0.7121 - 55s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8257756563245824, 'recall': 0.9301075268817204, 'f1-score': 0.8748419721871049, 'support': 372}, '1': {'precision': 0.8076923076923077, 'recall': 0.6621621621621622, 'f1-score': 0.7277227722772278, 'support': 222}, '2': {'precision': 0.8105263157894737, 'recall': 0.875, 'f1-score': 0.8415300546448087, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.13725490196078433, 'f1-score': 0.24137931034482762, 'support': 51}, '4': {'precision': 0.7777777777777778, 'recall': 0.25, 'f1-score': 0.3783783783783784, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.17647058823529413, 'f1-score': 0.3, 'support': 17}, '6': {'precision': 0.9166666666666666, 'recall': 0.4583333333333333, 'f1-score': 0.611111111111111, 'support': 24}, '7': {'precision': 0.7207792207792207, 'recall': 0.8538461538461538, 'f1-score': 0.7816901408450705, 'support': 260}, '8': {'precision': 0.5345454545454545, 'recall': 0.735, 'f1-score': 0.6189473684210526, 'support': 200}, '9': {'precision': 0.9090909090909091, 'recall': 0.12048192771084337, 'f1-score': 0.21276595744680848, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.26666666666666666, 'f1-score': 0.4210526315789474, 'support': 15}, '11': {'precision': 0.9090909090909091, 'recall': 0.8108108108108109, 'f1-score': 0.8571428571428571, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7444771723122239, 'recall': 0.7221428571428572, 'f1-score': 0.7331399564902104, 'support': 1400}, 'macro avg': {'precision': 0.7855342475197923, 'recall': 0.4827795439698284, 'f1-score': 0.5281971195675534, 'support': 1400}, 'weighted avg': {'precision': 0.7771449481644899, 'recall': 0.7221428571428572, 'f1-score': 0.70460034282623, 'support': 1400}, 'samples avg': {'precision': 0.7221428571428572, 'recall': 0.7221428571428572, 'f1-score': 0.7221428571428572, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9019073569482289, 'recall': 0.9194444444444444, 'f1-score': 0.9105914718019257, 'support': 360}, '1': {'precision': 0.8430232558139535, 'recall': 0.6651376146788991, 'f1-score': 0.7435897435897436, 'support': 218}, '2': {'precision': 0.9056603773584906, 'recall': 0.8888888888888888, 'f1-score': 0.897196261682243, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.11428571428571428, 'f1-score': 0.20512820512820512, 'support': 70}, '4': {'precision': 0.9285714285714286, 'recall': 0.5909090909090909, 'f1-score': 0.7222222222222223, 'support': 22}, '5': {'precision': 1.0, 'recall': 0.34285714285714286, 'f1-score': 0.5106382978723404, 'support': 35}, '6': {'precision': 0.9583333333333334, 'recall': 0.45098039215686275, 'f1-score': 0.6133333333333333, 'support': 51}, '7': {'precision': 0.7542372881355932, 'recall': 0.7876106194690266, 'f1-score': 0.7705627705627707, 'support': 226}, '8': {'precision': 0.39263803680981596, 'recall': 0.7757575757575758, 'f1-score': 0.5213849287169042, 'support': 165}, '9': {'precision': 0.8260869565217391, 'recall': 0.2289156626506024, 'f1-score': 0.3584905660377358, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8918918918918919, 'recall': 0.868421052631579, 'f1-score': 0.88, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7456993268511594, 'recall': 0.7121428571428572, 'f1-score': 0.7285348922177567, 'support': 1400}, 'macro avg': {'precision': 0.793770507080857, 'recall': 0.5706863449572395, 'f1-score': 0.6137916651616362, 'support': 1400}, 'weighted avg': {'precision': 0.8079385401863469, 'recall': 0.7121428571428572, 'f1-score': 0.7153067600707828, 'support': 1400}, 'samples avg': {'precision': 0.7121428571428572, 'recall': 0.7121428571428572, 'f1-score': 0.7121428571428572, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 52s - loss: 0.4806 - acc: 0.8566 - precision: 0.8839 - recall: 0.8348 - val_loss: 0.8869 - val_acc: 0.7714 - val_precision: 0.7888 - val_recall: 0.7657 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8405797101449275, 'recall': 0.9354838709677419, 'f1-score': 0.8854961832061068, 'support': 372}, '1': {'precision': 0.7702702702702703, 'recall': 0.7702702702702703, 'f1-score': 0.7702702702702703, 'support': 222}, '2': {'precision': 0.8172043010752689, 'recall': 0.8636363636363636, 'f1-score': 0.8397790055248618, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.21568627450980393, 'f1-score': 0.3548387096774193, 'support': 51}, '4': {'precision': 0.8181818181818182, 'recall': 0.32142857142857145, 'f1-score': 0.46153846153846156, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.6803519061583577, 'recall': 0.8923076923076924, 'f1-score': 0.7720465890183028, 'support': 260}, '8': {'precision': 0.6927374301675978, 'recall': 0.62, 'f1-score': 0.6543535620052771, 'support': 200}, '9': {'precision': 0.8125, 'recall': 0.1566265060240964, 'f1-score': 0.26262626262626265, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9354838709677419, 'recall': 0.7837837837837838, 'f1-score': 0.8529411764705881, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7749077490774908, 'recall': 0.75, 'f1-score': 0.7622504537205081, 'support': 1400}, 'macro avg': {'precision': 0.7974853313050757, 'recall': 0.5812901809643206, 'f1-score': 0.6346697843434518, 'support': 1400}, 'weighted avg': {'precision': 0.7878629331700904, 'recall': 0.75, 'f1-score': 0.7391536547196217, 'support': 1400}, 'samples avg': {'precision': 0.75, 'recall': 0.75, 'f1-score': 0.75, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8967391304347826, 'recall': 0.9166666666666666, 'f1-score': 0.9065934065934065, 'support': 360}, '1': {'precision': 0.7953488372093023, 'recall': 0.7844036697247706, 'f1-score': 0.7898383371824479, 'support': 218}, '2': {'precision': 0.9150943396226415, 'recall': 0.8981481481481481, 'f1-score': 0.9065420560747663, 'support': 108}, '3': {'precision': 1.0, 'recall': 0.2571428571428571, 'f1-score': 0.40909090909090906, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.9459459459459459, 'recall': 0.6862745098039216, 'f1-score': 0.7954545454545455, 'support': 51}, '7': {'precision': 0.7032967032967034, 'recall': 0.8495575221238938, 'f1-score': 0.7695390781563126, 'support': 226}, '8': {'precision': 0.5544554455445545, 'recall': 0.6787878787878788, 'f1-score': 0.6103542234332425, 'support': 165}, '9': {'precision': 0.8620689655172413, 'recall': 0.30120481927710846, 'f1-score': 0.44642857142857145, 'support': 83}, '10': {'precision': 0.8, 'recall': 0.8571428571428571, 'f1-score': 0.8275862068965518, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7888153053715967, 'recall': 0.7657142857142857, 'f1-score': 0.7770931496919172, 'support': 1400}, 'macro avg': {'precision': 0.7658679000695774, 'recall': 0.6698831811799193, 'f1-score': 0.6877074915804307, 'support': 1400}, 'weighted avg': {'precision': 0.8039529711822445, 'recall': 0.7657142857142857, 'f1-score': 0.7631436449455694, 'support': 1400}, 'samples avg': {'precision': 0.7657142857142857, 'recall': 0.7657142857142857, 'f1-score': 0.7657142857142857, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 52s - loss: 0.4103 - acc: 0.8762 - precision: 0.8950 - recall: 0.8538 - val_loss: 0.9875 - val_acc: 0.7714 - val_precision: 0.7870 - val_recall: 0.7600 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8175519630484989, 'recall': 0.9516129032258065, 'f1-score': 0.8795031055900622, 'support': 372}, '1': {'precision': 0.8390804597701149, 'recall': 0.6576576576576577, 'f1-score': 0.7373737373737375, 'support': 222}, '2': {'precision': 0.8191489361702128, 'recall': 0.875, 'f1-score': 0.8461538461538463, 'support': 88}, '3': {'precision': 0.9047619047619048, 'recall': 0.37254901960784315, 'f1-score': 0.5277777777777779, 'support': 51}, '4': {'precision': 0.8461538461538461, 'recall': 0.39285714285714285, 'f1-score': 0.5365853658536585, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.5294117647058824, 'f1-score': 0.6923076923076924, 'support': 17}, '6': {'precision': 1.0, 'recall': 0.625, 'f1-score': 0.7692307692307693, 'support': 24}, '7': {'precision': 0.7194719471947195, 'recall': 0.8384615384615385, 'f1-score': 0.7744227353463587, 'support': 260}, '8': {'precision': 0.6098654708520179, 'recall': 0.68, 'f1-score': 0.6430260047281323, 'support': 200}, '9': {'precision': 0.75, 'recall': 0.25301204819277107, 'f1-score': 0.3783783783783783, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7715549005158437, 'recall': 0.7478571428571429, 'f1-score': 0.7595212187159958, 'support': 1400}, 'macro avg': {'precision': 0.7859845564487438, 'recall': 0.5907743522471651, 'f1-score': 0.6506152961046255, 'support': 1400}, 'weighted avg': {'precision': 0.7809618272141631, 'recall': 0.7478571428571429, 'f1-score': 0.7451256187681173, 'support': 1400}, 'samples avg': {'precision': 0.7478571428571429, 'recall': 0.7478571428571429, 'f1-score': 0.7478571428571429, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8891820580474934, 'recall': 0.9361111111111111, 'f1-score': 0.912043301759134, 'support': 360}, '1': {'precision': 0.8827160493827161, 'recall': 0.6559633027522935, 'f1-score': 0.7526315789473684, 'support': 218}, '2': {'precision': 0.8918918918918919, 'recall': 0.9166666666666666, 'f1-score': 0.9041095890410958, 'support': 108}, '3': {'precision': 0.9333333333333333, 'recall': 0.4, 'f1-score': 0.5599999999999999, 'support': 70}, '4': {'precision': 0.7777777777777778, 'recall': 0.6363636363636364, 'f1-score': 0.7000000000000001, 'support': 22}, '5': {'precision': 0.8620689655172413, 'recall': 0.7142857142857143, 'f1-score': 0.7812500000000001, 'support': 35}, '6': {'precision': 0.9473684210526315, 'recall': 0.7058823529411765, 'f1-score': 0.8089887640449439, 'support': 51}, '7': {'precision': 0.7521367521367521, 'recall': 0.7787610619469026, 'f1-score': 0.765217391304348, 'support': 226}, '8': {'precision': 0.48148148148148145, 'recall': 0.7090909090909091, 'f1-score': 0.5735294117647058, 'support': 165}, '9': {'precision': 0.7777777777777778, 'recall': 0.5060240963855421, 'f1-score': 0.6131386861313868, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.85, 'recall': 0.8947368421052632, 'f1-score': 0.8717948717948718, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7869822485207101, 'recall': 0.76, 'f1-score': 0.7732558139534884, 'support': 1400}, 'macro avg': {'precision': 0.7672543028438865, 'recall': 0.6755736247862034, 'f1-score': 0.7054826941045603, 'support': 1400}, 'weighted avg': {'precision': 0.8064839412007087, 'recall': 0.76, 'f1-score': 0.7698896320568673, 'support': 1400}, 'samples avg': {'precision': 0.76, 'recall': 0.76, 'f1-score': 0.76, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 52s - loss: 0.3579 - acc: 0.8922 - precision: 0.9112 - recall: 0.8764 - val_loss: 0.9925 - val_acc: 0.7907 - val_precision: 0.7999 - val_recall: 0.7821 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8450363196125908, 'recall': 0.9381720430107527, 'f1-score': 0.8891719745222931, 'support': 372}, '1': {'precision': 0.7978723404255319, 'recall': 0.6756756756756757, 'f1-score': 0.7317073170731708, 'support': 222}, '2': {'precision': 0.79, 'recall': 0.8977272727272727, 'f1-score': 0.8404255319148937, 'support': 88}, '3': {'precision': 0.9047619047619048, 'recall': 0.37254901960784315, 'f1-score': 0.5277777777777779, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.696319018404908, 'recall': 0.8730769230769231, 'f1-score': 0.7747440273037542, 'support': 260}, '8': {'precision': 0.6428571428571429, 'recall': 0.675, 'f1-score': 0.6585365853658537, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.24096385542168675, 'f1-score': 0.37037037037037035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.7333333333333333, 'f1-score': 0.846153846153846, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.772992700729927, 'recall': 0.7564285714285715, 'f1-score': 0.7646209386281588, 'support': 1400}, 'macro avg': {'precision': 0.7740409134036329, 'recall': 0.6129288812684343, 'f1-score': 0.661416249231213, 'support': 1400}, 'weighted avg': {'precision': 0.7807916317284266, 'recall': 0.7564285714285715, 'f1-score': 0.7497835858792892, 'support': 1400}, 'samples avg': {'precision': 0.7564285714285715, 'recall': 0.7564285714285715, 'f1-score': 0.7564285714285715, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9106145251396648, 'recall': 0.9055555555555556, 'f1-score': 0.9080779944289693, 'support': 360}, '1': {'precision': 0.8541666666666666, 'recall': 0.7522935779816514, 'f1-score': 0.8, 'support': 218}, '2': {'precision': 0.9017857142857143, 'recall': 0.9351851851851852, 'f1-score': 0.9181818181818182, 'support': 108}, '3': {'precision': 0.9090909090909091, 'recall': 0.42857142857142855, 'f1-score': 0.5825242718446602, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8421052631578947, 'recall': 0.9142857142857143, 'f1-score': 0.8767123287671234, 'support': 35}, '6': {'precision': 0.9473684210526315, 'recall': 0.7058823529411765, 'f1-score': 0.8089887640449439, 'support': 51}, '7': {'precision': 0.74, 'recall': 0.8185840707964602, 'f1-score': 0.7773109243697479, 'support': 226}, '8': {'precision': 0.5283842794759825, 'recall': 0.7333333333333333, 'f1-score': 0.6142131979695432, 'support': 165}, '9': {'precision': 0.7872340425531915, 'recall': 0.4457831325301205, 'f1-score': 0.5692307692307692, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.799853907962016, 'recall': 0.7821428571428571, 'f1-score': 0.7908992416034669, 'support': 1400}, 'macro avg': {'precision': 0.7726198532384114, 'recall': 0.706927334548465, 'f1-score': 0.7261887001091561, 'support': 1400}, 'weighted avg': {'precision': 0.8122943489232114, 'recall': 0.7821428571428571, 'f1-score': 0.7865837693149493, 'support': 1400}, 'samples avg': {'precision': 0.7821428571428571, 'recall': 0.7821428571428571, 'f1-score': 0.7821428571428571, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 52s - loss: 0.3042 - acc: 0.9066 - precision: 0.9207 - recall: 0.8966 - val_loss: 1.0565 - val_acc: 0.7807 - val_precision: 0.7913 - val_recall: 0.7771 - 52s/epoch - 10ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.854320987654321, 'recall': 0.9301075268817204, 'f1-score': 0.8906048906048905, 'support': 372}, '1': {'precision': 0.8212290502793296, 'recall': 0.6621621621621622, 'f1-score': 0.7331670822942644, 'support': 222}, '2': {'precision': 0.8144329896907216, 'recall': 0.8977272727272727, 'f1-score': 0.8540540540540541, 'support': 88}, '3': {'precision': 0.7428571428571429, 'recall': 0.5098039215686274, 'f1-score': 0.6046511627906976, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.5357142857142857, 'f1-score': 0.6250000000000001, 'support': 28}, '5': {'precision': 0.8, 'recall': 0.7058823529411765, 'f1-score': 0.7500000000000001, 'support': 17}, '6': {'precision': 0.8888888888888888, 'recall': 0.6666666666666666, 'f1-score': 0.761904761904762, 'support': 24}, '7': {'precision': 0.7119741100323624, 'recall': 0.8461538461538461, 'f1-score': 0.773286467486819, 'support': 260}, '8': {'precision': 0.6177777777777778, 'recall': 0.695, 'f1-score': 0.6541176470588234, 'support': 200}, '9': {'precision': 0.7777777777777778, 'recall': 0.25301204819277107, 'f1-score': 0.3818181818181818, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6, 'f1-score': 0.7499999999999999, 'support': 15}, '11': {'precision': 0.9375, 'recall': 0.8108108108108109, 'f1-score': 0.8695652173913043, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7731582786287381, 'recall': 0.7571428571428571, 'f1-score': 0.7650667629014796, 'support': 1400}, 'macro avg': {'precision': 0.7474429788429477, 'recall': 0.6240800687553337, 'f1-score': 0.6652438050310614, 'support': 1400}, 'weighted avg': {'precision': 0.7775152050005537, 'recall': 0.7571428571428571, 'f1-score': 0.7539933035799055, 'support': 1400}, 'samples avg': {'precision': 0.7571428571428571, 'recall': 0.7571428571428571, 'f1-score': 0.7571428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9042253521126761, 'recall': 0.8916666666666667, 'f1-score': 0.8979020979020979, 'support': 360}, '1': {'precision': 0.8548387096774194, 'recall': 0.7293577981651376, 'f1-score': 0.7871287128712872, 'support': 218}, '2': {'precision': 0.9074074074074074, 'recall': 0.9074074074074074, 'f1-score': 0.9074074074074074, 'support': 108}, '3': {'precision': 0.7708333333333334, 'recall': 0.5285714285714286, 'f1-score': 0.6271186440677967, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8461538461538461, 'recall': 0.9428571428571428, 'f1-score': 0.8918918918918919, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7669491525423728, 'recall': 0.8008849557522124, 'f1-score': 0.7835497835497836, 'support': 226}, '8': {'precision': 0.502092050209205, 'recall': 0.7272727272727273, 'f1-score': 0.594059405940594, 'support': 165}, '9': {'precision': 0.7916666666666666, 'recall': 0.4578313253012048, 'f1-score': 0.5801526717557252, 'support': 83}, '10': {'precision': 0.9285714285714286, 'recall': 0.9285714285714286, 'f1-score': 0.9285714285714286, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7912727272727272, 'recall': 0.7771428571428571, 'f1-score': 0.7841441441441442, 'support': 1400}, 'macro avg': {'precision': 0.7540330171782195, 'recall': 0.7159519378058712, 'f1-score': 0.7267636131918648, 'support': 1400}, 'weighted avg': {'precision': 0.8034716828625299, 'recall': 0.7771428571428571, 'f1-score': 0.7828171448562984, 'support': 1400}, 'samples avg': {'precision': 0.7771428571428571, 'recall': 0.7771428571428571, 'f1-score': 0.7771428571428571, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 2 --verbose 2 --epochs 5 --num_layers 2 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:31:35.625726: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:31:35.876226: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:31:37.333374: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:31:37.333590: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:31:37.333606: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=2, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=2, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:31:45.220822: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:31:45.694948: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78796 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3366215.09it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3167219.85it/s]
Mon May 22 06:31:49 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:31:53.323576: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:38 25/148 [====>.........................] - ETA: 0s   49/148 [========>.....................] - ETA: 0s 73/148 [=============>................] - ETA: 0s 99/148 [===================>..........] - ETA: 0s127/148 [========================>.....] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2293975.06it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2553054.61it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2750724.03it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 81703.61it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2597092.26it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 81719.35it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3037778.38it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2992877.47it/s]
Mon May 22 06:31:55 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s21/44 [=============>................] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 1s18/44 [===========>..................] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2149350.51it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2340384.85it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2595944.12it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 81981.76it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2586795.42it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83469.92it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               2 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_2[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_2 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_2[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_3 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_3[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_4 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_4[0][0]']              
                                                                                                  
==================================================================================================
Total params: 94,776,589
Trainable params: 94,776,589
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 40s - loss: 0.7104 - acc: 0.7918 - precision: 0.8594 - recall: 0.7240 - val_loss: 0.8266 - val_acc: 0.7793 - val_precision: 0.8009 - val_recall: 0.7671 - 40s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8169014084507042, 'recall': 0.9354838709677419, 'f1-score': 0.8721804511278196, 'support': 372}, '1': {'precision': 0.7794117647058824, 'recall': 0.7162162162162162, 'f1-score': 0.7464788732394366, 'support': 222}, '2': {'precision': 0.797979797979798, 'recall': 0.8977272727272727, 'f1-score': 0.8449197860962567, 'support': 88}, '3': {'precision': 1.0, 'recall': 0.2549019607843137, 'f1-score': 0.40625, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.2857142857142857, 'f1-score': 0.4210526315789473, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.8333333333333334, 'recall': 0.8333333333333334, 'f1-score': 0.8333333333333334, 'support': 24}, '7': {'precision': 0.7184466019417476, 'recall': 0.8538461538461538, 'f1-score': 0.7803163444639718, 'support': 260}, '8': {'precision': 0.6205128205128205, 'recall': 0.605, 'f1-score': 0.6126582278481012, 'support': 200}, '9': {'precision': 0.6923076923076923, 'recall': 0.21686746987951808, 'f1-score': 0.33027522935779813, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.06666666666666667, 'f1-score': 0.125, 'support': 15}, '11': {'precision': 0.967741935483871, 'recall': 0.8108108108108109, 'f1-score': 0.8823529411764706, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7635285396590067, 'recall': 0.7357142857142858, 'f1-score': 0.7493634048744998, 'support': 1400}, 'macro avg': {'precision': 0.77127964267045, 'recall': 0.5479712972673635, 'f1-score': 0.58773323876434, 'support': 1400}, 'weighted avg': {'precision': 0.769075449008893, 'recall': 0.7357142857142858, 'f1-score': 0.7269546738478624, 'support': 1400}, 'samples avg': {'precision': 0.7357142857142858, 'recall': 0.7357142857142858, 'f1-score': 0.7357142857142858, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8962765957446809, 'recall': 0.9361111111111111, 'f1-score': 0.9157608695652175, 'support': 360}, '1': {'precision': 0.8375634517766497, 'recall': 0.7568807339449541, 'f1-score': 0.7951807228915663, 'support': 218}, '2': {'precision': 0.875, 'recall': 0.9074074074074074, 'f1-score': 0.8909090909090909, 'support': 108}, '3': {'precision': 0.9090909090909091, 'recall': 0.2857142857142857, 'f1-score': 0.43478260869565216, 'support': 70}, '4': {'precision': 0.8823529411764706, 'recall': 0.6818181818181818, 'f1-score': 0.7692307692307693, 'support': 22}, '5': {'precision': 0.8484848484848485, 'recall': 0.8, 'f1-score': 0.823529411764706, 'support': 35}, '6': {'precision': 0.875, 'recall': 0.8235294117647058, 'f1-score': 0.8484848484848485, 'support': 51}, '7': {'precision': 0.7510204081632653, 'recall': 0.8141592920353983, 'f1-score': 0.7813163481953291, 'support': 226}, '8': {'precision': 0.5414634146341464, 'recall': 0.6727272727272727, 'f1-score': 0.6, 'support': 165}, '9': {'precision': 0.7804878048780488, 'recall': 0.3855421686746988, 'f1-score': 0.5161290322580645, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5714285714285714, 'f1-score': 0.7272727272727273, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8008948545861297, 'recall': 0.7671428571428571, 'f1-score': 0.7836556001459322, 'support': 1400}, 'macro avg': {'precision': 0.7781276379129184, 'recall': 0.6561580983639885, 'f1-score': 0.6930202381488182, 'support': 1400}, 'weighted avg': {'precision': 0.8070642766985283, 'recall': 0.7671428571428571, 'f1-score': 0.7726764032521438, 'support': 1400}, 'samples avg': {'precision': 0.7671428571428571, 'recall': 0.7671428571428571, 'f1-score': 0.7671428571428571, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 39s - loss: 0.4361 - acc: 0.8646 - precision: 0.8863 - recall: 0.8450 - val_loss: 0.8988 - val_acc: 0.7743 - val_precision: 0.7909 - val_recall: 0.7700 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8553615960099751, 'recall': 0.9220430107526881, 'f1-score': 0.8874514877102199, 'support': 372}, '1': {'precision': 0.8195876288659794, 'recall': 0.7162162162162162, 'f1-score': 0.764423076923077, 'support': 222}, '2': {'precision': 0.8041237113402062, 'recall': 0.8863636363636364, 'f1-score': 0.8432432432432433, 'support': 88}, '3': {'precision': 0.8571428571428571, 'recall': 0.47058823529411764, 'f1-score': 0.6075949367088607, 'support': 51}, '4': {'precision': 0.7333333333333333, 'recall': 0.39285714285714285, 'f1-score': 0.5116279069767441, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.7189542483660131, 'recall': 0.8461538461538461, 'f1-score': 0.7773851590106007, 'support': 260}, '8': {'precision': 0.6063348416289592, 'recall': 0.67, 'f1-score': 0.6365795724465557, 'support': 200}, '9': {'precision': 0.7727272727272727, 'recall': 0.20481927710843373, 'f1-score': 0.3238095238095238, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7774502579218865, 'recall': 0.7535714285714286, 'f1-score': 0.7653246282190787, 'support': 1400}, 'macro avg': {'precision': 0.7693612516087538, 'recall': 0.6117885962771943, 'f1-score': 0.6608342851954944, 'support': 1400}, 'weighted avg': {'precision': 0.7826544067678117, 'recall': 0.7535714285714286, 'f1-score': 0.7518433857755662, 'support': 1400}, 'samples avg': {'precision': 0.7535714285714286, 'recall': 0.7535714285714286, 'f1-score': 0.7535714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9118457300275482, 'recall': 0.9194444444444444, 'f1-score': 0.9156293222683265, 'support': 360}, '1': {'precision': 0.842391304347826, 'recall': 0.7110091743119266, 'f1-score': 0.7711442786069651, 'support': 218}, '2': {'precision': 0.9090909090909091, 'recall': 0.9259259259259259, 'f1-score': 0.9174311926605504, 'support': 108}, '3': {'precision': 0.8823529411764706, 'recall': 0.42857142857142855, 'f1-score': 0.5769230769230769, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.8974358974358975, 'recall': 0.6862745098039216, 'f1-score': 0.7777777777777778, 'support': 51}, '7': {'precision': 0.7411764705882353, 'recall': 0.8362831858407079, 'f1-score': 0.7858627858627859, 'support': 226}, '8': {'precision': 0.4936708860759494, 'recall': 0.7090909090909091, 'f1-score': 0.582089552238806, 'support': 165}, '9': {'precision': 0.8378378378378378, 'recall': 0.37349397590361444, 'f1-score': 0.5166666666666666, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7909024211298606, 'recall': 0.77, 'f1-score': 0.7803112558812885, 'support': 1400}, 'macro avg': {'precision': 0.7677035893710147, 'recall': 0.6789529875043526, 'f1-score': 0.706684601024135, 'support': 1400}, 'weighted avg': {'precision': 0.8074356539978303, 'recall': 0.77, 'f1-score': 0.7753080765231389, 'support': 1400}, 'samples avg': {'precision': 0.77, 'recall': 0.77, 'f1-score': 0.77, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 39s - loss: 0.3688 - acc: 0.8848 - precision: 0.9051 - recall: 0.8678 - val_loss: 0.8655 - val_acc: 0.7929 - val_precision: 0.8097 - val_recall: 0.7843 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8087557603686636, 'recall': 0.9435483870967742, 'f1-score': 0.870967741935484, 'support': 372}, '1': {'precision': 0.8010204081632653, 'recall': 0.7072072072072072, 'f1-score': 0.7511961722488039, 'support': 222}, '2': {'precision': 0.8061224489795918, 'recall': 0.8977272727272727, 'f1-score': 0.849462365591398, 'support': 88}, '3': {'precision': 0.875, 'recall': 0.4117647058823529, 'f1-score': 0.56, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 0.875, 'recall': 0.8235294117647058, 'f1-score': 0.8484848484848485, 'support': 17}, '6': {'precision': 0.8571428571428571, 'recall': 0.75, 'f1-score': 0.7999999999999999, 'support': 24}, '7': {'precision': 0.7175324675324676, 'recall': 0.85, 'f1-score': 0.7781690140845071, 'support': 260}, '8': {'precision': 0.6878612716763006, 'recall': 0.595, 'f1-score': 0.6380697050938338, 'support': 200}, '9': {'precision': 0.782608695652174, 'recall': 0.21686746987951808, 'f1-score': 0.339622641509434, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7776130467012602, 'recall': 0.7492857142857143, 'f1-score': 0.7631866133139324, 'support': 1400}, 'macro avg': {'precision': 0.7638303007319477, 'recall': 0.6150297734077255, 'f1-score': 0.6596638409964293, 'support': 1400}, 'weighted avg': {'precision': 0.7790177465598948, 'recall': 0.7492857142857143, 'f1-score': 0.7462735224675419, 'support': 1400}, 'samples avg': {'precision': 0.7492857142857143, 'recall': 0.7492857142857143, 'f1-score': 0.7492857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8848167539267016, 'recall': 0.9388888888888889, 'f1-score': 0.9110512129380054, 'support': 360}, '1': {'precision': 0.8601036269430051, 'recall': 0.7614678899082569, 'f1-score': 0.8077858880778588, 'support': 218}, '2': {'precision': 0.9009009009009009, 'recall': 0.9259259259259259, 'f1-score': 0.91324200913242, 'support': 108}, '3': {'precision': 0.8918918918918919, 'recall': 0.4714285714285714, 'f1-score': 0.6168224299065421, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.8888888888888888, 'recall': 0.7843137254901961, 'f1-score': 0.8333333333333334, 'support': 51}, '7': {'precision': 0.744, 'recall': 0.8230088495575221, 'f1-score': 0.7815126050420168, 'support': 226}, '8': {'precision': 0.5736842105263158, 'recall': 0.6606060606060606, 'f1-score': 0.6140845070422535, 'support': 165}, '9': {'precision': 0.8333333333333334, 'recall': 0.42168674698795183, 'f1-score': 0.56, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8097345132743363, 'recall': 0.7842857142857143, 'f1-score': 0.7968069666182874, 'support': 1400}, 'macro avg': {'precision': 0.7704872797870255, 'recall': 0.6950238657034917, 'f1-score': 0.7208877770704478, 'support': 1400}, 'weighted avg': {'precision': 0.8118530894743204, 'recall': 0.7842857142857143, 'f1-score': 0.7892084738932389, 'support': 1400}, 'samples avg': {'precision': 0.7842857142857143, 'recall': 0.7842857142857143, 'f1-score': 0.7842857142857143, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 39s - loss: 0.3050 - acc: 0.9010 - precision: 0.9165 - recall: 0.8890 - val_loss: 0.9306 - val_acc: 0.7893 - val_precision: 0.8024 - val_recall: 0.7800 - 39s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8250591016548463, 'recall': 0.9381720430107527, 'f1-score': 0.8779874213836477, 'support': 372}, '1': {'precision': 0.7929292929292929, 'recall': 0.7072072072072072, 'f1-score': 0.7476190476190476, 'support': 222}, '2': {'precision': 0.8144329896907216, 'recall': 0.8977272727272727, 'f1-score': 0.8540540540540541, 'support': 88}, '3': {'precision': 0.7222222222222222, 'recall': 0.5098039215686274, 'f1-score': 0.5977011494252873, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6834319526627219, 'recall': 0.8884615384615384, 'f1-score': 0.7725752508361203, 'support': 260}, '8': {'precision': 0.7088607594936709, 'recall': 0.56, 'f1-score': 0.6256983240223464, 'support': 200}, '9': {'precision': 0.76, 'recall': 0.2289156626506024, 'f1-score': 0.35185185185185186, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7724945135332846, 'recall': 0.7542857142857143, 'f1-score': 0.7632815323455007, 'support': 1400}, 'macro avg': {'precision': 0.7559552471146641, 'recall': 0.624099503899287, 'f1-score': 0.668365624824273, 'support': 1400}, 'weighted avg': {'precision': 0.7731148599706292, 'recall': 0.7542857142857143, 'f1-score': 0.7479996488367495, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8909574468085106, 'recall': 0.9305555555555556, 'f1-score': 0.9103260869565218, 'support': 360}, '1': {'precision': 0.8367346938775511, 'recall': 0.7522935779816514, 'f1-score': 0.7922705314009661, 'support': 218}, '2': {'precision': 0.9017857142857143, 'recall': 0.9351851851851852, 'f1-score': 0.9181818181818182, 'support': 108}, '3': {'precision': 0.75, 'recall': 0.5142857142857142, 'f1-score': 0.6101694915254237, 'support': 70}, '4': {'precision': 0.7083333333333334, 'recall': 0.7727272727272727, 'f1-score': 0.7391304347826088, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7203065134099617, 'recall': 0.831858407079646, 'f1-score': 0.7720739219712526, 'support': 226}, '8': {'precision': 0.5921787709497207, 'recall': 0.6424242424242425, 'f1-score': 0.616279069767442, 'support': 165}, '9': {'precision': 0.825, 'recall': 0.39759036144578314, 'f1-score': 0.5365853658536586, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8023512123438648, 'recall': 0.78, 'f1-score': 0.791017747193046, 'support': 1400}, 'macro avg': {'precision': 0.7555901935016512, 'recall': 0.6986816646602332, 'f1-score': 0.7181153701713179, 'support': 1400}, 'weighted avg': {'precision': 0.8009443793516318, 'recall': 0.78, 'f1-score': 0.7832999160654724, 'support': 1400}, 'samples avg': {'precision': 0.78, 'recall': 0.78, 'f1-score': 0.78, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 38s - loss: 0.2623 - acc: 0.9178 - precision: 0.9269 - recall: 0.9074 - val_loss: 1.0411 - val_acc: 0.7814 - val_precision: 0.7934 - val_recall: 0.7736 - 38s/epoch - 8ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8386308068459658, 'recall': 0.9220430107526881, 'f1-score': 0.8783610755441742, 'support': 372}, '1': {'precision': 0.8, 'recall': 0.6666666666666666, 'f1-score': 0.7272727272727272, 'support': 222}, '2': {'precision': 0.8144329896907216, 'recall': 0.8977272727272727, 'f1-score': 0.8540540540540541, 'support': 88}, '3': {'precision': 0.7352941176470589, 'recall': 0.49019607843137253, 'f1-score': 0.588235294117647, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.6695402298850575, 'recall': 0.8961538461538462, 'f1-score': 0.7664473684210527, 'support': 260}, '8': {'precision': 0.6410256410256411, 'recall': 0.625, 'f1-score': 0.6329113924050633, 'support': 200}, '9': {'precision': 0.7727272727272727, 'recall': 0.20481927710843373, 'f1-score': 0.3238095238095238, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7618353969410051, 'recall': 0.7471428571428571, 'f1-score': 0.7544175982690227, 'support': 1400}, 'macro avg': {'precision': 0.7567777179876783, 'recall': 0.5953490316023355, 'f1-score': 0.6451008302600704, 'support': 1400}, 'weighted avg': {'precision': 0.76794266316125, 'recall': 0.7471428571428571, 'f1-score': 0.7395068023552918, 'support': 1400}, 'samples avg': {'precision': 0.7471428571428571, 'recall': 0.7471428571428571, 'f1-score': 0.7471428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9098591549295775, 'recall': 0.8972222222222223, 'f1-score': 0.9034965034965036, 'support': 360}, '1': {'precision': 0.8707865168539326, 'recall': 0.7110091743119266, 'f1-score': 0.7828282828282828, 'support': 218}, '2': {'precision': 0.9017857142857143, 'recall': 0.9351851851851852, 'f1-score': 0.9181818181818182, 'support': 108}, '3': {'precision': 0.782608695652174, 'recall': 0.5142857142857142, 'f1-score': 0.6206896551724138, 'support': 70}, '4': {'precision': 0.8, 'recall': 0.7272727272727273, 'f1-score': 0.761904761904762, 'support': 22}, '5': {'precision': 0.8611111111111112, 'recall': 0.8857142857142857, 'f1-score': 0.8732394366197184, 'support': 35}, '6': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 51}, '7': {'precision': 0.7058823529411765, 'recall': 0.8495575221238938, 'f1-score': 0.7710843373493975, 'support': 226}, '8': {'precision': 0.5373831775700935, 'recall': 0.696969696969697, 'f1-score': 0.6068601583113457, 'support': 165}, '9': {'precision': 0.7804878048780488, 'recall': 0.3855421686746988, 'f1-score': 0.5161290322580645, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7934065934065934, 'recall': 0.7735714285714286, 'f1-score': 0.7833634719710669, 'support': 1400}, 'macro avg': {'precision': 0.7590656343208113, 'recall': 0.6969631345345884, 'f1-score': 0.7174169044713907, 'support': 1400}, 'weighted avg': {'precision': 0.8024296001236128, 'recall': 0.7735714285714286, 'f1-score': 0.7784936330194628, 'support': 1400}, 'samples avg': {'precision': 0.7735714285714286, 'recall': 0.7735714285714286, 'f1-score': 0.7735714285714286, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 3 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:36:05.934022: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:36:06.168917: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:36:07.731403: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:36:07.731624: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:36:07.731640: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=3, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:36:17.708912: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:36:18.183088: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3397297.91it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3108536.58it/s]
Mon May 22 06:36:21 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:36:25.244416: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:38 26/148 [====>.........................] - ETA: 0s   53/148 [=========>....................] - ETA: 0s 79/148 [===============>..............] - ETA: 0s107/148 [====================>.........] - ETA: 0s135/148 [==========================>...] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2268172.18it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2583381.26it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2728890.05it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 81849.02it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2441590.69it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82832.92it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3050402.91it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3033071.07it/s]
Mon May 22 06:36:27 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s20/44 [============>.................] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 1s19/44 [===========>..................] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2051004.40it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2300049.20it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2533229.34it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82253.93it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2532136.96it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82871.50it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               3 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder_1 (Transfo  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_1 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_1[0][0]']  
                                                                                                  
 transformer_encoder_2 (Transfo  (None, None, 2560)  47213056    ['dropout_1[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 dropout_2 (Dropout)            (None, None, 2560)   0           ['transformer_encoder_2[0][0]']  
                                                                                                  
 transformer_encoder_3 (Transfo  (None, None, 2560)  47213056    ['dropout_2[0][0]']              
 rmerEncoder)                                                                                     
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder_3[0][0]']  
 xPooling1D)                                                                                      
                                                                                                  
 dropout_3 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_3[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_4 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_4[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dropout_5 (Dropout)            (None, 256)          0           ['concatenate[0][0]']            
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['dropout_5[0][0]']              
                                                                                                  
==================================================================================================
Total params: 141,989,645
Trainable params: 141,989,645
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 56s - loss: 0.7135 - acc: 0.7872 - precision: 0.8523 - recall: 0.7328 - val_loss: 0.8396 - val_acc: 0.7643 - val_precision: 0.7881 - val_recall: 0.7464 - 56s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8654822335025381, 'recall': 0.9166666666666666, 'f1-score': 0.8903394255874673, 'support': 372}, '1': {'precision': 0.8072916666666666, 'recall': 0.6981981981981982, 'f1-score': 0.7487922705314008, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.9411764705882353, 'recall': 0.3137254901960784, 'f1-score': 0.47058823529411764, 'support': 51}, '4': {'precision': 0.8, 'recall': 0.2857142857142857, 'f1-score': 0.4210526315789473, 'support': 28}, '5': {'precision': 0.9090909090909091, 'recall': 0.5882352941176471, 'f1-score': 0.7142857142857143, 'support': 17}, '6': {'precision': 0.9285714285714286, 'recall': 0.5416666666666666, 'f1-score': 0.6842105263157894, 'support': 24}, '7': {'precision': 0.7315436241610739, 'recall': 0.8384615384615385, 'f1-score': 0.7813620071684588, 'support': 260}, '8': {'precision': 0.5974025974025974, 'recall': 0.69, 'f1-score': 0.6403712296983758, 'support': 200}, '9': {'precision': 0.7619047619047619, 'recall': 0.1927710843373494, 'f1-score': 0.3076923076923077, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.90625, 'recall': 0.7837837837837838, 'f1-score': 0.8405797101449275, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7783661119515886, 'recall': 0.735, 'f1-score': 0.7560617193240265, 'support': 1400}, 'macro avg': {'precision': 0.7745974094974737, 'recall': 0.554019485474809, 'f1-score': 0.6144689777734297, 'support': 1400}, 'weighted avg': {'precision': 0.7878730279876036, 'recall': 0.735, 'f1-score': 0.7387297574575222, 'support': 1400}, 'samples avg': {'precision': 0.735, 'recall': 0.735, 'f1-score': 0.735, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9211267605633803, 'recall': 0.9083333333333333, 'f1-score': 0.9146853146853147, 'support': 360}, '1': {'precision': 0.8685714285714285, 'recall': 0.6972477064220184, 'f1-score': 0.7735368956743003, 'support': 218}, '2': {'precision': 0.9, 'recall': 0.9166666666666666, 'f1-score': 0.908256880733945, 'support': 108}, '3': {'precision': 0.9130434782608695, 'recall': 0.3, 'f1-score': 0.45161290322580644, 'support': 70}, '4': {'precision': 0.8823529411764706, 'recall': 0.6818181818181818, 'f1-score': 0.7692307692307693, 'support': 22}, '5': {'precision': 0.9, 'recall': 0.7714285714285715, 'f1-score': 0.8307692307692307, 'support': 35}, '6': {'precision': 0.8918918918918919, 'recall': 0.6470588235294118, 'f1-score': 0.7499999999999999, 'support': 51}, '7': {'precision': 0.78125, 'recall': 0.7743362831858407, 'f1-score': 0.7777777777777778, 'support': 226}, '8': {'precision': 0.46096654275092935, 'recall': 0.7515151515151515, 'f1-score': 0.5714285714285715, 'support': 165}, '9': {'precision': 0.7222222222222222, 'recall': 0.3132530120481928, 'f1-score': 0.4369747899159664, 'support': 83}, '10': {'precision': 0.9230769230769231, 'recall': 0.8571428571428571, 'f1-score': 0.888888888888889, 'support': 14}, '11': {'precision': 0.918918918918919, 'recall': 0.8947368421052632, 'f1-score': 0.9066666666666667, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7880844645550528, 'recall': 0.7464285714285714, 'f1-score': 0.7666911225238445, 'support': 1400}, 'macro avg': {'precision': 0.7756477774948488, 'recall': 0.6548874945534991, 'f1-score': 0.6907560529997875, 'support': 1400}, 'weighted avg': {'precision': 0.8134813712445441, 'recall': 0.7464285714285714, 'f1-score': 0.7607875573521988, 'support': 1400}, 'samples avg': {'precision': 0.7464285714285714, 'recall': 0.7464285714285714, 'f1-score': 0.7464285714285714, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 53s - loss: 0.4479 - acc: 0.8640 - precision: 0.8875 - recall: 0.8422 - val_loss: 0.7942 - val_acc: 0.7871 - val_precision: 0.8034 - val_recall: 0.7736 - 53s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8567839195979899, 'recall': 0.9166666666666666, 'f1-score': 0.8857142857142857, 'support': 372}, '1': {'precision': 0.7941176470588235, 'recall': 0.7297297297297297, 'f1-score': 0.7605633802816901, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.8823529411764706, 'recall': 0.29411764705882354, 'f1-score': 0.4411764705882352, 'support': 51}, '4': {'precision': 0.7857142857142857, 'recall': 0.39285714285714285, 'f1-score': 0.5238095238095237, 'support': 28}, '5': {'precision': 0.9285714285714286, 'recall': 0.7647058823529411, 'f1-score': 0.8387096774193549, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.7184466019417476, 'recall': 0.8538461538461538, 'f1-score': 0.7803163444639718, 'support': 260}, '8': {'precision': 0.6359223300970874, 'recall': 0.655, 'f1-score': 0.645320197044335, 'support': 200}, '9': {'precision': 0.7, 'recall': 0.25301204819277107, 'f1-score': 0.3716814159292035, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.9117647058823529, 'recall': 0.8378378378378378, 'f1-score': 0.8732394366197184, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7797619047619048, 'recall': 0.7485714285714286, 'f1-score': 0.7638483965014577, 'support': 1400}, 'macro avg': {'precision': 0.7648904259469449, 'recall': 0.6002366260650074, 'f1-score': 0.6504648147211655, 'support': 1400}, 'weighted avg': {'precision': 0.7811339402644116, 'recall': 0.7485714285714286, 'f1-score': 0.7492850037968434, 'support': 1400}, 'samples avg': {'precision': 0.7485714285714286, 'recall': 0.7485714285714286, 'f1-score': 0.7485714285714286, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9136490250696379, 'recall': 0.9111111111111111, 'f1-score': 0.9123783031988875, 'support': 360}, '1': {'precision': 0.8461538461538461, 'recall': 0.7568807339449541, 'f1-score': 0.7990314769975787, 'support': 218}, '2': {'precision': 0.9504950495049505, 'recall': 0.8888888888888888, 'f1-score': 0.9186602870813396, 'support': 108}, '3': {'precision': 0.9, 'recall': 0.38571428571428573, 'f1-score': 0.5399999999999999, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.9047619047619048, 'recall': 0.7450980392156863, 'f1-score': 0.8172043010752689, 'support': 51}, '7': {'precision': 0.7573221757322176, 'recall': 0.8008849557522124, 'f1-score': 0.7784946236559142, 'support': 226}, '8': {'precision': 0.5246636771300448, 'recall': 0.7090909090909091, 'f1-score': 0.6030927835051546, 'support': 165}, '9': {'precision': 0.7755102040816326, 'recall': 0.4578313253012048, 'f1-score': 0.5757575757575758, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8034124629080118, 'recall': 0.7735714285714286, 'f1-score': 0.7882096069868996, 'support': 1400}, 'macro avg': {'precision': 0.7738245316891744, 'recall': 0.6938743816349529, 'f1-score': 0.7198660493377482, 'support': 1400}, 'weighted avg': {'precision': 0.8141816556050615, 'recall': 0.7735714285714286, 'f1-score': 0.7836460366402207, 'support': 1400}, 'samples avg': {'precision': 0.7735714285714286, 'recall': 0.7735714285714286, 'f1-score': 0.7735714285714286, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 54s - loss: 0.3835 - acc: 0.8758 - precision: 0.8957 - recall: 0.8606 - val_loss: 0.8728 - val_acc: 0.7764 - val_precision: 0.7923 - val_recall: 0.7657 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.85785536159601, 'recall': 0.9247311827956989, 'f1-score': 0.890038809831824, 'support': 372}, '1': {'precision': 0.8146067415730337, 'recall': 0.6531531531531531, 'f1-score': 0.725, 'support': 222}, '2': {'precision': 0.7878787878787878, 'recall': 0.8863636363636364, 'f1-score': 0.8342245989304813, 'support': 88}, '3': {'precision': 0.8333333333333334, 'recall': 0.39215686274509803, 'f1-score': 0.5333333333333333, 'support': 51}, '4': {'precision': 0.7647058823529411, 'recall': 0.4642857142857143, 'f1-score': 0.5777777777777777, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9375, 'recall': 0.625, 'f1-score': 0.75, 'support': 24}, '7': {'precision': 0.6420765027322405, 'recall': 0.9038461538461539, 'f1-score': 0.7507987220447285, 'support': 260}, '8': {'precision': 0.6758241758241759, 'recall': 0.615, 'f1-score': 0.643979057591623, 'support': 200}, '9': {'precision': 0.7407407407407407, 'recall': 0.24096385542168675, 'f1-score': 0.36363636363636365, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.765659543109801, 'recall': 0.7421428571428571, 'f1-score': 0.7537178092129126, 'support': 1400}, 'macro avg': {'precision': 0.7707722128777365, 'recall': 0.5827679081203059, 'f1-score': 0.6414885718237617, 'support': 1400}, 'weighted avg': {'precision': 0.7764430960499131, 'recall': 0.7421428571428571, 'f1-score': 0.739511295692434, 'support': 1400}, 'samples avg': {'precision': 0.7421428571428571, 'recall': 0.7421428571428571, 'f1-score': 0.7421428571428571, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9118457300275482, 'recall': 0.9194444444444444, 'f1-score': 0.9156293222683265, 'support': 360}, '1': {'precision': 0.8975903614457831, 'recall': 0.6834862385321101, 'f1-score': 0.7760416666666666, 'support': 218}, '2': {'precision': 0.8956521739130435, 'recall': 0.9537037037037037, 'f1-score': 0.9237668161434978, 'support': 108}, '3': {'precision': 0.8787878787878788, 'recall': 0.4142857142857143, 'f1-score': 0.5631067961165049, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8235294117647058, 'recall': 0.8, 'f1-score': 0.8115942028985507, 'support': 35}, '6': {'precision': 0.9459459459459459, 'recall': 0.6862745098039216, 'f1-score': 0.7954545454545455, 'support': 51}, '7': {'precision': 0.6610169491525424, 'recall': 0.8628318584070797, 'f1-score': 0.7485604606525912, 'support': 226}, '8': {'precision': 0.545, 'recall': 0.6606060606060606, 'f1-score': 0.5972602739726028, 'support': 165}, '9': {'precision': 0.7560975609756098, 'recall': 0.37349397590361444, 'f1-score': 0.5, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7923133776792314, 'recall': 0.7657142857142857, 'f1-score': 0.7787867780602978, 'support': 1400}, 'macro avg': {'precision': 0.773254470559709, 'recall': 0.679482994785192, 'f1-score': 0.7099781272487325, 'support': 1400}, 'weighted avg': {'precision': 0.8056062602977072, 'recall': 0.7657142857142857, 'f1-score': 0.7716273772032671, 'support': 1400}, 'samples avg': {'precision': 0.7657142857142857, 'recall': 0.7657142857142857, 'f1-score': 0.7657142857142857, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 54s - loss: 0.3310 - acc: 0.8972 - precision: 0.9109 - recall: 0.8838 - val_loss: 0.9173 - val_acc: 0.7786 - val_precision: 0.7896 - val_recall: 0.7693 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.865979381443299, 'recall': 0.9032258064516129, 'f1-score': 0.8842105263157894, 'support': 372}, '1': {'precision': 0.78125, 'recall': 0.6756756756756757, 'f1-score': 0.7246376811594203, 'support': 222}, '2': {'precision': 0.8210526315789474, 'recall': 0.8863636363636364, 'f1-score': 0.8524590163934427, 'support': 88}, '3': {'precision': 0.7058823529411765, 'recall': 0.47058823529411764, 'f1-score': 0.5647058823529412, 'support': 51}, '4': {'precision': 0.75, 'recall': 0.42857142857142855, 'f1-score': 0.5454545454545454, 'support': 28}, '5': {'precision': 0.9230769230769231, 'recall': 0.7058823529411765, 'f1-score': 0.8000000000000002, 'support': 17}, '6': {'precision': 0.9333333333333333, 'recall': 0.5833333333333334, 'f1-score': 0.7179487179487181, 'support': 24}, '7': {'precision': 0.6498599439775911, 'recall': 0.8923076923076924, 'f1-score': 0.7520259319286873, 'support': 260}, '8': {'precision': 0.6633165829145728, 'recall': 0.66, 'f1-score': 0.6616541353383459, 'support': 200}, '9': {'precision': 0.76, 'recall': 0.2289156626506024, 'f1-score': 0.35185185185185186, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.6756756756756757, 'f1-score': 0.8064516129032258, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7622531089978054, 'recall': 0.7442857142857143, 'f1-score': 0.7531622696060716, 'support': 1400}, 'macro avg': {'precision': 0.7579808576358341, 'recall': 0.5879902178921758, 'f1-score': 0.6428501596584625, 'support': 1400}, 'weighted avg': {'precision': 0.7711669079894646, 'recall': 0.7442857142857143, 'f1-score': 0.7407503830799507, 'support': 1400}, 'samples avg': {'precision': 0.7442857142857143, 'recall': 0.7442857142857143, 'f1-score': 0.7442857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9277456647398844, 'recall': 0.8916666666666667, 'f1-score': 0.9093484419263456, 'support': 360}, '1': {'precision': 0.8707865168539326, 'recall': 0.7110091743119266, 'f1-score': 0.7828282828282828, 'support': 218}, '2': {'precision': 0.9150943396226415, 'recall': 0.8981481481481481, 'f1-score': 0.9065420560747663, 'support': 108}, '3': {'precision': 0.725, 'recall': 0.4142857142857143, 'f1-score': 0.5272727272727273, 'support': 70}, '4': {'precision': 0.8421052631578947, 'recall': 0.7272727272727273, 'f1-score': 0.7804878048780488, 'support': 22}, '5': {'precision': 0.8333333333333334, 'recall': 0.8571428571428571, 'f1-score': 0.8450704225352113, 'support': 35}, '6': {'precision': 0.8974358974358975, 'recall': 0.6862745098039216, 'f1-score': 0.7777777777777778, 'support': 51}, '7': {'precision': 0.6747404844290658, 'recall': 0.8628318584070797, 'f1-score': 0.7572815533980584, 'support': 226}, '8': {'precision': 0.5462962962962963, 'recall': 0.7151515151515152, 'f1-score': 0.6194225721784777, 'support': 165}, '9': {'precision': 0.7777777777777778, 'recall': 0.42168674698795183, 'f1-score': 0.546875, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.8571428571428571, 'f1-score': 0.923076923076923, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7895894428152492, 'recall': 0.7692857142857142, 'f1-score': 0.7793053545586107, 'support': 1400}, 'macro avg': {'precision': 0.7619271089039992, 'recall': 0.6874884321097406, 'f1-score': 0.7131323387732217, 'support': 1400}, 'weighted avg': {'precision': 0.801462925578961, 'recall': 0.7692857142857142, 'f1-score': 0.7749403987702991, 'support': 1400}, 'samples avg': {'precision': 0.7692857142857142, 'recall': 0.7692857142857142, 'f1-score': 0.7692857142857142, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 54s - loss: 0.2822 - acc: 0.9118 - precision: 0.9241 - recall: 0.9004 - val_loss: 1.0273 - val_acc: 0.7857 - val_precision: 0.7926 - val_recall: 0.7807 - 54s/epoch - 11ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8369304556354916, 'recall': 0.9381720430107527, 'f1-score': 0.8846641318124209, 'support': 372}, '1': {'precision': 0.8105263157894737, 'recall': 0.6936936936936937, 'f1-score': 0.7475728155339806, 'support': 222}, '2': {'precision': 0.8080808080808081, 'recall': 0.9090909090909091, 'f1-score': 0.8556149732620321, 'support': 88}, '3': {'precision': 0.7272727272727273, 'recall': 0.47058823529411764, 'f1-score': 0.5714285714285714, 'support': 51}, '4': {'precision': 0.7222222222222222, 'recall': 0.4642857142857143, 'f1-score': 0.5652173913043479, 'support': 28}, '5': {'precision': 0.8571428571428571, 'recall': 0.7058823529411765, 'f1-score': 0.7741935483870968, 'support': 17}, '6': {'precision': 0.8947368421052632, 'recall': 0.7083333333333334, 'f1-score': 0.7906976744186046, 'support': 24}, '7': {'precision': 0.7188498402555911, 'recall': 0.8653846153846154, 'f1-score': 0.7853403141361258, 'support': 260}, '8': {'precision': 0.6617647058823529, 'recall': 0.675, 'f1-score': 0.6683168316831682, 'support': 200}, '9': {'precision': 0.8, 'recall': 0.2891566265060241, 'f1-score': 0.4247787610619469, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.9655172413793104, 'recall': 0.7567567567567568, 'f1-score': 0.8484848484848485, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.778343023255814, 'recall': 0.765, 'f1-score': 0.771613832853026, 'support': 1400}, 'macro avg': {'precision': 0.7540803089050845, 'recall': 0.6263854574587508, 'f1-score': 0.6704853739625496, 'support': 1400}, 'weighted avg': {'precision': 0.7800874031298729, 'recall': 0.765, 'f1-score': 0.7599712449370977, 'support': 1400}, 'samples avg': {'precision': 0.765, 'recall': 0.765, 'f1-score': 0.765, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9016393442622951, 'recall': 0.9166666666666666, 'f1-score': 0.9090909090909091, 'support': 360}, '1': {'precision': 0.8666666666666667, 'recall': 0.7155963302752294, 'f1-score': 0.7839195979899497, 'support': 218}, '2': {'precision': 0.9090909090909091, 'recall': 0.9259259259259259, 'f1-score': 0.9174311926605504, 'support': 108}, '3': {'precision': 0.7555555555555555, 'recall': 0.4857142857142857, 'f1-score': 0.5913043478260869, 'support': 70}, '4': {'precision': 0.7619047619047619, 'recall': 0.7272727272727273, 'f1-score': 0.7441860465116279, 'support': 22}, '5': {'precision': 0.8157894736842105, 'recall': 0.8857142857142857, 'f1-score': 0.8493150684931505, 'support': 35}, '6': {'precision': 0.9024390243902439, 'recall': 0.7254901960784313, 'f1-score': 0.8043478260869564, 'support': 51}, '7': {'precision': 0.7248062015503876, 'recall': 0.827433628318584, 'f1-score': 0.7727272727272727, 'support': 226}, '8': {'precision': 0.5345622119815668, 'recall': 0.703030303030303, 'f1-score': 0.6073298429319371, 'support': 165}, '9': {'precision': 0.7959183673469388, 'recall': 0.46987951807228917, 'f1-score': 0.5909090909090909, 'support': 83}, '10': {'precision': 0.8666666666666667, 'recall': 0.9285714285714286, 'f1-score': 0.896551724137931, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.7926033357505439, 'recall': 0.7807142857142857, 'f1-score': 0.786613889888449, 'support': 1400}, 'macro avg': {'precision': 0.7466795426842364, 'recall': 0.7081563182881092, 'f1-score': 0.719248446344796, 'support': 1400}, 'weighted avg': {'precision': 0.7994749002870728, 'recall': 0.7807142857142857, 'f1-score': 0.7826873859304376, 'support': 1400}, 'samples avg': {'precision': 0.7807142857142857, 'recall': 0.7807142857142857, 'f1-score': 0.7807142857142857, 'support': 1400}}
Training Finished
+ wait
+ python LEGAL-PE/Level-3_of_Framework/Level_three/training_models-DimRed+Clustering.py --dataset_subset scotus --add_layers True --layers_from_end 2 --ft_model_used_for_extraction LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final --pretrained_model EleutherAI/gpt-neo-2.7B --to_test True --to_train True --train_run_number 1 --verbose 2 --epochs 5 --num_layers 1 --dff 4096 --with_clustering True --pad_len 150 --data_path LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1063: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1071: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/distances.py:1086: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/umap_.py:660: NumbaDeprecationWarning: [1mThe 'nopython' keyword argument was not supplied to the 'numba.jit' decorator. The implicit default value for this argument is currently False, but it will be changed to True in Numba 0.59.0. See https://numba.readthedocs.io/en/stable/reference/deprecation.html#deprecation-of-object-mode-fall-back-behaviour-when-using-jit for details.[0m
  @numba.jit()
2023-05-22 06:42:06.955841: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:42:07.200250: E tensorflow/stream_executor/cuda/cuda_blas.cc:2981] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-05-22 06:42:08.821562: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:42:08.821771: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /gpfslocalsup/spack_soft/sox/14.4.2/gcc-8.3.1-5wm6sfkfdu6aohr3vsvridk2xhm52loi/lib:/gpfslocalsup/spack_soft/openmpi/4.1.1/gcc-8.5.0-cezmf7dob4x36g7x5dr7jufg7yt4vpam/lib:/gpfslocalsup/spack_soft/cudnn/8.1.1.33-11.2/gcc-8.3.1-dgsfwc7e23vzc36jopc5nxyunptm2ieh/lib64:/gpfslocalsup/spack_soft/nccl/2.9.6-1/gcc-8.3.1-srwvuxi6a5sn7abu5sc3iusdirkw2cfn/lib:/gpfslocalsys/cuda/11.2/nvvm/lib64:/gpfslocalsys/cuda/11.2/extras/CUPTI/lib64:/gpfslocalsys/cuda/11.2/lib64:/gpfslocalsys/cuda/11.2/samples/common/lib/linux/x86_64:/gpfslocalsys/cuda/11.2/targets/x86_64-linux/lib:/gpfslocalsys/slurm/current/lib/slurm:/gpfslocalsys/slurm/current/lib
2023-05-22 06:42:08.821786: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
Num GPUs Available:  1
Namespace(dataset_subset='scotus', combine_layers=True, add_layers=True, layers_from_end=2, save_model_trained_here=False, self_ft_extracted=True, ft_model_used_for_extraction='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/EleutherAI_gpt-neo-2.7B/Strategy_0/sub_strategy_0/Training_data_EleutherAI_gpt-neo-2.7B/chunks_with_100_overlap_and_512_input-length/tuned_model/ZeRO3_epoch_2__final', pretrained_model='EleutherAI/gpt-neo-2.7B', finetuned_on_input_len=512, to_test=True, to_train=True, train_run_number=1, verbose=2, epochs=5, batch_size=1, load_to_retrain=False, model_load_path='', to_freeze=False, layers_to_freeze=[1], max_positional_encoding=40, num_layers=1, bilstm_before_encoder=False, dropout_before_first_fnn=True, dropout_before_inner_fnn=True, ffn_dropout_value=0.15, dropout_after_first_encoder=True, dropout_after_second_encoder=True, encoder_dropout_value=0.25, dff=4096, d_model=768, num_heads=8, include_rnn=False, from_encoder=False, with_clustering=True, clustering_strategy='hard', dimReduction='pumap', dim_reduction_metric='cosine', pad_len=150, strategy=1, only_clustered=False, train_dimR=False, save_dimR=False, train_clusterer=False, save_clusterer=False, parent_dir='LEGAL-PE/Level-3_of_Framework/savedModels/', data_path='LEGAL-P_E/SIGIR_experiments/finetuned_models/scotus/Extracted_data/from_512input_ft_model/Neo2.7b/', edit_for_ildc=False)
2023-05-22 06:42:19.449922: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-22 06:42:19.937799: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 78797 MB memory:  -> device: 0, name: NVIDIA A100-SXM4-80GB, pci bus id: 0000:48:00.0, compute capability: 8.0
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/umap/parametric_umap.py:148: UserWarning: tensorflow_probability not installed or incompatible to current                 tensorflow installation. Setting global_correlation_loss_weight to zero.
  warn(

 logging document chunks 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 3366215.09it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3085667.68it/s]
Mon May 22 06:42:23 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
2023-05-22 06:42:27.340022: I tensorflow/stream_executor/cuda/cuda_blas.cc:1614] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
  1/148 [..............................] - ETA: 1:52 25/148 [====>.........................] - ETA: 0s   49/148 [========>.....................] - ETA: 0s 72/148 [=============>................] - ETA: 0s 99/148 [===================>..........] - ETA: 0s128/148 [========================>.....] - ETA: 0s148/148 [==============================] - 1s 2ms/step
HDBSCAN(min_cluster_size=15, min_samples=10, prediction_data=True)

 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2302538.43it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2633195.34it/s]

 padding 


 rechunking 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 2717222.08it/s]

 padding 

  0%|          | 0/5000 [00:00<?, ?it/s]100%|██████████| 5000/5000 [00:00<00:00, 82567.64it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2511559.28it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 82907.77it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 3023700.10it/s]

 logging document chunks 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2971672.87it/s]
Mon May 22 06:42:29 2023 Building and compiling search function
Pickle of ParametricUMAP model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/model.pkl
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
Keras encoder model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/encoder
Keras full model loaded from LEGAL-PE/Level-3_of_Framework/savedModels/scotus/EleutherAI_gpt-neo-2.7B/ft_on_512_input_length/_ft_ZeRO3_epoch_2__final/last_2_layers_added/embedder_pumap_64dims_metric_cosine/parametric_model
 1/44 [..............................] - ETA: 2s17/44 [==========>...................] - ETA: 0s44/44 [==============================] - 0s 2ms/step
 1/44 [..............................] - ETA: 1s18/44 [===========>..................] - ETA: 0s44/44 [==============================] - ETA: 0s44/44 [==============================] - 0s 2ms/step

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2153291.38it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2305467.45it/s]

 padding 


 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2481836.69it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 83829.79it/s]

 rechunking 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 2473473.29it/s]

 padding 

  0%|          | 0/1400 [00:00<?, ?it/s]100%|██████████| 1400/1400 [00:00<00:00, 84604.01it/s]

 Compiling model for strategy 1

                    Chunked CLS
                    embeddings  ------------------------> Encoder Model -> output
                        |                                   |
                Dimensionality Reduction --> Clustering ____|
                   (PrametricUMAP)
                
/linkhome/rech/geniri01/uei84ht/.local/lib/python3.10/site-packages/keras/initializers/initializers_v2.py:120: UserWarning: The initializer GlorotUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  warnings.warn(

                                              Encoder ----> Max pooled ---> dense ---> 
                               1 layers                                |
                       Encoder Model =                                                |-->dense-->output
                                                                                      |
                                            Clustering ----> dense ------------------>
                    
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
Model: "model"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 cls_chunks_ (InputLayer)       [(None, None, 2560)  0           []                               
                                ]                                                                 
                                                                                                  
 transformer_encoder (Transform  (None, None, 2560)  47213056    ['cls_chunks_[0][0]']            
 erEncoder)                                                                                       
                                                                                                  
 global_max_pooling1d (GlobalMa  (None, 2560)        0           ['transformer_encoder[0][0]']    
 xPooling1D)                                                                                      
                                                                                                  
 dropout_1 (Dropout)            (None, 2560)         0           ['global_max_pooling1d[0][0]']   
                                                                                                  
 dense_2 (Dense)                (None, 128)          327808      ['dropout_1[0][0]']              
                                                                                                  
 clustered_chunks_ (InputLayer)  [(None, 150)]       0           []                               
                                                                                                  
 dropout_2 (Dropout)            (None, 128)          0           ['dense_2[0][0]']                
                                                                                                  
 dense_3 (Dense)                (None, 128)          19328       ['clustered_chunks_[0][0]']      
                                                                                                  
 concatenate (Concatenate)      (None, 256)          0           ['dropout_2[0][0]',              
                                                                  'dense_3[0][0]']                
                                                                                                  
 dense_4 (Dense)                (None, 13)           3341        ['concatenate[0][0]']            
                                                                                                  
==================================================================================================
Total params: 47,563,533
Trainable params: 47,563,533
Non-trainable params: 0
__________________________________________________________________________________________________
None
epoch 0 of 5 

5000/5000 - 24s - loss: 0.7094 - acc: 0.7922 - precision: 0.8669 - recall: 0.7228 - val_loss: 0.7884 - val_acc: 0.7836 - val_precision: 0.8093 - val_recall: 0.7579 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.873015873015873, 'recall': 0.8870967741935484, 'f1-score': 0.88, 'support': 372}, '1': {'precision': 0.8072916666666666, 'recall': 0.6981981981981982, 'f1-score': 0.7487922705314008, 'support': 222}, '2': {'precision': 0.797979797979798, 'recall': 0.8977272727272727, 'f1-score': 0.8449197860962567, 'support': 88}, '3': {'precision': 0.7241379310344828, 'recall': 0.4117647058823529, 'f1-score': 0.525, 'support': 51}, '4': {'precision': 0.8181818181818182, 'recall': 0.32142857142857145, 'f1-score': 0.46153846153846156, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.694006309148265, 'recall': 0.8461538461538461, 'f1-score': 0.7625649913344886, 'support': 260}, '8': {'precision': 0.648936170212766, 'recall': 0.61, 'f1-score': 0.6288659793814433, 'support': 200}, '9': {'precision': 0.8461538461538461, 'recall': 0.13253012048192772, 'f1-score': 0.22916666666666669, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.9393939393939394, 'recall': 0.8378378378378378, 'f1-score': 0.8857142857142858, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7816358024691358, 'recall': 0.7235714285714285, 'f1-score': 0.7514836795252225, 'support': 1400}, 'macro avg': {'precision': 0.7764262920178384, 'recall': 0.5742150884948436, 'f1-score': 0.6306280132972872, 'support': 1400}, 'weighted avg': {'precision': 0.7885192060372073, 'recall': 0.7235714285714285, 'f1-score': 0.7327188760833607, 'support': 1400}, 'samples avg': {'precision': 0.7235714285714285, 'recall': 0.7235714285714285, 'f1-score': 0.7235714285714285, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9228571428571428, 'recall': 0.8972222222222223, 'f1-score': 0.9098591549295774, 'support': 360}, '1': {'precision': 0.8540540540540541, 'recall': 0.7247706422018348, 'f1-score': 0.7841191066997519, 'support': 218}, '2': {'precision': 0.8938053097345132, 'recall': 0.9351851851851852, 'f1-score': 0.9140271493212669, 'support': 108}, '3': {'precision': 0.90625, 'recall': 0.4142857142857143, 'f1-score': 0.5686274509803921, 'support': 70}, '4': {'precision': 0.7894736842105263, 'recall': 0.6818181818181818, 'f1-score': 0.7317073170731707, 'support': 22}, '5': {'precision': 0.8235294117647058, 'recall': 0.8, 'f1-score': 0.8115942028985507, 'support': 35}, '6': {'precision': 0.8863636363636364, 'recall': 0.7647058823529411, 'f1-score': 0.8210526315789474, 'support': 51}, '7': {'precision': 0.7510204081632653, 'recall': 0.8141592920353983, 'f1-score': 0.7813163481953291, 'support': 226}, '8': {'precision': 0.5497630331753555, 'recall': 0.703030303030303, 'f1-score': 0.6170212765957447, 'support': 165}, '9': {'precision': 0.8571428571428571, 'recall': 0.2891566265060241, 'f1-score': 0.43243243243243246, 'support': 83}, '10': {'precision': 0.8333333333333334, 'recall': 0.7142857142857143, 'f1-score': 0.7692307692307692, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8093058733790999, 'recall': 0.7578571428571429, 'f1-score': 0.7827369974179269, 'support': 1400}, 'macro avg': {'precision': 0.7663330548388194, 'recall': 0.6641043543099063, 'f1-score': 0.6950557447723997, 'support': 1400}, 'weighted avg': {'precision': 0.8193059722221284, 'recall': 0.7578571428571429, 'f1-score': 0.7731644892926202, 'support': 1400}, 'samples avg': {'precision': 0.7578571428571429, 'recall': 0.7578571428571429, 'f1-score': 0.7578571428571429, 'support': 1400}}
epoch 1 of 5 

5000/5000 - 24s - loss: 0.3973 - acc: 0.8752 - precision: 0.8971 - recall: 0.8530 - val_loss: 0.8115 - val_acc: 0.7929 - val_precision: 0.8093 - val_recall: 0.7793 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8525, 'recall': 0.9166666666666666, 'f1-score': 0.8834196891191711, 'support': 372}, '1': {'precision': 0.801980198019802, 'recall': 0.7297297297297297, 'f1-score': 0.7641509433962265, 'support': 222}, '2': {'precision': 0.8125, 'recall': 0.8863636363636364, 'f1-score': 0.8478260869565218, 'support': 88}, '3': {'precision': 0.6571428571428571, 'recall': 0.45098039215686275, 'f1-score': 0.5348837209302325, 'support': 51}, '4': {'precision': 0.631578947368421, 'recall': 0.42857142857142855, 'f1-score': 0.5106382978723404, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.6470588235294118, 'f1-score': 0.7857142857142858, 'support': 17}, '6': {'precision': 0.9444444444444444, 'recall': 0.7083333333333334, 'f1-score': 0.8095238095238096, 'support': 24}, '7': {'precision': 0.6784660766961652, 'recall': 0.8846153846153846, 'f1-score': 0.7679465776293823, 'support': 260}, '8': {'precision': 0.6936416184971098, 'recall': 0.6, 'f1-score': 0.6434316353887399, 'support': 200}, '9': {'precision': 0.7619047619047619, 'recall': 0.1927710843373494, 'f1-score': 0.3076923076923077, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.5333333333333333, 'f1-score': 0.6956521739130436, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.774741506646972, 'recall': 0.7492857142857143, 'f1-score': 0.7618010167029776, 'support': 1400}, 'macro avg': {'precision': 0.7540699156979662, 'recall': 0.6012508961903825, 'f1-score': 0.6499561732902879, 'support': 1400}, 'weighted avg': {'precision': 0.7762472255329889, 'recall': 0.7492857142857143, 'f1-score': 0.746297888608706, 'support': 1400}, 'samples avg': {'precision': 0.7492857142857143, 'recall': 0.7492857142857143, 'f1-score': 0.7492857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9065934065934066, 'recall': 0.9166666666666666, 'f1-score': 0.9116022099447513, 'support': 360}, '1': {'precision': 0.8383838383838383, 'recall': 0.7614678899082569, 'f1-score': 0.798076923076923, 'support': 218}, '2': {'precision': 0.9252336448598131, 'recall': 0.9166666666666666, 'f1-score': 0.9209302325581395, 'support': 108}, '3': {'precision': 0.8, 'recall': 0.45714285714285713, 'f1-score': 0.5818181818181818, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.8285714285714286, 'recall': 0.8285714285714286, 'f1-score': 0.8285714285714286, 'support': 35}, '6': {'precision': 0.9111111111111111, 'recall': 0.803921568627451, 'f1-score': 0.8541666666666666, 'support': 51}, '7': {'precision': 0.7258687258687259, 'recall': 0.831858407079646, 'f1-score': 0.775257731958763, 'support': 226}, '8': {'precision': 0.5882352941176471, 'recall': 0.6666666666666666, 'f1-score': 0.625, 'support': 165}, '9': {'precision': 0.825, 'recall': 0.39759036144578314, 'f1-score': 0.5365853658536586, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8947368421052632, 'recall': 0.8947368421052632, 'f1-score': 0.8947368421052632, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8093471810089021, 'recall': 0.7792857142857142, 'f1-score': 0.7940320232896653, 'support': 1400}, 'macro avg': {'precision': 0.7648468964561596, 'recall': 0.6983988814443685, 'f1-score': 0.7209922637467402, 'support': 1400}, 'weighted avg': {'precision': 0.8101172026187531, 'recall': 0.7792857142857142, 'f1-score': 0.7865884209207996, 'support': 1400}, 'samples avg': {'precision': 0.7792857142857142, 'recall': 0.7792857142857142, 'f1-score': 0.7792857142857142, 'support': 1400}}
epoch 2 of 5 

5000/5000 - 24s - loss: 0.3040 - acc: 0.9034 - precision: 0.9179 - recall: 0.8880 - val_loss: 0.8559 - val_acc: 0.7929 - val_precision: 0.8065 - val_recall: 0.7829 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8666666666666667, 'recall': 0.9086021505376344, 'f1-score': 0.8871391076115485, 'support': 372}, '1': {'precision': 0.8029556650246306, 'recall': 0.7342342342342343, 'f1-score': 0.7670588235294118, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.717948717948718, 'recall': 0.5490196078431373, 'f1-score': 0.6222222222222223, 'support': 51}, '4': {'precision': 0.7058823529411765, 'recall': 0.42857142857142855, 'f1-score': 0.5333333333333333, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.9473684210526315, 'recall': 0.75, 'f1-score': 0.8372093023255814, 'support': 24}, '7': {'precision': 0.6909090909090909, 'recall': 0.8769230769230769, 'f1-score': 0.7728813559322034, 'support': 260}, '8': {'precision': 0.6666666666666666, 'recall': 0.69, 'f1-score': 0.6781326781326782, 'support': 200}, '9': {'precision': 0.782608695652174, 'recall': 0.21686746987951808, 'f1-score': 0.339622641509434, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4666666666666667, 'f1-score': 0.6363636363636364, 'support': 15}, '11': {'precision': 0.96875, 'recall': 0.8378378378378378, 'f1-score': 0.8985507246376812, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7800436999271668, 'recall': 0.765, 'f1-score': 0.7724486116119726, 'support': 1400}, 'macro avg': {'precision': 0.7676571931464853, 'recall': 0.6193052662921805, 'f1-score': 0.6659417607413185, 'support': 1400}, 'weighted avg': {'precision': 0.784688811102172, 'recall': 0.765, 'f1-score': 0.7600830232103994, 'support': 1400}, 'samples avg': {'precision': 0.765, 'recall': 0.765, 'f1-score': 0.765, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9252873563218391, 'recall': 0.8944444444444445, 'f1-score': 0.9096045197740114, 'support': 360}, '1': {'precision': 0.8316831683168316, 'recall': 0.7706422018348624, 'f1-score': 0.7999999999999999, 'support': 218}, '2': {'precision': 0.9090909090909091, 'recall': 0.9259259259259259, 'f1-score': 0.9174311926605504, 'support': 108}, '3': {'precision': 0.8, 'recall': 0.5142857142857142, 'f1-score': 0.6260869565217391, 'support': 70}, '4': {'precision': 0.7727272727272727, 'recall': 0.7727272727272727, 'f1-score': 0.7727272727272727, 'support': 22}, '5': {'precision': 0.8529411764705882, 'recall': 0.8285714285714286, 'f1-score': 0.8405797101449276, 'support': 35}, '6': {'precision': 0.8913043478260869, 'recall': 0.803921568627451, 'f1-score': 0.845360824742268, 'support': 51}, '7': {'precision': 0.74, 'recall': 0.8185840707964602, 'f1-score': 0.7773109243697479, 'support': 226}, '8': {'precision': 0.5666666666666667, 'recall': 0.7212121212121212, 'f1-score': 0.6346666666666666, 'support': 165}, '9': {'precision': 0.8292682926829268, 'recall': 0.40963855421686746, 'f1-score': 0.5483870967741935, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8717948717948718, 'recall': 0.8947368421052632, 'f1-score': 0.8831168831168831, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8064753495217072, 'recall': 0.7828571428571428, 'f1-score': 0.794490757520841, 'support': 1400}, 'macro avg': {'precision': 0.7621100560434353, 'recall': 0.703108033112469, 'f1-score': 0.7231866072040082, 'support': 1400}, 'weighted avg': {'precision': 0.8117374763004084, 'recall': 0.7828571428571428, 'f1-score': 0.7897235486741785, 'support': 1400}, 'samples avg': {'precision': 0.7828571428571428, 'recall': 0.7828571428571428, 'f1-score': 0.7828571428571428, 'support': 1400}}
epoch 3 of 5 

5000/5000 - 24s - loss: 0.2274 - acc: 0.9254 - precision: 0.9359 - recall: 0.9166 - val_loss: 0.9085 - val_acc: 0.7964 - val_precision: 0.8039 - val_recall: 0.7879 - 24s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8418491484184915, 'recall': 0.9301075268817204, 'f1-score': 0.8837803320561941, 'support': 372}, '1': {'precision': 0.7815533980582524, 'recall': 0.7252252252252253, 'f1-score': 0.7523364485981308, 'support': 222}, '2': {'precision': 0.8351648351648352, 'recall': 0.8636363636363636, 'f1-score': 0.8491620111731844, 'support': 88}, '3': {'precision': 0.7222222222222222, 'recall': 0.5098039215686274, 'f1-score': 0.5977011494252873, 'support': 51}, '4': {'precision': 0.631578947368421, 'recall': 0.42857142857142855, 'f1-score': 0.5106382978723404, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7058823529411765, 'f1-score': 0.8275862068965517, 'support': 17}, '6': {'precision': 0.8636363636363636, 'recall': 0.7916666666666666, 'f1-score': 0.8260869565217391, 'support': 24}, '7': {'precision': 0.6686217008797654, 'recall': 0.8769230769230769, 'f1-score': 0.7587354409317804, 'support': 260}, '8': {'precision': 0.7028571428571428, 'recall': 0.615, 'f1-score': 0.656, 'support': 200}, '9': {'precision': 0.8095238095238095, 'recall': 0.20481927710843373, 'f1-score': 0.32692307692307687, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.4, 'f1-score': 0.5714285714285715, 'support': 15}, '11': {'precision': 1.0, 'recall': 0.8108108108108109, 'f1-score': 0.8955223880597014, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7708029197080292, 'recall': 0.7542857142857143, 'f1-score': 0.7624548736462095, 'support': 1400}, 'macro avg': {'precision': 0.7582313513945619, 'recall': 0.6048035884871946, 'f1-score': 0.6504539138374275, 'support': 1400}, 'weighted avg': {'precision': 0.7757254333233443, 'recall': 0.7542857142857143, 'f1-score': 0.7474989303488025, 'support': 1400}, 'samples avg': {'precision': 0.7542857142857143, 'recall': 0.7542857142857143, 'f1-score': 0.7542857142857143, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.9068493150684932, 'recall': 0.9194444444444444, 'f1-score': 0.913103448275862, 'support': 360}, '1': {'precision': 0.813953488372093, 'recall': 0.8027522935779816, 'f1-score': 0.8083140877598153, 'support': 218}, '2': {'precision': 0.9306930693069307, 'recall': 0.8703703703703703, 'f1-score': 0.8995215311004785, 'support': 108}, '3': {'precision': 0.8333333333333334, 'recall': 0.5, 'f1-score': 0.625, 'support': 70}, '4': {'precision': 0.7391304347826086, 'recall': 0.7727272727272727, 'f1-score': 0.7555555555555555, 'support': 22}, '5': {'precision': 0.8205128205128205, 'recall': 0.9142857142857143, 'f1-score': 0.8648648648648648, 'support': 35}, '6': {'precision': 0.9130434782608695, 'recall': 0.8235294117647058, 'f1-score': 0.865979381443299, 'support': 51}, '7': {'precision': 0.7307692307692307, 'recall': 0.8407079646017699, 'f1-score': 0.7818930041152263, 'support': 226}, '8': {'precision': 0.5783783783783784, 'recall': 0.6484848484848484, 'f1-score': 0.6114285714285714, 'support': 165}, '9': {'precision': 0.813953488372093, 'recall': 0.42168674698795183, 'f1-score': 0.5555555555555556, 'support': 83}, '10': {'precision': 0.9166666666666666, 'recall': 0.7857142857142857, 'f1-score': 0.8461538461538461, 'support': 14}, '11': {'precision': 0.8292682926829268, 'recall': 0.8947368421052632, 'f1-score': 0.860759493670886, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8039358600583091, 'recall': 0.7878571428571428, 'f1-score': 0.7958152958152959, 'support': 1400}, 'macro avg': {'precision': 0.7558886151158805, 'recall': 0.7072646303895854, 'f1-score': 0.7221637953787662, 'support': 1400}, 'weighted avg': {'precision': 0.8048498435422664, 'recall': 0.7878571428571428, 'f1-score': 0.7893893841060119, 'support': 1400}, 'samples avg': {'precision': 0.7878571428571428, 'recall': 0.7878571428571428, 'f1-score': 0.7878571428571428, 'support': 1400}}
epoch 4 of 5 

5000/5000 - 23s - loss: 0.1767 - acc: 0.9404 - precision: 0.9491 - recall: 0.9322 - val_loss: 0.9915 - val_acc: 0.7950 - val_precision: 0.8026 - val_recall: 0.7900 - 23s/epoch - 5ms/step

 test--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8091954022988506, 'recall': 0.946236559139785, 'f1-score': 0.872366790582404, 'support': 372}, '1': {'precision': 0.824468085106383, 'recall': 0.6981981981981982, 'f1-score': 0.7560975609756098, 'support': 222}, '2': {'precision': 0.8297872340425532, 'recall': 0.8863636363636364, 'f1-score': 0.8571428571428571, 'support': 88}, '3': {'precision': 0.7352941176470589, 'recall': 0.49019607843137253, 'f1-score': 0.588235294117647, 'support': 51}, '4': {'precision': 0.6842105263157895, 'recall': 0.4642857142857143, 'f1-score': 0.5531914893617021, 'support': 28}, '5': {'precision': 1.0, 'recall': 0.7647058823529411, 'f1-score': 0.8666666666666666, 'support': 17}, '6': {'precision': 0.7692307692307693, 'recall': 0.8333333333333334, 'f1-score': 0.8, 'support': 24}, '7': {'precision': 0.7251655629139073, 'recall': 0.8423076923076923, 'f1-score': 0.7793594306049823, 'support': 260}, '8': {'precision': 0.6847826086956522, 'recall': 0.63, 'f1-score': 0.6562500000000001, 'support': 200}, '9': {'precision': 0.7666666666666667, 'recall': 0.27710843373493976, 'f1-score': 0.40707964601769914, 'support': 83}, '10': {'precision': 1.0, 'recall': 0.6666666666666666, 'f1-score': 0.8, 'support': 15}, '11': {'precision': 0.8611111111111112, 'recall': 0.8378378378378378, 'f1-score': 0.8493150684931507, 'support': 37}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 3}, 'micro avg': {'precision': 0.7768052516411379, 'recall': 0.7607142857142857, 'f1-score': 0.7686755683868639, 'support': 1400}, 'macro avg': {'precision': 0.7453778526175955, 'recall': 0.6413261563578553, 'f1-score': 0.6758234464586705, 'support': 1400}, 'weighted avg': {'precision': 0.7751338049172182, 'recall': 0.7607142857142857, 'f1-score': 0.755943636577345, 'support': 1400}, 'samples avg': {'precision': 0.7607142857142857, 'recall': 0.7607142857142857, 'f1-score': 0.7607142857142857, 'support': 1400}}

 validate--
test print: test label 1400
Classification Report
:
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/gpfslocalsup/pub/anaconda-py3/2022.05/envs/tensorflow-gpu-2.11.0+py3.10.8/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in samples with no predicted labels. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
{'0': {'precision': 0.8839050131926122, 'recall': 0.9305555555555556, 'f1-score': 0.9066305818673884, 'support': 360}, '1': {'precision': 0.8549222797927462, 'recall': 0.7568807339449541, 'f1-score': 0.802919708029197, 'support': 218}, '2': {'precision': 0.9252336448598131, 'recall': 0.9166666666666666, 'f1-score': 0.9209302325581395, 'support': 108}, '3': {'precision': 0.7959183673469388, 'recall': 0.5571428571428572, 'f1-score': 0.6554621848739496, 'support': 70}, '4': {'precision': 0.782608695652174, 'recall': 0.8181818181818182, 'f1-score': 0.8, 'support': 22}, '5': {'precision': 0.8378378378378378, 'recall': 0.8857142857142857, 'f1-score': 0.8611111111111112, 'support': 35}, '6': {'precision': 0.8958333333333334, 'recall': 0.8431372549019608, 'f1-score': 0.8686868686868686, 'support': 51}, '7': {'precision': 0.7627118644067796, 'recall': 0.7964601769911505, 'f1-score': 0.7792207792207791, 'support': 226}, '8': {'precision': 0.5577889447236181, 'recall': 0.6727272727272727, 'f1-score': 0.6098901098901098, 'support': 165}, '9': {'precision': 0.7916666666666666, 'recall': 0.4578313253012048, 'f1-score': 0.5801526717557252, 'support': 83}, '10': {'precision': 0.8125, 'recall': 0.9285714285714286, 'f1-score': 0.8666666666666666, 'support': 14}, '11': {'precision': 0.7906976744186046, 'recall': 0.8947368421052632, 'f1-score': 0.8395061728395061, 'support': 38}, '12': {'precision': 0.0, 'recall': 0.0, 'f1-score': 0.0, 'support': 10}, 'micro avg': {'precision': 0.8026124818577649, 'recall': 0.79, 'f1-score': 0.7962562994960404, 'support': 1400}, 'macro avg': {'precision': 0.745509563248548, 'recall': 0.727585093677263, 'f1-score': 0.7300905451922647, 'support': 1400}, 'weighted avg': {'precision': 0.8028467849489616, 'recall': 0.79, 'f1-score': 0.7912366049748025, 'support': 1400}, 'samples avg': {'precision': 0.79, 'recall': 0.79, 'f1-score': 0.79, 'support': 1400}}
Training Finished
+ wait
